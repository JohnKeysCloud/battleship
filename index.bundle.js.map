{"version":3,"file":"index.bundle.js","mappings":"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","sources":["webpack://battleship/./src/typescript/utilities/random-utilities.ts","webpack://battleship/./src/typescript/types/logic-types.ts","webpack://battleship/./src/typescript/types/type-guards.ts","webpack://battleship/./src/typescript/setup/randomize-bs-gameboard.ts","webpack://battleship/./src/typescript/logic/bs-ship-builder/bs-ship-builder.ts","webpack://battleship/./src/typescript/logic/bs-fleet-builder/bs-fleet-builder.ts","webpack://battleship/./src/typescript/logic/bs-gameboard-builder/bs-gameboard-builder.ts","webpack://battleship/./src/typescript/utilities/logic-utilities.ts","webpack://battleship/./src/typescript/logic/bs-gameboard-controller/bs-gameboard-controller.ts","webpack://battleship/./src/typescript/logic/bs-gameboard-controller/abstracted-method-callbacks/get-valid-ship-positions/get-valid-ship-positions.ts","webpack://battleship/./src/typescript/logic/bs-gameboard-controller/abstracted-method-callbacks/place-ship/place-ship.ts","webpack://battleship/./src/typescript/logic/bs-gameboard-repository/bs-gameboard-repository.ts","webpack://battleship/./src/typescript/state/player-state.ts","webpack://battleship/./src/typescript/utilities/cycloneLightbox.ts/cyclone-lightbox.ts","webpack://battleship/./src/typescript/utilities/create-github-link.ts","webpack://battleship/./src/typescript/markup/main/main-container-one/main-one-parabellum.ts","webpack://battleship/./src/typescript/markup/main/main-container-one/main-one-bellum.ts","webpack://battleship/./src/typescript/markup/main/main-container-one/main-one-post-bellum.ts","webpack://battleship/./src/typescript/utilities/cycloneHotSwapContainer.ts","webpack://battleship/./src/typescript/types/state-types.ts","webpack://battleship/./src/typescript/markup/components/gameboard-component/player-gameboard-component/player-gameboard-component.ts","webpack://battleship/./src/typescript/markup/components/gameboard-component/opponent-gameboard-component/opponent-gameboard-component.ts","webpack://battleship/./src/typescript/markup/main/main-container-two/main-container-two.ts","webpack://battleship/./src/typescript/markup/components/buttons/ship-shuffler-component/ship-shuffler-component.ts","webpack://battleship/./src/typescript/markup/components/buttons/ready-up-component/ready-up-component.ts","webpack://battleship/./src/typescript/markup/main/main-container-three/main-three-parabellum.ts","webpack://battleship/./src/typescript/markup/main/main-container-three/main-three-bellum.ts","webpack://battleship/./src/typescript/markup/main/main-container-three/main-three-post-bellum.ts","webpack://battleship/./src/typescript/markup/components/buttons/instructions-component/instructions-component.ts","webpack://battleship/./src/typescript/markup/main/main-component.ts","webpack://battleship/./src/typescript/markup/main/main-container-one/main-container-one.ts","webpack://battleship/./src/typescript/markup/main/main-container-three/main-container-three.ts","webpack://battleship/./src/typescript/markup/components/instructions-dialog-component/instructions-dialog-component.ts","webpack://battleship/./src/typescript/utilities/cycloneSitRepScroller.ts/cyclone-sit-rep-scroller.ts","webpack://battleship/./src/typescript/meta/dom-controller.ts","webpack://battleship/./src/typescript/markup/header/header.ts","webpack://battleship/./src/typescript/markup/header/nav/nav.ts","webpack://battleship/./src/typescript/state/game-state.ts","webpack://battleship/./src/typescript/utilities/event-bus.ts","webpack://battleship/./src/typescript/services/billow.ts","webpack://battleship/./src/app.ts","webpack://battleship/./src/typescript/meta/init/randomize-gameboard.ts"],"sourcesContent":["export const areArraysEqual = <T>(arrayOne: T[], arrayTwo: T[]) =>\n  arrayOne.length === arrayTwo.length\n  &&\n  arrayOne.every((value, index) => value === arrayTwo[index]);\n\nexport const capitalize = (str: string) => str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n\nexport const delay = (ms: number): Promise<void> => {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n};\n\nexport const getConvertedTypeFromAttr = <T extends string>(\n  element: HTMLElement,\n  attribute: string,\n  typeGuard: (value: string) => value is T\n): T => {\n  const attrValue = element.getAttribute(attribute);\n  if (!attrValue || !typeGuard(attrValue)) {\n    throw new Error(`Invalid or missing attribute: ${attribute}`);\n  }\n  return attrValue;\n};\n\nexport const getRandomInt = (min: number, max: number): number =>\n  Math.floor(Math.random() * (max - min + 1)) + min;\n\nexport const isEmptyObject = (obj: Record<PropertyKey, unknown>): boolean => {\n  return (\n    Object.keys(obj).length === 0 &&\n    Object.getOwnPropertySymbols(obj).length === 0\n  );\n};\n\nexport const createElement = <K extends keyof HTMLElementTagNameMap>(\n  tag: K,\n  classes: string[] = [],\n  attributes: Record<string, string> = {}\n): HTMLElementTagNameMap[K] => {\n  const element: HTMLElementTagNameMap[K] = document.createElement(tag);\n  classes.forEach((cls) => element.classList.add(cls));\n  Object.entries(attributes).forEach(([key, value]) =>\n    element.setAttribute(key, value)\n  );\n  return element;\n};\n\nexport const generateListFragment = (\n  listItemTextContentArray: { textContent: string }[],\n  identifier: string,\n  attributes: Record<string, string> = {}\n): DocumentFragment => {\n  if (!listItemTextContentArray.length)\n    throw new Error('The listItemTextContentArray is empty.');\n\n  if (!identifier) throw new Error('You must identify your list items.');\n\n  const listFragment = new DocumentFragment();\n\n  listItemTextContentArray.forEach((listItem, index) => {\n    const listElement: HTMLLIElement = createElement(\n      'li',\n      [`${identifier}-list-item`],\n      {\n        id: `${identifier}-list-item-${++index}`,\n        ...attributes,\n      }\n    );\n    listElement.textContent = listItem.textContent;\n\n    listFragment.appendChild(listElement);\n  });\n  \n  return listFragment;\n};\n\nexport const waitForAnimationEnd = (element: HTMLElement): Promise<void> => {\n  return new Promise((resolve) => {\n    const handler = () => {\n      element.removeEventListener('animationend', handler);\n      resolve();\n    };\n    element.addEventListener('animationend', handler);\n  });\n}\nexport const waitForTransitionEnd = (\n  element: HTMLElement,\n  timeout = 1000, // ? make timeout value slightly longer than the longest transition duration\n  expectedCount?: number, // ? optional number of transitionend events to wait for (e.g., for nested transitions)\n  callback?: () => void // ? optional callback, same as `if (callback) callback();`\n): Promise<void> => {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let transitionCount = 0;\n\n    const cleanup = () => {\n      if (!resolved) {\n        resolved = true;\n        element.removeEventListener('transitionend', handler);\n        clearTimeout(timer); // clear fallback timeout once resolved\n        resolve();\n        callback?.();\n      }\n    };\n\n    const handler = (event: TransitionEvent) => {\n      // ? If expecting multiple transitions, count until expectedCount is met\n      if (expectedCount !== undefined && expectedCount > 0) {\n        transitionCount++;\n        if (transitionCount >= expectedCount) {\n          cleanup();\n        }\n        return;\n      }\n\n      // ? Only resolve if transition event is on the element itself\n      if (event.target === element) {\n        cleanup();\n      }\n    };\n\n    element.addEventListener('transitionend', handler);\n\n    // Fallback timeout if `transitionend` event doesn't fire\n    const timer = setTimeout(() => {\n      cleanup();\n    }, timeout);\n  });\n};\nexport const waitForEvent = <K extends keyof HTMLElementEventMap>(\n  element: HTMLElement,\n  eventType: K,\n  callback?: () => void\n): Promise<HTMLElementEventMap[K]> => {\n  return new Promise((resolve) => {\n    const handler = (event: HTMLElementEventMap[K]) => {\n      element.removeEventListener(eventType, handler as EventListener);\n      resolve(event);\n      if (callback) callback();\n    };\n    element.addEventListener(eventType, handler as EventListener);\n  });\n};\n\nexport type Range<\n  N extends number,\n  Acc extends number[] = []\n> = Acc['length'] extends N ? Acc[number] : Range<N, [...Acc, Acc['length']]>;","import { BattleshipFleetBuilder } from '../logic/bs-fleet-builder/bs-fleet-builder';\nimport { BattleshipBoardBuilder } from '../logic/bs-gameboard-builder/bs-gameboard-builder';\nimport { BattleshipBoardController } from '../logic/bs-gameboard-controller/bs-gameboard-controller';\nimport { BattleshipBoardRepository } from '../logic/bs-gameboard-repository/bs-gameboard-repository';\nimport {\n  BattleshipBuilder,\n  SHIP_SYMBOLS\n} from '../logic/bs-ship-builder/bs-ship-builder';\nimport { PlayerState } from './state-types';\n\n//  --------------------------------------------------------------\n//  Enumerations\n\nexport enum AnglesOfRotation {\n  Degrees0 = 0,\n  Degrees90 = 90,\n  Degrees180 = 180,\n  Degrees270 = 270\n};\nexport enum ShipType {\n  Battleship = 'battleship',\n  Carrier = 'carrier',\n  Cruiser = 'cruiser',\n  Destroyer = 'destroyer',\n  PatrolBoat = 'patrolBoat',\n  Submarine = 'submarine',\n};\n\n//  --------------------------------------------------------------\n//  Types\n\nexport type AngleOfRotation = null | AnglesOfRotation;\nexport type AxisArrayKey = `row-${number}` | `column-${number}`;\nexport type Coordinates = [number, number];\nexport type CoordinatesArray = Coordinates[];\nexport type CoordinatesToString = `[${number}, ${number}]`;\nexport type OccupiedCoordinatesSet = Set<CoordinatesToString> | null;\nexport type Fleet = {\n  [key in ShipType]?: BattleshipBuilder;\n};\nexport type FleetConfigs = {\n  [key in ShipType]?: ShipConfig;\n};\nexport type FleetCoordinates = {\n  [key in ShipType]?: OccupiedCoordinatesSet | null;\n};\n\nexport type InBoundRotationalPlacePieceParamsForFleet = {\n  [key in ShipType]?: RotationalPositionMap | null;\n};\nexport type Gameboard = symbol[][];\nexport type OutOfBounds = 'outOfBounds';\nexport type Orientation = 'horizontal' | 'vertical';\nexport type PositionArray = IPosition[];\nexport type RotatedCoordinatesValue = Coordinates | OutOfBounds;\nexport type RotatedPlacePieceParams = {\n  [Key in AnglesOfRotation]?: RotatedPlacePieceParamsValue;\n};\nexport type RotatedPlacePieceParamsValue = IPlacePieceParams | OutOfBounds;\nexport type RotatedPlacePieceConfigurations = IPlacePieceParams | OutOfBounds;\nexport type ShipConfig = {\n  type: ShipType;\n  version?: FleetVersion;\n};\nexport type ShipLength = 2 | 3 | 4 | 5;\nexport type ShipSymbols = {\n  [key in ShipType]: symbol; // Each key in ShipType maps to a symbol\n};\nexport type ShipSymbolDescription = 'CA' | 'BS' | 'CR' | 'SB' | 'DD' | 'PB';\nexport type ShipSymbolValueArray = ShipSymbolValue[];\nexport type ShipSymbolValue = typeof SHIP_SYMBOLS[ShipType];\nexport type SizeLookupKey = `${ShipType}-${FleetVersion}`;\nexport type RotationalPositionMap = Map<AnglesOfRotation, IPlacePieceParams>;\nexport type FleetVersion = 1990 | 2002;\n\n//  --------------------------------------------------------------\n//  Interfaces\n\ninterface IGridGameboard<T> {\n  readonly board: T[][];\n  fillValue: T;\n};\nexport interface IGridGameboardSquare<T> extends IGridGameboard<T> {\n  boardSize: number;\n};\nexport interface IBattlehipFleetBuilderSet {\n  playerOneFleetBuilder: BattleshipFleetBuilder;\n  playerTwoFleetBuilder: BattleshipFleetBuilder;\n}\nexport interface IBattleshipGameboardBuilderSet {\n  playerOneBoardBuilder: BattleshipBoardBuilder;\n  playerTwoBoardBuilder: BattleshipBoardBuilder;\n}\nexport interface IBattleshipFleetBuilderSet {\n  playerOneFleetBuilder: BattleshipFleetBuilder;\n  playerTwoFleetBuilder: BattleshipFleetBuilder;\n}\nexport interface IBattleshipGameboardController extends IGridGameboardController {\n  playerState: Omit<PlayerState, 'gameboardController' | 'fleetBuilder'>;\n  getValidPositions(\n    shipPlacementConfigs: IShipPlacementConfigurations\n  ): IValidPositionsResult;\n  movePiece(ship: BattleshipBuilder, newBowCoordinates: Coordinates): void;\n  placePiece(options: IPlacePieceWrapperParams): void;\n  prettyPrint(): void;\n  removePiece(ship: BattleshipBuilder, resetInitialConfigs: boolean): void;\n  removeAllPieces(fleet: Fleet): void;\n  rotatePiece(ship: BattleshipBuilder): void;\n}\nexport interface IBattleshipGameboardControllerSet {\n  playerOneBoardController: BattleshipBoardController;\n  playerTwoBoardController: BattleshipBoardController;\n}\nexport interface IBattleshipGameboardRepositorySet {\n  playerOneBoardRepository: BattleshipBoardRepository;\n  playerTwoBoardRepository: BattleshipBoardRepository;\n}\ninterface IGridGameboardController {\n  placePiece(...args: any): void;\n  removePiece(...args: any): void;\n  removeAllPieces(...args: any): void;\n}\nexport interface IPlacementConfigurations {\n  coordinatesArray: CoordinatesArray | null;\n  orientation: Orientation | null;\n};\nexport interface IRotationalPivotConfigurations extends IPlacementConfigurations {\n  transientAngleOfRotation: AngleOfRotation;\n};\nexport interface IPlacePieceParams {\n  coordinates: Coordinates;\n  orientation: Orientation;\n};\nexport interface IPlacePieceWrapperParams extends IPlacePieceParams {\n  ship: BattleshipBuilder;\n};\nexport interface IPlacePieceCallbackParams extends IPlacePieceWrapperParams {\n  battleshipBoardBuilder: BattleshipBoardBuilder\n  battleshipBoardController: BattleshipBoardController;\n  battleshipBoardRepository: BattleshipBoardRepository;\n};\nexport interface IPosition {\n  bow: Coordinates; // [rowIndex, colIndex]\n  stern: Coordinates; // [rowIndex, colIndex]\n};\nexport interface IShipOptions {\n  hitCounter: number;\n  length: ShipLength;\n  type: ShipType;\n  version: FleetVersion;\n};\nexport interface IShipPlacementConfigurations {\n  orientation: Orientation;\n  shipLength: ShipLength;\n};\nexport interface ITestCaseShipHit {\n  expected: string; // Expected output\n  hits: number; // Function returning the string to be tested\n};\nexport interface ITestCaseValidPositions {\n  shipPlacementConfigs: IShipPlacementConfigurations;\n  validPositions: IValidPositionsResult;\n};\nexport interface IValidPlacementCallbackParams extends IShipPlacementConfigurations {\n  battleshipBoardBuilder: BattleshipBoardBuilder;\n  battleshipBoardController: BattleshipBoardController;\n};\nexport interface IValidPositionsResult {\n  [key: AxisArrayKey]: PositionArray;\n};","import {\n  AnglesOfRotation,\n  Coordinates,\n  OccupiedCoordinatesSet,\n  CoordinatesToString,\n  FleetCoordinates,\n  IPlacePieceParams,\n  IPosition,\n  Orientation,\n  OutOfBounds,\n  RotatedCoordinatesValue,\n  ShipLength,\n  ShipType,\n  PositionArray,\n  ShipSymbolDescription,\n} from '../types/logic-types';\nimport { PlayerType } from '../types/state-types';\n\nexport const isAngleOfRotation = (value: unknown): value is AnglesOfRotation => {\n  return Object.values(AnglesOfRotation).includes(value as ShipType);\n}\nexport const isCoordinates = (value: unknown): value is Coordinates => {\n  if (!Array.isArray(value) || value.length !== 2) return false;\n\n  return value.every((coordinate) => typeof coordinate === 'number');\n};\nexport const isOccupiedCoordinatesSet = (\n  value: unknown\n): value is OccupiedCoordinatesSet => {\n  if (value === null) return true;\n  if (!(value instanceof Set)) return false;\n\n  for (const member of value) {\n    if (!isCoordinatesToString(member)) {\n      return false;\n    }\n  }\n\n  return true;\n};\nexport const isFleetCoordinates = (\n  value: unknown\n): value is FleetCoordinates => {\n  if (typeof value !== 'object' || value === null) return false;\n\n  for (const key in value) {\n    if (!Object.values(ShipType).includes(key as ShipType)) {\n      return false;\n    }\n\n    const OccupiedCoordinatesSetOrNull = (value as FleetCoordinates)[\n      key as ShipType\n    ];\n\n    if (\n      OccupiedCoordinatesSetOrNull !== null &&\n      !isOccupiedCoordinatesSet(OccupiedCoordinatesSetOrNull)\n    ) {\n      return false;\n    }\n  }\n  return true;\n};\nexport const isPlainObject = (value: unknown): value is object => {\n  if (typeof value !== 'object' || value === null) return false;\n\n  const proto = Object.getPrototypeOf(value);\n  return proto === Object.prototype || proto === null;\n  // ? Why `proto === null`: Object.create(null) is a valid plain object.\n};\nexport const isOrientation = (value: unknown): value is Orientation => {\n  if (typeof value !== 'string') return false;\n  return ['horizontal', 'vertical'].includes(value);\n};\nexport const isOutOfBounds = (value: unknown): value is OutOfBounds => {\n  return value === 'outOfBounds';\n};\nexport const isPlacePieceParams = (\n  value: unknown\n): value is IPlacePieceParams => {\n  if (typeof value !== 'object' || value === null) return false;\n\n  if (!isCoordinates((value as IPlacePieceParams).coordinates)) return false;\n\n  return true;\n};\nexport const isPlayerType = (value: unknown): value is PlayerType => {\n  return (\n    typeof value === 'string' && (value === 'player' || value === 'opponent')\n  );\n};\nexport const isPosition = (value: unknown): value is IPosition => {\n  if (!isPlainObject(value)) return false;\n\n  const { bow, stern } = value as IPosition;\n\n  return isCoordinates(bow) && isCoordinates(stern);\n};\nexport const isPositionsArray = (value: unknown): value is PositionArray => {\n  if (!Array.isArray(value)) return false;\n\n  return value.every((position) => isPosition(position));\n};\nexport const isCoordinatesToString = (\n  value: unknown\n): value is CoordinatesToString => {\n  if (typeof value !== 'string') return false;\n\n  const match = value.match(/^\\[\\d{1}, \\d{1}\\]$/);\n  return match !== null;\n};\nexport const isRotatedCoordinatesValue = (\n  value: unknown\n): value is RotatedCoordinatesValue => {\n  return isCoordinates(value) || isOutOfBounds(value);\n};\nexport const isShipLength = (value: unknown): value is ShipLength => {\n  return typeof value === 'number' && [2, 3, 4, 5].includes(value);\n};\nexport const isShipSymbolDescription = (\n  value: unknown\n): value is ShipSymbolDescription => {\n  return (\n    typeof value === 'string' &&\n    ['CA', 'BS', 'CR', 'SB', 'DD', 'PB'].includes(value)\n  );\n};\nexport const isShipType = (value: unknown): value is ShipType => {\n  return Object.values(ShipType).includes(value as ShipType);\n};","import {\n  Coordinates,\n  Fleet,\n  IPlacePieceWrapperParams,\n  IShipPlacementConfigurations,\n  Orientation,\n  IPosition,\n  PositionArray,\n  AxisArrayKey,\n} from '../types/logic-types';\nimport {\n  areArraysEqual,\n  getRandomInt,\n} from '../utilities/random-utilities';\nimport { BattleshipBuilder } from '../logic/bs-ship-builder/bs-ship-builder';\nimport { BattleshipBoardController } from '../logic/bs-gameboard-controller/bs-gameboard-controller';\nimport { isShipType } from '../types/type-guards';\n\nexport function randomizeBSGameboard(\n  gameboardController: BattleshipBoardController, fleet: Fleet\n) {\n  if (!gameboardController)\n    throw new Error('Invalid Command: `gameboardController` is required to randomize the gameboard.');\n  if (!fleet)\n    throw new Error('Invalid Command: `fleet` is required to randomize the gameboard.');\n\n  const generateRandomCoordinates = (\n    shipLength: number,\n    boardSize: number\n  ): Coordinates => {\n    const max: number = boardSize - shipLength;\n    const xRandom: number = getRandomInt(0, max);\n    const yRandom: number = getRandomInt(0, max);\n\n    return [xRandom, yRandom];\n  };\n  const generateRandomOrientation = (): Orientation => {\n    return Math.random() < 0.5 ? 'horizontal' : 'vertical';\n  };\n  const areCoordinatesValid = (\n    coordinates: Coordinates,\n    ship: BattleshipBuilder,\n    orientation: Orientation\n  ): boolean => {\n    const validPositionsParams: IShipPlacementConfigurations = {\n      shipLength: ship.length,\n      orientation,\n    };\n\n    const validPositions =\n      gameboardController.getValidPositions(validPositionsParams);\n    const [bowX, bowY]: Coordinates = coordinates;\n    const isHorizontal: boolean = orientation === 'horizontal';\n    const axisIndex: number = isHorizontal ? bowY : bowX;\n\n    const axisArrayKey: AxisArrayKey = isHorizontal\n      ? `row-${axisIndex}`\n      : `column-${axisIndex}`;\n    const axisArray: PositionArray = validPositions[axisArrayKey];\n\n    return axisArray.some((position: IPosition) =>\n      areArraysEqual(position.bow, coordinates)\n    );\n  }; \n  const getValidCoordinatesRecursively = (\n    ship: BattleshipBuilder,\n    orientation: Orientation,\n    boardSize: number,\n    attempts: number = 0\n  ): Coordinates => {\n    if (attempts > 100)\n      throw new Error(`Max recursion depth exceeded when placing the ${ship.type}.`);\n\n    const coordinates: Coordinates = generateRandomCoordinates(\n      ship.length,\n      boardSize\n    );\n\n    return areCoordinatesValid(coordinates, ship, orientation)\n      ? coordinates\n      : getValidCoordinatesRecursively(\n          ship,\n          orientation,\n          boardSize,\n          attempts + 1\n        )\n  };\n\n  const boardSize: number = 10;\n\n  for (const shipType in fleet) {\n    if (!isShipType(shipType)) throw new Error(`Invalid Type: \"${shipType}\" doesn't conform to \"ShipType\".`);\n\n    const ship: BattleshipBuilder = fleet[shipType]!;\n    const randomOrientation: Orientation = generateRandomOrientation();\n\n    const coordinates: Coordinates = getValidCoordinatesRecursively(\n      ship,\n      randomOrientation,\n      boardSize\n    );\n\n    const placePieceParams: IPlacePieceWrapperParams = {\n      ship,\n      coordinates,\n      orientation: randomOrientation,\n    };\n    \n    gameboardController.placePiece(placePieceParams);\n  }\n}\n","import {\n  IPlacementConfigurations,\n  IRotationalPivotConfigurations,\n  IShipOptions,\n  ShipLength,\n  ShipSymbols,\n  ShipSymbolValue,\n  ShipType,\n  SizeLookupKey,\n  FleetVersion\n} from '../../types/logic-types';\n\nexport const SHIP_SYMBOLS: ShipSymbols = {\n  [ShipType.Carrier]: Symbol('CA'),\n  [ShipType.Battleship]: Symbol('BS'),\n  [ShipType.Cruiser]: Symbol('CR'),\n  [ShipType.Submarine]: Symbol('SB'),\n  [ShipType.Destroyer]: Symbol('DD'),\n  [ShipType.PatrolBoat]: Symbol('PB')\n} as const;\n\nconst sizeLookup: Record<SizeLookupKey, ShipLength | undefined> = {\n  'battleship-1990': 4,\n  'battleship-2002': 4,\n  'carrier-1990': 5,\n  'carrier-2002': 5,\n  'cruiser-1990': 3,\n  'cruiser-2002': undefined, // Explicitly mark missing values\n  'destroyer-1990': 2,\n  'destroyer-2002': 3,\n  'patrolBoat-1990': undefined,\n  'patrolBoat-2002': 2,\n  'submarine-1990': 3,\n  'submarine-2002': 3,\n};\n\nexport class BattleshipBuilder implements IShipOptions {\n  public readonly length: ShipLength;\n  public readonly seaworthy: boolean = true;\n  public readonly symbol: ShipSymbolValue;\n  public rotationalPivotConfigurations: IRotationalPivotConfigurations = {\n    transientAngleOfRotation: null,\n    coordinatesArray: null,\n    orientation: null\n  };\n  public currentplacementConfigurations: IPlacementConfigurations = {\n    coordinatesArray: null,\n    orientation: null\n  };\n  public isPlaced = (): boolean => this.currentplacementConfigurations.coordinatesArray !== null;\n  private _hitCounter: number = 0;\n\n  constructor(public readonly type: ShipType, public readonly version: FleetVersion = 2002) {\n    this.symbol = SHIP_SYMBOLS[type];\n\n    const key: SizeLookupKey = `${type}-${version}`;\n    const length: ShipLength | undefined = sizeLookup[key]; // Access using the typed key\n    if (length === undefined) {\n      throw new Error(`Invalid Command: ship type/version combination: ${key}.`);\n    }\n\n    this.length = length;\n  }\n\n  public hit = (): string => {\n    if (!this.isSeaworthy()) return 'This ship has already perished.';\n    \n    this._hitCounter++;\n    return `Hit registered. Hit count: ${this.hitCounter}.`; // Return the updated hit counter\n  };\n\n  isSeaworthy = (): boolean => this.hitCounter < this.length;\n\n  public resetConfigurations = (shouldResetShipRotationalData: boolean) => {\n    const placementConfigurations = { coordinatesArray: null, orientation: null };\n\n    this.currentplacementConfigurations = placementConfigurations;\n\n    if (shouldResetShipRotationalData === true) {\n      this.rotationalPivotConfigurations = {\n        ...placementConfigurations,\n        transientAngleOfRotation: null\n      };\n    }\n  };\n\n  public get hitCounter(): number {\n    return this._hitCounter;\n  }\n}","import {\n  Fleet,\n  FleetConfigs,\n  ShipType,\n  FleetVersion,\n} from '../../types/logic-types';\nimport {\n  BattleshipBuilder,\n} from '../bs-ship-builder/bs-ship-builder';\nimport { isShipType } from '../../types/type-guards';\n\nexport class BattleshipFleetBuilder {\n  private constructor(public readonly fleet: Fleet, public readonly version: FleetVersion) {}\n\n  private static createFleet(fleetConfigs: FleetConfigs): Fleet {\n    const fleet: Fleet = {};\n\n    for (const [shipType, config] of Object.entries(fleetConfigs)) {\n      if (config && isShipType(shipType)) {\n        fleet[shipType] = new BattleshipBuilder(config.type, config.version);\n      }\n    }\n\n    return fleet;\n  }\n\n  public static createHasbroFleet(): BattleshipFleetBuilder {\n    // 2002\n    return new BattleshipFleetBuilder(\n      BattleshipFleetBuilder.createFleet({\n        carrier: { type: ShipType.Carrier, version: 2002 },\n        battleship: { type: ShipType.Battleship, version: 2002 },\n        destroyer: { type: ShipType.Destroyer, version: 2002 },\n        submarine: { type: ShipType.Submarine, version: 2002 },\n        patrolBoat: { type: ShipType.PatrolBoat, version: 2002 },\n      }),\n      2002\n    );\n  }\n\n  public static createMBFleet(): BattleshipFleetBuilder {\n    // 1990\n    return new BattleshipFleetBuilder(\n      BattleshipFleetBuilder.createFleet({\n        carrier: { type: ShipType.Carrier, version: 1990 },\n        battleship: { type: ShipType.Battleship, version: 1990 },\n        cruiser: { type: ShipType.Cruiser, version: 1990 },\n        submarine: { type: ShipType.Submarine, version: 1990 },\n        destroyer: { type: ShipType.Destroyer, version: 1990 },\n      }),\n      1990\n    );\n  }\n\n  getShip(shipType: ShipType): BattleshipBuilder {\n    const ship = this.fleet[shipType];\n\n    if (!ship) {\n      throw new Error(\n        `Invalid Command: Ship of type ${shipType} not found in fleet.`\n      );\n    }\n\n    return ship;\n  }\n}","import {\n  Gameboard,\n  IGridGameboardSquare,\n} from '../../types/logic-types';\n\nexport class BattleshipBoardBuilder implements IGridGameboardSquare<symbol> {\n  private static readonly vacant: symbol = Symbol('VC');\n\n  private readonly _board: Gameboard;\n  private readonly _boardSize: number = 10;\n  private readonly _fillValue: symbol = BattleshipBoardBuilder.vacant;\n\n  constructor() {\n    this._board = Array.from({ length: this._boardSize }, () =>\n      Array(this._boardSize).fill(this._fillValue)\n    );\n  }\n\n  public get board(): Gameboard {\n    return this._board;\n  }\n\n  public get boardSize(): number {\n    return this._boardSize;\n  }\n\n  public get fillValue(): symbol {\n    return this._fillValue;\n  }\n}","import {\n  AxisArrayKey,\n  Coordinates,\n  IPosition,\n  IShipPlacementConfigurations,\n  Orientation,\n  ShipLength,\n} from \"../types/logic-types\";\nimport { areArraysEqual } from \"./random-utilities\";\n\n//  --------------------------------------------------------------\n\n// * GENERAL HELPER FUNCTIONS\nexport function createAxisArrayKey(\n  axisIndex: number,\n  isHorizontal: boolean\n): AxisArrayKey {\n  return isHorizontal ? `row-${axisIndex}` : `column-${axisIndex}`;\n}\nexport function createPositionObject(\n  [x, y]: Coordinates,\n  orientation: Orientation,\n  shipLength: ShipLength\n): IPosition {\n  const isHorizontal = orientation === 'horizontal';\n  const bowCoordinates: Coordinates = [x, y];\n  const sternCoordinates: Coordinates = isHorizontal\n    ? [x + shipLength - 1, y]\n    : [x, y + shipLength - 1];\n\n  return {\n    bow: bowCoordinates,\n    stern: sternCoordinates,\n  };\n}\nexport function createShipConfigurations(\n  shipLength: ShipLength,\n  orientation: Orientation\n): IShipPlacementConfigurations {\n  return {\n    orientation,\n    shipLength,\n  };\n}\n\n//  --------------------------------------------------------------\n\n// * BOUND CHECK HELPER FUNCTIONS\nexport const isCoordinateInBounds = (coordinate: number, boardSize: number): boolean =>\n  coordinate >= 0 && coordinate < boardSize;\nexport const areCoordinatesInBounds = (coordinates: Coordinates, boardSize: number): boolean => {\n  return coordinates.every((coordinate) => isCoordinateInBounds(coordinate, boardSize)); \n}\nexport const isPositionInBounds = (position: IPosition, boardSize: number): boolean => {\n  return areCoordinatesInBounds(position.bow, boardSize) && areCoordinatesInBounds(position.stern, boardSize);\n};\n\n//  --------------------------------------------------------------\n\n// * UTILITY FUNCTIONS\nexport const arePositionsEqual = (\n  positionOne: IPosition,\n  positionTwo: IPosition\n): boolean => {\n  return (\n    areArraysEqual(positionOne.bow, positionTwo.bow) &&\n    areArraysEqual(positionOne.stern, positionTwo.stern)\n  );\n};\n\n//  --------------------------------------------------------------\n\nexport const isNotNull = <T>(value: T | null | undefined): value is T => {\n  return value !== null && value !== undefined;\n}","import { BattleshipBuilder } from '../bs-ship-builder/bs-ship-builder';\nimport {\n  AngleOfRotation,\n  AnglesOfRotation,\n  AxisArrayKey,\n  Coordinates,\n  CoordinatesArray,\n  Fleet,\n  IBattleshipGameboardController,\n  IPlacePieceCallbackParams,\n  IPlacePieceParams,\n  IPlacePieceWrapperParams,\n  IPosition,\n  IShipPlacementConfigurations,\n  IValidPlacementCallbackParams,\n  IValidPositionsResult,\n  Orientation,\n  RotatedCoordinatesValue,\n  RotatedPlacePieceParams,\n  RotatedPlacePieceParamsValue,\n  ShipLength,\n  ShipType,\n  RotationalPositionMap,\n  PositionArray,\n  ShipSymbolValue,\n  ShipSymbolDescription,\n} from '../../types/logic-types';\nimport { AttackResult, PlayerState } from '../../types/state-types';\nimport {\n  areCoordinatesInBounds,\n  arePositionsEqual,\n  createAxisArrayKey,\n  createPositionObject,\n  isPositionInBounds,\n} from '../../utilities/logic-utilities';\nimport {\n  isAngleOfRotation,\n  isOutOfBounds,\n  isPlacePieceParams,\n  isPositionsArray,\n  isShipSymbolDescription,\n  isShipType,\n} from '../../types/type-guards';\nimport { getValidShipPositions } from './abstracted-method-callbacks/get-valid-ship-positions/get-valid-ship-positions';\nimport { placeShip } from './abstracted-method-callbacks/place-ship/place-ship';\n\nexport class BattleshipBoardController implements IBattleshipGameboardController {\n  constructor(\n    public readonly playerState: Omit<PlayerState, 'gameboardController'>\n  ) {}\n\n  //  --------------------------------------------------------------\n  //  Public\n\n  public getValidPositions({\n    orientation,\n    shipLength,\n  }: IShipPlacementConfigurations): IValidPositionsResult {\n    const validPlacementArg: IValidPlacementCallbackParams = {\n      orientation,\n      shipLength,\n      battleshipBoardBuilder: this.playerState.gameboardBuilder,\n      battleshipBoardController: this,\n    };\n\n    return getValidShipPositions(validPlacementArg);\n  }\n\n  public getAllValidBowCoordinates(\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): Set<Coordinates> {\n    let allValidBowCoordinates: Set<Coordinates> = new Set();\n    const validPositions: IValidPositionsResult = this.getValidPositions({\n      orientation,\n      shipLength,\n    });\n\n    for (const positionsInAxis of Object.values(validPositions)) {\n      if (!isPositionsArray(positionsInAxis))\n        throw new Error(\n          `Expected each value of validPositions to be an array of IPosition objects, but received: ${typeof positionsInAxis}.`\n        );\n\n      positionsInAxis.forEach((position) =>\n        allValidBowCoordinates.add(position.bow)\n      );\n    }\n\n    return allValidBowCoordinates;\n  }\n\n  public movePiece(\n    ship: BattleshipBuilder,\n    newBowCoordinates: Coordinates\n  ): void {\n    if (!ship.isPlaced()) {\n      console.warn(`Invalid Command: The ${ship.type} has not been placed.`);\n      return;\n    }\n\n    const currentOrientation: Orientation =\n      ship.currentplacementConfigurations.orientation!;\n\n    const newPosition: IPosition = createPositionObject(\n      newBowCoordinates,\n      currentOrientation,\n      ship.length\n    );\n\n    if (\n      !isPositionInBounds(\n        newPosition,\n        this.playerState.gameboardBuilder.boardSize\n      )\n    ) {\n      console.warn(\n        `Invalid Command: Position - Bow: [${newPosition.bow}] & Stern: [${newPosition.stern}] is out of bounds for the ${ship.type}.`\n      );\n\n      return;\n    }\n\n    const validPositions: IValidPositionsResult = this.getValidPositions({\n      orientation: currentOrientation,\n      shipLength: ship.length,\n    });\n\n    const isHorizontal: boolean = currentOrientation === 'horizontal';\n    const [x, y]: Coordinates = newBowCoordinates;\n    const axisArrayKey: AxisArrayKey = createAxisArrayKey(\n      isHorizontal ? y : x,\n      isHorizontal\n    );\n\n    const axisArray: PositionArray = validPositions[axisArrayKey];\n\n    const isNewPositionValid: boolean = axisArray.some(\n      (position: IPosition): boolean => arePositionsEqual(position, newPosition)\n    );\n\n    if (isNewPositionValid) {\n      const placementParameters: IPlacePieceWrapperParams = {\n        ship,\n        coordinates: newBowCoordinates,\n        orientation: currentOrientation,\n      };\n      const shouldResetShipRotationalData: boolean = true;\n\n      this.relocateShip(\n        ship,\n        placementParameters,\n        shouldResetShipRotationalData\n      );\n    } else {\n      console.warn(\n        `Invalid Command: Position - Bow: [${newPosition.bow}] & Stern: [${newPosition.stern}] is unavailable for the ${ship.type}.`\n      );\n    }\n  }\n\n  public placePiece({\n    ship,\n    coordinates,\n    orientation,\n  }: IPlacePieceWrapperParams): void {\n    const placeShipArg: IPlacePieceCallbackParams = {\n      ship,\n      coordinates,\n      orientation,\n      battleshipBoardController: this,\n      battleshipBoardBuilder: this.playerState.gameboardBuilder,\n      battleshipBoardRepository: this.playerState.gameboardRepository,\n    };\n\n    placeShip(placeShipArg);\n\n    this.setFleetRotatedPlacePieceParams(this.playerState.fleetBuilder.fleet);\n  }\n\n  public prettyPrint(): void {\n    console.table(\n      this.playerState.gameboardBuilder.board.map((row) =>\n        row.map((symbol) =>\n          symbol.description === 'VC' ? null : symbol.description\n        )\n      )\n    );\n  }\n\n  public receiveAttack(coordinates: Coordinates): AttackResult {\n    const attackedShip = this.getShipAt(coordinates);\n    if (attackedShip === null) return { hit: false };\n\n    attackedShip.hit();\n\n    const attackResult: AttackResult = {\n      hit: true,\n      isSunk: !attackedShip.isSeaworthy(), \n      type: attackedShip.type,\n    };\n\n    if (!isShipType(attackResult.type)) throw new Error('Invalid ship type');\n\n    if (attackResult.hit && attackResult.isSunk) {\n      this.playerState.gameboardRepository.addSunkenShip(attackResult.type);\n    }\n\n    return attackResult;\n  }\n\n  public removePiece(\n    ship: BattleshipBuilder,\n    shouldResetShipRotationalData: boolean = true\n  ): void {\n    if (!this.isShipValidForRemoval(ship)) return;\n\n    const removeShipFromBoard = (shipCoordinates: CoordinatesArray): void => {\n      shipCoordinates.forEach(([x, y]) => {\n        this.playerState.gameboardBuilder.board[y][x] =\n          this.playerState.gameboardBuilder.fillValue;\n      });\n    };\n    const nullifyShipCoordinateSetValue = (shipType: ShipType): void => {\n      this.playerState.gameboardRepository.nullifyShipCoordinatesValue(\n        shipType\n      );\n    };\n    const resetShipConfigurations = (\n      ship: BattleshipBuilder,\n      shouldResetShipRotationalData: boolean\n    ): void => {\n      if (shouldResetShipRotationalData) {\n        this.playerState.gameboardRepository.nullifyShipValidRotationalParams(\n          ship.type\n        );\n      }\n\n      ship.resetConfigurations(shouldResetShipRotationalData);\n    };\n\n    const shipCoordinates: CoordinatesArray =\n      ship.currentplacementConfigurations.coordinatesArray!;\n\n    removeShipFromBoard(shipCoordinates);\n    nullifyShipCoordinateSetValue(ship.type);\n    resetShipConfigurations(ship, shouldResetShipRotationalData);\n  }\n\n  public removeAllPieces(fleet: Fleet): void {\n    if (!Object.keys(fleet).length) {\n      console.error(\n        'Invalid Command: No ships to remove - Fleet is empty or uninitialized.'\n      );\n      return;\n    }\n\n    for (const ship of Object.values(fleet)) {\n      this.removePiece(ship);\n    }\n  }\n\n  public rotatePiece(ship: BattleshipBuilder): void {\n    const getNextAngle = (\n      rotationalPositionMap: RotationalPositionMap,\n      currentAngle: AngleOfRotation\n    ): AngleOfRotation => {\n      if (currentAngle === null || currentAngle === undefined)\n        throw new Error(\"Current angle doesn't exist\");\n\n      const angles: AnglesOfRotation[] = Array.from(\n        rotationalPositionMap.keys()\n      );\n\n      return (\n        angles.find((angle) => angle > currentAngle) ??\n        AnglesOfRotation.Degrees0\n      );\n    };\n    const getMaxAngle = (\n      rotationalPositionMap: RotationalPositionMap\n    ): AngleOfRotation =>\n      Array.from(rotationalPositionMap.keys()).pop() ??\n      AnglesOfRotation.Degrees0;\n    const getNextPiecePlacementParams = (\n      ship: BattleshipBuilder,\n      rotationalPositionMap: RotationalPositionMap\n    ): IPlacePieceWrapperParams => {\n      const currentAngle: AngleOfRotation =\n        ship.rotationalPivotConfigurations.transientAngleOfRotation;\n\n      const maxAngle: AngleOfRotation = getMaxAngle(rotationalPositionMap);\n\n      if (currentAngle === maxAngle) {\n        const originalBowCoordinates: Coordinates =\n          ship.rotationalPivotConfigurations.coordinatesArray![0];\n        const originalOrientation: Orientation =\n          ship.rotationalPivotConfigurations.orientation!;\n\n        // set current degree of rotation\n        ship.rotationalPivotConfigurations.transientAngleOfRotation =\n          AnglesOfRotation.Degrees0;\n\n        return {\n          ship,\n          coordinates: originalBowCoordinates,\n          orientation: originalOrientation,\n        };\n      }\n\n      const nextAngle: AngleOfRotation = getNextAngle(\n        rotationalPositionMap,\n        currentAngle\n      );\n      const nextPlacePieceParams: IPlacePieceParams | undefined =\n        rotationalPositionMap.get(nextAngle!);\n\n      // set current degree of rotation\n      ship.rotationalPivotConfigurations.transientAngleOfRotation = nextAngle;\n\n      return {\n        ship,\n        coordinates: nextPlacePieceParams!.coordinates,\n        orientation: nextPlacePieceParams!.orientation,\n      };\n    };\n    const updateTransientPlacementParams = (\n      rotationalPositionMap: RotationalPositionMap\n    ): IPlacePieceWrapperParams => {\n      let nextPlacePieceParams: IPlacePieceWrapperParams =\n        getNextPiecePlacementParams(ship, rotationalPositionMap);\n\n      while (\n        ship.rotationalPivotConfigurations.transientAngleOfRotation !==\n        initialAngle\n      ) {\n        if (\n          this.isRotatedPositionValid(\n            nextPlacePieceParams.coordinates,\n            nextPlacePieceParams.orientation,\n            ship.rotationalPivotConfigurations.transientAngleOfRotation,\n            ship.length\n          )\n        ) {\n          break;\n        }\n        nextPlacePieceParams = getNextPiecePlacementParams(\n          ship,\n          rotationalPositionMap\n        );\n      }\n\n      return nextPlacePieceParams;\n    };\n\n    const rotationalPositionMap: RotationalPositionMap =\n      this.playerState.gameboardRepository.inBoundRotationalPlacePieceForFleet[\n        ship.type\n      ]!;\n\n    const initialAngle =\n      ship.rotationalPivotConfigurations.transientAngleOfRotation;\n\n    /* \n    \n     The coolest part of this whole transient concept is that it                  \n     allows me to name a variable `finalPlacePieceParams` which implies a         \n     predetermined value, with a function named `updateTransientPlacementParams` \n     which implies something transient while the semantic naming of the           \n    | key-value pair maintain sound logicality. I am intuit. -                   \n    \n    */\n\n    const finalPlacePieceParams: IPlacePieceWrapperParams =\n      updateTransientPlacementParams(rotationalPositionMap);\n\n    if (\n      ship.rotationalPivotConfigurations.transientAngleOfRotation ===\n      initialAngle\n    ) {\n      console.warn('No valid rotational position found.');\n      return;\n    }\n\n    const shouldResetShipRotationalData: boolean = false;\n\n    this.relocateShip(\n      ship,\n      finalPlacePieceParams,\n      shouldResetShipRotationalData\n    );\n  }\n\n  //  --------------------------------------------------------------\n  //  Private\n\n  private areCoordinatesVacant(coordinates: Coordinates): boolean {\n    const [x, y] = coordinates;\n    return (\n      this.playerState.gameboardBuilder.board[y][x] ===\n      this.playerState.gameboardBuilder.fillValue\n    );\n  }\n\n  private getShipAt(coordinates: Coordinates): BattleshipBuilder | null {\n    if (this.areCoordinatesVacant(coordinates)) return null;\n\n    const gameboard = this.playerState.gameboardBuilder.board;\n    const [x, y]: Coordinates = coordinates;\n\n    const shipSymbolValue: ShipSymbolValue = gameboard[y][x];\n    const shipType: ShipType = this.getShipTypeFromSymbol(shipSymbolValue);\n\n    const ship: BattleshipBuilder = this.playerState.fleetBuilder.getShip(shipType);\n\n    return ship;\n  }\n\n  private getShipTypeFromSymbol = (shipSymbol: ShipSymbolValue) => {\n    if (!isShipSymbolDescription(shipSymbol.description))\n      throw new Error('Invalid ship symbol description');\n    const shipSymbolDescription: ShipSymbolDescription = shipSymbol.description; // ? Create Type\n\n    switch (shipSymbolDescription) {\n      case 'CA':\n        return ShipType.Carrier;\n      case 'DD':\n        return ShipType.Destroyer;\n      case 'SB':\n        return ShipType.Submarine;\n      case 'BS':\n        return ShipType.Battleship;\n      case 'CR':\n        return ShipType.Cruiser;\n      case 'PB':\n        return ShipType.PatrolBoat;\n      default:\n        throw new Error(\n          'The symbol description does not return valid ship type.'\n        );\n    }\n  };\n\n  private isRotatedPositionValid = (\n    [x, y]: Coordinates,\n    orientation: Orientation,\n    angleOfRotation: AngleOfRotation,\n    shipLength: ShipLength\n  ): boolean => {\n    const isHorizontal = orientation === 'horizontal';\n    const gameboardSize = this.playerState.gameboardBuilder.boardSize;\n    const gameboard = this.playerState.gameboardBuilder.board;\n    const fillValue = this.playerState.gameboardBuilder.fillValue;\n    const newAxisIndexStart = isHorizontal ? x : y;\n\n    let i: number;\n    let axisIndexEnd: number;\n\n    if (\n      (!isHorizontal && angleOfRotation === AnglesOfRotation.Degrees90) ||\n      (isHorizontal && angleOfRotation === AnglesOfRotation.Degrees270) ||\n      angleOfRotation === AnglesOfRotation.Degrees0\n    ) {\n      i = 1;\n      axisIndexEnd = shipLength;\n    } else {\n      i = 0;\n      axisIndexEnd = shipLength - 1;\n    }\n\n    if (newAxisIndexStart + shipLength - 1 >= gameboardSize) return false;\n\n    for (i; i < axisIndexEnd; i++) {\n      const cellValue = isHorizontal\n        ? gameboard[y][x + i]\n        : gameboard[y + i][x];\n\n      if (cellValue !== fillValue) return false;\n    }\n\n    return true;\n  };\n\n  private getRotatedPlacePieceParams(ship: BattleshipBuilder) {\n    const applyOffsetToCoordinate = (\n      coordinate: number,\n      shipLength: ShipLength\n    ): number => {\n      const offset: number = shipLength - 1;\n      return coordinate - offset;\n    };\n    const determineRotatedOrientation = (\n      angleOfRotation: AngleOfRotation,\n      isHorizontal: boolean\n    ): Orientation => {\n      return isHorizontal\n        ? angleOfRotation === AnglesOfRotation.Degrees180\n          ? 'horizontal'\n          : 'vertical'\n        : angleOfRotation === AnglesOfRotation.Degrees180\n        ? 'vertical'\n        : 'horizontal';\n    };\n    const getRotatedBowCoordinates = (\n      angleOfRotation: AngleOfRotation,\n      isHorizontal: boolean,\n      [x, y]: Coordinates\n    ): RotatedCoordinatesValue => {\n      if (\n        angleOfRotation === AnglesOfRotation.Degrees0 ||\n        (angleOfRotation === AnglesOfRotation.Degrees90 && isHorizontal) ||\n        (angleOfRotation === AnglesOfRotation.Degrees270 && !isHorizontal)\n      ) {\n        return rotationalPivotBowCoordinates;\n      }\n\n      const rotatedBowCoordinates: Coordinates = isHorizontal\n        ? angleOfRotation === AnglesOfRotation.Degrees180\n          ? [applyOffsetToCoordinate(x, ship.length), y]\n          : [x, applyOffsetToCoordinate(y, ship.length)] // angleOfRotation === 270\n        : angleOfRotation === AnglesOfRotation.Degrees180\n        ? [x, applyOffsetToCoordinate(y, ship.length)]\n        : [applyOffsetToCoordinate(x, ship.length), y]; // angleOfRotation === 90\n\n      return areCoordinatesInBounds(\n        rotatedBowCoordinates,\n        this.playerState.gameboardBuilder.boardSize\n      )\n        ? rotatedBowCoordinates\n        : 'outOfBounds';\n    };\n    const createRotatedPiecePlacementParams = (\n      rotationalPivotBowCoordinates: Coordinates,\n      rotationalPivotOrientation: Orientation\n    ): RotatedPlacePieceParams => {\n      const isHorizontal = rotationalPivotOrientation === 'horizontal';\n\n      const rotatedPiecePlacementParams: RotatedPlacePieceParams = {};\n\n      const anglesOfRotation: AnglesOfRotation[] = [\n        AnglesOfRotation.Degrees0,\n        AnglesOfRotation.Degrees90,\n        AnglesOfRotation.Degrees180,\n        AnglesOfRotation.Degrees270,\n      ];\n\n      anglesOfRotation.forEach((angleOfRotation) => {\n        const coordinates: RotatedCoordinatesValue =\n          angleOfRotation === AnglesOfRotation.Degrees0\n            ? rotationalPivotBowCoordinates\n            : getRotatedBowCoordinates(\n                angleOfRotation,\n                isHorizontal,\n                rotationalPivotBowCoordinates\n              );\n\n        if (coordinates === 'outOfBounds') {\n          rotatedPiecePlacementParams[angleOfRotation] = 'outOfBounds';\n        } else {\n          rotatedPiecePlacementParams[angleOfRotation] = {\n            coordinates,\n            orientation:\n              angleOfRotation === AnglesOfRotation.Degrees0\n                ? rotationalPivotOrientation\n                : determineRotatedOrientation(angleOfRotation, isHorizontal),\n          };\n        }\n      });\n\n      return rotatedPiecePlacementParams;\n    };\n    const generateRotationalPositionMap = (\n      rotatedPiecePlacementParams: RotatedPlacePieceParams\n    ): RotationalPositionMap => {\n      const rotatedPlacePieceParams: RotationalPositionMap = new Map();\n\n      for (const angleOfRotationString of Object.keys(\n        rotatedPiecePlacementParams\n      )) {\n        const angleOfRotationToNum = +angleOfRotationString as AngleOfRotation;\n\n        if (!isAngleOfRotation(angleOfRotationToNum)) {\n          throw new Error(\n            `Invalid Type: \"${angleOfRotationString}\" doesn't conform to \"AngleOfRotation\".`\n          );\n        }\n\n        const rotatedPlacePieceParamsValue: RotatedPlacePieceParamsValue =\n          rotatedPiecePlacementParams[angleOfRotationToNum]!;\n\n        if (\n          !(\n            isPlacePieceParams(rotatedPlacePieceParamsValue) ||\n            isOutOfBounds(rotatedPlacePieceParamsValue)\n          )\n        ) {\n          throw new Error(\n            `Invalid Type: \"${rotatedPlacePieceParamsValue}\" doesn't conform to \"RotatedPlacePieceParams\".`\n          );\n        }\n\n        if (!isPlacePieceParams(rotatedPlacePieceParamsValue)) continue;\n\n        const { coordinates: bowCoordinates, orientation }: IPlacePieceParams =\n          rotatedPlacePieceParamsValue;\n\n        const placePieceParams: IPlacePieceParams = {\n          coordinates: bowCoordinates,\n          orientation,\n        };\n\n        rotatedPlacePieceParams.set(angleOfRotationToNum, placePieceParams);\n      }\n\n      return rotatedPlacePieceParams;\n    };\n\n    const rotationalPivotBowCoordinates: Coordinates =\n      ship.rotationalPivotConfigurations.coordinatesArray![0];\n    const rotationalPivotOrientation: Orientation =\n      ship.rotationalPivotConfigurations.orientation!;\n    const rotatedPiecePlacementParams: RotatedPlacePieceParams =\n      createRotatedPiecePlacementParams(\n        rotationalPivotBowCoordinates,\n        rotationalPivotOrientation\n      );\n\n    const rotatedPlacePieceParamsMap: RotationalPositionMap =\n      generateRotationalPositionMap(rotatedPiecePlacementParams);\n\n    return rotatedPlacePieceParamsMap;\n  }\n\n  private isShipValidForRemoval(ship: BattleshipBuilder): boolean {\n    if (\n      !ship.currentplacementConfigurations.coordinatesArray ||\n      !this.playerState.gameboardRepository.isShipPlaced(ship.type)\n    ) {\n      console.error(\n        `Error removing ship: ${ship.type} is missing coordinates or not in the fleet.`\n      );\n      return false;\n    }\n\n    return true;\n  }\n\n  private relocateShip(\n    ship: BattleshipBuilder,\n    placementParameters: IPlacePieceWrapperParams,\n    shouldResetShipRotationalData: boolean\n  ): void {\n    this.removePiece(ship, shouldResetShipRotationalData);\n    this.placePiece(placementParameters);\n  }\n\n  private setFleetRotatedPlacePieceParams(fleet: Fleet): void {\n    for (const ship of Object.values(fleet)) {\n      if (ship.isPlaced()) this.setShipRotatedPlacePieceParams(ship);\n    }\n  }\n\n  private setShipRotatedPlacePieceParams(ship: BattleshipBuilder): void {\n    const rotatedPlacePieceParams: RotationalPositionMap =\n      this.getRotatedPlacePieceParams(ship);\n\n    this.playerState.gameboardRepository.setShipValidRotationalParams(\n      ship,\n      rotatedPlacePieceParams\n    );\n  }\n}\n","import {\n  AxisArrayKey,\n  Coordinates,\n  Gameboard,\n  IValidPlacementCallbackParams,\n  IValidPositionsResult,\n  Orientation,\n  PositionArray,\n  ShipLength,\n} from '../../../../types/logic-types';\n\nexport function getValidShipPositions({\n  shipLength,\n  orientation,\n  battleshipBoardBuilder\n}: IValidPlacementCallbackParams): IValidPositionsResult {\n  const extractAxisArray = (\n    axisIndex: number,\n    orientation: Orientation,\n    gameboard: Gameboard\n  ): Array<symbol> => { // or symbol[]\n    \n    return orientation === 'horizontal'\n      ? gameboard[axisIndex] // Returns row #<axisIndex>\n      : gameboard.map(row => row[axisIndex]) // `y` values at column-<axisIndex>\n  };\n  const findValidPositionsInAxis = (\n    axisArray: Array<symbol>, // or symbol[]\n    isHorizontal: boolean,\n    axisIndex: number,\n    shipLength: ShipLength\n  ): PositionArray => {\n    let streak: number = 0;\n    let validAxisPositions: PositionArray = [];\n    \n    for (let i = 0; i < axisArray.length; i++) {\n      if (axisArray[i] === battleshipBoardBuilder.fillValue) {\n        streak++;\n        \n        if (streak >= shipLength) {\n          const bowPosition: Coordinates =\n            isHorizontal\n            ? [i - (shipLength - 1), axisIndex]\n            : [axisIndex, i - (shipLength - 1)];\n          \n          const sternPosition: Coordinates =\n            isHorizontal\n              ? [i, axisIndex]\n              : [axisIndex, i];\n\n          validAxisPositions.push({\n            bow: bowPosition,\n            stern: sternPosition,\n          });\n        }\n      } else {\n        streak = 0;\n      }\n    }\n    \n    return validAxisPositions;\n  };\n\n  const validPositionsPerAxis: IValidPositionsResult = {}; \n  const board: Gameboard = battleshipBoardBuilder.board;\n  const isHorizontal = orientation === 'horizontal';\n\n  for (let axisIndex = 0; axisIndex < board.length; axisIndex++) {\n    const axisArray: Array<symbol> = extractAxisArray(axisIndex, orientation, board);\n    const validPositions: PositionArray = findValidPositionsInAxis(\n      axisArray,\n      isHorizontal,\n      axisIndex,\n      shipLength\n    );\n    \n    const axisTemplate: AxisArrayKey =\n      isHorizontal\n        ? `row-${axisIndex}`\n        : `column-${axisIndex}`;\n    \n    validPositionsPerAxis[axisTemplate] = validPositions;\n  }\n\n  return validPositionsPerAxis;\n}","import {\n  AnglesOfRotation,\n  AxisArrayKey,\n  Coordinates,\n  CoordinatesArray,\n  Gameboard,\n  IPlacementConfigurations,\n  IPlacePieceCallbackParams,\n  IPosition,\n  IShipPlacementConfigurations,\n  IValidPositionsResult,\n  Orientation,\n  ShipLength,\n  ShipSymbolValue,\n  ShipType,\n} from '../../../../types/logic-types';\nimport { arePositionsEqual, createPositionObject, isCoordinateInBounds } from '../../../../utilities/logic-utilities';\nimport { BattleshipBuilder } from '../../../bs-ship-builder/bs-ship-builder';\n\nexport function placeShip({\n  ship,\n  coordinates,\n  orientation,\n  battleshipBoardController,\n  battleshipBoardBuilder,\n  battleshipBoardRepository\n}: IPlacePieceCallbackParams): void {  \n  const shipLength: ShipLength = ship.length;\n  const [bowX, bowY]: Coordinates = coordinates;\n  const isHorizontal: boolean = orientation === 'horizontal';\n  const axisStart: number = isHorizontal ? bowX : bowY;\n  const axisEnd = axisStart + shipLength - 1;\n\n  if (!isCoordinateInBounds(axisEnd, battleshipBoardBuilder.boardSize)) {\n    const errorMessage: string = `Invalid Command: The ship placement attempt with the following configurations is out of bounds - Coordinates: ${coordinates}, Length: ${ship.length}, Orientation: ${orientation}.`;\n    throw new Error(errorMessage);\n  };\n\n  if (ship.isPlaced()) {\n    console.warn(`Invalid Command: The ${ship.type} has already been placed.`);\n    return;\n  };\n\n  const isPositionValid = (\n    position: IPosition,\n    shipConfigurations: IShipPlacementConfigurations,\n    axisArrayKey: AxisArrayKey\n  ): boolean => {\n    const validPositions: IValidPositionsResult =\n      battleshipBoardController.getValidPositions(shipConfigurations);\n\n    return validPositions[axisArrayKey].some((validPosition: IPosition) =>\n      arePositionsEqual(position, validPosition)\n    );\n  };\n\n  const position: IPosition = createPositionObject(\n    coordinates,\n    orientation,\n    shipLength,\n  );\n\n  const shipConfigurations: IShipPlacementConfigurations = {\n    shipLength,\n    orientation\n  };\n  const axisArrayKey: AxisArrayKey = isHorizontal\n    ? `row-${bowY}`\n    : `column-${bowX}`; \n    \n  if (isPositionValid(position, shipConfigurations, axisArrayKey)) {\n    const getPlacementCoordinates = (\n      validPosition: IPosition,\n      isHorizontal: Boolean\n    ): CoordinatesArray => {\n      const placementCoordinates: CoordinatesArray = [];\n\n      const [bowX, bowY]: Coordinates = validPosition.bow;\n      const [sternX, sternY]: Coordinates = validPosition.stern;\n\n      const primary: number = isHorizontal\n        ? bowY\n        : bowX;\n      const axisStart: number = isHorizontal\n        ? bowX\n        : bowY;\n      const axisEnd: number = isHorizontal\n        ? sternX\n        : sternY;\n\n      for (let i = axisStart; i <= axisEnd; i++) {\n        placementCoordinates.push(isHorizontal ? [i, primary] : [primary, i]);\n      }\n\n      return placementCoordinates;\n    };\n    const placeOnBoard = (\n      ship: BattleshipBuilder,\n      shipPlacementCoordinates: CoordinatesArray\n    ): void => {\n      const gameboard: Gameboard = battleshipBoardBuilder.board;\n      const shipSymbol: ShipSymbolValue = ship.symbol;\n\n      shipPlacementCoordinates.forEach((coordinates) => {\n        const [x, y]: Coordinates = coordinates;\n        gameboard[y][x] = shipSymbol;\n      });\n    };\n    const setShipConfigurations = (\n      ship: BattleshipBuilder,\n      coordinatesArray: CoordinatesArray,\n      orientation: Orientation\n    ): void => {\n      const placementConfigurations: IPlacementConfigurations = { coordinatesArray, orientation };\n      \n      ship.currentplacementConfigurations = placementConfigurations;\n\n      if (Object.values(ship.rotationalPivotConfigurations).every(value => value === null)) {\n        ship.rotationalPivotConfigurations = {\n          ...placementConfigurations,\n          transientAngleOfRotation: AnglesOfRotation.Degrees0,\n        }\n      }      \n    };\n    const updateOccupiedCoordinatesSet = (\n      shipType: ShipType,\n      placementCoordinates: CoordinatesArray\n    ): void => {\n      battleshipBoardRepository.addShipToFleetCoordinates(\n        shipType,\n        placementCoordinates\n      );\n    };\n\n    const placementCoordinates: CoordinatesArray = getPlacementCoordinates(\n      position,\n      isHorizontal\n    );\n\n    placeOnBoard(ship, placementCoordinates);\n    setShipConfigurations(\n      ship,\n      placementCoordinates,\n      orientation\n    );\n    updateOccupiedCoordinatesSet(ship.type, placementCoordinates);\n  } else {\n    const errorMessage: string = `Invalid Command: \"${JSON.stringify(\n      position\n    )}\" is unavailable for ship with Size: ${shipLength} and Orientation: ${orientation}.`;\n\n    throw new Error(errorMessage);\n  }\n}\n","import { BattleshipBuilder } from \"../bs-ship-builder/bs-ship-builder\";\nimport {\n  Coordinates,\n  CoordinatesArray,\n  CoordinatesToString,\n  FleetCoordinates,\n  InBoundRotationalPlacePieceParamsForFleet,\n  ShipType,\n  RotationalPositionMap\n} from \"../../types/logic-types\";\n\nexport class BattleshipBoardRepository {\n  readonly #fleetCoordinates: FleetCoordinates = {};\n  readonly #inBoundRotationalPlacePieceParamsForFleet: InBoundRotationalPlacePieceParamsForFleet =\n    {};\n  readonly #attackedCoordinates: Set<CoordinatesToString> = new Set();\n  readonly #sunkShips: Set<ShipType> = new Set();\n\n  //  --------------------------------------------------------------\n\n  public get fleetCoordinates(): FleetCoordinates {\n    return this.#fleetCoordinates;\n  }\n\n  public get inBoundRotationalPlacePieceForFleet(): InBoundRotationalPlacePieceParamsForFleet {\n    console.log(this.#inBoundRotationalPlacePieceParamsForFleet);\n    return this.#inBoundRotationalPlacePieceParamsForFleet;\n  }\n\n  public addAttackedCoordinates(coordinates: Coordinates): void {\n    this.#attackedCoordinates.add(`[${coordinates[0]}, ${coordinates[1]}]`);\n  }\n\n  public addShipToFleetCoordinates(\n    shipType: ShipType,\n    placementCoordinates: CoordinatesArray\n  ): void {\n    if (!this.fleetCoordinates[shipType]) {\n      this.fleetCoordinates[shipType] = new Set();\n    }\n\n    placementCoordinates.forEach((coordinates: Coordinates) => {\n      const [x, y]: Coordinates = coordinates;\n      const setMemberTemplate: CoordinatesToString = `[${x}, ${y}]`;\n      this.fleetCoordinates[shipType]!.add(setMemberTemplate);\n    });\n  }\n\n  public addSunkenShip(shipType: ShipType) {\n    this.#sunkShips.add(shipType);\n  }\n\n  public areAllShipsSunk(): boolean {\n    return this.#sunkShips.size === Object.keys(this.fleetCoordinates).length;\n  }\n\n  public isShipPlaced(shipType: ShipType): boolean {\n    return this.fleetCoordinates[shipType] !== null;\n  }\n\n  public nullifyShipCoordinatesValue(shipType: ShipType): void {\n    this.fleetCoordinates[shipType] = null;\n  }\n\n  public nullifyShipValidRotationalParams(shipType: ShipType): void {\n    this.inBoundRotationalPlacePieceForFleet[shipType] = null;\n  }\n\n  public setShipValidRotationalParams(\n    ship: BattleshipBuilder,\n    validRotatedPlacePieceParams: RotationalPositionMap\n  ): void {\n    if (!this.#inBoundRotationalPlacePieceParamsForFleet[ship.type])\n      this.#inBoundRotationalPlacePieceParamsForFleet[ship.type] =\n        validRotatedPlacePieceParams;\n  }\n\n  public hasTargetBeenAttacked(coordinates: Coordinates): boolean {\n    return this.#attackedCoordinates.has(\n      `[${coordinates[0]}, ${coordinates[1]}]`\n    );\n  }\n}","import { BattleshipFleetBuilder } from \"../logic/bs-fleet-builder/bs-fleet-builder\";\nimport { BattleshipBoardBuilder } from \"../logic/bs-gameboard-builder/bs-gameboard-builder\";\nimport { BattleshipBoardController } from \"../logic/bs-gameboard-controller/bs-gameboard-controller\";\nimport { BattleshipBoardRepository } from \"../logic/bs-gameboard-repository/bs-gameboard-repository\";\nimport { FleetVersion } from \"../types/logic-types\";\nimport { PlayerState } from \"../types/state-types\";\n\nexport const createPlayerStateObject = (fleetVersion: FleetVersion = 2002) => { \n  const gameboardBuilder = new BattleshipBoardBuilder();\n  const gameboardRepository = new BattleshipBoardRepository();\n  const fleetBuilder = fleetVersion === 2002\n    ? BattleshipFleetBuilder.createHasbroFleet()\n    : BattleshipFleetBuilder.createMBFleet();\n  const gameboardController = new BattleshipBoardController({\n    gameboardBuilder,\n    gameboardRepository,\n    fleetBuilder\n  });\n\n  return {\n    gameboardBuilder,\n    gameboardRepository,\n    fleetBuilder,\n    gameboardController,\n  }\n}\n\nconst player: PlayerState = createPlayerStateObject();\nconst opponent: PlayerState = createPlayerStateObject();\n\nexport const players: { player: PlayerState; opponent: PlayerState } = {\n  player,\n  opponent,\n};","interface DialogState {\n  isDialogOpen: boolean;\n  isEscapeKeyListenerAttached: boolean;\n  isCloseButtonListenerAttached: boolean;\n};\n\n/**\n * Lightbox by Cyclone Studios \n * \n * A class that manages a modal dialog, allowing it to be opened, closed, and interacted with.\n * It handles keyboard interactions (Escape key), and close button events. \n * \n * @example\n * const dialogElement = document.querySelector('dialog');\n * const lightbox = new LightBox(dialogElement);\n * lightbox.openLightbox();\n * \n * @class\n */\nexport class CycloneLightboxController {\n  /**\n   * The current state of the dialog (open/close and event listener attachment status).\n   * @private\n   * @type {DialogState}\n   */\n  private readonly dialogState: DialogState = {\n    isDialogOpen: false,\n    isEscapeKeyListenerAttached: false,\n    isCloseButtonListenerAttached: false,\n  };\n\n  /**\n   * The ID of the dialog element.\n   * @private\n   * @type {string}\n   */\n  private readonly dialogId: string;\n\n  /**\n   * The close button element inside the dialog.\n   * @private\n   * @type {HTMLButtonElement}\n   */\n  private readonly dialogCloseButton: HTMLButtonElement;\n\n  /**\n   * The listener function for closing the dialog when the close button is clicked.\n   * @private\n   * @type {() => void}\n   */\n  private closeButtonListener: () => void;\n\n  /**\n   * The listener function for handling the Escape key to close the dialog.\n   * @private\n   * @type {(event: KeyboardEvent) => void}\n   */\n  private escapeKeyListener: (event: KeyboardEvent) => void;\n\n  /**\n   * Creates an instance of the LightBox class.\n   * @param {HTMLDialogElement} dialogElement - The dialog element to manage.\n   * @param {string} [dialogCloseButtonID='ds-close-button'] - The ID of the close button inside the dialog.\n   * @param {boolean} [dialogInDocumentBody=true] - Whether to observe the dialog's removal from the document body.\n   * @throws {Error} Throws an error if the dialog element doesn't have an ID.\n   */\n  constructor(\n    private readonly dialogElement: HTMLDialogElement,\n    private readonly dialogCloseButtonID: string = 'ds-close-button',\n    private readonly dialogInDocumentBody: boolean = true\n  ) {\n    if (!this.dialogElement.id)\n      throw new Error('Dialog element must have an id.');\n\n    this.dialogId = this.dialogElement.id;\n    this.dialogCloseButton = this.dsGetCloseButton(\n      this.dialogCloseButtonID,\n      this.dialogId\n    );\n    this.dsAddCloseButtonAria(this.dialogCloseButton);\n\n    this.closeButtonListener = this.closeLightbox.bind(this);\n    this.escapeKeyListener = this.dsHandleEscapeKey.bind(this);\n\n    this.observeDialogRemoval();\n  }\n\n  /**\n   * Opens the dialog.\n   * Adds event listeners for closing the dialog.\n   */\n  public openLightbox() {\n    if (this.dialogState.isDialogOpen) return;\n\n    this.dialogElement.showModal();\n    this.dsAddListeners();\n    this.dialogState.isDialogOpen = true;\n  }\n\n  /**\n   * Closes the dialog with an animation and removes event listeners.\n   */\n  public closeLightbox() {\n    requestAnimationFrame(() => {\n      this.dialogElement.classList.add('closing');\n    });\n\n    this.dialogElement.addEventListener(\n      'animationend',\n      () => {\n        this.dialogElement.classList.remove('closing');\n        this.dialogElement.close();\n        this.dsRemoveListeners();\n        this.dialogState.isDialogOpen = false;\n      },\n      { once: true }\n    );\n  }\n\n  /**\n   * Returns whether the dialog is currently open.\n   * @returns {boolean} True if the dialog is open, false otherwise.\n   */\n  public isOpen(): boolean {\n    return this.dialogState.isDialogOpen;\n  }\n\n  /**\n   * Adds event listeners for the dialog's close button and Escape key.\n   * @private\n   */\n  private dsAddListeners() {\n    if (!this.dialogState.isCloseButtonListenerAttached) {\n      this.dialogCloseButton.addEventListener(\n        'click',\n        this.closeButtonListener\n      );\n      this.dialogState.isCloseButtonListenerAttached = true;\n    }\n\n    if (!this.dialogState.isEscapeKeyListenerAttached) {\n      window.addEventListener('keydown', this.escapeKeyListener);\n      this.dialogState.isEscapeKeyListenerAttached = true;\n    }\n  }\n\n  /**\n   * Removes event listeners for the dialog's close button and Escape key.\n   * @private\n   */\n  private dsRemoveListeners() {\n    this.dialogCloseButton.removeEventListener(\n      'click',\n      this.closeButtonListener\n    );\n    this.dialogState.isCloseButtonListenerAttached = false;\n\n    window.removeEventListener('keydown', this.escapeKeyListener);\n    this.dialogState.isEscapeKeyListenerAttached = false;\n  }\n\n  /**\n   * Retrieves the close button element inside the dialog.\n   * @private\n   * @param {string} closeButtonId - The ID of the close button.\n   * @param {string} dialogId - The ID of the dialog.\n   * @returns {HTMLButtonElement} The close button element.\n   * @throws {Error} Throws an error if the close button is not found.\n   */\n  private dsGetCloseButton(\n    closeButtonId: string,\n    dialogId: string\n  ): HTMLButtonElement {\n    const closeButton = this.dialogElement.querySelector<HTMLButtonElement>(\n      `#${closeButtonId}`\n    );\n\n    if (!closeButton) {\n      throw new Error(\n        `Close button with ID \"${closeButtonId}\" not found in dialog \"${dialogId}\".`\n      );\n    }\n\n    return closeButton;\n  }\n\n  /**\n   * Adds aria attribute to the close button.\n   * @private\n   * @param {HTMLButtonElement} closeButton - The close button element to update.\n   */\n  private dsAddCloseButtonAria(closeButton: HTMLButtonElement): void {\n    closeButton.setAttribute('aria-label', 'Close Dialog');\n  }\n\n  /**\n   * Handles the Escape key press to close the dialog.\n   * @private\n   * @param {KeyboardEvent} event - The keyboard event triggered by pressing a key.\n   */\n  private dsHandleEscapeKey(event: KeyboardEvent) {\n    if (event.key === 'Escape' && this.dialogState.isDialogOpen) {\n      event.preventDefault();\n      this.closeLightbox();\n    }\n  }\n\n  /**\n   * Observes the removal of the dialog element from the DOM and removes listeners accordingly.\n   * @private\n   */\n  private observeDialogRemoval() {\n    const observer: MutationObserver = new MutationObserver((mutations) => {\n      for (const mutation of mutations) {\n        Array.from(mutation.removedNodes).forEach((node) => {\n          if (node === this.dialogElement) {\n            this.dsRemoveListeners();\n            observer.disconnect(); // Stop observing once removed\n            return;\n          }\n        });\n      }\n    });\n\n    this.dialogInDocumentBody\n      ? observer.observe(document.body, { childList: true })\n      : observer.observe(document.body, { childList: true, subtree: true });\n  }\n}\n\n//  --------------------------------------------------------------\n\n// <---  Fun facts:\n// Lightboxes are named after the lightbox that photographers use to view slides.\n\n// The HTML <dialog> element didn't become a web standard until 2022, when Chrome, \n// Firefox and Safari added support for the element.\n\n// Ok maybe not that fun.\n\n// ---> Kizu Kuraudo\n\n//  --------------------------------------------------------------","// * UTILITIY\nfunction setAttributes(\n  element: Element,\n  attributes: { [key: string]: string }\n) {\n  for (const key in attributes) {\n    element.setAttribute(key, attributes[key]);\n  }\n}\n\n// > ------------------------------------------------------------------------\n\nexport function createGitHubLink(\n  size: string = '50px',\n  color: string = '#FFF',\n  gitHubUsername: string = 'johnKeysCloud',\n  projectName?: string\n): HTMLAnchorElement {\n  const pathOne: SVGPathElement = document.createElementNS(\n    'http://www.w3.org/2000/svg',\n    'path'\n  );\n  pathOne.setAttribute(\n    'd',\n    'M8.20003216,0 C3.67186256,0 0,3.67233045 0,8.2025137 C0,11.8266603 2.34955472,14.9012922 5.60770169,15.9859115 C6.01749428,16.0618219 6.16798309,15.8079721 6.16798309,15.5913056 C6.16798309,15.3957396 6.16033003,14.7495356 6.15685721,14.064154 C3.87553694,14.5603383 3.3941657,13.0963596 3.3941657,13.0963596 C3.02115925,12.1482506 2.48370842,11.896202 2.48370842,11.896202 C1.7397535,11.3870871 2.53978801,11.3975087 2.53978801,11.3975087 C3.36323189,11.4554066 3.79681972,12.242817 3.79681972,12.242817 C4.52816959,13.4968196 5.71510182,13.1342505 6.18303197,12.9247247 C6.25660428,12.3945093 6.46915364,12.0327122 6.70363321,11.8278826 C4.88233278,11.6204154 2.96765212,10.9170854 2.96765212,7.77413412 C2.96765212,6.87864774 3.28798748,6.14688355 3.81257603,5.57247278 C3.72742766,5.36584187 3.44677247,4.53159853 3.89200067,3.40175461 C3.89200067,3.40175461 4.58058343,3.18129256 6.14759636,4.24255971 C6.80164386,4.06076054 7.50315322,3.96966796 8.20003216,3.96658007 C8.89691109,3.96966796 9.59893494,4.06076054 10.2542687,4.24255971 C11.8194166,3.18129256 12.5070347,3.40175461 12.5070347,3.40175461 C12.9533562,4.53159853 12.6725723,5.36584187 12.587424,5.57247278 C13.1131701,6.14688355 13.4313189,6.87858341 13.4313189,7.77413412 C13.4313189,10.9245478 11.5130368,11.6182925 9.68710595,11.8213208 C9.98120223,12.0758783 10.2432714,12.5750862 10.2432714,13.3403025 C10.2432714,14.4377879 10.2337533,15.3211158 10.2337533,15.5913056 C10.2337533,15.8095804 10.3813481,16.0653602 10.7970574,15.9848178 C14.0534036,14.8989763 16.4,11.825438 16.4,8.2025137 C16.4,3.67233045 12.7286519,0 8.20003216,0'\n  );\n\n  const pathTwo: SVGPathElement = document.createElementNS(\n    'http://www.w3.org/2000/svg',\n    'path'\n  );\n  setAttributes(pathTwo, {\n    'd': 'M3.07518929,11.6824029 C3.05731167,11.723257 2.99359073,11.7355197 2.93568001,11.7075092 C2.87662002,11.6806603 2.84341872,11.6248974 2.86257332,11.5838496 C2.88013169,11.5417693 2.94385264,11.5300229 3.00278493,11.5582916 C3.06197262,11.5850759 3.09568471,11.6413552 3.07518929,11.6824029 M3.47564797,12.0435714 C3.436828,12.0799722 3.36091196,12.0630626 3.30938611,12.0055571 C3.25613634,11.9481806 3.24617596,11.8715065 3.28557057,11.8345248 C3.32560367,11.7981885 3.39922115,11.8151627 3.45259861,11.8726037 C3.50584838,11.9306256 3.51619186,12.0068479 3.47558413,12.0436359 M3.75038868,12.5056811 C3.70045904,12.5407266 3.61886048,12.5078755 3.5684839,12.4346866 C3.51861811,12.3615623 3.51861811,12.2737872 3.56956933,12.2386127 C3.62013745,12.2034381 3.70045904,12.235063 3.75153796,12.307671 C3.8013399,12.3820861 3.8013399,12.4698612 3.75032483,12.5057457 M4.2149514,13.0409152 C4.1703212,13.0906114 4.07531442,13.0773161 4.0057194,13.0094195 C3.93459201,12.9430719 3.91473508,12.8489074 3.95949298,12.7991467 C4.00463397,12.7493214 4.10021539,12.7633267 4.1703212,12.8306424 C4.24100164,12.8968609 4.26258248,12.9917354 4.21501525,13.0409152 M4.81538402,13.2216286 C4.79578249,13.2860399 4.70422354,13.3153413 4.6120261,13.2879762 C4.51995636,13.259772 4.45968324,13.1842596 4.4782632,13.1191383 C4.49741779,13.0542751 4.58935983,13.0237475 4.68225961,13.0530489 C4.77420165,13.081124 4.83460247,13.1560554 4.81544787,13.2216286 M5.49881989,13.2982381 C5.50111844,13.3661347 5.42290385,13.422414 5.32610931,13.4236402 C5.22874013,13.4257701 5.15001476,13.3708461 5.14899318,13.3041113 C5.14899318,13.2355693 5.22542,13.1798063 5.32272533,13.1781928 C5.41951987,13.1762566 5.49881989,13.2307933 5.49881989,13.2982381 M6.17012451,13.2722283 C6.18174496,13.3384468 6.11444849,13.4064725 6.01835628,13.4245438 C5.92386029,13.4419697 5.83638766,13.4011156 5.82432026,13.3354779 C5.81257211,13.2675814 5.88114555,13.1996203 5.97545,13.1820007 C6.07173375,13.1650911 6.15786557,13.2049126 6.17012451,13.2722283',\n    'fill-rule': 'nonzero',\n  });\n\n  const gInner: SVGElement = document.createElementNS(\n    'http://www.w3.org/2000/svg',\n    'g'\n  );\n  gInner.setAttribute('fill', color);\n  gInner.append(pathOne, pathTwo);\n\n  const gOuter: SVGElement = document.createElementNS(\n    'http://www.w3.org/2000/svg',\n    'g'\n  );\n  setAttributes(gOuter, {\n    stroke: 'none',\n    'stroke-width': '1',\n    fill: 'none',\n    'fill-rule': 'evenodd',\n  });\n  gOuter.appendChild(gInner);\n\n  const gitHubSVG: SVGElement = document.createElementNS(\n    'http://www.w3.org/2000/svg',\n    'svg'\n  );\n  setAttributes(gitHubSVG, {\n    viewBox: '0 0 17 16',\n    version: '1.1',\n    xmlns: 'http://www.w3.org/2000/svg',\n    'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n    width: size,\n    height: size,\n  });\n  gitHubSVG.classList.add('git-hub-svg');\n  gitHubSVG.appendChild(gOuter);\n\n  const gitHubLogoLink: HTMLAnchorElement = document.createElement('a');\n  gitHubLogoLink.classList.add('git-hub-logo-link');\n  setAttributes(gitHubLogoLink, {\n    href: projectName\n      ? `https://github.com/${gitHubUsername}/${projectName}`\n      : `https://github.com/${gitHubUsername}`,\n    rel: 'noopener noreferrer',\n    target: '_blank',\n    type: 'button',\n    'aria-label': 'GitHub profile link',\n  });\n  gitHubLogoLink.appendChild(gitHubSVG);\n\n  return gitHubLogoLink;\n}","import { InstructionsComponent } from \"../../components/buttons/instructions-component/instructions-component\";\nimport { createElement } from \"../../../utilities/random-utilities\";\n\n//  Main Container One Parabellum: Heading and Help Button\n\nexport function createMainOneParabellumFragment(\n  instructionsButton: InstructionsComponent\n): DocumentFragment {\n  const parabellumHeading = createElement('h2');\n  parabellumHeading.textContent = 'Parabellum';\n\n  const mainContainerOneParabellumWrapper: HTMLDivElement = createElement(\n    'div',\n    ['parabellum'],\n    {\n      id: 'main-container-one-parabellum',\n    }\n  );\n\n  mainContainerOneParabellumWrapper.append(parabellumHeading);\n  instructionsButton.render(mainContainerOneParabellumWrapper);\n\n  const parabellumFragment: DocumentFragment = new DocumentFragment();\n  parabellumFragment.append(mainContainerOneParabellumWrapper);\n\n  return parabellumFragment;\n}","import { createElement } from '../../../utilities/random-utilities';\nimport { CycloneSitRepScroller } from '../../../utilities/cycloneSitRepScroller.ts/cyclone-sit-rep-scroller';\n\n//  Main Container One Bellum: Situation Report (turn/attack state messaages)\n\nexport function createMainOneBellumFragment(\n  sitRepScrollerController: CycloneSitRepScroller\n): DocumentFragment {\n  const bellumHeading = createElement('h2');\n  bellumHeading.textContent = 'Parabellum';\n\n  const latestUpdatesHeading = createElement('h3');\n  latestUpdatesHeading.textContent = 'Situation Report:';\n\n  //  --------------------------------------------------------------\n  \n  const mainContainerOneBellumWrapper: HTMLDivElement = createElement(\n    'div',\n    ['bellum'],\n    {\n      id: 'main-container-one-bellum',\n    }\n  );\n  mainContainerOneBellumWrapper.append(\n    latestUpdatesHeading,\n    sitRepScrollerController.element\n  );\n\n  const bellumFragment: DocumentFragment = new DocumentFragment();\n  bellumFragment.appendChild(mainContainerOneBellumWrapper);\n\n  return bellumFragment;\n}\n","import { createElement } from '../../../utilities/random-utilities';\n\n//  Main Container One Post Bellum: <Insert Here>\n// ! Game over message with winner and loser text and a button to restart the game\n\nexport function createMainOnePostBellumFragment(): DocumentFragment {\n  // !\n\n  const mainContainerPostBellumWrapper: HTMLDivElement = createElement(\n    'div',\n    ['bellum'],\n    {\n      id: 'main-container-one-post-bellum',\n    }\n  );\n\n  const postBellumFragment: DocumentFragment = new DocumentFragment();\n  postBellumFragment.appendChild(mainContainerPostBellumWrapper);\n\n  return postBellumFragment;\n}","import { createElement } from \"./random-utilities\";\n\n/**\n * A container for dynamically swapping and managing fragments of the DOM.\n * \n * @class CycloneHotSwapContainer\n * @param {keyof HTMLElementTagNameMap} elementTag - The HTML element tag for the container (e.g., 'section', 'div').\n * @param {{ [key: string]: DocumentFragment }} fragments - A collection of swappable fragments, keyed by string identifiers.\n * @param {string} initialFragmentKey - The key of the initial fragment to render in the container.\n * @param {string[]} [classNames=[]] - An array of class names to apply to the container element (optional).\n * @param {Record<string, string>} [attributes={}] - A set of attributes to apply to the container element (optional).\n */\nexport class CycloneHotSwapContainer {\n  private readonly hotSwapContainer: HTMLElement;\n  private readonly fragmentsArray: DocumentFragment[];\n  #currentIndex: number;\n\n  constructor(\n    private readonly elementTag: keyof HTMLElementTagNameMap,\n    private readonly fragments: { [key: string]: DocumentFragment },\n    private readonly initialFragmentKey: string,\n    private readonly classNames: string[] = [],\n    private readonly attributes: Record<string, string> = {}\n  ) {\n    if (!fragments[initialFragmentKey]) {\n      throw new Error(\n        `Initial fragment with key \"${initialFragmentKey}\" does not exist.`\n      );\n    }\n\n    this.hotSwapContainer = createElement(\n      this.elementTag,\n      this.classNames,\n      this.attributes\n    );\n\n    this.fragmentsArray = Object.values(this.fragments);\n\n    this.#currentIndex = this.setInitialIndex(\n      this.fragmentsArray,\n      this.fragments,\n      this.initialFragmentKey\n    );\n\n    this.hotSwapContainer.appendChild(this.fragments[this.initialFragmentKey]);\n  }\n\n  public render(targetElement: HTMLElement) {\n    targetElement.appendChild(this.hotSwapContainer);\n  }\n\n  public swapFragmentByKey(key: string): void {\n    const fragment = this.getFragment(key);\n    this.swapFragment(fragment);\n    this.#currentIndex = this.fragmentsArray.indexOf(fragment);\n  }\n\n  public swapByOrder(): void {\n    this.#currentIndex = (this.#currentIndex + 1) % this.fragmentsArray.length;\n    this.swapFragment(this.fragmentsArray[this.#currentIndex]);\n  }\n\n  private setInitialIndex(\n    fragmentsArray: DocumentFragment[],\n    fragments: { [key: string]: DocumentFragment },\n    initialFragmentKey: string\n  ): number {\n    const initialIndex = fragmentsArray.indexOf(fragments[initialFragmentKey]);\n    if (initialIndex === -1) {\n      throw new Error(\n        `Initial fragment with key \"${initialFragmentKey}\" does not exist.`\n      );\n    }\n    return initialIndex;\n  }\n\n  private getFragment(key: string): DocumentFragment {\n    const fragment = this.fragments[key];\n    if (!fragment) {\n      throw new Error(`Fragment with key \"${key}\" does not exist.`);\n    }\n    return fragment;\n  }\n\n  private swapFragment(fragment: DocumentFragment) {\n    this.hotSwapContainer.replaceChildren(fragment);\n  }\n}","import { BattleshipFleetBuilder } from '../logic/bs-fleet-builder/bs-fleet-builder';\nimport { BattleshipBoardBuilder } from '../logic/bs-gameboard-builder/bs-gameboard-builder';\nimport { BattleshipBoardController } from '../logic/bs-gameboard-controller/bs-gameboard-controller';\nimport { BattleshipBoardRepository } from '../logic/bs-gameboard-repository/bs-gameboard-repository';\nimport { ShipType } from './logic-types';\n\n//  --------------------------------------------------------------\n\nexport type AttackResult = {\n  hit: boolean;\n  isSunk?: boolean;\n  type?: ShipType;\n};\nexport type CurrentPlayer = PlayerType | null;\nexport type GamePhase = 'parabellum' | 'bellum' | 'postBellum';\nexport type MessageSubject = 'You' | 'Your opponent';\nexport type MessageTarget = 'your' | 'their'; \nexport type MessageType = 'turn' | 'attack';\nexport type PlayerType = 'player' | 'opponent';\n\nexport enum gameboardStateValue {\n  inactive = 0,\n  active = 1,\n}\n//  --------------------------------------------------------------\n\nexport interface PlayerState {\n  gameboardBuilder: BattleshipBoardBuilder;\n  gameboardController: BattleshipBoardController;\n  gameboardRepository: BattleshipBoardRepository;\n  fleetBuilder: BattleshipFleetBuilder;\n};","//  State\nimport { GameState } from '../../../../state/game-state';\n\n//  Logic\nimport { BattleshipBuilder } from '../../../../logic/bs-ship-builder/bs-ship-builder';\nimport { BattleshipFleetBuilder } from '../../../../logic/bs-fleet-builder/bs-fleet-builder';\nimport { BattleshipBoardController } from '../../../../logic/bs-gameboard-controller/bs-gameboard-controller';\n\n//  Types\nimport {\n  isOrientation,\n  isShipLength,\n  isShipType,\n} from '../../../../types/type-guards'\nimport {\n  Coordinates,\n  CoordinatesArray,\n  Fleet,\n  Gameboard,\n  IPlacementConfigurations,\n  Orientation,\n  ShipLength,\n  ShipSymbolValue,\n  ShipSymbolValueArray,\n  ShipType,\n  } from '../../../../types/logic-types'\nimport {\n  AttackResult,\n  PlayerState,\n  gameboardStateValue,\n} from '../../../../types/state-types';\nimport { GridCellDataKey } from '../../../../types/dom-types';\nimport {\n  CloneSnapOffset,\n  DragState,\n  ShipBorderValueSplit,\n} from '../../component-types';\nimport { GridPlacementValue } from '../../../../types/css-types';\n\n//  Utilities\nimport {\n  areArraysEqual,\n  createElement,\n  delay,\n  getConvertedTypeFromAttr,\n  waitForEvent,\n  waitForTransitionEnd,\n} from '../../../../utilities/random-utilities';\n\n//  Stylesheets\nimport '../gameboard-component.scss';\nimport '../gameboard-animations.scss';\n\n//  --------------------------------------------------------------\n\nexport class PlayerGameboardComponent {\n  public id: string = 'player';\n\n  //  Elements\n  public gameboardContainer: HTMLElement;\n  private gameboard: DocumentFragment;\n  private fleetElements: Map<ShipType, HTMLDivElement> = new Map();\n  private dragImage: HTMLImageElement;\n  private shipDragClone: HTMLDivElement;\n\n  //  Event listeners\n  private listenersAdded: boolean = false;\n  private dragState: DragState = {\n    currentShipInstance: null,\n    initialPlacementConfigurations: null,\n    isValidDropTarget: false,\n    currentDragOverCell: null,\n    cloneSnapOffset: null,\n    shipBorderValueSplit: null,\n  };\n  private dragEventCallbacks: Record<string, (e: DragEvent) => void> = {\n    dragstart: (e: DragEvent) => this.handleShipDragStart(e, this.dragState),\n    drag: (e: DragEvent) => this.handleShipDrag(e, this.dragState),\n    dragenter: (e: DragEvent) => this.handleShipDragEnter(e),\n    dragleave: (e: DragEvent) => this.handleShipDragLeave(e),\n    dragover: (e: DragEvent) => this.handleShipDragOver(e, this.dragState),\n    drop: (e: DragEvent) => this.handleShipDrop(e, this.dragState),\n    dragend: (e: DragEvent) => this.handleShipDragEnd(e, this.dragState),\n  };\n\n  constructor(\n    public readonly playerState: PlayerState,\n    private readonly gameState: GameState\n  ) {\n    this.gameboardContainer = this.generateBoardContainer(\n      this.playerState.gameboardBuilder.boardSize\n    );\n\n    this.gameboard = this.generateBoardFragment(\n      this.playerState.gameboardBuilder.boardSize\n    );\n    this.dragImage = this.createDragImage();\n    this.shipDragClone = this.createShipDragClone();\n\n    this.gameState.eventBus.on(\n      'refreshGameboard',\n      this.refreshGameboardWrapper\n    );\n    this.gameState.eventBus.on('togglePlayerGameboardControls', this.toggleGameboardControls);\n    this.gameState.eventBus.on('receiveBillowAttack', this.receiveAttack);\n  }\n\n  public render(targetElement: HTMLElement): void {\n    if (!targetElement) {\n      throw new Error(\n        `Target element not found with ID - ${this.id} and selector - \"${targetElement}\".`\n      );\n    }\n\n    this.gameboardContainer.append(\n      this.dragImage,\n      this.shipDragClone,\n      this.gameboard\n    );\n    this.handleFleetPlacement(\n      this.playerState.fleetBuilder,\n      this.fleetElements\n    );\n    this.toggleParabellumListeners();\n\n    targetElement.appendChild(this.gameboardContainer);\n  }\n\n  public toggleParabellumListeners(): void {\n    if (!this.gameboardContainer) return;\n\n    const method = this.listenersAdded\n      ? 'removeEventListener'\n      : 'addEventListener';\n\n    // * Toggle Drag Events\n    Object.entries(this.dragEventCallbacks).forEach(([event, callback]) => {\n      this.gameboardContainer[method](event, callback as EventListener);\n    });\n\n    // * Toggle Rotation Event\n    this.gameboardContainer[method](\n      'click',\n      this.handleShipRotation as EventListener\n    );\n\n    this.listenersAdded = !this.listenersAdded;\n  }\n\n  private togglePlayerTurn(attackResult: AttackResult): void {\n    const { hit, isSunk } = attackResult;\n\n    if ((hit && !isSunk) || !hit) {\n      this.gameState.togglePlayerTurn();\n      return;\n    }\n\n    if (hit && isSunk) {\n      const gameOver = this.checkForWin();\n      if (!gameOver) {\n        this.gameState.togglePlayerTurn();\n        return;\n      }\n\n      // ? if it is game over, do some shit\n    }\n  }\n\n  public toggleShipsDraggable(): void {\n    this.fleetElements.forEach((shipElement) => {\n      shipElement.removeAttribute('draggable');\n    });\n  }\n\n  public toggleShipAdriftClass(): void {\n    this.fleetElements.forEach((shipElement) => {\n      shipElement.classList.remove('adrift');\n    });\n  }\n\n  //  --------------------------------------------------------------\n  //  Helpers\n\n  private applyGridPlacementValue(\n    gridPlacementValue: GridPlacementValue,\n    gridCrossAxis: number,\n    shipElement: HTMLDivElement,\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): void {\n    const isHorizontal: boolean = orientation === 'horizontal';\n    if (isHorizontal) {\n      shipElement.style.gridColumn = gridPlacementValue;\n      shipElement.style.gridRow = gridCrossAxis.toString();\n      shipElement.style.gridTemplateColumns = `repeat(${shipLength}, 1fr)`;\n    } else {\n      shipElement.style.gridRow = gridPlacementValue;\n      shipElement.style.gridColumn = gridCrossAxis.toString();\n      shipElement.style.gridTemplateRows = `repeat(${shipLength}, 1fr)`;\n    }\n  }\n\n  // TODO: move this to game state\n  private checkForWin(): boolean {\n    if (!this.playerState.gameboardRepository.areAllShipsSunk()) return false;\n\n    // TODO: Do something fun with this value.. set winner in repository ?\n    alert(\n      `${\n        this.gameState.currentPlayer === 'player' ? 'You win' : 'You lose'\n      } mother fucker! #TYPESHIT`\n    );\n\n    this.gameState.transitionToNextPhase();\n\n    return true;\n  }\n\n  private createDragImage(): HTMLImageElement {\n    const invisibleImage = createElement(\n      'img',\n      ['drag-image', 'accessibility'],\n      {\n        id: `${this.id}-drag-image`,\n        src: 'https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_misc-images/1x1_transparent.png',\n      }\n    );\n\n    return invisibleImage;\n  }\n\n  private createShipDragClone(): HTMLDivElement {\n    const shipCloneElement: HTMLDivElement = createElement(\n      'div',\n      ['ship-container-clone'],\n      {\n        id: `${this.id}-ship-drag-clone`,\n      }\n    );\n\n    return shipCloneElement;\n  }\n\n  private createBackgroundCellsFragment(\n    gameboard: Gameboard\n  ): DocumentFragment {\n    const cellFragment: DocumentFragment = new DocumentFragment();\n\n    gameboard.forEach((row: ShipSymbolValueArray, rowIndex) => {\n      row.forEach((symbol: ShipSymbolValue, colIndex) => {\n        const symbolDescription: string = symbol.description!.toLowerCase();\n\n        const hitMarker: HTMLDivElement = createElement('div', [\n          `${this.id}-hit-marker`,\n          'hit-marker',\n        ]);\n\n        const gridCell: HTMLDivElement = createElement(\n          'div',\n          [\n            `${this.id}-${symbolDescription}-cell`,\n            `player-${symbolDescription}-cell`,\n            'grid-cell',\n          ],\n          {\n            'data-x': colIndex.toString(),\n            'data-y': rowIndex.toString(),\n            'aria-label': `Row ${rowIndex + 1}, Column ${colIndex + 1}`,\n            role: 'gridCell',\n          }\n        );\n        gridCell.appendChild(hitMarker);\n\n        const gridCellContainer: HTMLDivElement = createElement(\n          'div',\n          [\n            `${this.id}-${symbolDescription}-grid-cell-container`,\n            'grid-cell-container',\n          ]\n        );\n        gridCellContainer.appendChild(gridCell);\n\n        cellFragment.appendChild(gridCellContainer);\n      });\n    });\n\n    return cellFragment;\n  }\n\n  private createShipElement(\n    shipType: ShipType,\n    shipLength: ShipLength,\n    gridPlacementValue: GridPlacementValue,\n    gridCrossAxis: number,\n    orientation: Orientation\n  ): HTMLDivElement {\n    const shipUnitFragment: DocumentFragment = this.generateShipUnitFragment(\n      shipLength,\n      shipType,\n      orientation,\n      this.id\n    );\n\n    const shipContainerElement: HTMLDivElement = createElement(\n      'div',\n      ['ship-container', 'adrift'],\n      {\n        id: `${this.id}-${shipType}-container`,\n        'data-dragging': 'false',\n        'data-length': shipLength.toString(),\n        'data-orientation': orientation,\n        'data-shipType': shipType,\n        draggable: 'true',\n      }\n    );\n\n    shipContainerElement.appendChild(shipUnitFragment);\n\n    this.applyGridPlacementValue(\n      gridPlacementValue,\n      gridCrossAxis,\n      shipContainerElement,\n      orientation,\n      shipLength\n    );\n\n    return shipContainerElement;\n  }\n\n  private generateBoardContainer(boardSize: number): HTMLElement {\n    const gameboardContainer: HTMLElement = createElement(\n      'section',\n      ['gameboard-container'],\n      {\n        id: `${this.id}-gameboard-container`,\n      }\n    );\n\n    gameboardContainer.style.setProperty('--grid-size', boardSize.toString());\n\n    return gameboardContainer;\n  }\n\n  private generateBoardFragment(boardSize: number): DocumentFragment {\n    const gameboardBackground: HTMLDivElement = createElement(\n      'div',\n      ['gameboard-background'],\n      {\n        id: `${this.id}-gameboard-background`,\n      }\n    );\n    gameboardBackground.appendChild(\n      this.createBackgroundCellsFragment(\n        this.playerState.gameboardBuilder.board\n      )\n    );\n\n    const gameboard = createElement('div', ['gameboard'], {\n      id: `${this.id}-gameboard`,\n    });\n    gameboard.style.setProperty('--grid-size', boardSize.toString());\n\n    const boardFragment: DocumentFragment = new DocumentFragment();\n    boardFragment.append(gameboardBackground, gameboard);\n\n    return boardFragment;\n  }\n\n  private generateShipUnitFragment(\n    shipLength: ShipLength,\n    shipType: ShipType,\n    orientation: Orientation,\n    id: string\n  ): DocumentFragment {\n    const shipUnitFragment: DocumentFragment = new DocumentFragment();\n\n    for (let i = 0; i < shipLength; i++) {\n      const isBow: boolean = i === 0;\n      const isStern: boolean = i === shipLength - 1;\n      const shipUnit: HTMLDivElement = createElement('div', [\n        'ship-unit',\n        `${shipType}-unit`,\n        `${id}-${shipType}-unit`,\n      ]);\n\n      const isHorizontal: boolean = orientation === 'horizontal';\n\n      isHorizontal\n        ? shipUnit.classList.add('ship-unit-horizontal')\n        : shipUnit.classList.add('ship-unit-vertical');\n\n      if (isBow) {\n        shipUnit.classList.add('ship-bow');\n        shipUnit.setAttribute('id', `${id}-${shipType}-bow`);\n      }\n\n      if (isStern) {\n        shipUnit.classList.add('ship-stern');\n        shipUnit.setAttribute('id', `${id}-${shipType}-stern`);\n      }\n\n      shipUnitFragment.appendChild(shipUnit);\n    }\n\n    return shipUnitFragment;\n  }\n\n  // TODO: match this against getGridPlacementValue to see if I can consolidate\n  private getAndSetGridPlacementValue(\n    shipContainerElement: HTMLDivElement,\n    bowCoordinates: Coordinates,\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): void {\n    const [gridPlacementValue, gridCrossAxis]: [\n      GridPlacementValue,\n      number\n    ] = this.getGridPlacementValue(bowCoordinates, orientation, shipLength);\n\n    this.setGridPlacementValue(\n      gridPlacementValue,\n      gridCrossAxis,\n      shipContainerElement,\n      orientation,\n      shipLength\n    );\n  }\n\n  private getGridPlacementValue(\n    coordinates: Coordinates,\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): [GridPlacementValue, number] {\n    const isHorizontal = orientation === 'horizontal';\n\n    const [x, y] = coordinates;\n    const gridStartMain = isHorizontal ? x + 1 : y + 1;\n    const gridCrossAxis = isHorizontal ? y + 1 : x + 1;\n\n    return [`${gridStartMain} / span ${shipLength}`, gridCrossAxis];\n  }\n\n  private getShipGridPlacementData(ship: BattleshipBuilder): {\n    bowCoordinates: Coordinates;\n    orientation: Orientation;\n    shipLength: ShipLength;\n  } {\n    const placementConfigurations: IPlacementConfigurations =\n      ship.currentplacementConfigurations;\n\n    if (\n      !placementConfigurations.coordinatesArray ||\n      !placementConfigurations.orientation\n    )\n      throw new Error(`The ${ship.type} has no placement configurations.`);\n\n    const bowCoordinates: Coordinates =\n      placementConfigurations.coordinatesArray[0];\n    const orientation: Orientation =\n      placementConfigurations.orientation;\n\n    const shipLength: ShipLength = ship.length;\n\n    return {\n      bowCoordinates,\n      orientation,\n      shipLength,\n    };\n  }\n\n  private handleFleetPlacement(\n    fleetBuilder: BattleshipFleetBuilder,\n    fleetElements: Map<ShipType, HTMLDivElement>\n  ) {\n    this.updateFleetElements(fleetBuilder);\n    this.placeFleetOnGameboard(fleetElements);\n  }\n\n  private async handleShipUnitCooked(\n    shipContainerElement: HTMLDivElement\n  ): Promise<void> {\n    const shipUnits = Array.from(\n      shipContainerElement.children\n    ) as HTMLElement[];\n\n    // Stagger animations\n    shipUnits.forEach((unit, i) => {\n      setTimeout(() => {\n        unit.classList.add('cooked');\n      }, 333 * (i + 1));\n    });\n\n    const lastUnit = shipUnits[shipUnits.length - 1];\n\n    // Wait for the animation of the last unit to end\n    await waitForTransitionEnd(lastUnit);\n  }\n\n  private hasTargetBeenAttacked(\n    coordinates: Coordinates\n  ): boolean {\n    const alreadyAttacked =\n      this.playerState.gameboardRepository.hasTargetBeenAttacked(coordinates);\n\n    if (!alreadyAttacked) {\n      this.playerState.gameboardRepository.addAttackedCoordinates(coordinates);\n    }\n\n    return alreadyAttacked;\n  }\n\n  private placeFleetOnGameboard(\n    fleetElements: Map<ShipType, HTMLDivElement>\n  ): void {\n    const gameboard =\n      this.gameboardContainer.querySelector<HTMLDivElement>('.gameboard');\n\n    if (!gameboard) {\n      throw new Error('Gameboard container not found.');\n    }\n\n    fleetElements.forEach((shipElement) => gameboard.appendChild(shipElement));\n  }\n\n  private _receiveAttack = async (\n    attackCoordinates: Coordinates\n  ): Promise<AttackResult> => {\n    const gridCellDataKey: GridCellDataKey = `[data-x=\"${attackCoordinates[0]}\"][data-y=\"${attackCoordinates[1]}\"]`;\n    const gridCell: HTMLDivElement | null =\n      this.gameboardContainer.querySelector<HTMLDivElement>(gridCellDataKey);\n\n    if (!gridCell) {\n      throw new Error('Grid cell not found.');\n    }\n\n    if (this.hasTargetBeenAttacked(attackCoordinates)) {\n      /* </>\n      \n       [INFO]                                                                      \n       This case is unreachable with Billow's coordinate logic,                    \n       but valid when playing against a human who may repeat attacks.              \n                                                                                   \n       [BACKLOG]                                                                    \n       TODO: Add a flash animation to indicate \"Cell already attacked\".             \n                                                                                   \n      \n      */\n\n      console.warn('Cell has already been attacked:', attackCoordinates);\n\n      return {\n        hit: false,\n      } as AttackResult;\n    }\n\n    const attackResult: AttackResult =\n      this.playerState.gameboardController.receiveAttack(attackCoordinates);\n    \n    try {\n      await this.triggerPrePlayerToggleAnimations(attackResult, gridCell);\n    } catch (error) {\n      console.error('Error in triggerPrePlayerToggleAnimations', error);\n    }\n\n    this.togglePlayerTurn(attackResult);\n\n    return attackResult;\n  }\n\n  private receiveAttack = async (\n    attackCoordinates: Coordinates\n  ): Promise<AttackResult> => {\n    return await this._receiveAttack(attackCoordinates);\n  }\n\n  private refreshGameboard(boardContainer: HTMLElement): void {\n    /* </>\n    \n     [BACKLOG]                                                                   \n     TODO: Refactor this method to remove only the ship being moved and          \n     re-place it at the new position instead of resetting the entire board. This \n     will improve performance, preserve other ship states, and reduce unnecessary\n     operations.                                                                 \n    \n   */\n    \n    const gameboard = boardContainer.querySelector(`#${this.id}-gameboard`);\n    const gameboardBackground = boardContainer.querySelector(\n      `#${this.id}-gameboard-background`\n    );\n\n    if (!gameboard || !gameboardBackground)\n      throw new Error('Missing gameboard and/or gameboard background elements');\n\n    this.gameboardContainer.removeChild(gameboard);\n    this.gameboardContainer.removeChild(gameboardBackground);\n    this.shipDragClone.classList.remove('visible');\n\n    this.gameboard = this.generateBoardFragment(\n      this.playerState.gameboardBuilder.boardSize\n    );\n\n    this.gameboardContainer.appendChild(this.gameboard);\n\n    this.handleFleetPlacement(\n      this.playerState.fleetBuilder,\n      this.fleetElements\n    );\n  }\n\n  private refreshGameboardWrapper = (): void => {\n    this.refreshGameboard(this.gameboardContainer);\n  };\n\n  private setGridPlacementValue(\n    gridPlacementValue: GridPlacementValue,\n    gridCrossAxis: number,\n    shipContainerElement: HTMLDivElement,\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): void {\n    const isHorizontal: boolean = orientation === 'horizontal';\n    if (isHorizontal) {\n      shipContainerElement.style.gridColumn = gridPlacementValue;\n      shipContainerElement.style.gridRow = gridCrossAxis.toString();\n      shipContainerElement.style.gridTemplateColumns = `repeat(${shipLength}, 1fr)`;\n    } else {\n      shipContainerElement.style.gridRow = gridPlacementValue;\n      shipContainerElement.style.gridColumn = gridCrossAxis.toString();\n      shipContainerElement.style.gridTemplateRows = `repeat(${shipLength}, 1fr)`;\n    }\n  }\n\n  private setFleetElements = (\n    shipType: ShipType,\n    shipLength: ShipLength,\n    gridPlacementValue: GridPlacementValue,\n    gridCrossAxis: number,\n    orientation: Orientation\n  ) => {\n    const shipElement: HTMLDivElement = this.createShipElement(\n      shipType,\n      shipLength,\n      gridPlacementValue,\n      gridCrossAxis,\n      orientation\n    );\n\n    this.fleetElements.set(shipType, shipElement);\n  };\n\n  private sinkShip = async (\n    shipContainerElement: HTMLDivElement\n  ): Promise<void> => {\n    const DELAY_AFTER_TRANSITION_SECOND: number = 1;\n\n    shipContainerElement.classList.add('sunk');\n\n    await waitForEvent(shipContainerElement, 'animationend');\n\n    await this.handleShipUnitCooked(shipContainerElement);\n\n    await delay(DELAY_AFTER_TRANSITION_SECOND * 1000);\n  };\n\n  private toggleGameboardControls = (newGameboardState: gameboardStateValue): void => {\n    this.gameboardContainer.classList.toggle(\n      'locked',\n      newGameboardState === gameboardStateValue.inactive\n    );\n  };\n\n  private triggerPrePlayerToggleAnimations = async (\n    attackResult: AttackResult,\n    gridCell: HTMLDivElement\n  ): Promise<void> => {\n    if (attackResult.isSunk) {\n      this.gameState.eventBus.emit(\n        'setAndScrollToNextSitRep',\n        attackResult\n      );\n      await this.updateGameboardPostAttack(attackResult, gridCell);\n    } else {\n      this.updateGameboardPostAttack(attackResult, gridCell);\n      await this.gameState.eventBus.emit(\n        'setAndScrollToNextSitRep',\n        attackResult\n      );\n    }\n  };\n\n  private updateFleetElements = (\n    fleetBuilder: BattleshipFleetBuilder\n  ) => {\n    if (this.fleetElements.size) this.fleetElements.clear();\n\n    for (const ship of Object.values(fleetBuilder.fleet)) {\n      const shipType: ShipType = ship.type;\n      const shipLength: ShipLength = ship.length;\n\n      const orientation: Orientation | null =\n        ship.currentplacementConfigurations.orientation;\n\n      if (!orientation) throw new Error('Orientation not set.');\n\n      const coordinatesArray: CoordinatesArray | null =\n        ship.currentplacementConfigurations.coordinatesArray;\n\n      if (!coordinatesArray || coordinatesArray.length === 0) {\n        console.error(`The ${shipType} has not been placed. Continuing...`);\n        continue;\n      }\n\n      const bowCoordinates: Coordinates = coordinatesArray[0];\n      const [gridPlacementValue, gridCrossAxis]: [\n        GridPlacementValue,\n        number\n      ] = this.getGridPlacementValue(bowCoordinates, orientation, shipLength);\n\n      this.setFleetElements(\n        shipType,\n        shipLength,\n        gridPlacementValue,\n        gridCrossAxis,\n        orientation\n      );\n    }\n  };\n\n  private updateGameboardPostAttack = async (\n    attackResult: AttackResult,\n    gridCell: HTMLDivElement\n  ): Promise<void> => {\n    const { hit, isSunk, type } = attackResult;\n\n    if (!hit) {\n      gridCell.classList.add('miss');\n    }\n\n    if (hit && !isSunk) {\n      gridCell.classList.add('hit');\n    }\n\n    if (hit && isSunk) {\n      if (!isShipType(type))\n        throw new Error(`The ${type} is not a valid ship type.`);\n\n      gridCell.classList.add('hit');\n      const ship: BattleshipBuilder =\n        this.playerState.fleetBuilder.getShip(type);\n\n      const { bowCoordinates, orientation, shipLength } =\n        this.getShipGridPlacementData(ship);\n\n      if (!this.fleetElements.has(ship.type)) {\n        throw new Error(`The ${ship.type} has no fleet element.`);\n      }\n\n      const shipContainerElement = this.fleetElements.get(ship.type);\n\n      if (!shipContainerElement) {\n        throw new Error(`The ${ship.type} has no fleet element.`);\n      }\n\n      this.getAndSetGridPlacementValue(\n        shipContainerElement,\n        bowCoordinates,\n        orientation,\n        shipLength\n      );\n\n      await this.sinkShip(shipContainerElement);\n    }\n  };\n\n  //  --------------------------------------------------------------\n  //  Ship Repositioning\n\n  private handleShipDragStart(e: DragEvent, dragState: DragState) {\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.ship-container')\n    )\n      return;\n\n    const setInitialDragStyles = (\n      shipContainerElement: HTMLDivElement\n    ): void => {\n      // Set dragging attribute to true\n      shipContainerElement.setAttribute('data-dragging', 'true');\n\n      // TODO: Make this less hacky  by adding class instead?\n      // Enable drag events for grid cells under ship containers\n      setTimeout(() => {\n        shipContainerElement.classList.add('locked');\n      }, 0);\n\n      // Make clone visible\n      this.shipDragClone.classList.add('visible');\n    };\n    const setCloneDimensions = (\n      shipContainer: HTMLDivElement,\n      shipClone: HTMLDivElement\n    ) => {\n      const shipBoundingRect = shipContainer.getBoundingClientRect();\n      shipClone.style.height = `${shipBoundingRect.height}px`;\n      shipClone.style.width = `${shipBoundingRect.width}px`;\n    };\n    const getCloneSnapOffset = (\n      shipContainerElement: HTMLDivElement,\n      orientation: Orientation,\n      dragState: DragState\n    ): CloneSnapOffset => {\n      const getShipBow = (\n        shipContainerElement: HTMLDivElement\n      ): HTMLDivElement => {\n        const shipBow: HTMLDivElement | null =\n          shipContainerElement.querySelector(`.ship-bow`);\n        if (!shipBow) throw new Error('Ship bow not found.');\n        return shipBow;\n      };\n\n      // Get ship bow element (cursor snap position)\n      const shipBow: HTMLDivElement = getShipBow(shipContainerElement);\n\n      // Get border of ship border to include in offset calculations\n      const shipBorderSize = getComputedStyle(document.documentElement)\n        .getPropertyValue('--ship-container-border-size')\n        .trim();\n\n      const match = shipBorderSize.match(\n        /^(?<numberValue>\\d+(\\.\\d+)?)(?<unitType>[a-z%]+)$/i\n      );\n\n      /* \n       \n        REGARDING ABOVE                                                         \n                                                                                    \n        Use ES2018 named match groups syntax to extract CSS variable values.        \n                                                                                    \n        (\\d+(\\.\\d+)?) matches any number of digits as  (primary capturing group)    \n                                                                                    \n        This is followed by an optional subgroup (\\.\\d+) for a decimal point        \n        and fractional                                                              \n        digits.                                                                     \n                                                                                    \n        This allows the entire first capturing group (\\d+(\\.\\d+)?) to match          \n        integers or floating-point                                                   \n        numbers.                                                                    \n                                                                                      \n        The ?<numberValue> syntax names the capturing group, storing it in          \n        `match.groups` for easy                                                     \n        access.                                                                     \n                                                                                      \n        This is destructured to extract potential floating-point numbers             \n        representing the ship's border                                              \n        size.                                                                       \n                                                                                    \n        The script dynamically updates the border size by reading the value         \n        directly from the SCSS                                                      \n        file.                                                                        \n                                                                                      \n        Currently, it only supports border sizes specified in pixels, but            \n        the `unitType` match group could be used to support other unit types        \n        in the future.                                                              \n                                                                                      \n        I don't feel like doing all that right now.                                |\n       \n      */\n\n      if (!match || !match.groups)\n        throw new Error('No matches found when parsing');\n\n      const shipBorderValueSplit =\n        match.groups as ShipBorderValueSplit;\n\n      dragState.shipBorderValueSplit = shipBorderValueSplit;\n\n      const isHorizontal: boolean = orientation === 'horizontal';\n\n      const [offsetX, offsetY] = isHorizontal\n        ? [\n            shipBow.getBoundingClientRect().width / 2,\n            shipBow.getBoundingClientRect().height / 2 +\n              Number(shipBorderValueSplit.numberValue),\n          ]\n        : [\n            shipBow.getBoundingClientRect().width / 2 +\n              Number(shipBorderValueSplit.numberValue),\n            shipBow.getBoundingClientRect().height / 2,\n          ];\n\n      const cloneSnapOffset: CloneSnapOffset = {\n        offsetX,\n        offsetY,\n      };\n\n      return cloneSnapOffset;\n    };\n    const classifyValidCellCoordinates = (\n      boardContainer: HTMLElement,\n      shipContainerElement: HTMLDivElement,\n      orientation: Orientation,\n      gameboardController: BattleshipBoardController\n    ): void => {\n      const shipLengthAttr: number | null = Number(\n        shipContainerElement.getAttribute('data-length')\n      );\n      if (!shipLengthAttr || !isShipLength(shipLengthAttr)) {\n        throw new Error('Invalid or missing ship type attribute.');\n      }\n\n      const classifyValidBowCells = (\n        gridCells: NodeListOf<HTMLDivElement>,\n        shipLength: ShipLength,\n        orientation: Orientation\n      ) => {\n        const allValidBowCoordinates: Set<Coordinates> =\n          gameboardController.getAllValidBowCoordinates(\n            orientation,\n            shipLength\n          );\n\n        gridCells.forEach((gridCell: HTMLDivElement) => {\n          const gridCellCoordinates: Coordinates = [\n            Number(gridCell.getAttribute('data-x')),\n            Number(gridCell.getAttribute('data-y')),\n          ];\n\n          for (const validBowCoordinates of allValidBowCoordinates) {\n            if (\n              !areArraysEqual(\n                validBowCoordinates,\n                gridCellCoordinates\n              )\n            )\n              continue;\n            gridCell.classList.add('valid-bow-coordinates');\n          }\n        });\n      };\n\n      const shipLength: ShipLength = shipLengthAttr;\n\n      const gridCells: NodeListOf<HTMLDivElement> =\n        boardContainer.querySelectorAll('.grid-cell');\n\n      classifyValidBowCells(gridCells, shipLength, orientation);\n    };\n    const updateDragState = (\n      dragState: DragState,\n      fleet: Fleet,\n      shipType: ShipType,\n      cloneSnapOffset: CloneSnapOffset\n    ) => {\n      // Ensure the ship type exists in the fleet\n      if (!fleet[shipType])\n        throw new Error(`The ${shipType} is not present in the fleet.`);\n\n      // Set the current ship instance and its initial configurations\n      dragState.currentShipInstance = fleet[shipType];\n      dragState.initialPlacementConfigurations =\n        dragState.currentShipInstance.currentplacementConfigurations;\n      dragState.cloneSnapOffset = cloneSnapOffset;\n    };\n\n    const shipContainerElement: HTMLDivElement = e.target;\n    const orientation: Orientation =\n      getConvertedTypeFromAttr(\n        shipContainerElement,\n        'data-orientation',\n        isOrientation\n      );\n\n    const fleet: Fleet = this.playerState.fleetBuilder.fleet;\n    const shipType: ShipType =\n      getConvertedTypeFromAttr(\n        shipContainerElement,\n        'data-shiptype',\n        isShipType\n      );\n\n    const cloneSnapOffset: CloneSnapOffset = getCloneSnapOffset(\n      shipContainerElement,\n      orientation,\n      dragState\n    );\n\n    updateDragState(dragState, fleet, shipType, cloneSnapOffset);\n\n    if (!dragState.currentShipInstance)\n      throw new Error(\n        `Drag state hasn't been updated with the current ship instance on drag start. Drag State: ${JSON.stringify(\n          dragState\n        )}`\n      );\n\n    // Remove the piece from the gameboard (non-null ensured by `setUpShipForDrag`)\n    this.playerState.gameboardController.removePiece(\n      dragState.currentShipInstance\n    );\n\n    // Set drag image to be transparent 1 x 1 png\n    e.dataTransfer?.setDragImage(this.dragImage, 0, 0);\n\n    setCloneDimensions(shipContainerElement, this.shipDragClone);\n    setInitialDragStyles(shipContainerElement);\n    classifyValidCellCoordinates(\n      this.gameboardContainer,\n      shipContainerElement,\n      orientation,\n      this.playerState.gameboardController\n    );\n    this.snapCloneToCursor(e, cloneSnapOffset);\n  }\n\n  private handleShipDrag(e: DragEvent, dragState: DragState) {\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.ship-container')\n    )\n      return;\n\n    const cloneSnapOffset: CloneSnapOffset | null =\n      dragState.cloneSnapOffset;\n\n    if (!cloneSnapOffset)\n      throw new Error(\n        'An error has occured during the `cloneSnapOffset` reading.'\n      );\n\n    this.snapCloneToCursor(e, cloneSnapOffset);\n  }\n\n  private handleShipDragEnter(e: DragEvent) {\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.grid-cell')\n    )\n      return;\n\n    const gridCell: HTMLDivElement = e.target;\n\n    // Check if current grid cell is valid for placement\n    const areValidBowCoordinates: boolean = gridCell.classList.contains(\n      'valid-bow-coordinates'\n    );\n\n    // Add appropriate visual feedback class to grid cell\n    areValidBowCoordinates\n      ? gridCell.classList.add('placement-is-valid')\n      : gridCell.classList.add('placement-is-invalid');\n\n    // Add appropriate visual feedback class to ship drag clone\n    if (areValidBowCoordinates)\n      this.shipDragClone.classList.add('placement-is-valid');\n  }\n\n  private handleShipDragLeave(e: DragEvent) {\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.grid-cell')\n    )\n      return;\n\n    const gridCell: HTMLDivElement = e.target;\n\n    const areValidBowCoordinates: boolean =\n      gridCell.classList.contains('placement-is-valid');\n\n    // Remove assigned visual feedback class from grid cell\n    areValidBowCoordinates\n      ? gridCell.classList.remove('placement-is-valid')\n      : gridCell.classList.remove('placement-is-invalid');\n\n    // Remove assigned visual feedback class from ship drag clone\n    if (this.shipDragClone.classList.contains('placement-is-valid'))\n      this.shipDragClone.classList.remove('placement-is-valid');\n  }\n\n  private handleShipDragOver(e: DragEvent, dragState: DragState) {\n    // Enables the drop event to fire\n    e.preventDefault();\n\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.grid-cell')\n    )\n      return;\n\n    const gridCell: HTMLDivElement = e.target;\n\n    // Update drag state for cleanup\n    dragState.currentDragOverCell = gridCell;\n\n    // Prevent further operations for invalid cells\n    if (!gridCell.classList.contains('valid-bow-coordinates')) return;\n  }\n\n  private handleShipDrop(e: DragEvent, dragState: DragState) {\n    e.preventDefault();\n\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.valid-bow-coordinates')\n    )\n      return;\n\n    // Validate and modify state\n    const { coordinatesArray, orientation: initialOrientation } =\n      dragState.initialPlacementConfigurations || {};\n\n    if (!coordinatesArray || !initialOrientation) {\n      throw new Error('Initial placement configurations are incomplete.');\n    }\n\n    dragState.isValidDropTarget = true;\n\n    const validGridCell: HTMLDivElement = e.target;\n\n    // Retrieve new coordinates from the valid grid cell\n    const xAttr = validGridCell.getAttribute('data-x');\n    const yAttr = validGridCell.getAttribute('data-y');\n    if (!xAttr || !yAttr) {\n      throw new Error('Missing or invalid grid cell coordinates.');\n    }\n    const newCoordinates: Coordinates = [\n      Number(xAttr),\n      Number(yAttr),\n    ];\n\n    this.playerState.gameboardController.placePiece({\n      ship: dragState.currentShipInstance!,\n      coordinates: newCoordinates,\n      orientation: initialOrientation,\n    });\n\n    // Re-renders board with new ship placement\n    this.refreshGameboard(this.gameboardContainer);\n\n    // Reset valid drop target state\n    dragState.isValidDropTarget = false;\n  }\n\n  private handleShipDragEnd(e: DragEvent, dragState: DragState) {\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.ship-container')\n    )\n      return;\n\n    const resetShipPosition = (): void => {\n      const { coordinatesArray, orientation: initialOrientation } =\n        dragState.initialPlacementConfigurations || {};\n      if (!coordinatesArray || !initialOrientation) {\n        throw new Error('Initial placement configurations are incomplete.');\n      }\n\n      // Get bow coordinates\n      const initialBowCoordinates: Coordinates =\n        coordinatesArray[0];\n\n      // Re-place ship on logic gameboard\n      this.playerState.gameboardController.placePiece({\n        ship: dragState.currentShipInstance!,\n        coordinates: initialBowCoordinates,\n        orientation: initialOrientation,\n      });\n    };\n\n    const removeDragStyles = (\n      shipContainerElement: HTMLDivElement,\n      currentDragOverCell: HTMLDivElement,\n      isValidDropTarget: boolean\n    ): void => {\n      const cellFeedbackClass: string = isValidDropTarget\n        ? 'placement-is-valid'\n        : 'placement-is-invalid';\n\n      // Set dragging attribute to false\n      shipContainerElement.setAttribute('data-dragging', 'false');\n\n      // Lower grid cell validation pseudo-element opacity\n      currentDragOverCell.classList.remove(cellFeedbackClass);\n\n      // Re-hide drag clone\n      this.shipDragClone.classList.remove('visible');\n\n      // Restore ship container draggability\n      shipContainerElement.classList.remove('locked');\n    };\n\n    const shipContainerElement: HTMLDivElement = e.target;\n\n    try {\n      const { currentDragOverCell, isValidDropTarget } = dragState;\n\n      if (!currentDragOverCell)\n        throw new Error(\n          `Current drag over cell is missing. Drag state: ${JSON.stringify(\n            dragState\n          )}`\n        );\n\n      removeDragStyles(\n        shipContainerElement,\n        currentDragOverCell,\n        isValidDropTarget\n      );\n\n      if (!isValidDropTarget) {\n        resetShipPosition();\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  private handleShipRotation = (e: MouseEvent) => {\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.ship-container')\n    )\n      return;\n\n    const shipContainerElement: HTMLDivElement = e.target;\n\n    const shipType: ShipType =\n      getConvertedTypeFromAttr(\n        shipContainerElement,\n        'data-shiptype',\n        isShipType\n      );\n\n    const ship = this.playerState.fleetBuilder.getShip(shipType);\n\n    this.playerState.gameboardController.rotatePiece(ship);\n    this.refreshGameboard(this.gameboardContainer);\n  };\n\n  private snapCloneToCursor(\n    e: DragEvent,\n    cloneSnapOffset: CloneSnapOffset\n  ): void {\n    const gameboardClientRect: DOMRect =\n      this.gameboardContainer.getBoundingClientRect();\n    const gameboardOffsetX: number = gameboardClientRect.left;\n    const gameboardOffsetY: number = gameboardClientRect.top;\n\n    const cursorX: number = e.clientX;\n    const cursorY: number = e.clientY;\n\n    const { offsetX, offsetY }: CloneSnapOffset = cloneSnapOffset;\n\n    document.documentElement.style.setProperty(\n      '--ship-clone-left',\n      `${cursorX - gameboardOffsetX - offsetX}px`\n    );\n\n    document.documentElement.style.setProperty(\n      '--ship-clone-top',\n      `${cursorY - gameboardOffsetY - offsetY}px`\n    );\n  }\n\n  //  -------------------------------------------------------------\n  // -\n\n  //  --------------------------------------------------------------\n  //  Utilities\n\n  // TODO: Do I need this\n  public getId(): string {\n    return this.id;\n  }\n}\n","import {\n  Coordinates,\n  CoordinatesArray,\n  Fleet,\n  Gameboard,\n  IPlacementConfigurations,\n  Orientation,\n  ShipLength,\n  ShipSymbolValue,\n  ShipSymbolValueArray,\n  ShipType,\n} from '../../../../types/logic-types';\nimport {\n  createElement,\n  waitForTransitionEnd,\n  delay,\n  waitForEvent,\n} from '../../../../utilities/random-utilities';\nimport { AttackResult, PlayerState, gameboardStateValue } from '../../../../types/state-types';\nimport '../gameboard-component.scss';\nimport '../gameboard-animations.scss';\n\nimport { isShipType } from '../../../../types/type-guards';\nimport { BattleshipBuilder } from '../../../../logic/bs-ship-builder/bs-ship-builder';\nimport { GridPlacementValue } from '../../../../types/css-types';\nimport { BattleshipFleetBuilder } from '../../../../logic/bs-fleet-builder/bs-fleet-builder';\nimport { GameState } from '../../../../state/game-state';\n\nexport class OpponentGameboardComponent {\n  private readonly id: string = 'opponent';\n\n  private gameboardContainer: HTMLDivElement;\n  private fleetElements: Map<ShipType, HTMLDivElement> = new Map();\n\n  constructor(\n    public readonly playerState: PlayerState,\n    private readonly gameState: GameState\n  ) {\n    this.gameboardContainer = this.generateBoardContainer(\n      this.playerState.gameboardBuilder.boardSize\n    );\n\n    this.updateFleetElements(this.playerState.fleetBuilder);\n\n    this.gameState.eventBus.on(\n      'toggleOpponentGameboardControls',\n      this.toggleGameboardControls\n    );\n  }\n\n  public render(targetElement: HTMLElement): void {\n    if (!targetElement) {\n      throw new Error(\n        `Target element not found with ID - ${this.id} and selector - \"${targetElement}\".`\n      );\n    }\n\n    const gameboard: DocumentFragment = this.generateBoardFragment(\n      this.playerState.gameboardBuilder.boardSize\n    );\n    this.gameboardContainer.appendChild(gameboard);\n\n    this.placeFleetOnGameboard(this.fleetElements);\n\n    targetElement.appendChild(this.gameboardContainer);\n  }\n\n  public toggleBellumListeners = (newGameboardState: gameboardStateValue): void => {\n    if (!this.gameboardContainer) return;\n\n    const method = newGameboardState === gameboardStateValue.inactive\n      ? 'removeEventListener'\n      : 'addEventListener';\n\n    this.gameboardContainer[method](\n      'click',\n      this.handleCellClick as EventListener\n    );\n  };\n\n  //  --------------------------------------------------------------\n  //  Helpers\n\n  private checkForWin(): boolean {\n    if (!this.playerState.gameboardRepository.areAllShipsSunk()) return false;\n\n    // TODO: Do something fun with this value.. set winner in repository ?\n    alert(\n      `${\n        this.gameState.currentPlayer === 'player' ? 'You win' : 'You lose'\n      } mother fucker! #TYPESHIT`\n    );\n\n    this.gameState.transitionToNextPhase();\n\n    return true;\n  }\n\n  private createBackgroundCellsFragment(\n    gameboard: Gameboard\n  ): DocumentFragment {\n    const cellFragment: DocumentFragment = new DocumentFragment();\n\n    gameboard.forEach((row: ShipSymbolValueArray, rowIndex: number) => {\n      // ? The ship symbol value isn't used to classify opponent board grid cells,\n      // ? otherwise players could inspect dev tools and see where the opponent's ships are.\n      row.forEach((_: ShipSymbolValue, colIndex: number) => {\n        const hitMarker: HTMLDivElement = createElement('div', [\n          `${this.id}-hit-marker`,\n          'hit-marker',\n        ]);\n\n        const gridCell: HTMLDivElement = createElement(\n          'div',\n          [`${this.id}-grid-cell`, 'grid-cell'],\n          {\n            'data-x': colIndex.toString(),\n            'data-y': rowIndex.toString(),\n            'aria-label': `Row ${rowIndex + 1}, Column ${colIndex + 1}`,\n            role: 'gridCell',\n          }\n        );\n        gridCell.appendChild(hitMarker);\n\n        const gridCellContainer: HTMLDivElement = createElement('div', [\n          `${this.id}-grid-cell-container`,\n          'grid-cell-container',\n        ]);\n        gridCellContainer.appendChild(gridCell);\n        \n        cellFragment.appendChild(gridCellContainer);\n      });\n    });\n\n    return cellFragment;\n  }\n\n  private createShipElement(\n    shipType: ShipType,\n    shipLength: ShipLength,\n    orientation: Orientation\n  ): HTMLDivElement {\n    const shipUnitFragment: DocumentFragment = this.generateShipUnitFragment(\n      shipLength,\n      shipType,\n      orientation,\n      this.id\n    );\n\n    const shipContainerElement: HTMLDivElement = createElement(\n      'div',\n      ['opponent-ship-container'],\n      {\n        id: `${this.id}-${shipType}-container`,\n      }\n    );\n    shipContainerElement.appendChild(shipUnitFragment);\n\n    return shipContainerElement;\n  }\n\n  private generateBoardContainer(boardSize: number): HTMLDivElement {\n    const gameboardContainer: HTMLDivElement = createElement(\n      'div',\n      ['gameboard-container', 'locked'],\n      {\n        id: `${this.id}-gameboard-container`,\n      }\n    );\n\n    gameboardContainer.style.setProperty('--grid-size', boardSize.toString());\n\n    return gameboardContainer;\n  }\n\n  private generateBoardFragment(boardSize: number): DocumentFragment {\n    const gameboardBackground: HTMLDivElement = createElement(\n      'div',\n      ['gameboard-background'],\n      {\n        id: `${this.id}-gameboard-background`,\n      }\n    );\n    gameboardBackground.appendChild(\n      this.createBackgroundCellsFragment(\n        this.playerState.gameboardBuilder.board\n      )\n    );\n\n    const gameboard = createElement('div', ['gameboard'], {\n      id: `${this.id}-gameboard`,\n    });\n    gameboard.style.setProperty('--grid-size', boardSize.toString());\n\n    this.fleetElements.forEach((shipContainerElement) => {\n      gameboard.appendChild(shipContainerElement);\n    });\n\n    const boardFragment: DocumentFragment = new DocumentFragment();\n    boardFragment.append(gameboardBackground, gameboard);\n\n    return boardFragment;\n  }\n\n  private generateShipUnitFragment(\n    shipLength: ShipLength,\n    shipType: ShipType,\n    orientation: Orientation,\n    id: string\n  ): DocumentFragment {\n    const shipUnitFragment: DocumentFragment = new DocumentFragment();\n\n    for (let i = 0; i < shipLength; i++) {\n      const isBow: boolean = i === 0;\n      const isStern: boolean = i === shipLength - 1;\n      const shipUnit: HTMLDivElement = createElement('div', [\n        'ship-unit',\n        `${shipType}-unit`,\n        `${id}-${shipType}-unit`,\n      ]);\n\n      const isHorizontal: boolean = orientation === 'horizontal';\n\n      isHorizontal\n        ? shipUnit.classList.add('ship-unit-horizontal')\n        : shipUnit.classList.add('ship-unit-vertical');\n\n      if (isBow) {\n        shipUnit.classList.add('ship-bow');\n        shipUnit.setAttribute('id', `${id}-${shipType}-bow`);\n      }\n\n      if (isStern) {\n        shipUnit.classList.add('ship-stern');\n        shipUnit.setAttribute('id', `${id}-${shipType}-stern`);\n      }\n\n      shipUnitFragment.appendChild(shipUnit);\n    }\n\n    return shipUnitFragment;\n  }\n\n  private getAndSetGridPlacementValue(\n    shipContainerElement: HTMLDivElement,\n    bowCoordinates: Coordinates,\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): void {\n    const [gridPlacementValue, gridCrossAxis]: [GridPlacementValue, number] =\n      this.getGridPlacementValue(bowCoordinates, orientation, shipLength);\n\n    this.setGridPlacementValue(\n      gridPlacementValue,\n      gridCrossAxis,\n      shipContainerElement,\n      orientation,\n      shipLength\n    );\n  }\n\n  private getAttackCoordinates(gridCell: HTMLDivElement): Coordinates {\n    const dataX = gridCell.getAttribute('data-x');\n    const dataY = gridCell.getAttribute('data-y');\n\n    if (dataX == null || dataY == null) {\n      throw new Error('Could not retrieve coordinates from grid cell.');\n    }\n\n    return [+dataX, +dataY];\n  }\n\n  private getGridPlacementValue(\n    coordinates: Coordinates,\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): [GridPlacementValue, number] {\n    const isHorizontal = orientation === 'horizontal';\n\n    const [x, y] = coordinates;\n    const gridStartMain = isHorizontal ? x + 1 : y + 1;\n    const gridCrossAxis = isHorizontal ? y + 1 : x + 1;\n\n    return [`${gridStartMain} / span ${shipLength}`, gridCrossAxis];\n  }\n\n  private getShipGridPlacementData(ship: BattleshipBuilder): {\n    bowCoordinates: Coordinates;\n    orientation: Orientation;\n    shipLength: ShipLength;\n  } {\n    const placementConfigurations: IPlacementConfigurations =\n      ship.currentplacementConfigurations;\n\n    if (\n      !placementConfigurations.coordinatesArray ||\n      !placementConfigurations.orientation\n    )\n      throw new Error(`The ${ship.type} has no placement configurations.`);\n\n    const bowCoordinates: Coordinates =\n      placementConfigurations.coordinatesArray[0];\n    const orientation: Orientation = placementConfigurations.orientation;\n\n    const shipLength: ShipLength = ship.length;\n\n    return {\n      bowCoordinates,\n      orientation,\n      shipLength,\n    };\n  }\n\n  private handleCellClick = (e: MouseEvent): void => {\n    this.receiveAttack(e);\n  };\n\n  private async handleShipUnitCooked(\n    shipContainerElement: HTMLDivElement\n  ): Promise<void> {\n    const shipUnits = Array.from(\n      shipContainerElement.children\n    ) as HTMLElement[];\n\n    // Stagger animations\n    shipUnits.forEach((unit, i) => {\n      setTimeout(() => {\n        unit.classList.add('cooked');\n      }, 333 * (i + 1));\n    });\n\n    const lastUnit = shipUnits[shipUnits.length - 1];\n\n    // Wait for the animation of the last unit to end\n    await waitForTransitionEnd(lastUnit);\n  }\n\n  private hasTargetBeenAttacked(coordinates: Coordinates): boolean {\n    const alreadyAttacked =\n      this.playerState.gameboardRepository.hasTargetBeenAttacked(coordinates);\n\n    if (!alreadyAttacked) {\n      this.playerState.gameboardRepository.addAttackedCoordinates(coordinates);\n    }\n\n    return alreadyAttacked;\n  }\n\n  private placeFleetOnGameboard(\n    fleetElements: Map<ShipType, HTMLDivElement>\n  ): void {\n    const gameboard =\n      this.gameboardContainer.querySelector<HTMLDivElement>('.gameboard');\n\n    if (!gameboard) {\n      throw new Error('Gameboard container not found.');\n    }\n\n    fleetElements.forEach((shipElement) => gameboard.appendChild(shipElement));\n  }\n\n  private async receiveAttack(e: MouseEvent): Promise<void> {\n    if (\n      !(e.target instanceof HTMLDivElement) ||\n      !e.target.matches('.grid-cell')\n    )\n      return;\n\n    const gridCell: HTMLDivElement = e.target;\n\n    const attackCoordinates: Coordinates = this.getAttackCoordinates(gridCell);\n\n    if (this.hasTargetBeenAttacked(attackCoordinates)) {\n      // TODO: Add a flash animation to indicate \"Cell already attacked\".\n      return;\n    }\n\n    this.toggleBellumListeners(gameboardStateValue.inactive);\n    this.toggleGameboardControls(gameboardStateValue.inactive);\n    \n    const attackResult: AttackResult =\n    this.playerState.gameboardController.receiveAttack(attackCoordinates);\n    \n    try {\n      await this.triggerPrePlayerToggleAnimations(attackResult, gridCell);\n    } catch (error) {\n      console.error('Animation failed', error);\n    }\n    \n    this.togglePlayerTurn(attackResult); \n  }\n\n  private setGridPlacementValue(\n    gridPlacementValue: GridPlacementValue,\n    gridCrossAxis: number,\n    shipContainerElement: HTMLDivElement,\n    orientation: Orientation,\n    shipLength: ShipLength\n  ): void {\n    const isHorizontal: boolean = orientation === 'horizontal';\n    if (isHorizontal) {\n      shipContainerElement.style.gridColumn = gridPlacementValue;\n      shipContainerElement.style.gridRow = gridCrossAxis.toString();\n      shipContainerElement.style.gridTemplateColumns = `repeat(${shipLength}, 1fr)`;\n    } else {\n      shipContainerElement.style.gridRow = gridPlacementValue;\n      shipContainerElement.style.gridColumn = gridCrossAxis.toString();\n      shipContainerElement.style.gridTemplateRows = `repeat(${shipLength}, 1fr)`;\n    }\n  }\n\n  private sinkShip = async (\n    shipContainerElement: HTMLDivElement\n  ): Promise<void> => {\n    const DELAY_AFTER_TRANSITION_SECOND: number = 1;\n\n    shipContainerElement.classList.add('sunk');\n\n    await waitForEvent(shipContainerElement, 'animationend');\n\n    await this.handleShipUnitCooked(shipContainerElement);\n\n    await delay(DELAY_AFTER_TRANSITION_SECOND * 1000);\n  };\n\n  private toggleGameboardControls = (\n    newGameboardState: gameboardStateValue\n  ): void => {\n    if (newGameboardState === gameboardStateValue.active) {\n      this.toggleBellumListeners(newGameboardState);\n    }\n\n    this.gameboardContainer.classList.toggle(\n      'locked',\n      newGameboardState === gameboardStateValue.inactive\n    );\n  };\n\n  private togglePlayerTurn(attackResult: AttackResult): void {\n    const { hit, isSunk } = attackResult;\n\n    if ((hit && !isSunk) || !hit) {\n      this.gameState.togglePlayerTurn();\n      return;\n    }\n\n    if (hit && isSunk) {\n      const gameOver = this.checkForWin();\n      if (!gameOver) {\n        this.gameState.togglePlayerTurn();\n        return;\n      }\n\n      // ? if it is game over, do some shit\n    }\n  }\n\n  private triggerPrePlayerToggleAnimations = async (\n    attackResult: AttackResult,\n    gridCell: HTMLDivElement\n  ): Promise<void> => {\n    if (attackResult.isSunk) {\n      this.gameState.eventBus.emit('setAndScrollToNextSitRep', attackResult);\n      await this.updateGameboardPostAttack(attackResult, gridCell);\n    } else {\n      this.updateGameboardPostAttack(attackResult, gridCell);\n      await this.gameState.eventBus.emit(\n        'setAndScrollToNextSitRep',\n        attackResult\n      );\n    }\n  };\n\n  private updateFleetElements(fleetBuilder: BattleshipFleetBuilder): void {\n    const fleet: Fleet = fleetBuilder.fleet;\n\n    for (const ship of Object.values(fleet)) {\n      const shipType: ShipType = ship.type;\n      const shipLength: ShipLength = ship.length;\n\n      const orientation: Orientation | null =\n        ship.currentplacementConfigurations.orientation;\n\n      if (!orientation) throw new Error('Orientation not set.');\n\n      const coordinatesArray: CoordinatesArray | null =\n        ship.currentplacementConfigurations.coordinatesArray;\n\n      if (!coordinatesArray || coordinatesArray.length === 0) {\n        console.error(`The ${shipType} has not been placed. Continuing...`);\n        continue;\n      }\n\n      const shipContainerElement: HTMLDivElement = this.createShipElement(\n        shipType,\n        shipLength,\n        orientation\n      );\n\n      this.fleetElements.set(shipType, shipContainerElement);\n    }\n  }\n\n  private updateGameboardPostAttack = async (\n    attackResult: AttackResult,\n    gridCell: HTMLDivElement\n  ): Promise<void> => {\n    const { hit, isSunk, type } = attackResult;\n\n    if (!hit) {\n      gridCell.classList.add('miss');\n    }\n\n    if (hit && !isSunk) {\n      gridCell.classList.add('hit');\n    }\n\n    if (hit && isSunk) {\n      if (!isShipType(type))\n        throw new Error(`The ${type} is not a valid ship type.`);\n\n      gridCell.classList.add('hit');\n      const ship: BattleshipBuilder =\n        this.playerState.fleetBuilder.getShip(type);\n\n      const { bowCoordinates, orientation, shipLength } =\n        this.getShipGridPlacementData(ship);\n\n      if (!this.fleetElements.has(ship.type)) {\n        throw new Error(`The ${ship.type} has no fleet element.`);\n      }\n\n      const shipContainerElement = this.fleetElements.get(ship.type);\n\n      if (!shipContainerElement) {\n        throw new Error(`The ${ship.type} has no fleet element.`);\n      }\n\n      this.getAndSetGridPlacementValue(\n        shipContainerElement,\n        bowCoordinates,\n        orientation,\n        shipLength\n      );\n\n      await this.sinkShip(shipContainerElement);\n    }\n  };\n\n  //  --------------------------------------------------------------\n  //  Utilities\n\n  // TODO: Do I need this\n  public getId(): string {\n    return this.id;\n  }\n}\n\n// TODO: add click listener that receieves an attack, toggles the state (updating main container one), etc.\n","import { createElement } from \"../../../utilities/random-utilities\";\n\nimport { PlayerGameboardComponent } from \"../../components/gameboard-component/player-gameboard-component/player-gameboard-component\";\nimport { OpponentGameboardComponent } from \"../../components/gameboard-component/opponent-gameboard-component/opponent-gameboard-component\";\n\nimport { PlayerState } from \"../../../types/state-types\";\nimport { GameState } from \"../../../state/game-state\";\n\nexport class MainContainerTwo {\n  private readonly mainContainerTwo: HTMLElement;\n\n  private readonly playerGameboardComponent: PlayerGameboardComponent;\n  private readonly opponentGameboardComponent: OpponentGameboardComponent;\n  \n  constructor(\n    players: { player: PlayerState; opponent: PlayerState },\n    private readonly gameState: GameState \n\n  ) {\n    this.playerGameboardComponent = new PlayerGameboardComponent(\n      players.player,\n      this.gameState\n    );\n    this.opponentGameboardComponent = new OpponentGameboardComponent(\n      players.opponent,\n      this.gameState\n    );\n\n    this.mainContainerTwo = createElement('section', ['main-container', 'parabellum'], {\n      id: 'main-container-two',\n    });\n  }\n\n  get element() { \n    return this.mainContainerTwo;\n  }\n\n  get playerGameboard() {\n    return this.playerGameboardComponent;\n  }\n\n  get opponentGameboard() {\n    return this.opponentGameboardComponent;\n  }\n\n  render(targetElement: HTMLElement) {\n    this.playerGameboardComponent.render(this.mainContainerTwo);\n    this.opponentGameboardComponent.render(this.mainContainerTwo);\n\n    targetElement.appendChild(this.mainContainerTwo);\n  }\n}\n\n","import { BattleshipBoardController } from \"../../../../logic/bs-gameboard-controller/bs-gameboard-controller\";\nimport { createElement } from \"../../../../utilities/random-utilities\";\nimport { Fleet } from \"../../../../types/logic-types\";\nimport { randomizeBSGameboard } from \"../../../../setup/randomize-bs-gameboard\";\nimport './ship-shuffler-component.scss';\nimport { GameState } from \"../../../../state/game-state\";\n\nexport class ShipShufflerButtonComponent {\n  private readonly shipShufflerButton: HTMLButtonElement;\n  private readonly shipShufflerButtonContainer: HTMLDivElement;\n  private readonly shipShufflerButtonTextContent: string = 'Shuffle';\n  private readonly buttonClass: string = 'ship-shuffler-button';\n\n  #listenerAttached: boolean = false;\n  private readonly shuffleShips: () => void = () => {\n    this.randomizeGameboard();\n    this.updateGameboard();\n  };\n\n  constructor(\n    private id: string,\n    // private gameboardContainer: HTMLElement, // TODO: do i need this?\n    private gameboardController: BattleshipBoardController,\n    private fleet: Fleet,\n    private gameState: GameState\n  ) {\n    this.shipShufflerButton = this.createshipShufflerButton(\n      `${this.id}-${this.buttonClass}`,\n      [this.buttonClass]\n    );\n    this.shipShufflerButton.classList.add(this.buttonClass);\n    this.shipShufflerButton.textContent = this.shipShufflerButtonTextContent;\n    this.toggleEventListener();\n\n    this.shipShufflerButtonContainer = this.createshipShufflerButtonContainer();\n    this.shipShufflerButtonContainer.appendChild(this.shipShufflerButton);\n  }\n\n  public render(targetElement: HTMLElement) {\n    if (!targetElement) {\n      throw new Error(`Target element not found. Recieved ${targetElement}.`);\n    }\n\n    targetElement.appendChild(this.shipShufflerButtonContainer);\n  }\n\n  public toggleEventListener() {\n    if (this.#listenerAttached === true) {\n      this.shipShufflerButton.removeEventListener('click', this.shuffleShips)\n      this.#listenerAttached = false;\n    } else {\n      this.shipShufflerButton.addEventListener('click', this.shuffleShips);\n      this.#listenerAttached = true;\n    }\n  }\n\n  //  --------------------------------------------------------------\n  //  Helpers\n\n  private createshipShufflerButton(\n    id: string,\n    classes: string[]\n  ): HTMLButtonElement {\n    const button: HTMLButtonElement = createElement('button', [...classes], {\n      id,\n    });\n    return button;\n  }\n\n  private createshipShufflerButtonContainer(): HTMLDivElement {\n    const container: HTMLDivElement = createElement('div', [\n      'ship-shuffler-button-container',\n    ]);\n    return container;\n  }\n\n  private randomizeGameboard() {\n    this.gameboardController.removeAllPieces(this.fleet);\n    randomizeBSGameboard(this.gameboardController, this.fleet);\n  }\n\n  private updateGameboard(): void {\n    this.gameState.eventBus.emit('refreshGameboard');\n  }\n\n  //  --------------------------------------------------------------\n  //  Utilities\n\n  public getId() {\n    return this.id;\n  }\n}","import { createElement } from \"../../../../utilities/random-utilities\";\nimport { PlayerGameboardComponent } from \"../../gameboard-component/player-gameboard-component/player-gameboard-component\";\nimport { InstructionsComponent } from \"../instructions-component/instructions-component\";\nimport { ShipShufflerButtonComponent } from \"../ship-shuffler-component/ship-shuffler-component\";\nimport './ready-up-component.scss';\n\n// ! for testing\nimport { app } from \"../../../../../app\";\n\nexport class ReadyUpButtonComponent {\n  private readonly readyUpButton: HTMLButtonElement;\n  private readonly readyUpButtonContainer: HTMLDivElement;\n  private readonly readyUpButtonTextContent: string = 'Ready Up';\n  private readonly buttonId: string = 'ready-up-button';\n\n  #listenerAttached: boolean = false;\n\n  private readonly readyUp: () => void = () => { // TODO: replace any with GameState?\n    this.anchorShips();\n    this.removeParabellumButtonListeners();\n    this.transitionToBellum(); \n  };\n\n  constructor(\n    private playerGameboardComponent: PlayerGameboardComponent,\n    private shipShufflerButton: ShipShufflerButtonComponent,\n    private instructionsButton: InstructionsComponent,\n    private transitionToNextPhase: () => void\n  ) {\n    this.readyUpButton = this.createReadyUpButton(this.buttonId);\n\n    this.toggleEventListener();\n\n    this.readyUpButtonContainer = this.createReadyUpButtonContainer();\n    this.readyUpButtonContainer.appendChild(this.readyUpButton);\n  }\n\n  public render(targetElement: HTMLElement) {\n    if (!targetElement) {\n      throw new Error(`Target element not found. Recieved ${targetElement}.`);\n    }\n\n    targetElement.appendChild(this.readyUpButtonContainer);\n  }\n\n  public toggleEventListener() {\n    if (this.#listenerAttached === true) {\n      this.readyUpButton.removeEventListener('click', this.readyUp);\n      this.#listenerAttached = false;\n    } else {\n      this.readyUpButton.addEventListener('click', this.readyUp);\n      this.#listenerAttached = true;\n    }\n  }\n\n  //  --------------------------------------------------------------\n\n  private anchorShips() {\n    // remove event listners from gameboard\n    this.playerGameboardComponent.toggleParabellumListeners();\n\n    // remove draggable attribute from ships\n    this.playerGameboardComponent.toggleShipsDraggable();\n\n    // remove `adrift` class from ship containers\n    this.playerGameboardComponent.toggleShipAdriftClass();\n  }\n\n  private createReadyUpButton(id: string): HTMLButtonElement {\n    const readyUpTextSpan = createElement('span', ['ready-up-button-text']);\n    readyUpTextSpan.textContent = this.readyUpButtonTextContent;\n\n    const inactiveReadyUpButton = createElement(\n      'img',\n      ['inactive-ready-up-button'],\n      {\n        alt: 'Ready Up (Inactive)',\n        src: 'https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-inactive.svg',\n      }\n    );\n\n    const activeReadyUpButton = createElement(\n      'img',\n      ['active-ready-up-button'],\n      {\n        alt: 'Ready Up (Active)',\n        src: 'https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-active.svg',\n      }\n    );\n\n    const button: HTMLButtonElement = createElement('button', [], {\n      id,\n    });\n    button.append(activeReadyUpButton, inactiveReadyUpButton, readyUpTextSpan);\n\n    return button;\n  }\n\n  private createReadyUpButtonContainer(): HTMLDivElement {\n    const container: HTMLDivElement = createElement('div', [\n      'ready-up-button-container',\n    ]);\n    return container;\n  }\n\n  private removeParabellumButtonListeners() {\n    this.shipShufflerButton.toggleEventListener();\n    this.instructionsButton.toggleEventListener();\n    this.toggleEventListener();\n  }\n\n  private transitionToBellum() {\n    this.transitionToNextPhase();\n  }\n}","import { createElement } from \"../../../utilities/random-utilities\";\nimport { ShipShufflerButtonComponent } from \"../../components/buttons/ship-shuffler-component/ship-shuffler-component\";\nimport { ReadyUpButtonComponent } from \"../../components/buttons/ready-up-component/ready-up-component\";\n\nexport function createMainThreeParabellumFragment(\n  shipShufflerButton: ShipShufflerButtonComponent,\n  readyUpButton: ReadyUpButtonComponent\n): DocumentFragment {  \n  const mainContainerThreeParabellumWrapper: HTMLDivElement = createElement(\n    'div',\n    ['parabellum'],\n    {\n      id: 'main-container-three-parabellum',\n    }\n  );\n  shipShufflerButton.render(mainContainerThreeParabellumWrapper);\n  readyUpButton.render(mainContainerThreeParabellumWrapper);\n\n  const parabellumFragment = new DocumentFragment();\n  parabellumFragment.appendChild(mainContainerThreeParabellumWrapper);\n\n  return parabellumFragment;\n};","import { capitalize, createElement } from \"../../../utilities/random-utilities\";\nimport { players } from \"../../../state/player-state\";\nimport { Fleet } from \"../../../types/logic-types\";\nimport { PlayerType } from \"../../../types/state-types\";\nimport { isPlayerType } from \"../../../types/type-guards\";\n\nexport function createMainThreeBellumFragment(): DocumentFragment {\n  const createFleetStatusContainer = (playerType: PlayerType, fleet: Fleet) => {\n    const fleetStatusHeading: HTMLHeadingElement = createElement(\n      'h3',\n      ['fleet-status-heading'],\n      {\n        id: `${playerType}-fleet-status-heading`,\n      }\n    );\n    fleetStatusHeading.textContent = capitalize(playerType);\n\n    const fleetStatusContainer: HTMLDivElement = createElement(\n      'div',\n      ['fleet-status-container'],\n      {\n        id: `${playerType}-fleet-status-container`,\n      }\n    );\n    fleetStatusContainer.appendChild(fleetStatusHeading);\n\n    Object.values(fleet).forEach((ship) => {\n      const hitCounterContainer: HTMLDivElement = createElement(\n        'div',\n        ['hit-counter-container', `${ship.type}-hit-counter-container`],\n        {\n          id: `${playerType}-${ship.type}-hit-counter-container`,\n        }\n      );\n\n      for (let i = 0; i < ship.length; i++) {\n        const hitCounterElement: HTMLDivElement = createElement('div', [\n          'hitpoint',\n          `${ship.type}-hitpoint`,\n          `${playerType}-${ship.type}-hitpoint`,\n        ]);\n\n        hitCounterContainer.append(hitCounterElement);\n      }\n\n      fleetStatusContainer.appendChild(hitCounterContainer);\n    });\n\n    return fleetStatusContainer\n  }\n\n  const fleetStatusContainers = Object.entries(players).map(\n    ([playerType, playerData]) => {\n      if (!isPlayerType(playerType)) throw new Error('Invalid player type.');\n\n      return createFleetStatusContainer(\n        playerType,\n        playerData.fleetBuilder.fleet\n      )\n    }\n  );\n\n  const shipLabelListItemsFragment = new DocumentFragment();\n  Object.values(players.player.fleetBuilder.fleet).map(ship => {\n    const shipLabelListElement = createElement('li', ['ship-hit-counter-label'], { id: `${ship.type}-hit-counter-label` });\n    shipLabelListElement.textContent = ship.type;\n    \n    shipLabelListItemsFragment.appendChild(shipLabelListElement);\n  });\n\n  const shipLabelList = createElement('div', [], { id: 'ship-label-list' });\n  shipLabelList.appendChild(shipLabelListItemsFragment);\n\n  const mainContainerThreeBellumWrapper = createElement('div', ['bellum'], {\n    id: 'main-container-three-bellum',\n  });\n\n  const [playerOneFleetStatusContainer, playerTwoFleetStatusContainer] = fleetStatusContainers;\n  mainContainerThreeBellumWrapper.append(\n    playerOneFleetStatusContainer,\n    shipLabelList,\n    playerTwoFleetStatusContainer\n  );\n\n  const bellumFragment = new DocumentFragment();\n  bellumFragment.appendChild(mainContainerThreeBellumWrapper);\n\n  return bellumFragment;\n}\n\n","import { createElement } from \"../../../utilities/random-utilities\";\n\nexport function createMainThreePostBellumFragment(): DocumentFragment {\n\n  // ! Play again button and find new opponent button (disabled) \n\n  const mainContainerThreePostBellumWrapper = createElement('div', ['post-bellum'], {\n    id: 'main-container-three-post-bellum',\n  });\n\n  const bellumFragment = new DocumentFragment();\n  bellumFragment.appendChild(mainContainerThreePostBellumWrapper);\n\n  return bellumFragment;\n}\n","//  get details from main one parabellum fragment and render\nimport { createElement } from \"../../../../utilities/random-utilities\";\nimport { CycloneLightboxController } from \"../../../../utilities/cycloneLightbox.ts/cyclone-lightbox\";\nimport './instructions-component.scss';\n\nexport class InstructionsComponent {\n  private readonly instructionsButton: HTMLButtonElement;\n  private readonly instructionsButtonContainer: HTMLDivElement;\n  private readonly buttonId: string = 'instructions-button';\n  private readonly buttonImageId: string = 'instructions-image';\n\n  #listenerAttached: boolean = false;\n  private readonly openInstructionsDialog: () => void;\n\n  constructor(\n    private instructionsLightboxController: CycloneLightboxController\n  ) {\n    this.instructionsButton = this.createInstructionsButton();\n    this.instructionsButtonContainer = this.createInstructionsButtonContainer();\n    this.instructionsButtonContainer.appendChild(this.instructionsButton);\n\n    this.openInstructionsDialog = (): void => this.instructionsLightboxController.openLightbox();\n\n    this.toggleEventListener();\n  }\n\n  public render(targetElement: HTMLElement) {\n    if (!targetElement) {\n      throw new Error(`Target element not found. Recieved ${targetElement}.`);\n    }\n\n    targetElement.appendChild(this.instructionsButtonContainer);\n  }\n\n  public toggleEventListener() {\n    if (this.#listenerAttached === true) {\n      this.instructionsButton.removeEventListener('click', this.openInstructionsDialog);\n      this.#listenerAttached = false;\n    } else {\n      this.instructionsButton.addEventListener('click', this.openInstructionsDialog);\n      this.#listenerAttached = true;\n    }\n  }\n\n  //  --------------------------------------------------------------\n  \n  private createInstructionsButton(): HTMLButtonElement {\n    const instructionsButton: HTMLButtonElement = createElement('button', [], {\n      id: this.buttonId,\n      type: 'button',\n    });\n\n    return instructionsButton;\n  }\n\n  private createInstructionsButtonContainer(): HTMLDivElement {\n    const instructionsButtonContainer: HTMLDivElement = createElement('div', [], {\n      id: `${this.buttonId}-container`,\n    });\n\n    return instructionsButtonContainer;\n  }\n}","import { PlayerState } from \"../../types/state-types\";\nimport { createElement } from \"../../utilities/random-utilities\";\n\nimport { createMainContainerOne } from \"./main-container-one/main-container-one\";\nimport { MainContainerTwo } from './main-container-two/main-container-two';\nimport { createMainContainerThree } from \"./main-container-three/main-container-three\";\nimport { InstructionsComponent } from \"../components/buttons/instructions-component/instructions-component\";\n\nimport { CycloneHotSwapContainer } from \"../../utilities/cycloneHotSwapContainer\";\nimport { CycloneLightboxController } from \"../../utilities/cycloneLightbox.ts/cyclone-lightbox\";\nimport { CycloneSitRepScroller } from \"../../utilities/cycloneSitRepScroller.ts/cyclone-sit-rep-scroller\";\nimport EventBus from \"../../utilities/event-bus\";\nimport { GameState } from \"../../state/game-state\";\n\nexport class MainComponent {\n  private readonly mainElement: HTMLElement = createElement('main');\n\n  public readonly mainContainerOne: CycloneHotSwapContainer;\n  public readonly mainContainerTwo: MainContainerTwo;\n  public readonly mainContainerThree: CycloneHotSwapContainer;\n\n  private readonly instructionsButton: InstructionsComponent;\n\n  constructor(\n    private readonly players: { player: PlayerState; opponent: PlayerState },\n    private readonly instructionsLightboxController: CycloneLightboxController,\n    private readonly cycloneSitRepScroller: CycloneSitRepScroller,\n    // ? maybe set to return string used to update ui via the css-class `player-turn` || `opponent-turn`\n    private readonly gameState: GameState\n  ) {\n    this.instructionsButton = new InstructionsComponent(\n      this.instructionsLightboxController\n    );\n\n    this.mainContainerOne = this.createMainContainerOne();\n    this.mainContainerTwo = new MainContainerTwo(\n      this.players,\n      this.gameState\n    );\n    this.mainContainerThree = this.createMainContainerThree();\n\n    this.renderMainContainers();\n  }\n\n  private createMainContainerOne(): CycloneHotSwapContainer {\n    return createMainContainerOne(\n      this.instructionsButton,\n      this.cycloneSitRepScroller\n    );\n  }\n\n  private createMainContainerThree(): CycloneHotSwapContainer {\n    return createMainContainerThree(\n      this.mainContainerTwo.playerGameboard,\n      this.instructionsButton,\n      this.gameState\n    );\n  }\n\n  private renderMainContainers(): void {\n    this.mainContainerOne.render(this.mainElement);\n    this.mainContainerTwo.render(this.mainElement);\n    this.mainContainerThree.render(this.mainElement);\n  }\n\n  public render(targetElement: HTMLElement) {\n    if (!targetElement) {\n      throw new Error(`Target element not found. Recieved ${targetElement}.`);\n    }\n\n    targetElement.appendChild(this.mainElement);\n  }\n}","import { InstructionsComponent } from \"../../components/buttons/instructions-component/instructions-component\";\nimport { FragmentKey } from \"../../../types/dom-types\";\nimport { createMainOneParabellumFragment } from \"./main-one-parabellum\";\nimport { createMainOneBellumFragment } from \"./main-one-bellum\";\nimport { createMainOnePostBellumFragment } from \"./main-one-post-bellum\";\nimport { CycloneHotSwapContainer } from \"../../../utilities/cycloneHotSwapContainer\";\nimport { CycloneSitRepScroller } from \"../../../utilities/cycloneSitRepScroller.ts/cyclone-sit-rep-scroller\";\n\nexport function createMainContainerOne(\n  instructionsButton: InstructionsComponent,\n  sitRepContainer: CycloneSitRepScroller\n): CycloneHotSwapContainer {\n  const mainOneFragments: { [key in FragmentKey]: DocumentFragment } = {\n    parabellum: createMainOneParabellumFragment(instructionsButton),\n    bellum: createMainOneBellumFragment(sitRepContainer),\n    postBellum: createMainOnePostBellumFragment(),\n  };\n\n  const mainContainerOne = new CycloneHotSwapContainer(\n    'section',\n    mainOneFragments,\n    'parabellum',\n    ['main-container'],\n    {\n      id: 'main-container-one',\n    }\n  );\n\n  return mainContainerOne;\n}","import { players } from \"../../../state/player-state\";\n\nimport { FragmentKey } from \"../../../types/dom-types\";\n\nimport { PlayerGameboardComponent } from \"../../components/gameboard-component/player-gameboard-component/player-gameboard-component\";\nimport { InstructionsComponent } from \"../../components/buttons/instructions-component/instructions-component\";\nimport { ShipShufflerButtonComponent } from \"../../components/buttons/ship-shuffler-component/ship-shuffler-component\";\nimport { ReadyUpButtonComponent } from \"../../components/buttons/ready-up-component/ready-up-component\";\n\nimport { createMainThreeParabellumFragment } from \"./main-three-parabellum\";\nimport { createMainThreeBellumFragment } from \"./main-three-bellum\";\nimport { createMainThreePostBellumFragment } from \"./main-three-post-bellum\";\n\nimport { CycloneHotSwapContainer } from \"../../../utilities/cycloneHotSwapContainer\";\nimport { GameState } from \"../../../state/game-state\";\n\nexport function createMainContainerThree(\n  playerGameboardComponent: PlayerGameboardComponent,\n  instructionsButton: InstructionsComponent,\n  gameState: GameState\n): CycloneHotSwapContainer {\n  const playerGameboardController = players.player.gameboardController;\n  const playerFleet = players.player.fleetBuilder.fleet;\n\n  const shipShufflerButton = new ShipShufflerButtonComponent(\n    playerGameboardComponent.id,\n    // playerGameboardComponent.gameboardContainer, // TODO: do i need this?\n    playerGameboardController,\n    playerFleet,\n    gameState\n  );\n\n  const readyUpButton = new ReadyUpButtonComponent(\n    playerGameboardComponent,\n    shipShufflerButton,\n    instructionsButton,\n    gameState.transitionToNextPhase,\n  );\n\n  const mainThreeFragments: { [key in FragmentKey]: DocumentFragment } = {\n    parabellum: createMainThreeParabellumFragment(\n      shipShufflerButton,\n      readyUpButton\n    ),\n    bellum: createMainThreeBellumFragment(),\n    postBellum: createMainThreePostBellumFragment(),\n  };\n  const mainContainerThree = new CycloneHotSwapContainer(\n    'section',\n    mainThreeFragments,\n    'parabellum', \n    ['main-container'],\n    {\n      id: 'main-container-three',\n    }\n  );\n\n  return mainContainerThree;\n}","import { createElement, generateListFragment } from \"../../../utilities/random-utilities\";\nimport instructionsListItemTextContentArray from '../../../../json/instructions-list-item-text-content.json';\nimport './instructions-dialog-component.scss';\n\nexport class InstructionsDialogComponent {\n  private readonly instructionsDialog: HTMLDialogElement;\n  private readonly instructionsDialogCloseButton: HTMLButtonElement;\n  static readonly dialogId = 'instructions-dialog';\n  static readonly closeButtonId = 'instructions-dialog-close-button';\n\n  constructor() {\n    this.instructionsDialogCloseButton =\n      this.createInstructionsDialogCloseButton();\n    this.instructionsDialog = this.createInstructionsDialog(\n      this.instructionsDialogCloseButton\n    );\n  }\n\n  get element(): HTMLDialogElement {\n    return this.instructionsDialog;\n  }\n\n  get closeButton(): HTMLButtonElement {\n    return this.instructionsDialogCloseButton;\n  }\n\n  private createInstructionsDialogCloseButton() {\n    const instructionsDialogCloseButton = createElement(\n      'button',\n      ['close-button'],\n      {\n        id: InstructionsDialogComponent.closeButtonId,\n        type: 'button',\n        'aria-label': 'Close Instructions Dialog',\n      }\n    );\n    instructionsDialogCloseButton.textContent = 'X';\n\n    return instructionsDialogCloseButton;\n  }\n\n  private createInstructionsDialog(closeButton: HTMLButtonElement) {\n    const tertiaryHeading = createElement('h3', ['tertiary-heading'], {\n      id: 'instructions-dialog-heading',\n    });\n    tertiaryHeading.textContent = 'Deploy your Bips:';\n\n    const listItemContentArray: { textContent: string }[] =\n      instructionsListItemTextContentArray;\n\n    const listItemFragment = generateListFragment(\n      listItemContentArray,\n      'instructions'\n    );\n\n    const instructionsList = createElement('ul', ['instructions-list'], {\n      id: 'instructions-list',\n    });\n    instructionsList.appendChild(listItemFragment);\n\n    const unanchoredShipExample = createElement('div', [], {\n      id: 'unanchored-ship-example',\n    });\n\n    const unanchoredShipText = createElement('p', [], {\n      id: 'unanchored-ship-text',\n    });\n    unanchoredShipText.textContent = '= Bips adrift';\n\n    const visualFeedbackKeyContainer = createElement('div', [], {\n      id: 'visual-feedback-key-container',\n    });\n    visualFeedbackKeyContainer.append(\n      unanchoredShipExample,\n      unanchoredShipText\n    );\n\n    const instructionsContentContainer = createElement('div', [], {\n      id: 'instructions-content',\n    });\n    instructionsContentContainer.append(\n      tertiaryHeading,\n      instructionsList,\n      visualFeedbackKeyContainer,\n    );\n\n    const instructionsDialog = createElement('dialog', [], {\n      id: InstructionsDialogComponent.dialogId,\n    });\n    instructionsDialog.append(\n      closeButton,\n      instructionsContentContainer\n    );\n\n    return instructionsDialog;\n  }\n\n  public render(targetElement: HTMLElement) {\n    if (!targetElement) {\n      throw new Error(`Target element not found. Recieved ${targetElement}.`);\n    }\n\n    targetElement.appendChild(this.instructionsDialog);\n  }\n}","import {\n  AttackResult,\n  MessageSubject,\n  MessageTarget,\n  MessageType,\n  PlayerType,\n} from '../../types/state-types';\nimport { createElement, delay, waitForTransitionEnd } from '../random-utilities';\n/* \n  \n   TODO: Make more reusable by enabling custom messages and adding         \n   default styles (i.e, a container width of 100% to match the container to| \n  | ensure that the scrolling aniamtion functions properly considering it  \n  | runs on percengate-base x-axis translation).                            \n  \n*/\n\n/*\n  \n   if (hit) <content> =                                                        \n   `${currentPlayer} hit your `${ship.type}!                                   \n   if (miss) <content> =                                                       \n   `${currentPlayer} missed! ${randomInsult} // switch statement with ai       \n    generated insults                                                          \n  \n*/\n\ntype SitRepType = 'current' | 'next';\ninterface ControlledSitRepElements {\n  container: HTMLDivElement;\n  current: HTMLDivElement;\n  next: HTMLDivElement;\n};\n\nexport class CycloneSitRepScroller {\n  private static readonly MESSAGES = {\n    TURN: {\n      PLAYER: 'Waiting for your attack...',\n      OPPONENT: 'Your opponent is attacking...',\n    },\n    ATTACK: {\n      HIT: (subject: string, target: string, type: string) =>\n        `${subject} hit ${target} ${type}!`,\n      SUNK: (subject: string, target: string, type: string) =>\n        `${subject} sunk ${target} ${type}!`,\n      MISS: (subject: string) => `${subject} missed!`,\n    },\n  };\n\n  private currentPlayer: PlayerType | null = null;\n  private currentSitRep: string | null = null;\n  private nextSitRep: string = '';\n\n  private readonly sitRepContainer: HTMLDivElement;\n  private readonly sitRepTextElements: {\n    current: HTMLSpanElement;\n    next: HTMLSpanElement;\n  };\n\n  #currentMessageType: MessageType = 'turn';\n\n  constructor() {\n    const { container, current, next }: ControlledSitRepElements =\n      this.getControlledSitRepElements();\n\n    this.sitRepContainer = container;\n    this.sitRepTextElements = {\n      current,\n      next,\n    };\n  }\n\n  get element() {\n    return this.sitRepContainer;\n  }\n\n  public initialize = (firstPlayer: PlayerType): void => {\n    this.currentPlayer = firstPlayer;\n    this.setInitialTextContent(firstPlayer);\n  };\n\n  public readonly setAndScrollToNextSitRep = async (\n    attackResult?: AttackResult\n  ): Promise<void> => {\n    const DELAY_AFTER_TRANSITION_SECONDS: number = 0.5;\n\n    this.nextSitRep = attackResult\n      ? this.getNextSitRep(attackResult)\n      : this.getNextSitRep();\n\n    this.sitRepTextElements.next.textContent = this.nextSitRep;\n    this.sitRepContainer.classList.add('scrolling');\n\n    // pauses execution until the transition ends\n    await waitForTransitionEnd(this.sitRepContainer);\n\n    this.resetSitRepContainer();\n\n    await delay(DELAY_AFTER_TRANSITION_SECONDS * 1000); \n  };\n\n  //  --------------------------------------------------------------\n\n  private readonly getAttackSitRep = (\n    currentPlayer: PlayerType,\n    attackResult: AttackResult\n  ) => {\n    const { hit, isSunk, type } = attackResult;\n\n    const subject: MessageSubject =\n      currentPlayer === 'player' ? 'You' : 'Your opponent';\n    const target: MessageTarget = currentPlayer === 'player' ? 'their' : 'your';\n\n    if (!hit || !type)\n      return CycloneSitRepScroller.MESSAGES.ATTACK.MISS(subject);\n\n    return isSunk\n      ? CycloneSitRepScroller.MESSAGES.ATTACK.SUNK(subject, target, type)\n      : CycloneSitRepScroller.MESSAGES.ATTACK.HIT(subject, target, type);\n  };\n\n  private readonly getNextSitRep = (attackResult?: AttackResult): string => {\n    if (this.#currentMessageType === 'attack') this.toggleCurrentPlayer();\n    this.toggleSitRepType();\n\n    if (this.currentPlayer === null) {\n      throw new Error(\n        '`currentPlayer` cannot be null. Ensure it is assigned a valid `PlayerType` before retrieving the next sit rep.'\n      );\n    }\n\n    return attackResult\n      ? this.getAttackSitRep(this.currentPlayer, attackResult)\n      : this.getTurnSitRep(this.currentPlayer);\n  };\n\n  private readonly getTurnSitRep = (currentPlayer: PlayerType): string =>\n    currentPlayer === 'player'\n      ? CycloneSitRepScroller.MESSAGES.TURN.PLAYER\n      : CycloneSitRepScroller.MESSAGES.TURN.OPPONENT;\n\n  private readonly resetSitRepContainer = () => {\n    const { current, next } = this.sitRepTextElements;\n\n    this.sitRepContainer.classList.remove('scrolling');\n\n    this.currentSitRep = this.nextSitRep;\n    current.textContent = this.currentSitRep;\n\n    this.nextSitRep = '';\n    next.textContent = this.nextSitRep;\n\n    this.sitRepContainer.removeEventListener(\n      'transitionend',\n      this.resetSitRepContainer\n    );\n  };\n\n  private readonly setInitialTextContent = (currentPlayer: PlayerType) => {\n    const message: string =\n      currentPlayer === 'player'\n        ? CycloneSitRepScroller.MESSAGES.TURN.PLAYER\n        : CycloneSitRepScroller.MESSAGES.TURN.OPPONENT;\n\n    this.currentSitRep = message;\n    this.sitRepTextElements.current.textContent = message;\n  };\n\n  private readonly toggleCurrentPlayer = (): void => {\n    this.currentPlayer =\n      this.currentPlayer === 'player' ? 'opponent' : 'player';\n  };\n\n  private readonly toggleSitRepType = (): void => {\n    this.#currentMessageType =\n      this.#currentMessageType === 'turn' ? 'attack' : 'turn';\n  };\n\n  //  --------------------------------------------------------------\n\n  private readonly getControlledSitRepElements = (): ControlledSitRepElements => {\n      const sitRepContainerTypes: SitRepType[] = ['current', 'next'];\n      const sitRepContainer = createElement('div', [], {\n        id: 'sit-rep-container',\n      });\n\n      /* \n    \n      We're using `null as unknown as HTMLDivElement` instead of a               \n      non-null assertion (`!`) to initialize the variables as `null`             \n      while ensuring TypeScript knows they'll be assigned an                     \n      `HTMLDivElement` later.                                                    \n                                                                                 \n      The reason for using `unknown` is that `null` is not directly              | \n      assignable to a specific type (e.g., `HTMLDivElement`), but                 \n      `unknown` allows us to temporarily assign `null` and later                 \n      assert that the value will be of type `HTMLDivElement` once                \n      properly initialized.                                                      \n    |                                                                             |\n      This approach is preferred over the non-null assertion                     \n      operator(`!`) because it is more explicit and type - safe.                 \n    |                                                                             |\n      The non-null assertion simply tells TypeScript \"I know this                \n      won't be `null` or `undefined`,\" but using `null as unknown as              \n      HTMLDivElement` provides a clearer path of the value being                 \n      safely initialized to an `HTMLDivElement` at a later point                 \n      in time. This reduces the risk of potential runtime errors.                \n    \n  */\n      let currentTextContentElement: HTMLDivElement =\n        null as unknown as HTMLDivElement;\n      let nextTextContentElement: HTMLDivElement =\n        null as unknown as HTMLDivElement;\n      let currentSitRepContainer: HTMLDivElement =\n        null as unknown as HTMLDivElement;\n      let nextSitRepContainer: HTMLDivElement =\n        null as unknown as HTMLDivElement;\n\n      sitRepContainerTypes.forEach((type) => {\n        const textContentElement: HTMLDivElement = createElement(\n          'div',\n          ['sit-rep-text-content'],\n          {\n            id: `${type}-sit-rep-text-content`,\n          }\n        );\n        type === 'current'\n          ? (currentTextContentElement = textContentElement)\n          : (nextTextContentElement = textContentElement);\n\n        const sitRepContentContainer: HTMLDivElement = createElement(\n          'div',\n          ['sit-rep-slot'],\n          {\n            id: `${type}-update-container`,\n          }\n        );\n        type === 'current'\n          ? (currentSitRepContainer = sitRepContentContainer)\n          : (nextSitRepContainer = sitRepContentContainer);\n\n        sitRepContentContainer.appendChild(textContentElement);\n      });\n\n      sitRepContainer.append(nextSitRepContainer, currentSitRepContainer);\n\n      return {\n        container: sitRepContainer,\n        current: currentTextContentElement,\n        next: nextTextContentElement,\n      };\n    };\n}\n","import '../../styles/sass/index.scss';\n\nimport { GameState } from '../state/game-state';\nimport { players } from '../state/player-state';\nimport { CycloneLightboxController } from '../utilities/cycloneLightbox.ts/cyclone-lightbox';\n\n//  markup\nimport { createHeader } from '../markup/header/header';\nimport { MainComponent } from '../markup/main/main-component';\nimport { InstructionsDialogComponent } from '../markup/components/instructions-dialog-component/instructions-dialog-component';\nimport { CycloneSitRepScroller } from '../utilities/cycloneSitRepScroller.ts/cyclone-sit-rep-scroller';\nimport { AttackResult, PlayerType, gameboardStateValue } from '../types/state-types';\nimport { BillowBot } from '../services/billow';\nimport { waitForTransitionEnd } from '../utilities/random-utilities';\n\n//  --------------------------------------------------------------\n\nexport class DOMController {\n  public readonly instructionsLightboxController: CycloneLightboxController;\n  public readonly cycloneSitRepScroller: CycloneSitRepScroller =\n    new CycloneSitRepScroller();\n  public readonly mainComponent: MainComponent;\n\n  private readonly content: HTMLElement;\n  private readonly header: HTMLElement = createHeader();\n  private readonly instructionsDialog: InstructionsDialogComponent =\n    new InstructionsDialogComponent();\n  // private readonly footer: HTMLElement;\n\n  constructor(\n    private readonly gameState: GameState,\n    private readonly billowBot: BillowBot | null // make optional if multiplayer\n  ) {\n    if (!document) throw new Error('Fuck!');\n\n    const content = document.getElementById('content');\n    if (!content) throw new Error('Shit!');\n\n    this.content = content;\n    this.instructionsLightboxController = new CycloneLightboxController(\n      this.instructionsDialog.element,\n      'instructions-dialog-close-button'\n    );\n    this.mainComponent = new MainComponent(\n      players,\n      this.instructionsLightboxController,\n      this.cycloneSitRepScroller,\n      this.gameState\n    );\n\n    this.gameState.eventBus.on(\n      'transitionToNextPhase',\n      this.transitionToNextPhase\n    );\n    this.gameState.eventBus.on(\n      'updateUIActiveGameboard',\n      this.updateUIActiveGameboard\n    );\n    this.gameState.eventBus.on(\n      'setAndScrollToNextSitRep',\n      this.cycloneSitRepScroller.setAndScrollToNextSitRep\n    );\n\n    // this.footer = createFooter();\n  }\n\n  public render() {\n    this.content.appendChild(this.header);\n    this.mainComponent.render(this.content);\n    this.instructionsDialog.render(document.body);\n    // append footer via here\n  }\n\n  // ? sets initial turn state styles (I like this name better ). {TIMELESS ARTIFACT }\n  private readyPlayerOne = async (): Promise<void> => {\n    await this.updateUIActiveGameboard();\n    this.mainComponent.mainContainerTwo.opponentGameboard.toggleBellumListeners(\n      gameboardStateValue.active\n    );\n    this.gameState.eventBus.emit(\n      'togglePlayerGameboardControls',\n      gameboardStateValue.inactive\n    );\n    this.gameState.eventBus.emit(\n      'toggleOpponentGameboardControls',\n      gameboardStateValue.active\n    );\n  };\n\n  private updateUIActiveGameboard = async (): Promise<void> => {\n    const container = this.mainComponent.mainContainerTwo.element;\n    container.classList.toggle(\n      'player-turn',\n      this.gameState.currentPlayer === 'player'\n    );\n\n    await waitForTransitionEnd(container, 1000);\n  };\n\n  private transitionToNextPhase = async (): Promise<void> => {\n    if (this.gameState.currentGamePhase === 'bellum') {\n      this.gameState.setInitialPlayer();\n\n      if (!this.gameState.currentPlayer)\n        throw new Error('Current player must be set in game state.');\n\n      // ? set initial sit rep scroller text content\n      this.initializeSitRepScroller(this.gameState.currentPlayer); // ? make dynamic\n    }\n\n    this.mainComponent.mainContainerOne.swapByOrder();\n    this.mainComponent.mainContainerThree.swapByOrder();\n    await this.updateGameboardsOnTransition(this.gameState);\n\n    // TODO: If multiplayer becomes the dominant mode, reverse this check to reduce conditionals\n    if (this.gameState.currentPlayer === 'opponent') {\n      // ? && playing against billow (if multiplayer is introduced)\n\n      console.log('billowBot', this.billowBot);\n\n      if (this.billowBot) {\n        const billowAttackResult: AttackResult = await this.billowBot.attack();\n\n        //  ADD STUFF HERE? --------------------------------------------------------------\n        // * debugging\n        console.log('billowAttackResult', billowAttackResult);\n\n        //  emit billowAttack\n        // TODO: emit receive attack in the playergameboardcomponentin billowBot.ts\n        // match coordinates with corresponding grid cell on player gameboard\n\n        //  method on billowBot `ponderAttackCoordinates` called by `billowAttack` event listener.\n        // apply animation to multiple random unattacked grid cells one at a time.\n        // (start off fast, slow down as time goes on (2 second long animation?)\n        // selected grid cell gets 'selected cell' animation (1 second long animation?)\n        // at the end of selected cell animation, apply hit / miss styles to the selected grid cell.\n\n        //  method on playerGameboardComponent `receiveAttack`? called by `billowAttack` event listener.\n        // await one of the following:\n        // if hit, add cooked to ship unit at that coordinate\n        // if miss, add miss styles to grid cell at that coordinate\n\n        //  check end game state\n        // check if all player ships are sunk\n        // if yes, declare winner\n        // if no, toggle turn\n      }\n    }\n  };\n\n  private updateGameboardContainerState = async (gameState: GameState): Promise<void> => {\n    const gameboardContainer = this.mainComponent.mainContainerTwo.element;\n\n    gameboardContainer.classList.toggle('parabellum', gameState.currentGamePhase === 'parabellum');\n    gameboardContainer.classList.toggle('bellum', gameState.currentGamePhase === 'bellum');\n    gameboardContainer.classList.toggle('postBellum', gameState.currentGamePhase === 'postBellum');\n\n    await waitForTransitionEnd(gameboardContainer, 1000);\n  };\n\n  private updateGameboardsOnTransition = async (\n    gameState: GameState\n  ): Promise<void> => {\n      await this.updateGameboardContainerState(gameState);\n\n    if (gameState.currentGamePhase === 'parabellum') {\n      // TODO: reset gamePhase SCSS color\n      this.resetGame();\n      return;\n    }\n\n    if (gameState.currentGamePhase === 'bellum') {\n      if (gameState.currentPlayer === 'player') {\n        this.readyPlayerOne();\n      }\n\n      // ? Do I want to manipulate the gameboard in anyway on transition to bellum\n    }\n\n    if (gameState.currentGamePhase === 'postBellum') {\n      // TODO: change gamePhase SCSS color\n      // ? do something fun ?\n    }\n\n  };\n\n  private initializeSitRepScroller = (firstPlayer: PlayerType): void => {\n    /*\n    \n       The event listener is dynamically triggered whenever a grid cell          \n       container is clicked, with a debounce of 3 seconds to prevent rapid       \n       interactions on the game board.                                           \n                                                                                 \n       A front-end API schema story:                                             \n       I've implemented a container that manages the display of real-time        \n       battlefield situation reports(sit - rep). This system dynamically          \n       updates and transitions messages based on game flow. It integrates         \n       seamlessly by requiring only an `AttackResult` interface, which           \n       encapsulates all necessary data for determining hit / miss status, ship   \n       type, and whether a ship has sunk.                                        \n    \n    */\n\n    if (!this.cycloneSitRepScroller.element) {\n      console.error('CycloneSitRepScroller element is null or undefined!');\n      return;\n    }\n\n    this.cycloneSitRepScroller.initialize(firstPlayer);\n  };\n\n  private resetGame = () => {\n    this.mainComponent.mainContainerOne.swapFragmentByKey('parabellum');\n    this.mainComponent.mainContainerThree.swapFragmentByKey('parabellum');\n    this.gameState.resetGameState();\n\n    // ? or re-render the entire dom to ensure no lingering state\n    // ? or render a new main component ?\n  };\n}","import { createElement } from \"../../utilities/random-utilities\";\nimport { createNav } from \"./nav/nav\";\n\nexport function createHeader() {\n  const nav = createNav();\n\n  const header = createElement('header');\n  header.appendChild(nav);\n\n  return header;\n}","import { createElement } from \"../../../utilities/random-utilities\";\nimport { createGitHubLink } from \"../../../utilities/create-github-link\";\n\nexport function createNav() {\n  const headingLink = createElement('a', ['heading-link'], {\n    id: 'heading-link',\n    href: 'https://johnkeyscloud.github.io/battleship/',\n  });\n  headingLink.textContent = 'ShattleBip';\n\n  const heading: HTMLHeadingElement = createElement('h1', ['main-heading']);\n  heading.appendChild(headingLink);\n\n  const gitHubLogoLink: HTMLAnchorElement = createGitHubLink();\n\n  const nav: HTMLElement = createElement('nav');\n  nav.append(heading, gitHubLogoLink);\n\n  return nav;\n}; ","import { GamePhase, CurrentPlayer, gameboardStateValue } from \"../types/state-types\";\nimport EventBus from \"../utilities/event-bus\";\nexport class GameState {\n  public currentGamePhase: GamePhase = 'parabellum';\n  public currentPlayer: CurrentPlayer = null;\n  public static getInitialPlayer(): CurrentPlayer {\n    return Math.random() > 0.5 ? 'player' : 'opponent';\n  }\n\n  constructor(\n    public readonly isMultiplayer: boolean,\n    public readonly eventBus: EventBus\n  ) {}\n\n  // ! connect\n  // Reset the game state and notify subscribers\n  public resetGameState = (): void => {\n    this.currentGamePhase = 'parabellum';\n    this.currentPlayer = null;\n    // Emit a game reset event\n    this.eventBus.emit('gameReset');\n  };\n\n  public setInitialPlayer = (): void => {\n    this.currentPlayer = GameState.getInitialPlayer();\n  };\n\n  public toggleGameboardControls = (): void => {\n    const isPlayer = this.currentPlayer === 'player';\n\n    if (isPlayer) {\n      // NOTE: We dont need to explicitly disable the opponent's gameboard here.\n      //\n      // Reason:\n      //  On a valid player click, the opponents gameboard listeners are immediately removed\n      //   at the end of that turn.\n      //  `togglePlayerTurn()` is called afterward in the same click listener. It awaits\n      //   `updateUIActiveGameboard()` before toggling gameboard controls, so we purposely\n      //   re-enabled the opponent's gameboard beforehand to avoid waiting for that UI transition.\n      //\n      // This design staggers the updates for pointer-events on the players gameboard\n      // because they dont need to be instantly disabled  their interactivity is purely cosmetic.\n      // Opponent gameboard controls are already off at this point; we only re-enable them\n      // when it becomes the opponent's turn.\n      // (See `opponent-gameboard-component.ts` line 377)\n\n      this.eventBus.emit(\n        'toggleOpponentGameboardControls',\n        gameboardStateValue.active\n      );\n    }\n\n    this.eventBus.emit(\n      'togglePlayerGameboardControls',\n      isPlayer\n        ? gameboardStateValue.inactive\n        : gameboardStateValue.active\n    );\n  };\n\n  public togglePlayerTurn = async (): Promise<void> => {\n    this.currentPlayer =\n      this.currentPlayer === 'player' ? 'opponent' : 'player';\n\n    this.eventBus.emit('setAndScrollToNextSitRep');\n    await this.updateUIActiveGameboard();\n    this.toggleGameboardControls();\n\n    if (!this.isMultiplayer && this.currentPlayer === 'opponent') {\n      await this.eventBus.emit('billowAttack');\n    }\n  };\n\n  public transitionToNextPhase = (): void => {\n    switch (this.currentGamePhase) {\n      case 'parabellum':\n        this.currentGamePhase = 'bellum';\n        break;\n      case 'bellum':\n        this.currentGamePhase = 'postBellum';\n        break;\n      case 'postBellum':\n        this.currentGamePhase = 'parabellum';\n        break;\n    }\n    // Emit the event with the new game phase\n    this.eventBus.emit('transitionToNextPhase');\n  };\n\n  public updateUIActiveGameboard = async (): Promise<void> => {\n    await this.eventBus.emit('updateUIActiveGameboard');\n  };\n}\n\n","//  Pub-sub/Mediator Pattern with Async Support\n\ntype Listener<T = any, R = void> = (data: T) => R | Promise<R>;\n\nexport default class EventBus {\n  private events: Record<string, Array<Listener<any, any>>> = {};\n\n  /**\n   * Register a listener for a specific event.\n   * @param eventName - The name of the event.\n   * @param fn - The callback function to register.\n   */\n  on<T, R = void>(eventName: string, fn: Listener<T, R>): void {\n    this.events[eventName] = this.events[eventName] || [];\n    this.events[eventName].push(fn);\n  }\n\n  /**\n   * Unregister a listener for a specific event.\n   * @param eventName - The name of the event.\n   * @param fn - The callback function to remove.\n   */\n  off<T, R = void>(eventName: string, fn: Listener<T, R>): void {\n    if (this.events[eventName]) {\n      this.events[eventName] = this.events[eventName].filter(\n        (listener) => listener !== fn\n      );\n    }\n  }\n\n  /**\n   * Emit an event, calling all listeners registered for it.\n   * Supports awaiting asynchronous listeners.\n   * @param eventName - The name of the event.\n   * @param data - The data to pass to the listeners (optional).\n   * @returns A promise that resolves when all listeners have finished.\n   */\n  async emit<T, R = void>(eventName: string, data?: T): Promise<R[]> {\n    if (this.events[eventName]) {\n      // Await all listener executions (in parallel)\n      return await Promise.all(this.events[eventName].map((fn) => fn(data)));\n    }\n    return [];\n  }\n}\n","import { GameState } from \"../state/game-state\";\nimport { Coordinates } from \"../types/logic-types\";\nimport { AttackResult } from \"../types/state-types\";\nimport { isCoordinates } from \"../types/type-guards\";\n\nexport class BillowBot {\n  #possibleAttacks: Set<string>;\n  #lastAttackCoordinates: Coordinates | null = null;\n  #wasLastTargetHit: boolean | null = null;\n\n  constructor(\n    private readonly gameState: GameState\n  ) {\n    this.#possibleAttacks = new Set();\n    this.populatepossibleAttacksSet();\n    this.gameState.eventBus.on('billowAttack', this.attack);\n  }\n\n  public attack = async (): Promise<AttackResult> => {\n    try {\n      const attackCoordinates: Coordinates = await this.determineNextTarget();\n\n      console.log('attackCoordinates', attackCoordinates);\n\n      const [attackResult]: AttackResult[] = await this.gameState.eventBus.emit('receiveBillowAttack', attackCoordinates);\n    \n      if (attackResult.hit) {\n        this.rememberLastTargetHit(attackCoordinates);\n      }\n\n      return attackResult;\n    } catch (error) {\n      console.error('Error in BillowBot.attack:', error);\n      throw error;\n    }\n  }\n\n  public getNextAttackCoordinates(\n    lastAttackCoordinates: Coordinates | null,\n    wasLastTargetHit: boolean | null\n  ): Coordinates {\n    // TODO: implement smart attack\n    // const coordinates: Coordinates = !wasLastTargetHit\n    //   ? this.getRandomCoordinates()\n    //   : this.getSmartCoordinates(lastAttackCoordinates);\n    \n    const coordinates: Coordinates = this.getRandomCoordinates();\n    \n    // ? use to make next attack more strategic\n    this.#lastAttackCoordinates = coordinates;\n\n    return coordinates;\n  } \n\n  private async determineNextTarget(): Promise<Coordinates> {\n    await this.ponder(500);\n    return this.getNextAttackCoordinates(this.#lastAttackCoordinates, this.#wasLastTargetHit);\n  }\n\n  private ponder(timeCapsuleMS: number): Promise<void> {\n    // ? animate board\n    return new Promise((resolve) => setTimeout(resolve, timeCapsuleMS));\n  }\n\n  private populatepossibleAttacksSet() {\n    for (let x = 0; x < 10; x++) {\n      for (let y = 0; y < 10; y++) {\n        this.#possibleAttacks.add(`${x},${y}`);\n      }\n    }\n  }\n\n  private getRandomCoordinates(): Coordinates {\n    const coordinatesString: string = Array.from(this.#possibleAttacks)[Math.floor(Math.random() * this.#possibleAttacks.size)];\n    this.#possibleAttacks.delete(coordinatesString);\n\n    const coordinates: number[] = coordinatesString.split(',').map(Number);\n\n    if (!isCoordinates(coordinates)) throw new Error('Invalid coordinates');\n\n    return coordinates;\n  }\n\n  private getSmartCoordinates(lastAttackCoordinates: Coordinates | null): Coordinates {\n    if (!lastAttackCoordinates)\n      throw new Error('Last attack coordinates are required');\n\n    const [lastAttackX, lastAttackY]: Coordinates = lastAttackCoordinates;\n\n    // find first unattacked adjacent cell\n    const adjacentCells: Coordinates[] = [\n      [lastAttackX + 1, lastAttackY],\n      [lastAttackX - 1, lastAttackY],\n      [lastAttackX, lastAttackY + 1],\n      [lastAttackX, lastAttackY - 1],\n    ];\n\n    // TODO: If one adjacent square is free, `billowBot` will target it.\n    // If it registers a consecutive hit, itll keep attacking in that\n    // direction until the ship is `sunk` or it misses  then try the\n    // opposite direction. Once the ship is sunk, `billowBot` returns\n    // to random attacks.\n    //\n    // Possible future optimizations:\n    // - Parity-based optimization: Skip odd cells to maximize efficiency.\n    // - Probability density maps: Simulate likely ship placements based on\n    //   missed shots and remaining ships.\n    // - Ship orientation inference: Use consecutive hits to determine if a\n    //   ship is horizontal or vertical more quickly. \n\n    return [0, 0] as Coordinates; // ! temporary return\n  }\n\n  private rememberLastTargetHit(coordinates: Coordinates) {\n    this.#lastAttackCoordinates = coordinates;\n    this.#wasLastTargetHit = true;\n  }\n}","import { initApp } from './typescript/meta/init-app';\nimport { DOMController } from './typescript/meta/dom-controller';\nimport { GameState } from './typescript/state/game-state';\nimport EventBus from './typescript/utilities/event-bus';\nimport { BillowBot } from './typescript/services/billow';\nclass App {\n  public readonly eventBus: EventBus;\n  public readonly gameState: GameState;\n  public readonly domController: DOMController;\n  public readonly isMultiplayer: boolean = false; // ? move elsewhere if multiplayer is implemented\n  public readonly billowBot: BillowBot | null; \n\n  private constructor() {\n    this.eventBus = new EventBus();\n    this.gameState = new GameState(this.isMultiplayer, this.eventBus);\n    this.billowBot = !this.isMultiplayer ? new BillowBot(this.gameState) : null; \n    this.domController = new DOMController(this.gameState, this.billowBot);\n    // ? pass isMultiplayer to the DOMController so a multiplayer button can be rendered if multiplayer is implemented\n  }\n\n  public static powerOn() {\n    console.time('Loading');\n    initApp(); \n    console.timeEnd('Loading');\n\n    return new App();\n  }\n\n  public pressStart() {\n    this.domController.render();\n  }\n}\n\nconsole.time('powerOn');\nexport const app = App.powerOn(); // ? pass in isMultiplayer as a parameter\nconsole.timeEnd('powerOn');\n\nconsole.time('pressStart');\napp.pressStart();\nconsole.timeEnd('pressStart');","import { randomizeBSGameboard } from \"../../setup/randomize-bs-gameboard\";\nimport { players } from \"../../state/player-state\";\n\nexport const randomizeBSGameboards = () => {\n  randomizeBSGameboard(\n    players.player.gameboardController,\n    players.player.fleetBuilder.fleet\n  );\n  randomizeBSGameboard(\n    players.opponent.gameboardController,\n    players.opponent.fleetBuilder.fleet\n  );\n};\n"],"names":["areArraysEqual","arrayOne","arrayTwo","length","every","value","index","delay","ms","Promise","resolve","setTimeout","getConvertedTypeFromAttr","element","attribute","typeGuard","attrValue","getAttribute","Error","getRandomInt","min","max","Math","floor","random","createElement","tag","classes","attributes","document","forEach","cls","classList","add","Object","entries","key","setAttribute","waitForTransitionEnd","timeout","expectedCount","callback","resolved","transitionCount","cleanup","removeEventListener","handler","clearTimeout","timer","event","undefined","target","addEventListener","waitForEvent","eventType","AnglesOfRotation","ShipType","isCoordinates","Array","isArray","coordinate","isOrientation","includes","isOutOfBounds","isPlacePieceParams","coordinates","isPosition","proto","getPrototypeOf","prototype","isPlainObject","bow","stern","isShipType","values","randomizeBSGameboard","gameboardController","fleet","getValidCoordinatesRecursively","ship","orientation","boardSize","attempts","type","generateRandomCoordinates","shipLength","areCoordinatesValid","validPositionsParams","validPositions","getValidPositions","bowX","bowY","isHorizontal","axisIndex","some","position","shipType","randomOrientation","placePieceParams","placePiece","SHIP_SYMBOLS","Carrier","Symbol","Battleship","Cruiser","Submarine","Destroyer","PatrolBoat","sizeLookup","BattleshipBuilder","seaworthy","rotationalPivotConfigurations","transientAngleOfRotation","coordinatesArray","currentplacementConfigurations","isPlaced","this","_hitCounter","constructor","version","symbol","hit","isSeaworthy","hitCounter","resetConfigurations","shouldResetShipRotationalData","placementConfigurations","BattleshipFleetBuilder","createFleet","fleetConfigs","config","createHasbroFleet","carrier","battleship","destroyer","submarine","patrolBoat","createMBFleet","cruiser","getShip","BattleshipBoardBuilder","static","_boardSize","_fillValue","vacant","_board","from","fill","board","fillValue","createPositionObject","x","y","isCoordinateInBounds","areCoordinatesInBounds","arePositionsEqual","positionOne","positionTwo","BattleshipBoardController","playerState","battleshipBoardBuilder","extractAxisArray","gameboard","map","row","findValidPositionsInAxis","axisArray","streak","validAxisPositions","i","bowPosition","sternPosition","push","validPositionsPerAxis","getValidShipPositions","gameboardBuilder","battleshipBoardController","getAllValidBowCoordinates","allValidBowCoordinates","Set","positionsInAxis","movePiece","newBowCoordinates","console","warn","currentOrientation","newPosition","isPositionInBounds","axisArrayKey","createAxisArrayKey","isNewPositionValid","placementParameters","relocateShip","battleshipBoardRepository","errorMessage","isPositionValid","shipConfigurations","validPosition","JSON","stringify","getPlacementCoordinates","placementCoordinates","sternX","sternY","primary","axisEnd","placeOnBoard","shipPlacementCoordinates","shipSymbol","setShipConfigurations","Degrees0","updateOccupiedCoordinatesSet","addShipToFleetCoordinates","placeShip","gameboardRepository","setFleetRotatedPlacePieceParams","fleetBuilder","prettyPrint","table","description","receiveAttack","attackedShip","getShipAt","attackResult","isSunk","addSunkenShip","removePiece","isShipValidForRemoval","shipCoordinates","removeShipFromBoard","nullifyShipCoordinatesValue","nullifyShipCoordinateSetValue","resetShipConfigurations","nullifyShipValidRotationalParams","removeAllPieces","keys","error","rotatePiece","getNextPiecePlacementParams","rotationalPositionMap","currentAngle","maxAngle","pop","getMaxAngle","originalBowCoordinates","originalOrientation","nextAngle","getNextAngle","find","angle","nextPlacePieceParams","get","inBoundRotationalPlacePieceForFleet","initialAngle","finalPlacePieceParams","isRotatedPositionValid","updateTransientPlacementParams","areCoordinatesVacant","shipSymbolValue","getShipTypeFromSymbol","angleOfRotation","gameboardSize","newAxisIndexStart","axisIndexEnd","Degrees90","Degrees270","getRotatedPlacePieceParams","applyOffsetToCoordinate","determineRotatedOrientation","Degrees180","getRotatedBowCoordinates","rotationalPivotBowCoordinates","rotatedBowCoordinates","rotationalPivotOrientation","rotatedPiecePlacementParams","createRotatedPiecePlacementParams","rotatedPlacePieceParamsMap","rotatedPlacePieceParams","Map","angleOfRotationString","angleOfRotationToNum","rotatedPlacePieceParamsValue","bowCoordinates","set","generateRotationalPositionMap","isShipPlaced","setShipRotatedPlacePieceParams","setShipValidRotationalParams","BattleshipBoardRepository","fleetCoordinates","log","addAttackedCoordinates","setMemberTemplate","areAllShipsSunk","size","validRotatedPlacePieceParams","hasTargetBeenAttacked","has","createPlayerStateObject","fleetVersion","players","player","opponent","CycloneLightboxController","dialogState","isDialogOpen","isEscapeKeyListenerAttached","isCloseButtonListenerAttached","dialogElement","dialogCloseButtonID","dialogInDocumentBody","id","dialogId","dialogCloseButton","dsGetCloseButton","dsAddCloseButtonAria","closeButtonListener","closeLightbox","bind","escapeKeyListener","dsHandleEscapeKey","observeDialogRemoval","openLightbox","showModal","dsAddListeners","requestAnimationFrame","remove","close","dsRemoveListeners","once","isOpen","window","closeButtonId","closeButton","querySelector","preventDefault","observer","MutationObserver","mutations","mutation","removedNodes","node","disconnect","observe","body","childList","subtree","setAttributes","createMainOneParabellumFragment","instructionsButton","parabellumHeading","textContent","mainContainerOneParabellumWrapper","append","render","parabellumFragment","DocumentFragment","createMainOneBellumFragment","sitRepScrollerController","latestUpdatesHeading","mainContainerOneBellumWrapper","bellumFragment","appendChild","createMainOnePostBellumFragment","mainContainerPostBellumWrapper","postBellumFragment","CycloneHotSwapContainer","elementTag","fragments","initialFragmentKey","classNames","hotSwapContainer","fragmentsArray","setInitialIndex","targetElement","swapFragmentByKey","fragment","getFragment","swapFragment","indexOf","swapByOrder","initialIndex","replaceChildren","gameboardStateValue","PlayerGameboardComponent","fleetElements","listenersAdded","dragState","currentShipInstance","initialPlacementConfigurations","isValidDropTarget","currentDragOverCell","cloneSnapOffset","shipBorderValueSplit","dragEventCallbacks","dragstart","e","handleShipDragStart","drag","handleShipDrag","dragenter","handleShipDragEnter","dragleave","handleShipDragLeave","dragover","handleShipDragOver","drop","handleShipDrop","dragend","handleShipDragEnd","gameState","gameboardContainer","generateBoardContainer","generateBoardFragment","dragImage","createDragImage","shipDragClone","createShipDragClone","eventBus","on","refreshGameboardWrapper","toggleGameboardControls","handleFleetPlacement","toggleParabellumListeners","method","handleShipRotation","togglePlayerTurn","checkForWin","toggleShipsDraggable","shipElement","removeAttribute","toggleShipAdriftClass","applyGridPlacementValue","gridPlacementValue","gridCrossAxis","style","gridColumn","gridRow","toString","gridTemplateColumns","gridTemplateRows","alert","currentPlayer","transitionToNextPhase","src","createBackgroundCellsFragment","cellFragment","rowIndex","colIndex","symbolDescription","toLowerCase","hitMarker","gridCell","role","gridCellContainer","createShipElement","shipUnitFragment","generateShipUnitFragment","shipContainerElement","draggable","setProperty","gameboardBackground","boardFragment","isBow","isStern","shipUnit","getAndSetGridPlacementValue","getGridPlacementValue","setGridPlacementValue","getShipGridPlacementData","updateFleetElements","placeFleetOnGameboard","handleShipUnitCooked","shipUnits","children","unit","lastUnit","alreadyAttacked","_receiveAttack","async","gridCellDataKey","attackCoordinates","triggerPrePlayerToggleAnimations","refreshGameboard","boardContainer","removeChild","setFleetElements","sinkShip","DELAY_AFTER_TRANSITION_SECOND","newGameboardState","toggle","inactive","emit","updateGameboardPostAttack","clear","HTMLDivElement","matches","getCloneSnapOffset","shipBow","getShipBow","match","getComputedStyle","documentElement","getPropertyValue","trim","groups","offsetX","offsetY","getBoundingClientRect","width","height","Number","numberValue","updateDragState","dataTransfer","setDragImage","setCloneDimensions","shipContainer","shipClone","shipBoundingRect","setInitialDragStyles","classifyValidCellCoordinates","shipLengthAttr","classifyValidBowCells","gridCells","gridCellCoordinates","validBowCoordinates","querySelectorAll","snapCloneToCursor","areValidBowCoordinates","contains","initialOrientation","validGridCell","xAttr","yAttr","newCoordinates","resetShipPosition","initialBowCoordinates","removeDragStyles","cellFeedbackClass","gameboardClientRect","gameboardOffsetX","left","gameboardOffsetY","top","cursorX","clientX","cursorY","clientY","getId","OpponentGameboardComponent","toggleBellumListeners","handleCellClick","_","getAttackCoordinates","dataX","dataY","active","MainContainerTwo","playerGameboardComponent","opponentGameboardComponent","mainContainerTwo","playerGameboard","opponentGameboard","ShipShufflerButtonComponent","shipShufflerButtonTextContent","buttonClass","shuffleShips","randomizeGameboard","updateGameboard","shipShufflerButton","createshipShufflerButton","toggleEventListener","shipShufflerButtonContainer","createshipShufflerButtonContainer","ReadyUpButtonComponent","readyUpButtonTextContent","buttonId","readyUp","anchorShips","removeParabellumButtonListeners","transitionToBellum","readyUpButton","createReadyUpButton","readyUpButtonContainer","createReadyUpButtonContainer","readyUpTextSpan","inactiveReadyUpButton","alt","activeReadyUpButton","button","createMainThreeParabellumFragment","mainContainerThreeParabellumWrapper","createMainThreeBellumFragment","fleetStatusContainers","playerType","playerData","createFleetStatusContainer","fleetStatusHeading","str","charAt","toUpperCase","slice","fleetStatusContainer","hitCounterContainer","hitCounterElement","shipLabelListItemsFragment","shipLabelListElement","shipLabelList","mainContainerThreeBellumWrapper","playerOneFleetStatusContainer","playerTwoFleetStatusContainer","createMainThreePostBellumFragment","mainContainerThreePostBellumWrapper","InstructionsComponent","buttonImageId","instructionsLightboxController","createInstructionsButton","instructionsButtonContainer","createInstructionsButtonContainer","openInstructionsDialog","MainComponent","mainElement","cycloneSitRepScroller","mainContainerOne","createMainContainerOne","mainContainerThree","createMainContainerThree","renderMainContainers","sitRepContainer","mainOneFragments","parabellum","bellum","postBellum","playerGameboardController","playerFleet","mainThreeFragments","InstructionsDialogComponent","instructionsDialogCloseButton","createInstructionsDialogCloseButton","instructionsDialog","createInstructionsDialog","tertiaryHeading","listItemFragment","generateListFragment","listItemTextContentArray","identifier","listFragment","listItem","listElement","instructionsListItemTextContentArray","instructionsList","unanchoredShipExample","unanchoredShipText","visualFeedbackKeyContainer","instructionsContentContainer","CycloneSitRepScroller","TURN","PLAYER","OPPONENT","ATTACK","HIT","subject","SUNK","MISS","currentSitRep","nextSitRep","container","current","next","getControlledSitRepElements","sitRepTextElements","initialize","firstPlayer","setInitialTextContent","setAndScrollToNextSitRep","getNextSitRep","resetSitRepContainer","DELAY_AFTER_TRANSITION_SECONDS","getAttackSitRep","MESSAGES","toggleCurrentPlayer","toggleSitRepType","getTurnSitRep","message","currentTextContentElement","nextTextContentElement","currentSitRepContainer","nextSitRepContainer","textContentElement","sitRepContentContainer","DOMController","header","nav","headingLink","href","heading","gitHubLogoLink","color","gitHubUsername","projectName","pathOne","createElementNS","pathTwo","gInner","gOuter","stroke","gitHubSVG","viewBox","xmlns","rel","createGitHubLink","createNav","createHeader","billowBot","content","getElementById","mainComponent","updateUIActiveGameboard","readyPlayerOne","currentGamePhase","setInitialPlayer","initializeSitRepScroller","updateGameboardsOnTransition","billowAttackResult","attack","updateGameboardContainerState","resetGame","resetGameState","GameState","getInitialPlayer","isMultiplayer","isPlayer","EventBus","events","eventName","fn","off","filter","listener","data","all","BillowBot","populatepossibleAttacksSet","determineNextTarget","rememberLastTargetHit","getNextAttackCoordinates","lastAttackCoordinates","wasLastTargetHit","getRandomCoordinates","ponder","timeCapsuleMS","coordinatesString","delete","split","getSmartCoordinates","lastAttackX","lastAttackY","App","domController","powerOn","time","timeEnd","pressStart","app"],"sourceRoot":""}