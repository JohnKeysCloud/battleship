!function(){"use strict";const e=(e,t)=>e.length===t.length&&e.every(((e,r)=>e===t[r])),t=(e,t,r)=>{const n=e.getAttribute(t);if(!n||!r(n))throw new Error(`Invalid or missing attribute: ${t}`);return n},r=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,n=(e,t=[],r={})=>{const n=document.createElement(e);return t.forEach((e=>n.classList.add(e))),Object.entries(r).forEach((([e,t])=>n.setAttribute(e,t))),n};var i,o,a;!function(e){e[e.Degrees0=0]="Degrees0",e[e.Degrees90=90]="Degrees90",e[e.Degrees180=180]="Degrees180",e[e.Degrees270=270]="Degrees270"}(i||(i={})),(a=o||(o={})).Battleship="battleship",a.Carrier="carrier",a.Cruiser="cruiser",a.Destroyer="destroyer",a.PatrolBoat="patrolBoat",a.Submarine="submarine";const s={[o.Carrier]:Symbol("CA"),[o.Battleship]:Symbol("BS"),[o.Cruiser]:Symbol("CR"),[o.Submarine]:Symbol("SB"),[o.Destroyer]:Symbol("DD"),[o.PatrolBoat]:Symbol("PB")},l={"battleship-1990":4,"battleship-2002":4,"carrier-1990":5,"carrier-2002":5,"cruiser-1990":3,"cruiser-2002":void 0,"destroyer-1990":2,"destroyer-2002":3,"patrolBoat-1990":void 0,"patrolBoat-2002":2,"submarine-1990":3,"submarine-2002":3};class d{seaworthy=!0;rotationalPivotConfigurations={transientAngleOfRotation:null,coordinatesArray:null,orientation:null};currentplacementConfigurations={coordinatesArray:null,orientation:null};isPlaced=()=>null!==this.currentplacementConfigurations.coordinatesArray;_hitCounter=0;constructor(e,t=2002){this.type=e,this.version=t,this.symbol=s[e];const r=`${e}-${t}`,n=l[r];if(void 0===n)throw new Error(`Invalid Command: ship type/version combination: ${r}.`);this.length=n}hit=()=>this.isSeaworthy()?(this._hitCounter++,`Hit registered. Hit count: ${this.hitCounter}.`):"This ship has already perished.";isSeaworthy=()=>this.hitCounter<this.length;resetConfigurations=e=>{const t={coordinatesArray:null,orientation:null};this.currentplacementConfigurations=t,!0===e&&(this.rotationalPivotConfigurations={...t,transientAngleOfRotation:null})};get hitCounter(){return this._hitCounter}}function h([e,t],r,n){return{bow:[e,t],stern:"horizontal"===r?[e+n-1,t]:[e,t+n-1]}}const c=(e,t)=>e>=0&&e<t,u=(e,t)=>e.every((e=>c(e,t))),p=(t,r)=>e(t.bow,r.bow)&&e(t.stern,r.stern),g=e=>!(!Array.isArray(e)||2!==e.length)&&e.every((e=>"number"==typeof e)),m=e=>"string"==typeof e&&["horizontal","vertical"].includes(e),f=e=>"outOfBounds"===e,b=e=>"object"==typeof e&&null!==e&&!!g(e.coordinates),C=e=>{if(!(e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||null===t})(e))return!1;const{bow:t,stern:r}=e;return g(t)&&g(r)},y=e=>Object.values(o).includes(e);class v{constructor(e,t){this.fleet=e,this.version=t}static createFleet(e){const t={};for(const[r,n]of Object.entries(e))n&&y(r)&&(t[r]=new d(n.type,n.version));return t}static createHasbroFleet(){return new v(v.createFleet({carrier:{type:o.Carrier,version:2002},battleship:{type:o.Battleship,version:2002},destroyer:{type:o.Destroyer,version:2002},submarine:{type:o.Submarine,version:2002},patrolBoat:{type:o.PatrolBoat,version:2002}}),2002)}static createMBFleet(){return new v(v.createFleet({carrier:{type:o.Carrier,version:1990},battleship:{type:o.Battleship,version:1990},cruiser:{type:o.Cruiser,version:1990},submarine:{type:o.Submarine,version:1990},destroyer:{type:o.Destroyer,version:1990}}),1990)}getShip(e){const t=this.fleet[e];if(!t)throw new Error(`Invalid Command: Ship of type ${e} not found in fleet.`);return t}}class w{static vacant=Symbol("VC");_boardSize=10;_fillValue=w.vacant;constructor(){this._board=Array.from({length:this._boardSize},(()=>Array(this._boardSize).fill(this._fillValue)))}get board(){return this._board}get boardSize(){return this._boardSize}get fillValue(){return this._fillValue}}class S{constructor(e){this.playerState=e}getValidPositions({orientation:e,shipLength:t}){return function({shipLength:e,orientation:t,battleshipBoardBuilder:r}){const n=(e,t,r)=>"horizontal"===t?r[e]:r.map((t=>t[e])),i=(e,t,n,i)=>{let o=0,a=[];for(let s=0;s<e.length;s++)if(e[s]===r.fillValue){if(o++,o>=i){const e=t?[s-(i-1),n]:[n,s-(i-1)],r=t?[s,n]:[n,s];a.push({bow:e,stern:r})}}else o=0;return a},o={},a=r.board,s="horizontal"===t;for(let r=0;r<a.length;r++){const l=i(n(r,t,a),s,r,e);o[s?`row-${r}`:`column-${r}`]=l}return o}({orientation:e,shipLength:t,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardController:this})}getAllValidBowCoordinates(e,t){let r=new Set;const n=this.getValidPositions({orientation:e,shipLength:t});for(const e of Object.values(n)){if(i=e,!Array.isArray(i)||!i.every((e=>C(e))))throw new Error(`Expected each value of validPositions to be an array of IPosition objects, but received: ${typeof e}.`);e.forEach((e=>r.add(e.bow)))}var i;return r}movePiece(e,t){if(!e.isPlaced())return void console.warn(`Invalid Command: The ${e.type} has not been placed.`);const r=e.currentplacementConfigurations.orientation,n=h(t,r,e.length);if(i=n,o=this.playerState.gameboardBuilder.boardSize,!u(i.bow,o)||!u(i.stern,o))return void console.warn(`Invalid Command: Position - Bow: [${n.bow}] & Stern: [${n.stern}] is out of bounds for the ${e.type}.`);var i,o;const a=this.getValidPositions({orientation:r,shipLength:e.length}),s="horizontal"===r,[l,d]=t,c=function(e,t){return t?`row-${e}`:`column-${e}`}(s?d:l,s),g=a[c].some((e=>p(e,n)));if(g){const n={ship:e,coordinates:t,orientation:r},i=!0;this.relocateShip(e,n,i)}else console.warn(`Invalid Command: Position - Bow: [${n.bow}] & Stern: [${n.stern}] is unavailable for the ${e.type}.`)}placePiece({ship:e,coordinates:t,orientation:r}){!function({ship:e,coordinates:t,orientation:r,battleshipBoardController:n,battleshipBoardBuilder:o,battleshipBoardRepository:a}){const s=e.length,[l,d]=t,u="horizontal"===r;if(!c((u?l:d)+s-1,o.boardSize)){const n=`Invalid Command: The ship placement attempt with the following configurations is out of bounds - Coordinates: ${t}, Length: ${e.length}, Orientation: ${r}.`;throw new Error(n)}if(e.isPlaced())return void console.warn(`Invalid Command: The ${e.type} has already been placed.`);const g=h(t,r,s);if(!((e,t,r)=>n.getValidPositions(t)[r].some((t=>p(e,t))))(g,{shipLength:s,orientation:r},u?`row-${d}`:`column-${l}`)){const e=`Invalid Command: "${JSON.stringify(g)}" is unavailable for ship with Size: ${s} and Orientation: ${r}.`;throw new Error(e)}{const t=(e,t)=>{const r=[],[n,i]=e.bow,[o,a]=e.stern,s=t?i:n,l=t?o:a;for(let e=t?n:i;e<=l;e++)r.push(t?[e,s]:[s,e]);return r},n=(e,t)=>{const r=o.board,n=e.symbol;t.forEach((e=>{const[t,i]=e;r[i][t]=n}))},s=(e,t,r)=>{const n={coordinatesArray:t,orientation:r};e.currentplacementConfigurations=n,Object.values(e.rotationalPivotConfigurations).every((e=>null===e))&&(e.rotationalPivotConfigurations={...n,transientAngleOfRotation:i.Degrees0})},l=(e,t)=>{a.addShipToFleetCoordinates(e,t)},d=t(g,u);n(e,d),s(e,d,r),l(e.type,d)}}({ship:e,coordinates:t,orientation:r,battleshipBoardController:this,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardRepository:this.playerState.gameboardRepository}),this.setFleetRotatedPlacePieceParams(this.playerState.fleetBuilder.fleet)}prettyPrint(){console.table(this.playerState.gameboardBuilder.board.map((e=>e.map((e=>"VC"===e.description?null:e.description)))))}receiveAttack(e){const t=this.getShipAt(e);if(t)return t.hit(),t.isSeaworthy()||console.log(`You sunk the ${t.type} fam!`),t;console.warn("Missed me with that bitch!")}removePiece(e,t=!0){this.isShipValidForRemoval(e)&&((e=>{e.forEach((([e,t])=>{this.playerState.gameboardBuilder.board[t][e]=this.playerState.gameboardBuilder.fillValue}))})(e.currentplacementConfigurations.coordinatesArray),(e=>{this.playerState.gameboardRepository.nullifyShipCoordinatesValue(e)})(e.type),((e,t)=>{t&&this.playerState.gameboardRepository.nullifyShipValidRotationalParams(e.type),e.resetConfigurations(t)})(e,t))}removeAllPieces(e){if(Object.keys(e).length)for(const t of Object.values(e))this.removePiece(t);else console.error("Invalid Command: No ships to remove - Fleet is empty or uninitialized.")}rotatePiece(e){const t=(e,t)=>{const r=e.rotationalPivotConfigurations.transientAngleOfRotation,n=(e=>Array.from(e.keys()).pop()??i.Degrees0)(t);if(r===n){const t=e.rotationalPivotConfigurations.coordinatesArray[0],r=e.rotationalPivotConfigurations.orientation;return e.rotationalPivotConfigurations.transientAngleOfRotation=i.Degrees0,{ship:e,coordinates:t,orientation:r}}const o=((e,t)=>{if(null==t)throw new Error("Current angle doesn't exist");return Array.from(e.keys()).find((e=>e>t))??i.Degrees0})(t,r),a=t.get(o);return e.rotationalPivotConfigurations.transientAngleOfRotation=o,{ship:e,coordinates:a.coordinates,orientation:a.orientation}},r=this.playerState.gameboardRepository.inBoundRotationalPlacePieceForFleet[e.type],n=e.rotationalPivotConfigurations.transientAngleOfRotation,o=(r=>{let i=t(e,r);for(;e.rotationalPivotConfigurations.transientAngleOfRotation!==n&&!this.isRotatedPositionValid(i.coordinates,i.orientation,e.rotationalPivotConfigurations.transientAngleOfRotation,e.length);)i=t(e,r);return i})(r);e.rotationalPivotConfigurations.transientAngleOfRotation!==n?this.relocateShip(e,o,!1):console.warn("No valid rotational position found.")}areCoordinatesVacant(e){const[t,r]=e;return this.playerState.gameboardBuilder.board[r][t]===this.playerState.gameboardBuilder.fillValue}getShipAt(e){if(this.areCoordinatesVacant(e))return null;const t=this.playerState.gameboardBuilder.board,[r,n]=e,i=t[n][r],o=this.getShipTypeFromSymbol(i);return this.playerState.fleetBuilder.getShip(o)}getShipTypeFromSymbol=e=>{if("string"!=typeof(t=e.description)||!["CA","BS","CR","SB","DD","PB"].includes(t))throw new Error("Invalid ship symbol description");var t;switch(e.description){case"CA":return o.Carrier;case"DD":return o.Destroyer;case"SB":return o.Submarine;case"BS":return o.Battleship;case"CR":return o.Cruiser;case"PB":return o.PatrolBoat;default:throw new Error("The symbol description does not return valid ship type.")}};isRotatedPositionValid=([e,t],r,n,o)=>{const a="horizontal"===r,s=this.playerState.gameboardBuilder.boardSize,l=this.playerState.gameboardBuilder.board,d=this.playerState.gameboardBuilder.fillValue,h=a?e:t;let c,u;if(!a&&n===i.Degrees90||a&&n===i.Degrees270||n===i.Degrees0?(c=1,u=o):(c=0,u=o-1),h+o-1>=s)return!1;for(;c<u;c++)if((a?l[t][e+c]:l[t+c][e])!==d)return!1;return!0};getRotatedPlacePieceParams(e){const t=(e,t)=>e-(t-1),r=(e,t)=>t?e===i.Degrees180?"horizontal":"vertical":e===i.Degrees180?"vertical":"horizontal",n=(r,n,[a,s])=>{if(r===i.Degrees0||r===i.Degrees90&&n||r===i.Degrees270&&!n)return o;const l=n?r===i.Degrees180?[t(a,e.length),s]:[a,t(s,e.length)]:r===i.Degrees180?[a,t(s,e.length)]:[t(a,e.length),s];return u(l,this.playerState.gameboardBuilder.boardSize)?l:"outOfBounds"},o=e.rotationalPivotConfigurations.coordinatesArray[0],a=e.rotationalPivotConfigurations.orientation,s=((e,t)=>{const o="horizontal"===t,a={};return[i.Degrees0,i.Degrees90,i.Degrees180,i.Degrees270].forEach((s=>{const l=s===i.Degrees0?e:n(s,o,e);a[s]="outOfBounds"===l?"outOfBounds":{coordinates:l,orientation:s===i.Degrees0?t:r(s,o)}})),a})(o,a),l=(e=>{const t=new Map;for(const n of Object.keys(e)){const o=+n;if(r=o,!Object.values(i).includes(r))throw new Error(`Invalid Type: "${n}" doesn't conform to "AngleOfRotation".`);const a=e[o];if(!b(a)&&!f(a))throw new Error(`Invalid Type: "${a}" doesn't conform to "RotatedPlacePieceParams".`);if(!b(a))continue;const{coordinates:s,orientation:l}=a,d={coordinates:s,orientation:l};t.set(o,d)}var r;return t})(s);return l}isShipValidForRemoval(e){return!(!e.currentplacementConfigurations.coordinatesArray||!this.playerState.gameboardRepository.isShipPlaced(e.type))||(console.error(`Error removing ship: ${e.type} is missing coordinates or not in the fleet.`),!1)}relocateShip(e,t,r){this.removePiece(e,r),this.placePiece(t)}setFleetRotatedPlacePieceParams(e){for(const t of Object.values(e))t.isPlaced()&&this.setShipRotatedPlacePieceParams(t)}setShipRotatedPlacePieceParams(e){const t=this.getRotatedPlacePieceParams(e);this.playerState.gameboardRepository.setShipValidRotationalParams(e,t)}}class B{_fleetCoordinates={};_inBoundRotationalPlacePieceParamsForFleet={};get fleetCoordinates(){return this._fleetCoordinates}get inBoundRotationalPlacePieceForFleet(){return this._inBoundRotationalPlacePieceParamsForFleet}addShipToFleetCoordinates(e,t){this.fleetCoordinates[e]||(this.fleetCoordinates[e]=new Set),t.forEach((t=>{const[r,n]=t,i=`[${r}, ${n}]`;this.fleetCoordinates[e].add(i)}))}isShipPlaced(e){return null!==this.fleetCoordinates[e]}nullifyShipCoordinatesValue(e){this.fleetCoordinates[e]=null}nullifyShipValidRotationalParams(e){this.inBoundRotationalPlacePieceForFleet[e]=null}setShipValidRotationalParams(e,t){this._inBoundRotationalPlacePieceParamsForFleet[e.type]||(this._inBoundRotationalPlacePieceParamsForFleet[e.type]=t)}}const P=(e=2002)=>{const t=new w,r=new B,n=2002===e?v.createHasbroFleet():v.createMBFleet();return{gameboardBuilder:t,gameboardRepository:r,fleetBuilder:n,gameboardController:new S({gameboardBuilder:t,gameboardRepository:r,fleetBuilder:n})}},D={player:P(),opponent:P()};function E(t,n){if(!t)throw new Error("Invalid Command: `gameboardController` is required to randomize the gameboard.");if(!n)throw new Error("Invalid Command: `fleet` is required to randomize the gameboard.");const i=(n,o,a,s=0)=>{if(s>100)throw new Error(`Max recursion depth exceeded when placing the ${n.type}.`);const l=((e,t)=>{const n=t-e;return[r(0,n),r(0,n)]})(n.length,a);return((r,n,i)=>{const o={shipLength:n.length,orientation:i},a=t.getValidPositions(o),[s,l]=r,d="horizontal"===i,h=d?l:s;return a[d?`row-${h}`:`column-${h}`].some((t=>e(t.bow,r)))})(l,n,o)?l:i(n,o,a,s+1)};for(const e in n){if(!y(e))throw new Error(`Invalid Type: "${e}" doesn't conform to "ShipType".`);const r=n[e],o=Math.random()<.5?"horizontal":"vertical",a={ship:r,coordinates:i(r,o,10),orientation:o};t.placePiece(a)}}function $(e,t){for(const r in t)e.setAttribute(r,t[r])}class F{constructor(e,t){this.playerGameboardComponent=e,this.opponentGameboardComponent=t,this.mainContainerTwo=n("section",["main-container"],{id:"main-container-two"})}get getPlayerGameboardComponent(){return this.playerGameboardComponent}render(e){this.playerGameboardComponent.render(this.mainContainerTwo),this.opponentGameboardComponent.render(this.mainContainerTwo),e.appendChild(this.mainContainerTwo)}}var R=new class{events={};on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}emit(e,t){this.events[e]&&this.events[e].forEach((e=>e(t)))}};class L{id="player";fleetElements=new Set;constructor(e){this.playerState=e,this.boardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize),this.gameboard=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize),this.dragImage=this.createDragImage(),this.shipDragClone=this.createShipDragClone(),R.on("updateGameboard",(e=>{this.updateGameboard(e)}))}render(e){if(!e)throw new Error(`Target element not found with ID - ${this.id} and selector - "${e}".`);this.boardContainer.append(this.dragImage,this.shipDragClone,this.gameboard),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements),e.appendChild(this.boardContainer)}createDragImage(){return n("img",["drag-image","accessibility"],{id:`${this.id}-drag-image`,src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_misc-images/1x1_transparent.png"})}createShipDragClone(){return n("div",["ship-container-clone"],{id:`${this.id}-ship-drag-clone`})}createBackgroundCellsFragment(e){const t=new DocumentFragment;return e.forEach(((e,r)=>{e.forEach(((e,i)=>{const o=e.description.toLowerCase(),a=n("div",[`${this.id}-${o}-cell`,`player-${o}-cell`,"grid-cell"],{"data-x":i.toString(),"data-y":r.toString(),"aria-label":`Row ${r+1}, Column ${i+1}`,role:"gridCell"}),s=n("div",[`${this.id}-${o}-grid-cell-container`,"grid-cell-container"]);s.appendChild(a),t.appendChild(s)}))})),t}createShipElement(e,t,r,i,o){const a=this.generateShipUnitFragment(t,e,o,this.id),s=n("div",["ship-container"],{id:`${this.id}-${e}-container`,"data-shipType":e,"data-length":t.toString(),"data-orientation":o,draggable:"true"});return s.appendChild(a),"horizontal"===o?(s.style.gridColumn=r,s.style.gridRow=i.toString(),s.style.gridTemplateColumns=`repeat(${t}, 1fr)`):(s.style.gridRow=r,s.style.gridColumn=i.toString(),s.style.gridTemplateRows=`repeat(${t}, 1fr)`),s}generateBoardContainer(e){const t=n("section",["gameboard-container"],{id:`${this.id}-gameboard-container`});return t.style.setProperty("--grid-size",e.toString()),this.handleDragListeners(t),this.handleClickListeners(t),t}generateBoardFragment(e){const t=n("div",["gameboard-background"],{id:`${this.id}-gameboard-background`});t.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const r=n("div",["gameboard"],{id:`${this.id}-gameboard`});r.style.setProperty("--grid-size",e.toString());const i=new DocumentFragment;return i.append(t,r),i}generateShipUnitFragment(e,t,r,i){const o=new DocumentFragment;for(let a=0;a<e;a++){const s=0===a,l=a===e-1,d=n("div",["ship-unit",`${t}-unit`,`${i}-${t}-unit`]);"horizontal"===r?d.classList.add("ship-unit-horizontal"):d.classList.add("ship-unit-vertical"),s&&(d.classList.add("ship-bow"),d.setAttribute("id",`${i}-${t}-bow`)),l&&(d.classList.add("ship-stern"),d.setAttribute("id",`${i}-${t}-stern`)),o.appendChild(d)}return o}getGridPlacementValue(e,t,r){const n="horizontal"===t,[i,o]=e;return[`${n?i+1:o+1} / span ${r}`,n?o+1:i+1]}handleFleetPlacement(e,t){this.updateFleetElements(e),this.placeFleetOnGameboard(t)}placeFleetOnGameboard(e){const t=this.boardContainer.querySelector(".gameboard");if(!t)throw new Error("Gameboard container not found.");e.forEach((e=>t.appendChild(e)))}updateFleetElements=e=>{this.fleetElements.size&&this.fleetElements.clear();for(const t of Object.values(e.fleet)){const e=t.type,r=t.length,n=t.currentplacementConfigurations.orientation;if(!n)throw new Error("Orientation not set.");const i=t.currentplacementConfigurations.coordinatesArray;if(!i||0===i.length){console.error(`The ${e} has not been placed. Continuing...`);continue}const[o,a]=i[0],[s,l]=this.getGridPlacementValue([o,a],n,r),d=this.createShipElement(e,r,s,l,n);this.fleetElements.add(d)}};updateGameboard(e){const t=e.querySelector(`#${this.id}-gameboard`),r=e.querySelector(`#${this.id}-gameboard-background`);if(!t||!r)throw new Error("Missing gameboard and/or gameboard background elements");this.boardContainer.removeChild(t),this.boardContainer.removeChild(r),this.shipDragClone.classList.remove("visible"),this.gameboard=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize),this.boardContainer.appendChild(this.gameboard),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements)}handleDragListeners(e){const t={currentShipInstance:null,initialPlacementConfigurations:null,isValidDropTarget:!1,currentDragOverCell:null,cloneSnapOffset:null,shipBorderValueSplit:null};e.addEventListener("dragstart",(e=>{this.handleShipDragStart(e,t)})),e.addEventListener("drag",(e=>{this.handleShipDrag(e,t)})),e.addEventListener("dragenter",(e=>{this.handleShipDragEnter(e)})),e.addEventListener("dragleave",(e=>{this.handleShipDragLeave(e)})),e.addEventListener("dragover",(e=>{this.handleShipDragOver(e,t)})),e.addEventListener("drop",(e=>{this.handleShipDrop(e,t)})),e.addEventListener("dragend",(e=>{this.handleShipDragEnd(e,t)}))}handleShipDragStart(r,n){if(!(r.target instanceof HTMLDivElement&&r.target.matches(".ship-container")))return;const i=r.target,o=t(i,"data-orientation",m),a=this.playerState.fleetBuilder.fleet,s=t(i,"data-shiptype",y),l=((e,t,r)=>{const n=(e=>{const t=e.querySelector(".ship-bow");if(!t)throw new Error("Ship bow not found.");return t})(e),i=getComputedStyle(document.documentElement).getPropertyValue("--ship-container-border-size").trim().match(/^(?<numberValue>\d+(\.\d+)?)(?<unitType>[a-z%]+)$/i);if(!i||!i.groups)throw new Error("No matches found when parsing");const o=i.groups;r.shipBorderValueSplit=o;const a="horizontal"===t,[s,l]=a?[n.getBoundingClientRect().width/2,n.getBoundingClientRect().height/2+Number(o.numberValue)]:[n.getBoundingClientRect().width/2+Number(o.numberValue),n.getBoundingClientRect().height/2];return{offsetX:s,offsetY:l}})(i,o,n);if(((e,t,r,n)=>{if(!t[r])throw new Error(`The ${r} is not present in the fleet.`);e.currentShipInstance=t[r],e.initialPlacementConfigurations=e.currentShipInstance.currentplacementConfigurations,e.cloneSnapOffset=n})(n,a,s,l),!n.currentShipInstance)throw new Error(`Drag state hasn't been updated with the current ship instance on drag start. Drag State: ${JSON.stringify(n)}`);this.playerState.gameboardController.removePiece(n.currentShipInstance),r.dataTransfer?.setDragImage(this.dragImage,0,0),((e,t)=>{const r=e.getBoundingClientRect();t.style.height=`${r.height}px`,t.style.width=`${r.width}px`})(i,this.shipDragClone),(e=>{e.classList.add("lower-opacity"),setTimeout((()=>{e.style.pointerEvents="none"}),0),this.shipDragClone.classList.add("visible")})(i),((t,r,n,i)=>{const o=Number(r.getAttribute("data-length"));if(!o||"number"!=typeof(a=o)||![2,3,4,5].includes(a))throw new Error("Invalid or missing ship type attribute.");var a;const s=o;((t,r,n)=>{const o=i.getAllValidBowCoordinates(n,r);t.forEach((t=>{const r=[Number(t.getAttribute("data-x")),Number(t.getAttribute("data-y"))];for(const n of o)e(n,r)&&t.classList.add("valid-bow-coordinates")}))})(t.querySelectorAll(".grid-cell"),s,n)})(this.boardContainer,i,o,this.playerState.gameboardController),this.snapCloneToCursor(r,l)}handleShipDrag(e,t){if(!(e.target instanceof HTMLDivElement&&e.target.matches(".ship-container")))return;const r=t.cloneSnapOffset;if(!r)throw new Error("An error has occured during the `cloneSnapOffset` reading.");this.snapCloneToCursor(e,r)}handleShipDragEnter(e){if(!(e.target instanceof HTMLDivElement&&e.target.matches(".grid-cell")))return;const t=e.target,r=t.classList.contains("valid-bow-coordinates");r?t.classList.add("placement-is-valid"):t.classList.add("placement-is-invalid"),r&&this.shipDragClone.classList.add("placement-is-valid")}handleShipDragLeave(e){if(!(e.target instanceof HTMLDivElement&&e.target.matches(".grid-cell")))return;const t=e.target;t.classList.contains("placement-is-valid")?t.classList.remove("placement-is-valid"):t.classList.remove("placement-is-invalid"),this.shipDragClone.classList.contains("placement-is-valid")&&this.shipDragClone.classList.remove("placement-is-valid")}handleShipDragOver(e,t){if(e.preventDefault(),!(e.target instanceof HTMLDivElement&&e.target.matches(".grid-cell")))return;const r=e.target;t.currentDragOverCell=r,r.classList.contains("valid-bow-coordinates")}handleShipDrop(e,t){if(e.preventDefault(),!(e.target instanceof HTMLDivElement&&e.target.matches(".valid-bow-coordinates")))return;const{coordinatesArray:r,orientation:n}=t.initialPlacementConfigurations||{};if(!r||!n)throw new Error("Initial placement configurations are incomplete.");t.isValidDropTarget=!0;const i=e.target,o=i.getAttribute("data-x"),a=i.getAttribute("data-y");if(!o||!a)throw new Error("Missing or invalid grid cell coordinates.");const s=[Number(o),Number(a)];this.playerState.gameboardController.placePiece({ship:t.currentShipInstance,coordinates:s,orientation:n}),this.updateGameboard(this.boardContainer),t.isValidDropTarget=!1}handleShipDragEnd(e,t){if(!(e.target instanceof HTMLDivElement&&e.target.matches(".ship-container")))return;const r=()=>{const{coordinatesArray:e,orientation:r}=t.initialPlacementConfigurations||{};if(!e||!r)throw new Error("Initial placement configurations are incomplete.");const n=e[0];this.playerState.gameboardController.placePiece({ship:t.currentShipInstance,coordinates:n,orientation:r})},n=(e,t,r)=>{const n=r?"placement-is-valid":"placement-is-invalid";t.classList.remove(n),e.classList.remove("lower-opacity"),this.shipDragClone.classList.remove("visible"),e.style.pointerEvents="auto"},i=e.target;try{const{currentDragOverCell:e,isValidDropTarget:o}=t;if(!e)throw new Error(`Current drag over cell is missing. Drag state: ${JSON.stringify(t)}`);n(i,e,o),o||r()}catch(e){console.error(e)}}snapCloneToCursor(e,t){const r=this.boardContainer.getBoundingClientRect(),n=r.left,i=r.top,o=e.clientX,a=e.clientY,{offsetX:s,offsetY:l}=t;document.documentElement.style.setProperty("--ship-clone-left",o-n-s+"px"),document.documentElement.style.setProperty("--ship-clone-top",a-i-l+"px")}handleClickListeners(e){e.addEventListener("click",(e=>{this.handleShipRotation(e)}))}handleShipRotation(e){if(!(e.target instanceof HTMLDivElement&&e.target.matches(".ship-container")))return;const r=e.target,n=t(r,"data-shiptype",y),i=this.playerState.fleetBuilder.getShip(n);this.playerState.gameboardController.rotatePiece(i),this.updateGameboard(this.boardContainer)}getId(){return this.id}}class A{id="opponent";constructor(e){this.playerState=e,this.boardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize)}render(e){if(!e)throw new Error(`Target element not found with ID - ${this.id} and selector - "${e}".`);const t=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize);this.boardContainer.appendChild(t),e.appendChild(this.boardContainer)}createBackgroundCellsFragment(e){const t=new DocumentFragment;return e.forEach(((e,r)=>{e.forEach(((e,i)=>{const o=n("div",[`${this.id}-cell`,"grid-cell"],{"data-x":i.toString(),"data-y":r.toString(),"aria-label":`Row ${r+1}, Column ${i+1}`,role:"gridCell"}),a=n("div",[`${this.id}-grid-cell-container`,"grid-cell-container"]);a.appendChild(o),t.appendChild(a)}))})),t}generateBoardContainer(e){const t=n("div",["gameboard-container"],{id:`${this.id}-gameboard-container`});return t.style.setProperty("--grid-size",e.toString()),t}generateBoardFragment(e){const t=n("div",["gameboard-background"],{id:`${this.id}-gameboard-background`});t.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const r=n("div",["gameboard"],{id:`${this.id}-gameboard`});r.style.setProperty("--grid-size",e.toString());const i=new DocumentFragment;return i.append(t,r),i}getId(){return this.id}}class z{constructor(e,t,r,i=[],o={}){if(this.elementTag=e,this.fragments=t,this.initialFragmentKey=r,this.classNames=i,this.attributes=o,!t[r])throw new Error(`Initial fragment with key "${r}" does not exist.`);this.hotSwapContainer=n(this.elementTag,this.classNames,this.attributes),this.hotSwapContainer.appendChild(this.fragments[this.initialFragmentKey])}render(e){e.appendChild(this.hotSwapContainer)}replaceFragment(e){this.hotSwapContainer.replaceChildren(e)}replaceFragmentByKey(e){const t=this.getFragment(e);this.replaceFragment(t)}getFragment(e){const t=this.fragments[e];if(!t)throw new Error(`Fragment with key "${e}" does not exist.`);return t}}function T(){const e=n("h2",[],{id:"subheading"});e.textContent="Parabellum";const t=n("button",[],{id:"instructions-button"}),r=n("div",[],{id:"instructions-button-container"});r.appendChild(t);const i=n("div",["parabellum"],{id:"main-container-one-parabellum"});i.append(e,r);const o=new DocumentFragment;return o.append(i),o}function O(){const e=n("div",["bellum"],{id:"main-container-one-bellum"}),t=new DocumentFragment;return t.appendChild(e),t}function I(){const e=n("div",["bellum"],{id:"main-container-one-post-bellum"}),t=new DocumentFragment;return t.appendChild(e),t}class V{shipShufflerButtonTextContent="Shuffle";buttonClass="ship-shuffler-button";constructor(e,t,r,n){this.id=e,this.gameboardContainer=t,this.gameboardController=r,this.fleet=n,this.shipShufflerButton=this.createshipShufflerButton(`${this.id}-${this.buttonClass}`,[this.buttonClass]),this.shipShufflerButton.classList.add(this.buttonClass),this.shipShufflerButton.textContent=this.shipShufflerButtonTextContent,this.addEventListener(this.shipShufflerButton),this.shipShufflerButtonContainer=this.createshipShufflerButtonContainer(),this.shipShufflerButtonContainer.appendChild(this.shipShufflerButton)}render(e){if(!e)throw new Error(`Target element not found. Recieved ${e}.`);e.appendChild(this.shipShufflerButtonContainer)}addEventListener(e){e.addEventListener("click",(()=>{this.randomizeGameboard(),this.updateGameboard(this.gameboardContainer)}))}createshipShufflerButton(e,t){return n("button",[...t],{id:e})}createshipShufflerButtonContainer(){return n("div",["ship-shuffler-button-container"])}randomizeGameboard(){this.gameboardController.removeAllPieces(this.fleet),E(this.gameboardController,this.fleet)}updateGameboard(e){R.emit("updateGameboard",e)}getId(){return this.id}}class k{readyUpButtonTextContent="Ready Up";buttonClass="ready-up-button";constructor(e,t,r,n){this.id=e,this.gameboardContainer=t,this.gameboardController=r,this.fleet=n,this.readyUpButton=this.createReadyUpButton(this.buttonClass),this.readyUpButton.classList.add(this.buttonClass),this.addEventListener(this.readyUpButton),this.readyUpButtonContainer=this.createReadyUpButtonContainer(),this.readyUpButtonContainer.appendChild(this.readyUpButton)}addEventListener(e){e.addEventListener("click",(()=>{this.readyUp()}))}createReadyUpButton(e){const t=n("span",["ready-up-button-text"]);t.textContent=this.readyUpButtonTextContent;const r=n("img",["inactive-ready-up-button"],{alt:"Ready Up (Inactive)",src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-inactive.svg"}),i=n("img",["active-ready-up-button"],{alt:"Ready Up (Active)",src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-active.svg"}),o=n("button",[],{id:e});return o.append(i,r,t),o}createReadyUpButtonContainer(){return n("div",["ready-up-button-container"])}readyUp(){console.log("Ready up button clicked")}render(e){if(!e)throw new Error(`Target element not found. Recieved ${e}.`);e.appendChild(this.readyUpButtonContainer)}getId(){return this.id}}function x(e,t,r){const i=new V(e.id,e.boardContainer,t,r),o=new k(e.id,e.boardContainer,t,r),a=n("div",["parabellum"],{id:"main-container-three-parabellum"});i.render(a),o.render(a);const s=new DocumentFragment;return s.appendChild(a),s}function M(){const e=n("div",["bellum"],{id:"main-container-three-bellum"}),t=new DocumentFragment;return t.appendChild(e),t}function G(){const e=n("div",["post-bellum"],{id:"main-container-three-post-bellum"}),t=new DocumentFragment;return t.appendChild(e),t}console.time("init"),function(){console.time("randomizeBSGameboards"),E(D.player.gameboardController,D.player.fleetBuilder.fleet),E(D.opponent.gameboardController,D.opponent.fleetBuilder.fleet),console.timeEnd("randomizeBSGameboards");const e=document.getElementById("content");if(!e)throw new Error("Fuck!");const t=n("a",["heading-link"],{id:"heading-link",href:"https://johnkeyscloud.github.io/battleship/"});t.textContent="ShattleBip";const r=n("h1",["main-heading"]);r.appendChild(t);const i=function(e="50px",t="#FFF",r="johnKeysCloud",n){const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M8.20003216,0 C3.67186256,0 0,3.67233045 0,8.2025137 C0,11.8266603 2.34955472,14.9012922 5.60770169,15.9859115 C6.01749428,16.0618219 6.16798309,15.8079721 6.16798309,15.5913056 C6.16798309,15.3957396 6.16033003,14.7495356 6.15685721,14.064154 C3.87553694,14.5603383 3.3941657,13.0963596 3.3941657,13.0963596 C3.02115925,12.1482506 2.48370842,11.896202 2.48370842,11.896202 C1.7397535,11.3870871 2.53978801,11.3975087 2.53978801,11.3975087 C3.36323189,11.4554066 3.79681972,12.242817 3.79681972,12.242817 C4.52816959,13.4968196 5.71510182,13.1342505 6.18303197,12.9247247 C6.25660428,12.3945093 6.46915364,12.0327122 6.70363321,11.8278826 C4.88233278,11.6204154 2.96765212,10.9170854 2.96765212,7.77413412 C2.96765212,6.87864774 3.28798748,6.14688355 3.81257603,5.57247278 C3.72742766,5.36584187 3.44677247,4.53159853 3.89200067,3.40175461 C3.89200067,3.40175461 4.58058343,3.18129256 6.14759636,4.24255971 C6.80164386,4.06076054 7.50315322,3.96966796 8.20003216,3.96658007 C8.89691109,3.96966796 9.59893494,4.06076054 10.2542687,4.24255971 C11.8194166,3.18129256 12.5070347,3.40175461 12.5070347,3.40175461 C12.9533562,4.53159853 12.6725723,5.36584187 12.587424,5.57247278 C13.1131701,6.14688355 13.4313189,6.87858341 13.4313189,7.77413412 C13.4313189,10.9245478 11.5130368,11.6182925 9.68710595,11.8213208 C9.98120223,12.0758783 10.2432714,12.5750862 10.2432714,13.3403025 C10.2432714,14.4377879 10.2337533,15.3211158 10.2337533,15.5913056 C10.2337533,15.8095804 10.3813481,16.0653602 10.7970574,15.9848178 C14.0534036,14.8989763 16.4,11.825438 16.4,8.2025137 C16.4,3.67233045 12.7286519,0 8.20003216,0");const o=document.createElementNS("http://www.w3.org/2000/svg","path");$(o,{d:"M3.07518929,11.6824029 C3.05731167,11.723257 2.99359073,11.7355197 2.93568001,11.7075092 C2.87662002,11.6806603 2.84341872,11.6248974 2.86257332,11.5838496 C2.88013169,11.5417693 2.94385264,11.5300229 3.00278493,11.5582916 C3.06197262,11.5850759 3.09568471,11.6413552 3.07518929,11.6824029 M3.47564797,12.0435714 C3.436828,12.0799722 3.36091196,12.0630626 3.30938611,12.0055571 C3.25613634,11.9481806 3.24617596,11.8715065 3.28557057,11.8345248 C3.32560367,11.7981885 3.39922115,11.8151627 3.45259861,11.8726037 C3.50584838,11.9306256 3.51619186,12.0068479 3.47558413,12.0436359 M3.75038868,12.5056811 C3.70045904,12.5407266 3.61886048,12.5078755 3.5684839,12.4346866 C3.51861811,12.3615623 3.51861811,12.2737872 3.56956933,12.2386127 C3.62013745,12.2034381 3.70045904,12.235063 3.75153796,12.307671 C3.8013399,12.3820861 3.8013399,12.4698612 3.75032483,12.5057457 M4.2149514,13.0409152 C4.1703212,13.0906114 4.07531442,13.0773161 4.0057194,13.0094195 C3.93459201,12.9430719 3.91473508,12.8489074 3.95949298,12.7991467 C4.00463397,12.7493214 4.10021539,12.7633267 4.1703212,12.8306424 C4.24100164,12.8968609 4.26258248,12.9917354 4.21501525,13.0409152 M4.81538402,13.2216286 C4.79578249,13.2860399 4.70422354,13.3153413 4.6120261,13.2879762 C4.51995636,13.259772 4.45968324,13.1842596 4.4782632,13.1191383 C4.49741779,13.0542751 4.58935983,13.0237475 4.68225961,13.0530489 C4.77420165,13.081124 4.83460247,13.1560554 4.81544787,13.2216286 M5.49881989,13.2982381 C5.50111844,13.3661347 5.42290385,13.422414 5.32610931,13.4236402 C5.22874013,13.4257701 5.15001476,13.3708461 5.14899318,13.3041113 C5.14899318,13.2355693 5.22542,13.1798063 5.32272533,13.1781928 C5.41951987,13.1762566 5.49881989,13.2307933 5.49881989,13.2982381 M6.17012451,13.2722283 C6.18174496,13.3384468 6.11444849,13.4064725 6.01835628,13.4245438 C5.92386029,13.4419697 5.83638766,13.4011156 5.82432026,13.3354779 C5.81257211,13.2675814 5.88114555,13.1996203 5.97545,13.1820007 C6.07173375,13.1650911 6.15786557,13.2049126 6.17012451,13.2722283","fill-rule":"nonzero"});const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("fill",t),a.append(i,o);const s=document.createElementNS("http://www.w3.org/2000/svg","g");$(s,{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}),s.appendChild(a);const l=document.createElementNS("http://www.w3.org/2000/svg","svg");$(l,{viewBox:"0 0 17 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:e,height:e}),l.classList.add("git-hub-svg"),l.appendChild(s);const d=document.createElement("a");return d.classList.add("git-hub-logo-link"),$(d,{href:n?`https://github.com/${r}/${n}`:`https://github.com/${r}`,rel:"noopener noreferrer",target:"_blank",type:"button","aria-label":"GitHub profile link"}),d.appendChild(l),d}(),o=n("nav");o.append(r,i),e.appendChild(o);const a=function(e){const t=new L(e.player),r=e.player.gameboardController,i=e.player.fleetBuilder.fleet,o=new A(e.opponent),a={parabellum:T(),bellum:O(),postBellum:I()},s=new z("section",a,"parabellum",["main-container"],{id:"main-container-one"}),l=new F(t,o),d={parabellum:x(t,r,i),bellum:M(),postBellum:G()},h=new z("section",d,"parabellum",["main-container"],{id:"main-container-three"}),c=n("main",["gameboard-main"],{id:"player-gameboard-section"});return s.render(c),l.render(c),h.render(c),c}(D);e.appendChild(a)}(),console.timeEnd("init")}();
//# sourceMappingURL=index.bundle.js.map