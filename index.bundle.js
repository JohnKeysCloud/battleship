!function(){"use strict";const t=(t,e)=>t.length===e.length&&t.every(((t,i)=>t===e[i])),e=t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),i=t=>new Promise((e=>setTimeout(e,t))),n=(t,e,i)=>{const n=t.getAttribute(e);if(!n||!i(n))throw new Error(`Invalid or missing attribute: ${e}`);return n},r=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,a=(t,e=[],i={})=>{const n=document.createElement(t);return e.forEach((t=>n.classList.add(t))),Object.entries(i).forEach((([t,e])=>n.setAttribute(t,e))),n},o=t=>new Promise((e=>setTimeout(e,t))),s=(t,e=1e3,i,n)=>new Promise((r=>{let a=!1,o=0;const s=()=>{a||(a=!0,t.removeEventListener("transitionend",l),clearTimeout(h),r(),n?.())},l=e=>{if(void 0!==i&&i>0)return o++,void(o>=i&&s());e.target===t&&s()};t.addEventListener("transitionend",l);const h=setTimeout((()=>{s()}),e)}));var l,h,c;!function(t){t[t.Degrees0=0]="Degrees0",t[t.Degrees90=90]="Degrees90",t[t.Degrees180=180]="Degrees180",t[t.Degrees270=270]="Degrees270"}(l||(l={})),(c=h||(h={})).Battleship="battleship",c.Carrier="carrier",c.Cruiser="cruiser",c.Destroyer="destroyer",c.PatrolBoat="patrolBoat",c.Submarine="submarine";const d=t=>!(!Array.isArray(t)||2!==t.length)&&t.every((t=>"number"==typeof t)),u=t=>t instanceof HTMLDivElement,p=t=>t instanceof HTMLElement,g=t=>"string"==typeof t&&["horizontal","vertical"].includes(t),m=t=>"outOfBounds"===t,f=t=>"object"==typeof t&&null!==t&&!!d(t.coordinates),y=t=>{if(!(t=>{if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||null===e})(t))return!1;const{bow:e,stern:i}=t;return d(e)&&d(i)},b=t=>Object.values(h).includes(t);function C(e,i){if(!e)throw new Error("Invalid Command: `gameboardController` is required to randomize the gameboard.");if(!i)throw new Error("Invalid Command: `fleet` is required to randomize the gameboard.");const n=(i,a,o,s=0)=>{if(s>100)throw new Error(`Max recursion depth exceeded when placing the ${i.type}.`);const l=((t,e)=>{const i=e-t;return[r(0,i),r(0,i)]})(i.length,o);return((i,n,r)=>{const a={shipLength:n.length,orientation:r},o=e.getValidPositions(a),[s,l]=i,h="horizontal"===r,c=h?l:s;return o[h?`row-${c}`:`column-${c}`].some((e=>t(e.bow,i)))})(l,i,a)?l:n(i,a,o,s+1)};for(const t in i){if(!b(t))throw new Error(`Invalid Type: "${t}" doesn't conform to "ShipType".`);const r=i[t],a=Math.random()<.5?"horizontal":"vertical",o={ship:r,coordinates:n(r,a,10),orientation:a};e.placePiece(o)}}const S={[h.Carrier]:Symbol("CA"),[h.Battleship]:Symbol("BS"),[h.Cruiser]:Symbol("CR"),[h.Submarine]:Symbol("SB"),[h.Destroyer]:Symbol("DD"),[h.PatrolBoat]:Symbol("PB")},w={"battleship-1990":4,"battleship-2002":4,"carrier-1990":5,"carrier-2002":5,"cruiser-1990":3,"cruiser-2002":void 0,"destroyer-1990":2,"destroyer-2002":3,"patrolBoat-1990":void 0,"patrolBoat-2002":2,"submarine-1990":3,"submarine-2002":3};class v{seaworthy=!0;rotationalPivotConfigurations={transientAngleOfRotation:null,coordinatesArray:null,orientation:null};currentplacementConfigurations={coordinatesArray:null,orientation:null};isPlaced=()=>null!==this.currentplacementConfigurations.coordinatesArray;_hitCounter=0;constructor(t,e=2002){this.type=t,this.version=e,this.symbol=S[t];const i=`${t}-${e}`,n=w[i];if(void 0===n)throw new Error(`Invalid Command: ship type/version combination: ${i}.`);this.length=n}hit=()=>this.isSeaworthy()?(this._hitCounter++,`Hit registered. Hit count: ${this.hitCounter}.`):"This ship has already perished.";isSeaworthy=()=>this.hitCounter<this.length;resetConfigurations=t=>{const e={coordinatesArray:null,orientation:null};this.currentplacementConfigurations=e,!0===t&&(this.rotationalPivotConfigurations={...e,transientAngleOfRotation:null})};get hitCounter(){return this._hitCounter}}class B{constructor(t,e){this.fleet=t,this.version=e}static createFleet(t){const e={};for(const[i,n]of Object.entries(t))n&&b(i)&&(e[i]=new v(n.type,n.version));return e}static createHasbroFleet(){return new B(B.createFleet({carrier:{type:h.Carrier,version:2002},battleship:{type:h.Battleship,version:2002},destroyer:{type:h.Destroyer,version:2002},submarine:{type:h.Submarine,version:2002},patrolBoat:{type:h.PatrolBoat,version:2002}}),2002)}static createMBFleet(){return new B(B.createFleet({carrier:{type:h.Carrier,version:1990},battleship:{type:h.Battleship,version:1990},cruiser:{type:h.Cruiser,version:1990},submarine:{type:h.Submarine,version:1990},destroyer:{type:h.Destroyer,version:1990}}),1990)}getShip(t){const e=this.fleet[t];if(!e)throw new Error(`Invalid Command: Ship of type ${t} not found in fleet.`);return e}}class E{static vacant=Symbol("VC");_boardSize=10;_fillValue=E.vacant;constructor(){this._board=Array.from({length:this._boardSize},(()=>Array(this._boardSize).fill(this._fillValue)))}get board(){return this._board}get boardSize(){return this._boardSize}get fillValue(){return this._fillValue}}function P([t,e],i,n){return{bow:[t,e],stern:"horizontal"===i?[t+n-1,e]:[t,e+n-1]}}const A=(t,e)=>t>=0&&t<e,T=(t,e)=>t.every((t=>A(t,e))),k=(e,i)=>t(e.bow,i.bow)&&t(e.stern,i.stern);class L{constructor(t){this.playerState=t}getValidPositions({orientation:t,shipLength:e}){return function({shipLength:t,orientation:e,battleshipBoardBuilder:i}){const n=(t,e,i)=>"horizontal"===e?i[t]:i.map((e=>e[t])),r=(t,e,n,r)=>{let a=0,o=[];for(let s=0;s<t.length;s++)if(t[s]===i.fillValue){if(a++,a>=r){const t=e?[s-(r-1),n]:[n,s-(r-1)],i=e?[s,n]:[n,s];o.push({bow:t,stern:i})}}else a=0;return o},a={},o=i.board,s="horizontal"===e;for(let i=0;i<o.length;i++){const l=r(n(i,e,o),s,i,t);a[s?`row-${i}`:`column-${i}`]=l}return a}({orientation:t,shipLength:e,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardController:this})}getAllValidBowCoordinates(t,e){let i=new Set;const n=this.getValidPositions({orientation:t,shipLength:e});for(const t of Object.values(n)){if(r=t,!Array.isArray(r)||!r.every((t=>y(t))))throw new Error(`Expected each value of validPositions to be an array of IPosition objects, but received: ${typeof t}.`);t.forEach((t=>i.add(t.bow)))}var r;return i}movePiece(t,e){if(!t.isPlaced())return void console.warn(`Invalid Command: The ${t.type} has not been placed.`);const i=t.currentplacementConfigurations.orientation,n=P(e,i,t.length);if(r=n,a=this.playerState.gameboardBuilder.boardSize,!T(r.bow,a)||!T(r.stern,a))return void console.warn(`Invalid Command: Position - Bow: [${n.bow}] & Stern: [${n.stern}] is out of bounds for the ${t.type}.`);var r,a;const o=this.getValidPositions({orientation:i,shipLength:t.length}),s="horizontal"===i,[l,h]=e,c=function(t,e){return e?`row-${t}`:`column-${t}`}(s?h:l,s),d=o[c].some((t=>k(t,n)));if(d){const n={ship:t,coordinates:e,orientation:i},r=!0;this.relocateShip(t,n,r)}else console.warn(`Invalid Command: Position - Bow: [${n.bow}] & Stern: [${n.stern}] is unavailable for the ${t.type}.`)}placePiece({ship:t,coordinates:e,orientation:i}){!function({ship:t,coordinates:e,orientation:i,battleshipBoardController:n,battleshipBoardBuilder:r,battleshipBoardRepository:a}){const o=t.length,[s,h]=e,c="horizontal"===i;if(!A((c?s:h)+o-1,r.boardSize)){const n=`Invalid Command: The ship placement attempt with the following configurations is out of bounds - Coordinates: ${e}, Length: ${t.length}, Orientation: ${i}.`;throw new Error(n)}if(t.isPlaced())return void console.warn(`Invalid Command: The ${t.type} has already been placed.`);const d=P(e,i,o);if(!((t,e,i)=>n.getValidPositions(e)[i].some((e=>k(t,e))))(d,{shipLength:o,orientation:i},c?`row-${h}`:`column-${s}`)){const t=`Invalid Command: "${JSON.stringify(d)}" is unavailable for ship with Size: ${o} and Orientation: ${i}.`;throw new Error(t)}{const e=(t,e)=>{const i=[],[n,r]=t.bow,[a,o]=t.stern,s=e?r:n,l=e?a:o;for(let t=e?n:r;t<=l;t++)i.push(e?[t,s]:[s,t]);return i},n=(t,e)=>{const i=r.board,n=t.symbol;e.forEach((t=>{const[e,r]=t;i[r][e]=n}))},o=(t,e,i)=>{const n={coordinatesArray:e,orientation:i};t.currentplacementConfigurations=n,Object.values(t.rotationalPivotConfigurations).every((t=>null===t))&&(t.rotationalPivotConfigurations={...n,transientAngleOfRotation:l.Degrees0})},s=(t,e)=>{a.addShipToFleetCoordinates(t,e)},h=e(d,c);n(t,h),o(t,h,i),s(t.type,h)}}({ship:t,coordinates:e,orientation:i,battleshipBoardController:this,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardRepository:this.playerState.gameboardRepository}),this.setFleetRotatedPlacePieceParams(this.playerState.fleetBuilder.fleet)}prettyPrint(){console.table(this.playerState.gameboardBuilder.board.map((t=>t.map((t=>"VC"===t.description?null:t.description)))))}receiveAttack(t){const e=this.getShipAt(t);if(null===e)return{hit:!1};e.hit();const i={hit:!0,isSunk:!e.isSeaworthy(),type:e.type};if(!b(i.type))throw new Error("Invalid ship type");return i.hit&&i.isSunk&&this.playerState.gameboardRepository.addSunkenShip(i.type),i}removePiece(t,e=!0){this.isShipValidForRemoval(t)&&((t=>{t.forEach((([t,e])=>{this.playerState.gameboardBuilder.board[e][t]=this.playerState.gameboardBuilder.fillValue}))})(t.currentplacementConfigurations.coordinatesArray),(t=>{this.playerState.gameboardRepository.nullifyShipCoordinatesValue(t)})(t.type),((t,e)=>{e&&this.playerState.gameboardRepository.nullifyShipValidRotationalParams(t.type),t.resetConfigurations(e)})(t,e))}removeAllPieces(t){if(Object.keys(t).length)for(const e of Object.values(t))this.removePiece(e);else console.error("Invalid Command: No ships to remove - Fleet is empty or uninitialized.")}rotatePiece(t){const e=(t,e)=>{const i=t.rotationalPivotConfigurations.transientAngleOfRotation,n=(t=>Array.from(t.keys()).pop()??l.Degrees0)(e);if(i===n){const e=t.rotationalPivotConfigurations.coordinatesArray[0],i=t.rotationalPivotConfigurations.orientation;return t.rotationalPivotConfigurations.transientAngleOfRotation=l.Degrees0,{ship:t,coordinates:e,orientation:i}}const r=((t,e)=>{if(null==e)throw new Error("Current angle doesn't exist");return Array.from(t.keys()).find((t=>t>e))??l.Degrees0})(e,i),a=e.get(r);return t.rotationalPivotConfigurations.transientAngleOfRotation=r,{ship:t,coordinates:a.coordinates,orientation:a.orientation}},i=this.playerState.gameboardRepository.inBoundRotationalPlacePieceForFleet[t.type],n=t.rotationalPivotConfigurations.transientAngleOfRotation,r=(i=>{let r=e(t,i);for(;t.rotationalPivotConfigurations.transientAngleOfRotation!==n&&!this.isRotatedPositionValid(r.coordinates,r.orientation,t.rotationalPivotConfigurations.transientAngleOfRotation,t.length);)r=e(t,i);return r})(i);t.rotationalPivotConfigurations.transientAngleOfRotation!==n?this.relocateShip(t,r,!1):console.warn("No valid rotational position found.")}areCoordinatesVacant(t){const[e,i]=t;return this.playerState.gameboardBuilder.board[i][e]===this.playerState.gameboardBuilder.fillValue}getShipAt(t){if(this.areCoordinatesVacant(t))return null;const e=this.playerState.gameboardBuilder.board,[i,n]=t,r=e[n][i],a=this.getShipTypeFromSymbol(r);return this.playerState.fleetBuilder.getShip(a)}getShipTypeFromSymbol=t=>{if("string"!=typeof(e=t.description)||!["CA","BS","CR","SB","DD","PB"].includes(e))throw new Error("Invalid ship symbol description");var e;switch(t.description){case"CA":return h.Carrier;case"DD":return h.Destroyer;case"SB":return h.Submarine;case"BS":return h.Battleship;case"CR":return h.Cruiser;case"PB":return h.PatrolBoat;default:throw new Error("The symbol description does not return valid ship type.")}};isRotatedPositionValid=([t,e],i,n,r)=>{const a="horizontal"===i,o=this.playerState.gameboardBuilder.boardSize,s=this.playerState.gameboardBuilder.board,h=this.playerState.gameboardBuilder.fillValue,c=a?t:e;let d,u;if(!a&&n===l.Degrees90||a&&n===l.Degrees270||n===l.Degrees0?(d=1,u=r):(d=0,u=r-1),c+r-1>=o)return!1;for(;d<u;d++)if((a?s[e][t+d]:s[e+d][t])!==h)return!1;return!0};getRotatedPlacePieceParams(t){const e=(t,e)=>t-(e-1),i=(t,e)=>e?t===l.Degrees180?"horizontal":"vertical":t===l.Degrees180?"vertical":"horizontal",n=(i,n,[a,o])=>{if(i===l.Degrees0||i===l.Degrees90&&n||i===l.Degrees270&&!n)return r;const s=n?i===l.Degrees180?[e(a,t.length),o]:[a,e(o,t.length)]:i===l.Degrees180?[a,e(o,t.length)]:[e(a,t.length),o];return T(s,this.playerState.gameboardBuilder.boardSize)?s:"outOfBounds"},r=t.rotationalPivotConfigurations.coordinatesArray[0],a=t.rotationalPivotConfigurations.orientation,o=((t,e)=>{const r="horizontal"===e,a={};return[l.Degrees0,l.Degrees90,l.Degrees180,l.Degrees270].forEach((o=>{const s=o===l.Degrees0?t:n(o,r,t);a[o]="outOfBounds"===s?"outOfBounds":{coordinates:s,orientation:o===l.Degrees0?e:i(o,r)}})),a})(r,a),s=(t=>{const e=new Map;for(const n of Object.keys(t)){const r=+n;if(i=r,!Object.values(l).includes(i))throw new Error(`Invalid Type: "${n}" doesn't conform to "AngleOfRotation".`);const a=t[r];if(!f(a)&&!m(a))throw new Error(`Invalid Type: "${a}" doesn't conform to "RotatedPlacePieceParams".`);if(!f(a))continue;const{coordinates:o,orientation:s}=a,h={coordinates:o,orientation:s};e.set(r,h)}var i;return e})(o);return s}isShipValidForRemoval(t){return!(!t.currentplacementConfigurations.coordinatesArray||!this.playerState.gameboardRepository.isShipPlaced(t.type))||(console.error(`Error removing ship: ${t.type} is missing coordinates or not in the fleet.`),!1)}relocateShip(t,e,i){this.removePiece(t,i),this.placePiece(e)}setFleetRotatedPlacePieceParams(t){for(const e of Object.values(t))e.isPlaced()&&this.setShipRotatedPlacePieceParams(e)}setShipRotatedPlacePieceParams(t){const e=this.getRotatedPlacePieceParams(t);this.playerState.gameboardRepository.setShipValidRotationalParams(t,e)}}class ${#t={};#e={};#i=new Set;#n=new Set;get fleetCoordinates(){return this.#t}get inBoundRotationalPlacePieceForFleet(){return console.log(this.#e),this.#e}addAttackedCoordinates(t){this.#i.add(`[${t[0]}, ${t[1]}]`)}addShipToFleetCoordinates(t,e){this.fleetCoordinates[t]||(this.fleetCoordinates[t]=new Set),e.forEach((e=>{const[i,n]=e,r=`[${i}, ${n}]`;this.fleetCoordinates[t].add(r)}))}addSunkenShip(t){this.#n.add(t)}areAllShipsSunk(){return this.#n.size===Object.keys(this.fleetCoordinates).length}isShipPlaced(t){return null!==this.fleetCoordinates[t]}nullifyShipCoordinatesValue(t){this.fleetCoordinates[t]=null}nullifyShipValidRotationalParams(t){this.inBoundRotationalPlacePieceForFleet[t]=null}setShipValidRotationalParams(t,e){this.#e[t.type]||(this.#e[t.type]=e)}hasTargetBeenAttacked(t){return this.#i.has(`[${t[0]}, ${t[1]}]`)}}const R=(t=2002)=>{const e=new E,i=new $,n=2002===t?B.createHasbroFleet():B.createMBFleet();return{gameboardBuilder:e,gameboardRepository:i,fleetBuilder:n,gameboardController:new L({gameboardBuilder:e,gameboardRepository:i,fleetBuilder:n})}},D={player:R(),opponent:R()};class x{dialogState={isDialogOpen:!1,isEscapeKeyListenerAttached:!1,isCloseButtonListenerAttached:!1};constructor(t,e="ds-close-button",i=!0){if(this.dialogElement=t,this.dialogCloseButtonID=e,this.dialogInDocumentBody=i,!this.dialogElement.id)throw new Error("Dialog element must have an id.");this.dialogId=this.dialogElement.id,this.dialogCloseButton=this.dsGetCloseButton(this.dialogCloseButtonID,this.dialogId),this.dsAddCloseButtonAria(this.dialogCloseButton),this.closeButtonListener=this.closeLightbox.bind(this),this.escapeKeyListener=this.dsHandleEscapeKey.bind(this),this.observeDialogRemoval()}openLightbox(){this.dialogState.isDialogOpen||(this.dialogElement.showModal(),this.dsAddListeners(),this.dialogState.isDialogOpen=!0)}closeLightbox(){requestAnimationFrame((()=>{this.dialogElement.classList.add("closing")})),this.dialogElement.addEventListener("animationend",(()=>{this.dialogElement.classList.remove("closing"),this.dialogElement.close(),this.dsRemoveListeners(),this.dialogState.isDialogOpen=!1}),{once:!0})}isOpen(){return this.dialogState.isDialogOpen}dsAddListeners(){this.dialogState.isCloseButtonListenerAttached||(this.dialogCloseButton.addEventListener("click",this.closeButtonListener),this.dialogState.isCloseButtonListenerAttached=!0),this.dialogState.isEscapeKeyListenerAttached||(window.addEventListener("keydown",this.escapeKeyListener),this.dialogState.isEscapeKeyListenerAttached=!0)}dsRemoveListeners(){this.dialogCloseButton.removeEventListener("click",this.closeButtonListener),this.dialogState.isCloseButtonListenerAttached=!1,window.removeEventListener("keydown",this.escapeKeyListener),this.dialogState.isEscapeKeyListenerAttached=!1}dsGetCloseButton(t,e){const i=this.dialogElement.querySelector(`#${t}`);if(!i)throw new Error(`Close button with ID "${t}" not found in dialog "${e}".`);return i}dsAddCloseButtonAria(t){t.setAttribute("aria-label","Close Dialog")}dsHandleEscapeKey(t){"Escape"===t.key&&this.dialogState.isDialogOpen&&(t.preventDefault(),this.closeLightbox())}observeDialogRemoval(){const t=new MutationObserver((e=>{for(const i of e)Array.from(i.removedNodes).forEach((e=>{if(e===this.dialogElement)return this.dsRemoveListeners(),void t.disconnect()}))}));this.dialogInDocumentBody?t.observe(document.body,{childList:!0}):t.observe(document.body,{childList:!0,subtree:!0})}}function I(t,e){for(const i in e)t.setAttribute(i,e[i])}function G(t){const e=a("h2");e.textContent="Parabellum";const i=a("div",["parabellum"],{id:"main-container-one-parabellum"});i.append(e),t.render(i);const n=new DocumentFragment;return n.append(i),n}function F(t){a("h2").textContent="Parabellum";const e=a("h3");e.textContent="Situation Report:";const i=a("div",["bellum"],{id:"main-container-one-bellum"});i.append(e,t.element);const n=new DocumentFragment;return n.appendChild(i),n}function O(){const t=a("div",["bellum"],{id:"main-container-one-post-bellum"}),e=new DocumentFragment;return e.appendChild(t),e}class M{#r;constructor(t,e,i,n=[],r={}){if(this.elementTag=t,this.fragments=e,this.initialFragmentKey=i,this.classNames=n,this.attributes=r,!e[i])throw new Error(`Initial fragment with key "${i}" does not exist.`);this.hotSwapContainer=a(this.elementTag,this.classNames,this.attributes),this.fragmentsArray=Object.values(this.fragments),this.#r=this.setInitialIndex(this.fragmentsArray,this.fragments,this.initialFragmentKey),this.hotSwapContainer.appendChild(this.fragments[this.initialFragmentKey])}render(t){t.appendChild(this.hotSwapContainer)}swapFragmentByKey(t){const e=this.getFragment(t);this.swapFragment(e),this.#r=this.fragmentsArray.indexOf(e)}swapByOrder(){this.#r=(this.#r+1)%this.fragmentsArray.length,this.swapFragment(this.fragmentsArray[this.#r])}setInitialIndex(t,e,i){const n=t.indexOf(e[i]);if(-1===n)throw new Error(`Initial fragment with key "${i}" does not exist.`);return n}getFragment(t){const e=this.fragments[t];if(!e)throw new Error(`Fragment with key "${t}" does not exist.`);return e}swapFragment(t){this.hotSwapContainer.replaceChildren(t)}}var N;!function(t){t[t.inactive=0]="inactive",t[t.active=1]="active"}(N||(N={}));class z{id="player";fleetElements=new Map;listenersAdded=!1;dragState={currentShipInstance:null,initialPlacementConfigurations:null,isValidDropTarget:!1,currentDragOverCell:null,cloneSnapOffset:null,shipBorderValueSplit:null};dragEventCallbacks={dragstart:t=>this.handleShipDragStart(t,this.dragState),drag:t=>this.handleShipDrag(t,this.dragState),dragenter:t=>this.handleShipDragEnter(t),dragleave:t=>this.handleShipDragLeave(t),dragover:t=>this.handleShipDragOver(t,this.dragState),drop:t=>this.handleShipDrop(t,this.dragState),dragend:t=>this.handleShipDragEnd(t,this.dragState)};constructor(t,e){this.playerState=t,this.gameState=e,this.gameboardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize),this.gameboard=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize),this.dragImage=this.createDragImage(),this.shipDragClone=this.createShipDragClone(),this.gameState.eventBus.on("refreshGameboard",this.refreshGameboardWrapper),this.gameState.eventBus.on("togglePlayerGameboardControls",this.toggleGameboardControls),this.gameState.eventBus.on("receiveBillowAttack",this.receiveAttack)}render(t){if(!t)throw new Error(`Target element not found with ID - ${this.id} and selector - "${t}".`);this.gameboardContainer.append(this.dragImage,this.shipDragClone,this.gameboard),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements),this.toggleParabellumListeners(),t.appendChild(this.gameboardContainer)}toggleParabellumListeners(){if(!this.gameboardContainer)return;const t=this.listenersAdded?"removeEventListener":"addEventListener";Object.entries(this.dragEventCallbacks).forEach((([e,i])=>{this.gameboardContainer[t](e,i)})),this.gameboardContainer[t]("click",this.handleShipRotation),this.listenersAdded=!this.listenersAdded}togglePlayerTurn(t){const{hit:e,isSunk:i}=t;if(e&&!i||!e)this.gameState.togglePlayerTurn();else if(e&&i&&!this.checkForWin())return void this.gameState.togglePlayerTurn()}toggleShipsDraggable(){this.fleetElements.forEach((t=>{t.removeAttribute("draggable")}))}toggleShipAdriftClass(){this.fleetElements.forEach((t=>{t.classList.remove("adrift")}))}applyGridPlacementValue(t,e,i,n,r){"horizontal"===n?(i.style.gridColumn=t,i.style.gridRow=e.toString(),i.style.gridTemplateColumns=`repeat(${r}, 1fr)`):(i.style.gridRow=t,i.style.gridColumn=e.toString(),i.style.gridTemplateRows=`repeat(${r}, 1fr)`)}checkForWin(){return!!this.playerState.gameboardRepository.areAllShipsSunk()&&(alert(("player"===this.gameState.currentPlayer?"You win":"You lose")+" mother fucker! #TYPESHIT"),this.gameState.transitionToNextPhase(),!0)}createDragImage(){return a("img",["drag-image","accessibility"],{id:`${this.id}-drag-image`,src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_misc-images/1x1_transparent.png"})}createShipDragClone(){return a("div",["ship-container-clone"],{id:`${this.id}-ship-drag-clone`})}createBackgroundCellsFragment(t){const e=new DocumentFragment;return t.forEach(((t,i)=>{t.forEach(((t,n)=>{const r=t.description.toLowerCase(),o=a("div",[`${this.id}-hit-marker`,"hit-marker"]),s=a("div",[`${this.id}-${r}-cell`,`player-${r}-cell`,"grid-cell"],{"data-x":n.toString(),"data-y":i.toString(),"aria-label":`Row ${i+1}, Column ${n+1}`,role:"gridCell"});s.appendChild(o);const l=a("div",[`${this.id}-${r}-grid-cell-container`,"grid-cell-container"]);l.appendChild(s),e.appendChild(l)}))})),e}createShipElement(t,e,i,n,r){const o=this.generateShipUnitFragment(e,t,r,this.id,i,n),s=a("div",["ship-container","adrift"],{id:`${this.id}-${t}-container`,"data-dragging":"false","data-length":e.toString(),"data-orientation":r,"data-shipType":t,draggable:"true"});return s.appendChild(o),this.applyGridPlacementValue(i,n,s,r,e),this.syncShipUnitDataAttributes(s,t),s}generateBoardContainer(t){const e=a("section",["gameboard-container"],{id:`${this.id}-gameboard-container`});return e.style.setProperty("--grid-size",t.toString()),e}generateBoardFragment(t){const e=a("div",["gameboard-background"],{id:`${this.id}-gameboard-background`});e.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const i=a("div",["gameboard"],{id:`${this.id}-gameboard`});i.style.setProperty("--grid-size",t.toString());const n=new DocumentFragment;return n.append(e,i),n}generateShipUnitFragment(t,e,i,n,r,o){const s=new DocumentFragment;for(let r=0;r<t;r++){const o=0===r,l=r===t-1,h=a("div",["ship-unit",`${e}-unit`,`${n}-${e}-unit`]);"horizontal"===i?h.classList.add("ship-unit-horizontal"):h.classList.add("ship-unit-vertical"),o&&(h.classList.add("ship-bow"),h.setAttribute("id",`${n}-${e}-bow`)),l&&(h.classList.add("ship-stern"),h.setAttribute("id",`${n}-${e}-stern`)),s.appendChild(h)}return s}getGridPlacementValue(t,e,i){const n="horizontal"===e,[r,a]=t;return[`${n?r+1:a+1} / span ${i}`,n?a+1:r+1]}getShipPlacementData(t){const e=this.playerState.fleetBuilder.getShip(t),{coordinatesArray:i,orientation:n}=e.currentplacementConfigurations;if(!i||!n)throw new Error(`The ${e.type} has no placement configurations.`);return{bowCoordinates:i[0],orientation:n,shipLength:e.length}}handleFleetPlacement(t,e){this.updateFleetElements(t),this.placeFleetOnGameboard(e)}async cookShipUnit(t,e){const i=this.fleetElements.get(t);if(!i)throw new Error(`The ${t} has no fleet element.`);const[n,r]=e,a=i.querySelector(`[data-x="${n}"][data-y="${r}"]`);if(a?.classList.add("cooked"),a){if(a.classList.add("cooked"),!p(a))throw new Error("The attacked ship must be an HTML Element.");await s(a,999),await o(2e3)}else console.warn(`No ship unit found at coordinates (${n}, ${r}) on ${t}.`)}handleSinkingShip=async t=>{const e=this.fleetElements.get(t);if(!e)throw new Error(`The ${t} has no fleet element.`);await this.sinkShip(e)};hasTargetBeenAttacked(t){const e=this.playerState.gameboardRepository.hasTargetBeenAttacked(t);return e||this.playerState.gameboardRepository.addAttackedCoordinates(t),e}placeFleetOnGameboard(t){const e=this.gameboardContainer.querySelector(".gameboard");if(!e)throw new Error("Gameboard container not found.");t.forEach((t=>e.appendChild(t)))}_receiveAttack=async t=>{const e=`[data-x="${t[0]}"][data-y="${t[1]}"]`,i=this.gameboardContainer.querySelector(e);if(!i)throw new Error("Grid cell not found.");if(this.hasTargetBeenAttacked(t))return console.warn("Cell has already been attacked:",t),{hit:!1};const n=this.playerState.gameboardController.receiveAttack(t);try{await this.triggerPrePlayerToggleAnimations(n,i,t)}catch(t){console.error("Error in triggerPrePlayerToggleAnimations",t)}return this.togglePlayerTurn(n),n};receiveAttack=async t=>await this._receiveAttack(t);refreshGameboard(t){const e=t.querySelector(`#${this.id}-gameboard`),i=t.querySelector(`#${this.id}-gameboard-background`);if(!e||!i)throw new Error("Missing gameboard and/or gameboard background elements");this.gameboardContainer.removeChild(e),this.gameboardContainer.removeChild(i),this.shipDragClone.classList.remove("visible"),this.gameboard=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize),this.gameboardContainer.appendChild(this.gameboard),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements)}refreshGameboardWrapper=()=>{this.refreshGameboard(this.gameboardContainer)};setFleetElement=(t,e,i,n,r)=>{const a=this.createShipElement(t,e,i,n,r);console.log("shipElement",a),this.fleetElements.set(t,a)};syncShipUnitDataAttributes=(t,e)=>{const i=this.playerState.fleetBuilder.getShip(e),{coordinatesArray:n}=i.currentplacementConfigurations;if(r=n,!(Array.isArray(r)&&r.length>0&&r.every(d)))throw new Error("The ship's coordinates array is improperly structured or non-existent.");var r;const a=Array.from(t.children).filter(p);if(!(t=>Array.isArray(t)&&t.length>0&&t.every(u))(a))throw new Error("All ship unit's must be HTML DIV elements.");if(n.length!==a.length)throw new Error(`Mismatch between ship units (${a.length}) and coordinates (${n.length}) for ${e}`);n.forEach((([t,e],i)=>{const n=a[i];n.setAttribute("data-x",String(t)),n.setAttribute("data-y",String(e))}))};sinkShip=async t=>{console.log("ðŸš€ ~ PlayerGameboardComponent ~ handleSinkingShip= ~ shipContainerElement:",t)};toggleGameboardControls=t=>{this.gameboardContainer.classList.toggle("locked",t===N.inactive)};triggerPrePlayerToggleAnimations=async(t,e,i)=>{const n=this.updateGameboardPostAttack(t,e,i),r=this.gameState.eventBus.emit("setAndScrollToNextSitRep",t);await Promise.all([n,r])};updateFleetElements=t=>{this.fleetElements.size&&this.fleetElements.clear();for(const e of Object.values(t.fleet)){const t=e.type,i=e.length,n=e.currentplacementConfigurations.orientation;if(!n)throw new Error("Orientation not set.");const r=e.currentplacementConfigurations.coordinatesArray;if(!r||0===r.length){console.error(`The ${t} has not been placed. Continuing...`);continue}const a=r[0],[o,s]=this.getGridPlacementValue(a,n,i);this.setFleetElement(t,i,o,s,n)}};updateGameboardPostAttack=async(t,e,i)=>{const{hit:n,isSunk:r,type:a}=t;if(n){if(!b(a))throw new Error(`The ${a} is not a valid ship type.`);if(e.classList.add("hit"),r)await this.handleSinkingShip(a);else{if(!i)throw new Error("Attack coordinates not found. They are required for updating the player gameboard post attack.");await this.cookShipUnit(a,i)}}else e.classList.add("miss")};handleShipDragStart(e,i){if(!(e.target instanceof HTMLDivElement&&e.target.matches(".ship-container")))return;const r=e.target,a=n(r,"data-orientation",g),o=this.playerState.fleetBuilder.fleet,s=n(r,"data-shiptype",b),l=((t,e,i)=>{const n=(t=>{const e=t.querySelector(".ship-bow");if(!e)throw new Error("Ship bow not found.");return e})(t),r=getComputedStyle(document.documentElement).getPropertyValue("--ship-container-border-size").trim().match(/^(?<numberValue>\d+(\.\d+)?)(?<unitType>[a-z%]+)$/i);if(!r||!r.groups)throw new Error("No matches found when parsing");const a=r.groups;i.shipBorderValueSplit=a;const o="horizontal"===e,[s,l]=o?[n.getBoundingClientRect().width/2,n.getBoundingClientRect().height/2+Number(a.numberValue)]:[n.getBoundingClientRect().width/2+Number(a.numberValue),n.getBoundingClientRect().height/2];return{offsetX:s,offsetY:l}})(r,a,i);if(((t,e,i,n)=>{if(!e[i])throw new Error(`The ${i} is not present in the fleet.`);t.currentShipInstance=e[i],t.initialPlacementConfigurations=t.currentShipInstance.currentplacementConfigurations,t.cloneSnapOffset=n})(i,o,s,l),!i.currentShipInstance)throw new Error(`Drag state hasn't been updated with the current ship instance on drag start. Drag State: ${JSON.stringify(i)}`);this.playerState.gameboardController.removePiece(i.currentShipInstance),e.dataTransfer?.setDragImage(this.dragImage,0,0),((t,e)=>{const i=t.getBoundingClientRect();e.style.height=`${i.height}px`,e.style.width=`${i.width}px`})(r,this.shipDragClone),(t=>{t.setAttribute("data-dragging","true"),setTimeout((()=>{t.classList.add("locked")}),0),this.shipDragClone.classList.add("visible")})(r),((e,i,n,r)=>{const a=Number(i.getAttribute("data-length"));if(!a||"number"!=typeof(o=a)||![2,3,4,5].includes(o))throw new Error("Invalid or missing ship type attribute.");var o;const s=a;((e,i,n)=>{const a=r.getAllValidBowCoordinates(n,i);e.forEach((e=>{const i=[Number(e.getAttribute("data-x")),Number(e.getAttribute("data-y"))];for(const n of a)t(n,i)&&e.classList.add("valid-bow-coordinates")}))})(e.querySelectorAll(".grid-cell"),s,n)})(this.gameboardContainer,r,a,this.playerState.gameboardController),this.snapCloneToCursor(e,l)}handleShipDrag(t,e){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".ship-container")))return;const i=e.cloneSnapOffset;if(!i)throw new Error("An error has occured during the `cloneSnapOffset` reading.");this.snapCloneToCursor(t,i)}handleShipDragEnter(t){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const e=t.target,i=e.classList.contains("valid-bow-coordinates");i?e.classList.add("placement-is-valid"):e.classList.add("placement-is-invalid"),i&&this.shipDragClone.classList.add("placement-is-valid")}handleShipDragLeave(t){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const e=t.target;e.classList.contains("placement-is-valid")?e.classList.remove("placement-is-valid"):e.classList.remove("placement-is-invalid"),this.shipDragClone.classList.contains("placement-is-valid")&&this.shipDragClone.classList.remove("placement-is-valid")}handleShipDragOver(t,e){if(t.preventDefault(),!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const i=t.target;e.currentDragOverCell=i,i.classList.contains("valid-bow-coordinates")}handleShipDrop(t,e){if(t.preventDefault(),!(t.target instanceof HTMLDivElement&&t.target.matches(".valid-bow-coordinates")))return;const{coordinatesArray:i,orientation:n}=e.initialPlacementConfigurations||{};if(!i||!n)throw new Error("Initial placement configurations are incomplete.");e.isValidDropTarget=!0;const r=t.target,a=r.getAttribute("data-x"),o=r.getAttribute("data-y");if(!a||!o)throw new Error("Missing or invalid grid cell coordinates.");const s=[Number(a),Number(o)];this.playerState.gameboardController.placePiece({ship:e.currentShipInstance,coordinates:s,orientation:n}),this.refreshGameboard(this.gameboardContainer),e.isValidDropTarget=!1}handleShipDragEnd(t,e){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".ship-container")))return;const i=()=>{const{coordinatesArray:t,orientation:i}=e.initialPlacementConfigurations||{};if(!t||!i)throw new Error("Initial placement configurations are incomplete.");const n=t[0];this.playerState.gameboardController.placePiece({ship:e.currentShipInstance,coordinates:n,orientation:i})},n=(t,e,i)=>{const n=i?"placement-is-valid":"placement-is-invalid";t.setAttribute("data-dragging","false"),e.classList.remove(n),this.shipDragClone.classList.remove("visible"),t.classList.remove("locked")},r=t.target;try{const{currentDragOverCell:t,isValidDropTarget:a}=e;if(!t)throw new Error(`Current drag over cell is missing. Drag state: ${JSON.stringify(e)}`);n(r,t,a),a||i()}catch(t){console.error(t)}}handleShipRotation=t=>{if(!(t.target instanceof HTMLDivElement&&t.target.matches(".ship-container")))return;const e=t.target,i=n(e,"data-shiptype",b),r=this.playerState.fleetBuilder.getShip(i);this.playerState.gameboardController.rotatePiece(r),this.refreshGameboard(this.gameboardContainer)};snapCloneToCursor(t,e){const i=this.gameboardContainer.getBoundingClientRect(),n=i.left,r=i.top,a=t.clientX,o=t.clientY,{offsetX:s,offsetY:l}=e;document.documentElement.style.setProperty("--ship-clone-left",a-n-s+"px"),document.documentElement.style.setProperty("--ship-clone-top",o-r-l+"px")}getId(){return this.id}}class V{id="opponent";fleetElements=new Map;constructor(t,e){this.playerState=t,this.gameState=e,this.gameboardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize),this.updateFleetElements(this.playerState.fleetBuilder),this.gameState.eventBus.on("toggleOpponentGameboardControls",this.toggleGameboardControls)}render(t){if(!t)throw new Error(`Target element not found with ID - ${this.id} and selector - "${t}".`);const e=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize);this.gameboardContainer.appendChild(e),this.placeFleetOnGameboard(this.fleetElements),t.appendChild(this.gameboardContainer)}toggleBellumListeners=t=>{if(!this.gameboardContainer)return;const e=t===N.inactive?"removeEventListener":"addEventListener";this.gameboardContainer[e]("click",this.handleCellClick)};checkForWin(){return!!this.playerState.gameboardRepository.areAllShipsSunk()&&(alert(("player"===this.gameState.currentPlayer?"You win":"You lose")+" mother fucker! #TYPESHIT"),this.gameState.transitionToNextPhase(),!0)}async cookAllShipUnits(t){const e=Array.from(t.children);e.forEach(((t,e)=>{setTimeout((()=>{t.classList.add("cooked")}),333*(e+1))}));const i=e[e.length-1];await s(i,999),await o(1e3)}createBackgroundCellsFragment(t){const e=new DocumentFragment;return t.forEach(((t,i)=>{t.forEach(((t,n)=>{const r=a("div",[`${this.id}-hit-marker`,"hit-marker"]),o=a("div",[`${this.id}-grid-cell`,"grid-cell"],{"data-x":n.toString(),"data-y":i.toString(),"aria-label":`Row ${i+1}, Column ${n+1}`,role:"gridCell"});o.appendChild(r);const s=a("div",[`${this.id}-grid-cell-container`,"grid-cell-container"]);s.appendChild(o),e.appendChild(s)}))})),e}createShipElement(t,e,i){const n=this.generateShipUnitFragment(e,t,i,this.id),r=a("div",["opponent-ship-container"],{id:`${this.id}-${t}-container`});return r.appendChild(n),r}generateBoardContainer(t){const e=a("div",["gameboard-container","locked"],{id:`${this.id}-gameboard-container`});return e.style.setProperty("--grid-size",t.toString()),e}generateBoardFragment(t){const e=a("div",["gameboard-background"],{id:`${this.id}-gameboard-background`});e.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const i=a("div",["gameboard"],{id:`${this.id}-gameboard`});i.style.setProperty("--grid-size",t.toString()),this.fleetElements.forEach((t=>{i.appendChild(t)}));const n=new DocumentFragment;return n.append(e,i),n}generateShipUnitFragment(t,e,i,n){const r=new DocumentFragment;for(let o=0;o<t;o++){const s=0===o,l=o===t-1,h=a("div",["ship-unit",`${e}-unit`,`${n}-${e}-unit`]);"horizontal"===i?h.classList.add("ship-unit-horizontal"):h.classList.add("ship-unit-vertical"),s&&(h.classList.add("ship-bow"),h.setAttribute("id",`${n}-${e}-bow`)),l&&(h.classList.add("ship-stern"),h.setAttribute("id",`${n}-${e}-stern`)),r.appendChild(h)}return r}getAttackCoordinates(t){const e=t.getAttribute("data-x"),i=t.getAttribute("data-y");if(null==e||null==i)throw new Error("Could not retrieve coordinates from grid cell.");return[+e,+i]}getGridAreaValue(t,e,i){const n="horizontal"===e,[r,a]=t;return[`${n?r+1:a+1} / span ${i}`,n?a+1:r+1]}getShipPlacementData(t){const e=this.playerState.fleetBuilder.getShip(t),{coordinatesArray:i,orientation:n}=e.currentplacementConfigurations;if(!i||!n)throw new Error(`The ${e.type} has no placement configurations.`);return{bowCoordinates:i[0],orientation:n,shipLength:e.length}}handleCellClick=t=>{this.receiveAttack(t)};async handleSinkingShip(t){const{bowCoordinates:i,orientation:n,shipLength:r}=this.getShipPlacementData(t),a=this.fleetElements.get(t);if(!a)throw new Error(`The ${e(t)}'s ship container element not found.`);this.revealShipPosition(a,i,n,r),await this.sinkShip(a)}hasTargetBeenAttacked(t){const e=this.playerState.gameboardRepository.hasTargetBeenAttacked(t);return e||this.playerState.gameboardRepository.addAttackedCoordinates(t),e}placeFleetOnGameboard(t){const e=this.gameboardContainer.querySelector(".gameboard");if(!e)throw new Error("Gameboard container not found.");t.forEach((t=>e.appendChild(t)))}revealShipPosition(t,e,i,n){const[r,a]=this.getGridAreaValue(e,i,n);this.setGridPlacementValue(r,a,t,i,n)}async receiveAttack(t){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const e=t.target,i=this.getAttackCoordinates(e);if(this.hasTargetBeenAttacked(i))return;this.toggleBellumListeners(N.inactive),this.toggleGameboardControls(N.inactive);const n=this.playerState.gameboardController.receiveAttack(i);try{await this.triggerPrePlayerToggleAnimations(n,e)}catch(t){console.error("Animation failed",t)}this.togglePlayerTurn(n)}setGridPlacementValue(t,e,i,n,r){"horizontal"===n?(i.style.gridColumn=t,i.style.gridRow=e.toString(),i.style.gridTemplateColumns=`repeat(${r}, 1fr)`):(i.style.gridRow=t,i.style.gridColumn=e.toString(),i.style.gridTemplateRows=`repeat(${r}, 1fr)`)}sinkShip=async t=>{var e,n;t.classList.add("sunk"),await(e=t,n="animationend",new Promise((t=>{const i=r=>{e.removeEventListener(n,i),t(r)};e.addEventListener(n,i)}))),await this.cookAllShipUnits(t),await i(1e3)};toggleGameboardControls=t=>{t===N.active&&this.toggleBellumListeners(t),this.gameboardContainer.classList.toggle("locked",t===N.inactive)};togglePlayerTurn(t){const{hit:e,isSunk:i}=t;if(e&&!i||!e)this.gameState.togglePlayerTurn();else if(e&&i&&!this.checkForWin())return void this.gameState.togglePlayerTurn()}triggerPrePlayerToggleAnimations=async(t,e)=>{const i=this.updateGameboardPostAttack(t,e),n=this.gameState.eventBus.emit("setAndScrollToNextSitRep",t);await Promise.all([i,n])};updateFleetElements(t){const e=t.fleet;for(const t of Object.values(e)){const e=t.type,i=t.length,n=t.currentplacementConfigurations.orientation;if(!n)throw new Error("Orientation not set.");const r=t.currentplacementConfigurations.coordinatesArray;if(!r||0===r.length){console.error(`The ${e} has not been placed. Continuing...`);continue}const a=this.createShipElement(e,i,n);this.fleetElements.set(e,a)}}updateGameboardPostAttack=async(t,e)=>{const{hit:i,isSunk:n,type:r}=t;if(i){if(!b(r))throw new Error(`The ${r} is not a valid ship type.`);e.classList.add("hit"),n&&await this.handleSinkingShip(r)}else e.classList.add("miss")};getId(){return this.id}}class U{constructor(t,e){this.gameState=e,this.playerGameboardComponent=new z(t.player,this.gameState),this.opponentGameboardComponent=new V(t.opponent,this.gameState),this.mainContainerTwo=a("section",["main-container","parabellum"],{id:"main-container-two"})}get element(){return this.mainContainerTwo}get playerGameboard(){return this.playerGameboardComponent}get opponentGameboard(){return this.opponentGameboardComponent}render(t){this.playerGameboardComponent.render(this.mainContainerTwo),this.opponentGameboardComponent.render(this.mainContainerTwo),t.appendChild(this.mainContainerTwo)}}class H{shipShufflerButtonTextContent="Shuffle";buttonClass="ship-shuffler-button";#a=!1;shuffleShips=()=>{this.randomizeGameboard(),this.updateGameboard()};constructor(t,e,i,n){this.id=t,this.gameboardController=e,this.fleet=i,this.gameState=n,this.shipShufflerButton=this.createshipShufflerButton(`${this.id}-${this.buttonClass}`,[this.buttonClass]),this.shipShufflerButton.classList.add(this.buttonClass),this.shipShufflerButton.textContent=this.shipShufflerButtonTextContent,this.toggleEventListener(),this.shipShufflerButtonContainer=this.createshipShufflerButtonContainer(),this.shipShufflerButtonContainer.appendChild(this.shipShufflerButton)}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.shipShufflerButtonContainer)}toggleEventListener(){!0===this.#a?(this.shipShufflerButton.removeEventListener("click",this.shuffleShips),this.#a=!1):(this.shipShufflerButton.addEventListener("click",this.shuffleShips),this.#a=!0)}createshipShufflerButton(t,e){return a("button",[...e],{id:t})}createshipShufflerButtonContainer(){return a("div",["ship-shuffler-button-container"])}randomizeGameboard(){this.gameboardController.removeAllPieces(this.fleet),C(this.gameboardController,this.fleet)}updateGameboard(){this.gameState.eventBus.emit("refreshGameboard")}getId(){return this.id}}class j{readyUpButtonTextContent="Ready Up";buttonId="ready-up-button";#a=!1;readyUp=()=>{this.anchorShips(),this.removeParabellumButtonListeners(),this.transitionToBellum()};constructor(t,e,i,n){this.playerGameboardComponent=t,this.shipShufflerButton=e,this.instructionsButton=i,this.transitionToNextPhase=n,this.readyUpButton=this.createReadyUpButton(this.buttonId),this.toggleEventListener(),this.readyUpButtonContainer=this.createReadyUpButtonContainer(),this.readyUpButtonContainer.appendChild(this.readyUpButton)}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.readyUpButtonContainer)}toggleEventListener(){!0===this.#a?(this.readyUpButton.removeEventListener("click",this.readyUp),this.#a=!1):(this.readyUpButton.addEventListener("click",this.readyUp),this.#a=!0)}anchorShips(){this.playerGameboardComponent.toggleParabellumListeners(),this.playerGameboardComponent.toggleShipsDraggable(),this.playerGameboardComponent.toggleShipAdriftClass()}createReadyUpButton(t){const e=a("span",["ready-up-button-text"]);e.textContent=this.readyUpButtonTextContent;const i=a("img",["inactive-ready-up-button"],{alt:"Ready Up (Inactive)",src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-inactive.svg"}),n=a("img",["active-ready-up-button"],{alt:"Ready Up (Active)",src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-active.svg"}),r=a("button",[],{id:t});return r.append(n,i,e),r}createReadyUpButtonContainer(){return a("div",["ready-up-button-container"])}removeParabellumButtonListeners(){this.shipShufflerButton.toggleEventListener(),this.instructionsButton.toggleEventListener(),this.toggleEventListener()}transitionToBellum(){this.transitionToNextPhase()}}function K(t,e){const i=a("div",["parabellum"],{id:"main-container-three-parabellum"});t.render(i),e.render(i);const n=new DocumentFragment;return n.appendChild(i),n}function _(){const t=Object.entries(D).map((([t,i])=>{if("string"!=typeof(n=t)||"player"!==n&&"opponent"!==n)throw new Error("Invalid player type.");var n;return((t,i)=>{const n=a("h3",["fleet-status-heading"],{id:`${t}-fleet-status-heading`});n.textContent=e(t);const r=a("div",["fleet-status-container"],{id:`${t}-fleet-status-container`});return r.appendChild(n),Object.values(i).forEach((e=>{const i=a("div",["hit-counter-container",`${e.type}-hit-counter-container`],{id:`${t}-${e.type}-hit-counter-container`});for(let n=0;n<e.length;n++){const n=a("div",["hitpoint",`${e.type}-hitpoint`,`${t}-${e.type}-hitpoint`]);i.append(n)}r.appendChild(i)})),r})(t,i.fleetBuilder.fleet)})),i=new DocumentFragment;Object.values(D.player.fleetBuilder.fleet).map((t=>{const e=a("li",["ship-hit-counter-label"],{id:`${t.type}-hit-counter-label`});e.textContent=t.type,i.appendChild(e)}));const n=a("div",[],{id:"ship-label-list"});n.appendChild(i);const r=a("div",["bellum"],{id:"main-container-three-bellum"}),[o,s]=t;r.append(o,n,s);const l=new DocumentFragment;return l.appendChild(r),l}function Y(){const t=a("div",["post-bellum"],{id:"main-container-three-post-bellum"}),e=new DocumentFragment;return e.appendChild(t),e}class q{buttonId="instructions-button";buttonImageId="instructions-image";#a=!1;constructor(t){this.instructionsLightboxController=t,this.instructionsButton=this.createInstructionsButton(),this.instructionsButtonContainer=this.createInstructionsButtonContainer(),this.instructionsButtonContainer.appendChild(this.instructionsButton),this.openInstructionsDialog=()=>this.instructionsLightboxController.openLightbox(),this.toggleEventListener()}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.instructionsButtonContainer)}toggleEventListener(){!0===this.#a?(this.instructionsButton.removeEventListener("click",this.openInstructionsDialog),this.#a=!1):(this.instructionsButton.addEventListener("click",this.openInstructionsDialog),this.#a=!0)}createInstructionsButton(){return a("button",[],{id:this.buttonId,type:"button"})}createInstructionsButtonContainer(){return a("div",[],{id:`${this.buttonId}-container`})}}class W{mainElement=a("main");constructor(t,e,i,n){this.players=t,this.instructionsLightboxController=e,this.cycloneSitRepScroller=i,this.gameState=n,this.instructionsButton=new q(this.instructionsLightboxController),this.mainContainerOne=this.createMainContainerOne(),this.mainContainerTwo=new U(this.players,this.gameState),this.mainContainerThree=this.createMainContainerThree(),this.renderMainContainers()}createMainContainerOne(){return function(t,e){const i={parabellum:G(t),bellum:F(e),postBellum:O()};return new M("section",i,"parabellum",["main-container"],{id:"main-container-one"})}(this.instructionsButton,this.cycloneSitRepScroller)}createMainContainerThree(){return function(t,e,i){const n=D.player.gameboardController,r=D.player.fleetBuilder.fleet,a=new H(t.id,n,r,i),o={parabellum:K(a,new j(t,a,e,i.transitionToNextPhase)),bellum:_(),postBellum:Y()};return new M("section",o,"parabellum",["main-container"],{id:"main-container-three"})}(this.mainContainerTwo.playerGameboard,this.instructionsButton,this.gameState)}renderMainContainers(){this.mainContainerOne.render(this.mainElement),this.mainContainerTwo.render(this.mainElement),this.mainContainerThree.render(this.mainElement)}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.mainElement)}}var J=JSON.parse('[{"textContent":"Drag & drop to reposition"},{"textContent":"Tap to rotate"},{"textContent":"Lock positions & ready up"}]');class X{static dialogId="instructions-dialog";static closeButtonId="instructions-dialog-close-button";constructor(){this.instructionsDialogCloseButton=this.createInstructionsDialogCloseButton(),this.instructionsDialog=this.createInstructionsDialog(this.instructionsDialogCloseButton)}get element(){return this.instructionsDialog}get closeButton(){return this.instructionsDialogCloseButton}createInstructionsDialogCloseButton(){const t=a("button",["close-button"],{id:X.closeButtonId,type:"button","aria-label":"Close Instructions Dialog"});return t.textContent="X",t}createInstructionsDialog(t){const e=a("h3",["tertiary-heading"],{id:"instructions-dialog-heading"});e.textContent="Deploy your Bips:";const i=((t,e,i={})=>{if(!t.length)throw new Error("The listItemTextContentArray is empty.");if(!e)throw new Error("You must identify your list items.");const n=new DocumentFragment;return t.forEach(((t,r)=>{const o=a("li",[`${e}-list-item`],{id:`${e}-list-item-${++r}`,...i});o.textContent=t.textContent,n.appendChild(o)})),n})(J,"instructions"),n=a("ul",["instructions-list"],{id:"instructions-list"});n.appendChild(i);const r=a("div",[],{id:"unanchored-ship-example"}),o=a("p",[],{id:"unanchored-ship-text"});o.textContent="= Bips adrift";const s=a("div",[],{id:"visual-feedback-key-container"});s.append(r,o);const l=a("div",[],{id:"instructions-content"});l.append(e,n,s);const h=a("dialog",[],{id:X.dialogId});return h.append(t,l),h}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.instructionsDialog)}}class Q{static MESSAGES={TURN:{PLAYER:"Waiting for your attack...",OPPONENT:"Your opponent is attacking..."},ATTACK:{HIT:(t,e,i)=>`${t} hit ${e} ${i}!`,SUNK:(t,e,i)=>`${t} sunk ${e} ${i}!`,MISS:t=>`${t} missed!`}};currentPlayer=null;currentSitRep=null;nextSitRep="";#o="turn";constructor(){const{container:t,current:e,next:i}=this.getControlledSitRepElements();this.sitRepContainer=t,this.sitRepTextElements={current:e,next:i}}get element(){return this.sitRepContainer}initialize=t=>{this.currentPlayer=t,this.setInitialTextContent(t)};setAndScrollToNextSitRep=async t=>{this.nextSitRep=t?this.getNextSitRep(t):this.getNextSitRep(),this.sitRepTextElements.next.textContent=this.nextSitRep,this.sitRepContainer.classList.add("scrolling"),await s(this.sitRepContainer),this.resetSitRepContainer(),await i(500)};getAttackSitRep=(t,e)=>{const{hit:i,isSunk:n,type:r}=e,a="player"===t?"You":"Your opponent",o="player"===t?"their":"your";return i&&r?n?Q.MESSAGES.ATTACK.SUNK(a,o,r):Q.MESSAGES.ATTACK.HIT(a,o,r):Q.MESSAGES.ATTACK.MISS(a)};getNextSitRep=t=>{if("attack"===this.#o&&this.toggleCurrentPlayer(),this.toggleSitRepType(),null===this.currentPlayer)throw new Error("`currentPlayer` cannot be null. Ensure it is assigned a valid `PlayerType` before retrieving the next sit rep.");return t?this.getAttackSitRep(this.currentPlayer,t):this.getTurnSitRep(this.currentPlayer)};getTurnSitRep=t=>"player"===t?Q.MESSAGES.TURN.PLAYER:Q.MESSAGES.TURN.OPPONENT;resetSitRepContainer=()=>{const{current:t,next:e}=this.sitRepTextElements;this.sitRepContainer.classList.remove("scrolling"),this.currentSitRep=this.nextSitRep,t.textContent=this.currentSitRep,this.nextSitRep="",e.textContent=this.nextSitRep,this.sitRepContainer.removeEventListener("transitionend",this.resetSitRepContainer)};setInitialTextContent=t=>{const e="player"===t?Q.MESSAGES.TURN.PLAYER:Q.MESSAGES.TURN.OPPONENT;this.currentSitRep=e,this.sitRepTextElements.current.textContent=e};toggleCurrentPlayer=()=>{this.currentPlayer="player"===this.currentPlayer?"opponent":"player"};toggleSitRepType=()=>{this.#o="turn"===this.#o?"attack":"turn"};getControlledSitRepElements=()=>{const t=a("div",[],{id:"sit-rep-container"});let e=null,i=null,n=null,r=null;return["current","next"].forEach((t=>{const o=a("div",["sit-rep-text-content"],{id:`${t}-sit-rep-text-content`});"current"===t?e=o:i=o;const s=a("div",["sit-rep-slot"],{id:`${t}-update-container`});"current"===t?n=s:r=s,s.appendChild(o)})),t.append(r,n),{container:t,current:e,next:i}}}class Z{cycloneSitRepScroller=new Q;header=function(){const t=function(){const t=a("a",["heading-link"],{id:"heading-link",href:"https://johnkeyscloud.github.io/battleship/"});t.textContent="ShattleBip";const e=a("h1",["main-heading"]);e.appendChild(t);const i=function(t="50px",e="#FFF",i="johnKeysCloud",n){const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M8.20003216,0 C3.67186256,0 0,3.67233045 0,8.2025137 C0,11.8266603 2.34955472,14.9012922 5.60770169,15.9859115 C6.01749428,16.0618219 6.16798309,15.8079721 6.16798309,15.5913056 C6.16798309,15.3957396 6.16033003,14.7495356 6.15685721,14.064154 C3.87553694,14.5603383 3.3941657,13.0963596 3.3941657,13.0963596 C3.02115925,12.1482506 2.48370842,11.896202 2.48370842,11.896202 C1.7397535,11.3870871 2.53978801,11.3975087 2.53978801,11.3975087 C3.36323189,11.4554066 3.79681972,12.242817 3.79681972,12.242817 C4.52816959,13.4968196 5.71510182,13.1342505 6.18303197,12.9247247 C6.25660428,12.3945093 6.46915364,12.0327122 6.70363321,11.8278826 C4.88233278,11.6204154 2.96765212,10.9170854 2.96765212,7.77413412 C2.96765212,6.87864774 3.28798748,6.14688355 3.81257603,5.57247278 C3.72742766,5.36584187 3.44677247,4.53159853 3.89200067,3.40175461 C3.89200067,3.40175461 4.58058343,3.18129256 6.14759636,4.24255971 C6.80164386,4.06076054 7.50315322,3.96966796 8.20003216,3.96658007 C8.89691109,3.96966796 9.59893494,4.06076054 10.2542687,4.24255971 C11.8194166,3.18129256 12.5070347,3.40175461 12.5070347,3.40175461 C12.9533562,4.53159853 12.6725723,5.36584187 12.587424,5.57247278 C13.1131701,6.14688355 13.4313189,6.87858341 13.4313189,7.77413412 C13.4313189,10.9245478 11.5130368,11.6182925 9.68710595,11.8213208 C9.98120223,12.0758783 10.2432714,12.5750862 10.2432714,13.3403025 C10.2432714,14.4377879 10.2337533,15.3211158 10.2337533,15.5913056 C10.2337533,15.8095804 10.3813481,16.0653602 10.7970574,15.9848178 C14.0534036,14.8989763 16.4,11.825438 16.4,8.2025137 C16.4,3.67233045 12.7286519,0 8.20003216,0");const a=document.createElementNS("http://www.w3.org/2000/svg","path");I(a,{d:"M3.07518929,11.6824029 C3.05731167,11.723257 2.99359073,11.7355197 2.93568001,11.7075092 C2.87662002,11.6806603 2.84341872,11.6248974 2.86257332,11.5838496 C2.88013169,11.5417693 2.94385264,11.5300229 3.00278493,11.5582916 C3.06197262,11.5850759 3.09568471,11.6413552 3.07518929,11.6824029 M3.47564797,12.0435714 C3.436828,12.0799722 3.36091196,12.0630626 3.30938611,12.0055571 C3.25613634,11.9481806 3.24617596,11.8715065 3.28557057,11.8345248 C3.32560367,11.7981885 3.39922115,11.8151627 3.45259861,11.8726037 C3.50584838,11.9306256 3.51619186,12.0068479 3.47558413,12.0436359 M3.75038868,12.5056811 C3.70045904,12.5407266 3.61886048,12.5078755 3.5684839,12.4346866 C3.51861811,12.3615623 3.51861811,12.2737872 3.56956933,12.2386127 C3.62013745,12.2034381 3.70045904,12.235063 3.75153796,12.307671 C3.8013399,12.3820861 3.8013399,12.4698612 3.75032483,12.5057457 M4.2149514,13.0409152 C4.1703212,13.0906114 4.07531442,13.0773161 4.0057194,13.0094195 C3.93459201,12.9430719 3.91473508,12.8489074 3.95949298,12.7991467 C4.00463397,12.7493214 4.10021539,12.7633267 4.1703212,12.8306424 C4.24100164,12.8968609 4.26258248,12.9917354 4.21501525,13.0409152 M4.81538402,13.2216286 C4.79578249,13.2860399 4.70422354,13.3153413 4.6120261,13.2879762 C4.51995636,13.259772 4.45968324,13.1842596 4.4782632,13.1191383 C4.49741779,13.0542751 4.58935983,13.0237475 4.68225961,13.0530489 C4.77420165,13.081124 4.83460247,13.1560554 4.81544787,13.2216286 M5.49881989,13.2982381 C5.50111844,13.3661347 5.42290385,13.422414 5.32610931,13.4236402 C5.22874013,13.4257701 5.15001476,13.3708461 5.14899318,13.3041113 C5.14899318,13.2355693 5.22542,13.1798063 5.32272533,13.1781928 C5.41951987,13.1762566 5.49881989,13.2307933 5.49881989,13.2982381 M6.17012451,13.2722283 C6.18174496,13.3384468 6.11444849,13.4064725 6.01835628,13.4245438 C5.92386029,13.4419697 5.83638766,13.4011156 5.82432026,13.3354779 C5.81257211,13.2675814 5.88114555,13.1996203 5.97545,13.1820007 C6.07173375,13.1650911 6.15786557,13.2049126 6.17012451,13.2722283","fill-rule":"nonzero"});const o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("fill",e),o.append(r,a);const s=document.createElementNS("http://www.w3.org/2000/svg","g");I(s,{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}),s.appendChild(o);const l=document.createElementNS("http://www.w3.org/2000/svg","svg");I(l,{viewBox:"0 0 17 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:t,height:t}),l.classList.add("git-hub-svg"),l.appendChild(s);const h=document.createElement("a");return h.classList.add("git-hub-logo-link"),I(h,{href:n?`https://github.com/${i}/${n}`:`https://github.com/${i}`,rel:"noopener noreferrer",target:"_blank",type:"button","aria-label":"GitHub profile link"}),h.appendChild(l),h}(),n=a("nav");return n.append(e,i),n}(),e=a("header");return e.appendChild(t),e}();instructionsDialog=new X;constructor(t,e){if(this.gameState=t,this.billowBot=e,!document)throw new Error("Fuck!");const i=document.getElementById("content");if(!i)throw new Error("Shit!");this.content=i,this.instructionsLightboxController=new x(this.instructionsDialog.element,"instructions-dialog-close-button"),this.mainComponent=new W(D,this.instructionsLightboxController,this.cycloneSitRepScroller,this.gameState),this.gameState.eventBus.on("transitionToNextPhase",this.transitionToNextPhase),this.gameState.eventBus.on("updateUIActiveGameboard",this.updateUIActiveGameboard),this.gameState.eventBus.on("setAndScrollToNextSitRep",this.cycloneSitRepScroller.setAndScrollToNextSitRep)}render(){this.content.appendChild(this.header),this.mainComponent.render(this.content),this.instructionsDialog.render(document.body)}readyPlayerOne=async()=>{await this.updateUIActiveGameboard(),this.mainComponent.mainContainerTwo.opponentGameboard.toggleBellumListeners(N.active),this.gameState.eventBus.emit("togglePlayerGameboardControls",N.inactive),this.gameState.eventBus.emit("toggleOpponentGameboardControls",N.active)};updateUIActiveGameboard=async()=>{const t=this.mainComponent.mainContainerTwo.element;t.classList.toggle("player-turn","player"===this.gameState.currentPlayer),await s(t,1e3)};transitionToNextPhase=async()=>{if("bellum"===this.gameState.currentGamePhase){if(this.gameState.setInitialPlayer(),!this.gameState.currentPlayer)throw new Error("Current player must be set in game state.");this.initializeSitRepScroller(this.gameState.currentPlayer)}if(this.mainComponent.mainContainerOne.swapByOrder(),this.mainComponent.mainContainerThree.swapByOrder(),await this.updateGameboardsOnTransition(this.gameState),"opponent"===this.gameState.currentPlayer&&(console.log("billowBot",this.billowBot),this.billowBot)){const t=await this.billowBot.attack();console.log("billowAttackResult",t)}};updateGameboardContainerState=async t=>{const e=this.mainComponent.mainContainerTwo.element;e.classList.toggle("parabellum","parabellum"===t.currentGamePhase),e.classList.toggle("bellum","bellum"===t.currentGamePhase),e.classList.toggle("postBellum","postBellum"===t.currentGamePhase),await s(e,1e3)};updateGameboardsOnTransition=async t=>{await this.updateGameboardContainerState(t),"parabellum"!==t.currentGamePhase?("bellum"===t.currentGamePhase&&"player"===t.currentPlayer&&this.readyPlayerOne(),t.currentGamePhase):this.resetGame()};initializeSitRepScroller=t=>{this.cycloneSitRepScroller.element?this.cycloneSitRepScroller.initialize(t):console.error("CycloneSitRepScroller element is null or undefined!")};resetGame=()=>{this.mainComponent.mainContainerOne.swapFragmentByKey("parabellum"),this.mainComponent.mainContainerThree.swapFragmentByKey("parabellum"),this.gameState.resetGameState()}}class tt{currentGamePhase="parabellum";currentPlayer=null;static getInitialPlayer(){return Math.random()>.5?"player":"opponent"}constructor(t,e){this.isMultiplayer=t,this.eventBus=e}resetGameState=()=>{this.currentGamePhase="parabellum",this.currentPlayer=null,this.eventBus.emit("gameReset")};setInitialPlayer=()=>{this.currentPlayer=tt.getInitialPlayer()};toggleGameboardControls=()=>{const t="player"===this.currentPlayer;t&&this.eventBus.emit("toggleOpponentGameboardControls",N.active),this.eventBus.emit("togglePlayerGameboardControls",t?N.inactive:N.active)};togglePlayerTurn=async()=>{this.currentPlayer="player"===this.currentPlayer?"opponent":"player",this.eventBus.emit("setAndScrollToNextSitRep"),await this.updateUIActiveGameboard(),this.toggleGameboardControls(),this.isMultiplayer||"opponent"!==this.currentPlayer||await this.eventBus.emit("billowAttack")};transitionToNextPhase=()=>{switch(this.currentGamePhase){case"parabellum":this.currentGamePhase="bellum";break;case"bellum":this.currentGamePhase="postBellum";break;case"postBellum":this.currentGamePhase="parabellum"}this.eventBus.emit("transitionToNextPhase")};updateUIActiveGameboard=async()=>{await this.eventBus.emit("updateUIActiveGameboard")}}class et{events={};on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((t=>t!==e)))}async emit(t,e){return this.events[t]?await Promise.all(this.events[t].map((t=>t(e)))):[]}}class it{#s;#l=null;#h=null;constructor(t){this.gameState=t,this.#s=new Set,this.populatepossibleAttacksSet(),this.gameState.eventBus.on("billowAttack",this.attack)}attack=async()=>{try{const t=await this.determineNextTarget();console.log("attackCoordinates",t);const[e]=await this.gameState.eventBus.emit("receiveBillowAttack",t);return e.hit&&this.rememberLastTargetHit(t),e}catch(t){throw console.error("Error in BillowBot.attack:",t),t}};getNextAttackCoordinates(t,e){const i=this.getRandomCoordinates();return this.#l=i,i}async determineNextTarget(){return await this.ponder(500),this.getNextAttackCoordinates(this.#l,this.#h)}ponder(t){return new Promise((e=>setTimeout(e,t)))}populatepossibleAttacksSet(){for(let t=0;t<10;t++)for(let e=0;e<10;e++)this.#s.add(`${t},${e}`)}getRandomCoordinates(){const t=Array.from(this.#s)[Math.floor(Math.random()*this.#s.size)];this.#s.delete(t);const e=t.split(",").map(Number);if(!d(e))throw new Error("Invalid coordinates");return e}getSmartCoordinates(t){if(!t)throw new Error("Last attack coordinates are required");const[e,i]=t;return[0,0]}rememberLastTargetHit(t){this.#l=t,this.#h=!0}}class nt{isMultiplayer=!1;constructor(){this.eventBus=new et,this.gameState=new tt(this.isMultiplayer,this.eventBus),this.billowBot=this.isMultiplayer?null:new it(this.gameState),this.domController=new Z(this.gameState,this.billowBot)}static powerOn(){return console.time("Loading"),C(D.player.gameboardController,D.player.fleetBuilder.fleet),C(D.opponent.gameboardController,D.opponent.fleetBuilder.fleet),console.timeEnd("Loading"),new nt}pressStart(){this.domController.render()}}console.time("powerOn");const rt=nt.powerOn();console.timeEnd("powerOn"),console.time("pressStart"),rt.pressStart(),console.timeEnd("pressStart")}();
//# sourceMappingURL=index.bundle.js.map