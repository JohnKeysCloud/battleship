!function(){"use strict";var t={d:function(e,n){for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}};t.d({},{q:function(){return ot}});class e{dialogState={isDialogOpen:!1,isEscapeKeyListenerAttached:!1,isCloseButtonListenerAttached:!1};constructor(t,e="ds-close-button",n=!0){if(this.dialogElement=t,this.dialogCloseButtonID=e,this.dialogInDocumentBody=n,!this.dialogElement.id)throw new Error("Dialog element must have an id.");this.dialogId=this.dialogElement.id,this.dialogCloseButton=this.dsGetCloseButton(this.dialogCloseButtonID,this.dialogId),this.dsAddCloseButtonAria(this.dialogCloseButton),this.closeButtonListener=this.closeLightbox.bind(this),this.escapeKeyListener=this.dsHandleEscapeKey.bind(this),this.observeDialogRemoval()}openLightbox(){this.dialogState.isDialogOpen||(this.dialogElement.showModal(),this.dsAddListeners(),this.dialogState.isDialogOpen=!0)}closeLightbox(){requestAnimationFrame((()=>{this.dialogElement.classList.add("closing")})),this.dialogElement.addEventListener("animationend",(()=>{this.dialogElement.classList.remove("closing"),this.dialogElement.close(),this.dsRemoveListeners(),this.dialogState.isDialogOpen=!1}),{once:!0})}isOpen(){return this.dialogState.isDialogOpen}dsAddListeners(){this.dialogState.isCloseButtonListenerAttached||(this.dialogCloseButton.addEventListener("click",this.closeButtonListener),this.dialogState.isCloseButtonListenerAttached=!0),this.dialogState.isEscapeKeyListenerAttached||(window.addEventListener("keydown",this.escapeKeyListener),this.dialogState.isEscapeKeyListenerAttached=!0)}dsRemoveListeners(){this.dialogCloseButton.removeEventListener("click",this.closeButtonListener),this.dialogState.isCloseButtonListenerAttached=!1,window.removeEventListener("keydown",this.escapeKeyListener),this.dialogState.isEscapeKeyListenerAttached=!1}dsGetCloseButton(t,e){const n=this.dialogElement.querySelector(`#${t}`);if(!n)throw new Error(`Close button with ID "${t}" not found in dialog "${e}".`);return n}dsAddCloseButtonAria(t){t.setAttribute("aria-label","Close Dialog")}dsHandleEscapeKey(t){"Escape"===t.key&&this.dialogState.isDialogOpen&&(t.preventDefault(),this.closeLightbox())}observeDialogRemoval(){const t=new MutationObserver((e=>{for(const n of e)Array.from(n.removedNodes).forEach((e=>{if(e===this.dialogElement)return this.dsRemoveListeners(),void t.disconnect()}))}));this.dialogInDocumentBody?t.observe(document.body,{childList:!0}):t.observe(document.body,{childList:!0,subtree:!0})}}const n=(t,e)=>t.length===e.length&&t.every(((t,n)=>t===e[n])),i=t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),r=(t,e,n)=>{const i=t.getAttribute(e);if(!i||!n(i))throw new Error(`Invalid or missing attribute: ${e}`);return i},a=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,o=(t,e=[],n={})=>{const i=document.createElement(t);return e.forEach((t=>i.classList.add(t))),Object.entries(n).forEach((([t,e])=>i.setAttribute(t,e))),i},s=t=>new Promise((e=>setTimeout(e,t))),l=(t,e=1e3,n,i)=>new Promise((r=>{let a=!1,o=0;const s=()=>{a||(a=!0,t.removeEventListener("transitionend",l),clearTimeout(h),r(),i?.())},l=e=>{if(void 0!==n&&n>0)return o++,void(o>=n&&s());e.target===t&&s()};t.addEventListener("transitionend",l);const h=setTimeout((()=>{s()}),e)}));function h(t,e){for(const n in e)t.setAttribute(n,e[n])}function d(t){const e=o("h2");e.textContent="Parabellum";const n=o("div",["parabellum"],{id:"main-container-one-parabellum"});n.append(e),t.render(n);const i=new DocumentFragment;return i.append(n),i}function c(t){o("h2").textContent="Parabellum";const e=o("h3");e.textContent="Situation Report:";const n=o("div",["bellum"],{id:"main-container-one-bellum"});n.append(e,t.element);const i=new DocumentFragment;return i.appendChild(n),i}function u(t){const e=o("h2",["secondary-heading"],{id:"game-over-heading"});e.textContent="Game Over";const n=o("div",["post-bellum"],{id:"main-container-one-post-bellum"});n.append(e,t);const i=new DocumentFragment;return i.appendChild(n),i}class p{#t;constructor(t,e,n,i=[],r={}){if(this.elementTag=t,this.fragments=e,this.initialFragmentKey=n,this.classNames=i,this.attributes=r,!e[n])throw new Error(`Initial fragment with key "${n}" does not exist.`);this.hotSwapContainer=o(this.elementTag,this.classNames,this.attributes),this.fragmentsArray=Object.values(this.fragments),this.#t=this.setInitialIndex(this.fragmentsArray,this.fragments,this.initialFragmentKey),this.hotSwapContainer.appendChild(this.fragments[this.initialFragmentKey])}render(t){t.appendChild(this.hotSwapContainer)}swapFragmentByKey(t){const e=this.getFragment(t);this.swapFragment(e),this.#t=this.fragmentsArray.indexOf(e)}swapByOrder(){this.#t=(this.#t+1)%this.fragmentsArray.length,this.swapFragment(this.fragmentsArray[this.#t])}setInitialIndex(t,e,n){const i=t.indexOf(e[n]);if(-1===i)throw new Error(`Initial fragment with key "${n}" does not exist.`);return i}getFragment(t){const e=this.fragments[t];if(!e)throw new Error(`Fragment with key "${t}" does not exist.`);return e}swapFragment(t){this.hotSwapContainer.replaceChildren(t)}}class g{constructor(t,e){this.element=t,this.initialText=e,e&&(this.element.textContent=e)}getElement(){return this.element}resetText(){this.initialText&&(this.element.textContent=this.initialText)}updateText(t){this.element.textContent=t}}class m extends g{constructor(t,e,n,i){super(t,i),this.eventBus=e,this.rowName=n}updateTextWrapper=t=>{this.updateText(t)};init(){this.eventBus.on(this.rowName,this.updateTextWrapper)}destroy(){this.eventBus.off(this.rowName,this.updateTextWrapper)}}var y,f,C;!function(t){t[t.Degrees0=0]="Degrees0",t[t.Degrees90=90]="Degrees90",t[t.Degrees180=180]="Degrees180",t[t.Degrees270=270]="Degrees270"}(y||(y={})),(C=f||(f={})).Battleship="battleship",C.Carrier="carrier",C.Cruiser="cruiser",C.Destroyer="destroyer",C.PatrolBoat="patrolBoat",C.Submarine="submarine";const b=t=>!(!Array.isArray(t)||2!==t.length)&&t.every((t=>"number"==typeof t)),S=t=>t instanceof HTMLDivElement,v=t=>t instanceof HTMLElement,w=t=>"string"==typeof t&&["horizontal","vertical"].includes(t),B=t=>"outOfBounds"===t,E=t=>"object"==typeof t&&null!==t&&!!b(t.coordinates),P=t=>{if(!(t=>{if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||null===e})(t))return!1;const{bow:e,stern:n}=t;return b(e)&&b(n)},A=t=>Object.values(f).includes(t);var T;!function(t){t[t.inactive=0]="inactive",t[t.active=1]="active"}(T||(T={}));class L{id="player";fleetElements=new Map;listenersAdded=!1;dragState={currentShipInstance:null,initialPlacementConfigurations:null,isValidDropTarget:!1,currentDragOverCell:null,cloneSnapOffset:null,shipBorderValueSplit:null};dragEventCallbacks={dragstart:t=>this.handleShipDragStart(t,this.dragState),drag:t=>this.handleShipDrag(t,this.dragState),dragenter:t=>this.handleShipDragEnter(t),dragleave:t=>this.handleShipDragLeave(t),dragover:t=>this.handleShipDragOver(t,this.dragState),drop:t=>this.handleShipDrop(t,this.dragState),dragend:t=>this.handleShipDragEnd(t,this.dragState)};constructor(t,e){this.playerState=t,this.gameState=e,this.gameboardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize),this.gameboard=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize),this.dragImage=this.createDragImage(),this.shipDragClone=this.createShipDragClone(),this.gameState.eventBus.on("refreshGameboard",this.refreshGameboardWrapper),this.gameState.eventBus.on("togglePlayerGameboardControls",this.toggleGameboardControls),this.gameState.eventBus.on("receiveBillowAttack",this.receiveAttack)}render(t){if(!t)throw new Error(`Target element not found with ID - ${this.id} and selector - "${t}".`);this.gameboardContainer.append(this.dragImage,this.shipDragClone,this.gameboard),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements),this.toggleParabellumListeners(),t.appendChild(this.gameboardContainer)}toggleParabellumListeners(){if(!this.gameboardContainer)return;const t=this.listenersAdded?"removeEventListener":"addEventListener";Object.entries(this.dragEventCallbacks).forEach((([e,n])=>{this.gameboardContainer[t](e,n)})),this.gameboardContainer[t]("click",this.handleShipRotation),this.listenersAdded=!this.listenersAdded}togglePlayerTurn(t){const{hit:e,isSunk:n}=t;if(e&&!n||!e)this.gameState.togglePlayerTurn();else if(e&&n){if(!this.isGameOver())return void this.gameState.togglePlayerTurn();this.gameState.eventBus.emit("updateVictoryBannerText","You Lose Dumbass!"),this.gameState.transitionToNextPhase()}}toggleShipsDraggable(){this.fleetElements.forEach((t=>{t.removeAttribute("draggable")}))}toggleShipAdriftClass(){this.fleetElements.forEach((t=>{t.classList.remove("adrift")}))}applyGridPlacementValue(t,e,n,i,r){"horizontal"===i?(n.style.gridColumn=t,n.style.gridRow=e.toString(),n.style.gridTemplateColumns=`repeat(${r}, 1fr)`):(n.style.gridRow=t,n.style.gridColumn=e.toString(),n.style.gridTemplateRows=`repeat(${r}, 1fr)`)}isGameOver(){return this.playerState.gameboardRepository.areAllShipsSunk()}createDragImage(){return o("img",["drag-image","accessibility"],{id:`${this.id}-drag-image`,src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_misc-images/1x1_transparent.png"})}createShipDragClone(){return o("div",["ship-container-clone"],{id:`${this.id}-ship-drag-clone`})}createBackgroundCellsFragment(t){const e=new DocumentFragment;return t.forEach(((t,n)=>{t.forEach(((t,i)=>{const r=t.description.toLowerCase(),a=o("div",[`${this.id}-hit-marker`,"hit-marker"]),s=o("div",[`${this.id}-${r}-cell`,`player-${r}-cell`,"grid-cell"],{"data-x":i.toString(),"data-y":n.toString(),"aria-label":`Row ${n+1}, Column ${i+1}`,role:"gridCell"});s.appendChild(a);const l=o("div",[`${this.id}-${r}-grid-cell-container`,"grid-cell-container"]);l.appendChild(s),e.appendChild(l)}))})),e}createShipElement(t,e,n,i,r){const a=this.generateShipUnitFragment(e,t,r,this.id,n,i),s=o("div",["ship-container","player-ship-container","adrift"],{id:`${this.id}-${t}-container`,"data-dragging":"false","data-length":e.toString(),"data-orientation":r,"data-shipType":t,draggable:"true"});return s.appendChild(a),this.applyGridPlacementValue(n,i,s,r,e),this.syncShipUnitDataAttributes(s,t),s}generateBoardContainer(t){const e=o("section",["gameboard-container"],{id:`${this.id}-gameboard-container`});return e.style.setProperty("--grid-size",t.toString()),e}generateBoardFragment(t){const e=o("div",["gameboard-background"],{id:`${this.id}-gameboard-background`});e.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const n=o("div",["gameboard"],{id:`${this.id}-gameboard`});n.style.setProperty("--grid-size",t.toString());const i=new DocumentFragment;return i.append(e,n),i}generateShipUnitFragment(t,e,n,i,r,a){const s=new DocumentFragment;for(let r=0;r<t;r++){const a=0===r,l=r===t-1,h=o("div",["ship-unit",`${e}-unit`,`${i}-${e}-unit`]);"horizontal"===n?h.classList.add("ship-unit-horizontal"):h.classList.add("ship-unit-vertical"),a&&(h.classList.add("ship-bow"),h.setAttribute("id",`${i}-${e}-bow`)),l&&(h.classList.add("ship-stern"),h.setAttribute("id",`${i}-${e}-stern`)),s.appendChild(h)}return s}getGridPlacementValue(t,e,n){const i="horizontal"===e,[r,a]=t;return[`${i?r+1:a+1} / span ${n}`,i?a+1:r+1]}getShipPlacementData(t){const e=this.playerState.fleetBuilder.getShip(t),{coordinatesArray:n,orientation:i}=e.currentplacementConfigurations;if(!n||!i)throw new Error(`The ${e.type} has no placement configurations.`);return{bowCoordinates:n[0],orientation:i,shipLength:e.length}}handleFleetPlacement(t,e){this.updateFleetElements(t),this.placeFleetOnGameboard(e)}async cookShipUnit(t,e){const n=this.fleetElements.get(t);if(!n)throw new Error(`The ${t} has no fleet element.`);const[i,r]=e,a=n.querySelector(`[data-x="${i}"][data-y="${r}"]`);if(a?.classList.add("cooked"),a){if(a.classList.add("cooked"),!v(a))throw new Error("The attacked ship must be an HTML Element.");await l(a,999),await s(2e3)}else console.warn(`No ship unit found at coordinates (${i}, ${r}) on ${t}.`)}handleSinkingShip=async t=>{const e=this.fleetElements.get(t);if(!e)throw new Error(`The ${t} has no fleet element.`);await this.sinkShip(e)};hasTargetBeenAttacked(t){const e=this.playerState.gameboardRepository.hasTargetBeenAttacked(t);return e||this.playerState.gameboardRepository.addAttackedCoordinates(t),e}placeFleetOnGameboard(t){const e=this.gameboardContainer.querySelector(".gameboard");if(!e)throw new Error("Gameboard container not found.");t.forEach((t=>e.appendChild(t)))}_receiveAttack=async t=>{const e=`[data-x="${t[0]}"][data-y="${t[1]}"]`,n=this.gameboardContainer.querySelector(e);if(!n)throw new Error("Grid cell not found.");if(this.hasTargetBeenAttacked(t))return console.warn("Cell has already been attacked:",t),{hit:!1};const i=this.playerState.gameboardController.receiveAttack(t);try{await this.triggerPrePlayerToggleAnimations(i,n,t)}catch(t){console.error("Error in triggerPrePlayerToggleAnimations",t)}return this.togglePlayerTurn(i),i};receiveAttack=async t=>await this._receiveAttack(t);refreshGameboard(t){const e=t.querySelector(`#${this.id}-gameboard`),n=t.querySelector(`#${this.id}-gameboard-background`);if(!e||!n)throw new Error("Missing gameboard and/or gameboard background elements");this.gameboardContainer.removeChild(e),this.gameboardContainer.removeChild(n),this.shipDragClone.classList.remove("visible"),this.gameboard=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize),this.gameboardContainer.appendChild(this.gameboard),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements)}refreshGameboardWrapper=()=>{this.refreshGameboard(this.gameboardContainer)};setFleetElement=(t,e,n,i,r)=>{const a=this.createShipElement(t,e,n,i,r);this.fleetElements.set(t,a)};syncShipUnitDataAttributes=(t,e)=>{const n=this.playerState.fleetBuilder.getShip(e),{coordinatesArray:i}=n.currentplacementConfigurations;if(r=i,!(Array.isArray(r)&&r.length>0&&r.every(b)))throw new Error("The ship's coordinates array is improperly structured or non-existent.");var r;const a=Array.from(t.children).filter(v);if(!(t=>Array.isArray(t)&&t.length>0&&t.every(S))(a))throw new Error("All ship unit's must be HTML DIV elements.");if(i.length!==a.length)throw new Error(`Mismatch between ship units (${a.length}) and coordinates (${i.length}) for ${e}`);i.forEach((([t,e],n)=>{const i=a[n];i.setAttribute("data-x",String(t)),i.setAttribute("data-y",String(e))}))};sinkShip=async t=>{var e;t.classList.add("sunk"),await(e=t,new Promise((t=>{const n=()=>{e.removeEventListener("animationend",n),t()};e.addEventListener("animationend",n)}))),await s(1e3)};toggleGameboardControls=t=>{this.gameboardContainer.classList.toggle("locked",t===T.inactive)};triggerPrePlayerToggleAnimations=async(t,e,n)=>{const i=this.updateUIPostAttack(t,e,n),r=this.gameState.eventBus.emit("setAndScrollToNextSitRep",t);await Promise.all([i,r])};updateFleetElements=t=>{this.fleetElements.size&&this.fleetElements.clear();for(const e of Object.values(t.fleet)){const t=e.type,n=e.length,i=e.currentplacementConfigurations.orientation;if(!i)throw new Error("Orientation not set.");const r=e.currentplacementConfigurations.coordinatesArray;if(!r||0===r.length){console.error(`The ${t} has not been placed. Continuing...`);continue}const a=r[0],[o,s]=this.getGridPlacementValue(a,i,n);this.setFleetElement(t,n,o,s,i)}};updateUIPostAttack=async(t,e,n)=>{const{hit:i,isSunk:r,type:a}=t;if(i){if(!A(a))throw new Error(`The ${a} is not a valid ship type.`);if(!n)throw new Error("Attack coordinates not found. They are required for updating the player gameboard post attack.");e.classList.add("hit"),this.gameState.eventBus.emit("markNextHitPoint",{playerType:"player",shipType:a}),await this.cookShipUnit(a,n),r&&await this.handleSinkingShip(a)}else e.classList.add("miss")};handleShipDragStart(t,e){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".ship-container")))return;const i=t.target,a=r(i,"data-orientation",w),o=this.playerState.fleetBuilder.fleet,s=r(i,"data-shiptype",A),l=((t,e,n)=>{const i=(t=>{const e=t.querySelector(".ship-bow");if(!e)throw new Error("Ship bow not found.");return e})(t),r=getComputedStyle(document.documentElement).getPropertyValue("--ship-container-border-size").trim().match(/^(?<numberValue>\d+(\.\d+)?)(?<unitType>[a-z%]+)$/i);if(!r||!r.groups)throw new Error("No matches found when parsing");const a=r.groups;n.shipBorderValueSplit=a;const o="horizontal"===e,[s,l]=o?[i.getBoundingClientRect().width/2,i.getBoundingClientRect().height/2+Number(a.numberValue)]:[i.getBoundingClientRect().width/2+Number(a.numberValue),i.getBoundingClientRect().height/2];return{offsetX:s,offsetY:l}})(i,a,e);if(((t,e,n,i)=>{if(!e[n])throw new Error(`The ${n} is not present in the fleet.`);t.currentShipInstance=e[n],t.initialPlacementConfigurations=t.currentShipInstance.currentplacementConfigurations,t.cloneSnapOffset=i})(e,o,s,l),!e.currentShipInstance)throw new Error(`Drag state hasn't been updated with the current ship instance on drag start. Drag State: ${JSON.stringify(e)}`);this.playerState.gameboardController.removePiece(e.currentShipInstance),t.dataTransfer?.setDragImage(this.dragImage,0,0),((t,e)=>{const n=t.getBoundingClientRect();e.style.height=`${n.height}px`,e.style.width=`${n.width}px`})(i,this.shipDragClone),(t=>{t.setAttribute("data-dragging","true"),requestAnimationFrame((()=>{t.classList.add("locked")})),this.shipDragClone.classList.add("visible")})(i),((t,e,i,r)=>{const a=Number(e.getAttribute("data-length"));if(!a||"number"!=typeof(o=a)||![2,3,4,5].includes(o))throw new Error("Invalid or missing ship type attribute.");var o;const s=a;((t,e,i)=>{const a=r.getAllValidBowCoordinates(i,e);t.forEach((t=>{const e=[Number(t.getAttribute("data-x")),Number(t.getAttribute("data-y"))];for(const i of a)n(i,e)&&t.classList.add("valid-bow-coordinates")}))})(t.querySelectorAll(".grid-cell"),s,i)})(this.gameboardContainer,i,a,this.playerState.gameboardController),this.snapCloneToCursor(t,l)}handleShipDrag(t,e){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".ship-container")))return;const n=e.cloneSnapOffset;if(!n)throw new Error("An error has occured during the `cloneSnapOffset` reading.");this.snapCloneToCursor(t,n)}handleShipDragEnter(t){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const e=t.target,n=e.classList.contains("valid-bow-coordinates");n?e.classList.add("placement-is-valid"):e.classList.add("placement-is-invalid"),n&&this.shipDragClone.classList.add("placement-is-valid")}handleShipDragLeave(t){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const e=t.target;e.classList.contains("placement-is-valid")?e.classList.remove("placement-is-valid"):e.classList.remove("placement-is-invalid"),this.shipDragClone.classList.contains("placement-is-valid")&&this.shipDragClone.classList.remove("placement-is-valid")}handleShipDragOver(t,e){if(t.preventDefault(),!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const n=t.target;e.currentDragOverCell=n,n.classList.contains("valid-bow-coordinates")}handleShipDrop(t,e){if(t.preventDefault(),!(t.target instanceof HTMLDivElement&&t.target.matches(".valid-bow-coordinates")))return;const{coordinatesArray:n,orientation:i}=e.initialPlacementConfigurations||{};if(!n||!i)throw new Error("Initial placement configurations are incomplete.");e.isValidDropTarget=!0;const r=t.target,a=r.getAttribute("data-x"),o=r.getAttribute("data-y");if(!a||!o)throw new Error("Missing or invalid grid cell coordinates.");const s=[Number(a),Number(o)];this.playerState.gameboardController.placePiece({ship:e.currentShipInstance,coordinates:s,orientation:i}),this.refreshGameboard(this.gameboardContainer),e.isValidDropTarget=!1}handleShipDragEnd(t,e){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".ship-container")))return;const n=()=>{const{coordinatesArray:t,orientation:n}=e.initialPlacementConfigurations||{};if(!t||!n)throw new Error("Initial placement configurations are incomplete.");const i=t[0];this.playerState.gameboardController.placePiece({ship:e.currentShipInstance,coordinates:i,orientation:n})},i=(t,e,n)=>{const i=n?"placement-is-valid":"placement-is-invalid";t.setAttribute("data-dragging","false"),e.classList.remove(i),this.shipDragClone.classList.remove("visible"),t.classList.remove("locked")},r=t.target;try{const{currentDragOverCell:t,isValidDropTarget:a}=e;if(!t)throw new Error(`Current drag over cell is missing. Drag state: ${JSON.stringify(e)}`);i(r,t,a),a||n()}catch(t){console.error(t)}}handleShipRotation=t=>{if(!(t.target instanceof HTMLDivElement&&t.target.matches(".ship-container")))return;const e=t.target,n=r(e,"data-shiptype",A),i=this.playerState.fleetBuilder.getShip(n);this.playerState.gameboardController.rotatePiece(i),this.refreshGameboard(this.gameboardContainer)};snapCloneToCursor(t,e){const n=this.gameboardContainer.getBoundingClientRect(),i=n.left,r=n.top,a=t.clientX,o=t.clientY,{offsetX:s,offsetY:l}=e;document.documentElement.style.setProperty("--ship-clone-left",a-i-s+"px"),document.documentElement.style.setProperty("--ship-clone-top",o-r-l+"px")}getId(){return this.id}}class ${id="opponent";fleetElements=new Map;constructor(t,e){this.playerState=t,this.gameState=e,this.gameboardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize),this.updateFleetElements(this.playerState.fleetBuilder),this.gameState.eventBus.on("toggleOpponentGameboardControls",this.toggleGameboardControls)}render(t){if(!t)throw new Error(`Target element not found with ID - ${this.id} and selector - "${t}".`);const e=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize);this.gameboardContainer.appendChild(e),this.placeFleetOnGameboard(this.fleetElements),t.appendChild(this.gameboardContainer)}toggleBellumListeners=t=>{if(!this.gameboardContainer)return;const e=t===T.inactive?"removeEventListener":"addEventListener";this.gameboardContainer[e]("click",this.handleCellClick)};isGameOver(){return this.playerState.gameboardRepository.areAllShipsSunk()}async cookAllShipUnits(t){const e=Array.from(t.children);e.forEach(((t,e)=>{setTimeout((()=>{t.classList.add("cooked")}),333*(e+1))}));const n=e[e.length-1];await l(n,999),await s(1e3)}createBackgroundCellsFragment(t){const e=new DocumentFragment;return t.forEach(((t,n)=>{t.forEach(((t,i)=>{const r=o("div",[`${this.id}-hit-marker`,"hit-marker"]),a=o("div",[`${this.id}-grid-cell`,"grid-cell"],{"data-x":i.toString(),"data-y":n.toString(),"aria-label":`Row ${n+1}, Column ${i+1}`,role:"gridCell"});a.appendChild(r);const s=o("div",[`${this.id}-grid-cell-container`,"grid-cell-container"]);s.appendChild(a),e.appendChild(s)}))})),e}createShipElement(t,e,n){const i=this.generateShipUnitFragment(e,t,n,this.id),r=o("div",["ship-container","opponent-ship-container"],{id:`${this.id}-${t}-container`});return r.appendChild(i),r}generateBoardContainer(t){const e=o("div",["gameboard-container","locked"],{id:`${this.id}-gameboard-container`});return e.style.setProperty("--grid-size",t.toString()),e}generateBoardFragment(t){const e=o("div",["gameboard-background"],{id:`${this.id}-gameboard-background`});e.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const n=o("div",["gameboard"],{id:`${this.id}-gameboard`});n.style.setProperty("--grid-size",t.toString()),this.fleetElements.forEach((t=>{n.appendChild(t)}));const i=new DocumentFragment;return i.append(e,n),i}generateShipUnitFragment(t,e,n,i){const r=new DocumentFragment;for(let a=0;a<t;a++){const s=0===a,l=a===t-1,h=o("div",["ship-unit",`${e}-unit`,`${i}-${e}-unit`]);"horizontal"===n?h.classList.add("ship-unit-horizontal"):h.classList.add("ship-unit-vertical"),s&&(h.classList.add("ship-bow"),h.setAttribute("id",`${i}-${e}-bow`)),l&&(h.classList.add("ship-stern"),h.setAttribute("id",`${i}-${e}-stern`)),r.appendChild(h)}return r}getAttackCoordinates(t){const e=t.getAttribute("data-x"),n=t.getAttribute("data-y");if(null==e||null==n)throw new Error("Could not retrieve coordinates from grid cell.");return[+e,+n]}getGridAreaValue(t,e,n){const i="horizontal"===e,[r,a]=t;return[`${i?r+1:a+1} / span ${n}`,i?a+1:r+1]}getShipPlacementData(t){const e=this.playerState.fleetBuilder.getShip(t),{coordinatesArray:n,orientation:i}=e.currentplacementConfigurations;if(!n||!i)throw new Error(`The ${e.type} has no placement configurations.`);return{bowCoordinates:n[0],orientation:i,shipLength:e.length}}handleCellClick=t=>{this.receiveAttack(t)};async handleSinkingShip(t){const{bowCoordinates:e,orientation:n,shipLength:r}=this.getShipPlacementData(t),a=this.fleetElements.get(t);if(!a)throw new Error(`The ${i(t)}'s ship container element not found.`);this.revealShipPosition(a,e,n,r),await this.sinkShip(a)}hasTargetBeenAttacked(t){const e=this.playerState.gameboardRepository.hasTargetBeenAttacked(t);return e||this.playerState.gameboardRepository.addAttackedCoordinates(t),e}placeFleetOnGameboard(t){const e=this.gameboardContainer.querySelector(".gameboard");if(!e)throw new Error("Gameboard container not found.");t.forEach((t=>e.appendChild(t)))}revealShipPosition(t,e,n,i){const[r,a]=this.getGridAreaValue(e,n,i);this.setGridPlacementValue(r,a,t,n,i)}async receiveAttack(t){if(!(t.target instanceof HTMLDivElement&&t.target.matches(".grid-cell")))return;const e=t.target,n=this.getAttackCoordinates(e);if(this.hasTargetBeenAttacked(n))return;this.toggleBellumListeners(T.inactive),this.toggleGameboardControls(T.inactive);const i=this.playerState.gameboardController.receiveAttack(n);try{await this.triggerPrePlayerToggleAnimations(i,e)}catch(t){console.error("Animation failed",t)}this.togglePlayerTurn(i)}setGridPlacementValue(t,e,n,i,r){"horizontal"===i?(n.style.gridColumn=t,n.style.gridRow=e.toString(),n.style.gridTemplateColumns=`repeat(${r}, 1fr)`):(n.style.gridRow=t,n.style.gridColumn=e.toString(),n.style.gridTemplateRows=`repeat(${r}, 1fr)`)}sinkShip=async t=>{var e,n;t.classList.add("sunk"),await(e=t,n="animationend",new Promise((t=>{const i=r=>{e.removeEventListener(n,i),t(r)};e.addEventListener(n,i)}))),await this.cookAllShipUnits(t),await s(1e3)};toggleGameboardControls=t=>{t===T.active&&this.toggleBellumListeners(t),this.gameboardContainer.classList.toggle("locked",t===T.inactive)};togglePlayerTurn(t){const{hit:e,isSunk:n}=t;if(e&&!n||!e)this.gameState.togglePlayerTurn();else if(e&&n){if(!this.isGameOver())return void this.gameState.togglePlayerTurn();this.toggleBellumListeners(T.inactive),this.gameState.eventBus.emit("updateVictoryBannerText","You Win Clanker!"),this.gameState.transitionToNextPhase()}}triggerPrePlayerToggleAnimations=async(t,e)=>{const n=this.updateUIPostAttack(t,e),i=this.gameState.eventBus.emit("setAndScrollToNextSitRep",t);await Promise.all([n,i])};updateFleetElements(t){const e=t.fleet;for(const t of Object.values(e)){const e=t.type,n=t.length,i=t.currentplacementConfigurations.orientation;if(!i)throw new Error("Orientation not set.");const r=t.currentplacementConfigurations.coordinatesArray;if(!r||0===r.length){console.error(`The ${e} has not been placed. Continuing...`);continue}const a=this.createShipElement(e,n,i);this.fleetElements.set(e,a)}}updateUIPostAttack=async(t,e)=>{const{hit:n,isSunk:i,type:r}=t;if(n){if(!A(r))throw new Error(`The ${r} is not a valid ship type.`);e.classList.add("hit"),this.gameState.eventBus.emit("markNextHitPoint",{playerType:"opponent",shipType:r}),i&&await this.handleSinkingShip(r)}else e.classList.add("miss")};getId(){return this.id}}class k{constructor(t,e){this.playerCore=t,this.gameState=e,this.playerGameboardComponent=new L(this.playerCore.player,this.gameState),this.opponentGameboardComponent=new $(this.playerCore.opponent,this.gameState),this.mainContainerTwo=o("section",["main-container","parabellum"],{id:"main-container-two"})}get element(){return this.mainContainerTwo}get playerGameboard(){return this.playerGameboardComponent}get opponentGameboard(){return this.opponentGameboardComponent}render(t){this.playerGameboardComponent.render(this.mainContainerTwo),this.opponentGameboardComponent.render(this.mainContainerTwo),t.appendChild(this.mainContainerTwo)}}function D(t,e){if(!t)throw new Error("Invalid Command: `gameboardController` is required to randomize the gameboard.");if(!e)throw new Error("Invalid Command: `fleet` is required to randomize the gameboard.");const i=(e,r,o,s=0)=>{if(s>100)throw new Error(`Max recursion depth exceeded when placing the ${e.type}.`);const l=((t,e)=>{const n=e-t;return[a(0,n),a(0,n)]})(e.length,o);return((e,i,r)=>{const a={shipLength:i.length,orientation:r},o=t.getValidPositions(a),[s,l]=e,h="horizontal"===r,d=h?l:s;return o[h?`row-${d}`:`column-${d}`].some((t=>n(t.bow,e)))})(l,e,r)?l:i(e,r,o,s+1)};for(const n in e){if(!A(n))throw new Error(`Invalid Type: "${n}" doesn't conform to "ShipType".`);const r=e[n],a=Math.random()<.5?"horizontal":"vertical",o={ship:r,coordinates:i(r,a,10),orientation:a};t.placePiece(o)}}class R{shipShufflerButtonTextContent="Shuffle";buttonClass="ship-shuffler-button";#e=!1;shuffleShips=()=>{this.randomizeGameboard(),this.updateGameboard()};constructor(t,e,n,i){this.id=t,this.gameboardController=e,this.fleet=n,this.gameState=i,this.shipShufflerButton=this.createshipShufflerButton(`${this.id}-${this.buttonClass}`,[this.buttonClass]),this.shipShufflerButton.classList.add(this.buttonClass),this.shipShufflerButton.textContent=this.shipShufflerButtonTextContent,this.toggleEventListener(),this.shipShufflerButtonContainer=this.createshipShufflerButtonContainer(),this.shipShufflerButtonContainer.appendChild(this.shipShufflerButton)}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.shipShufflerButtonContainer)}toggleEventListener(){!0===this.#e?(this.shipShufflerButton.removeEventListener("click",this.shuffleShips),this.#e=!1):(this.shipShufflerButton.addEventListener("click",this.shuffleShips),this.#e=!0)}createshipShufflerButton(t,e){return o("button",[...e],{id:t})}createshipShufflerButtonContainer(){return o("div",["ship-shuffler-button-container"])}randomizeGameboard(){this.gameboardController.removeAllPieces(this.fleet),D(this.gameboardController,this.fleet)}updateGameboard(){this.gameState.eventBus.emit("refreshGameboard")}getId(){return this.id}}class x{readyUpButtonTextContent="Ready Up";buttonId="ready-up-button";#e=!1;readyUp=()=>{this.anchorShips(),this.removeParabellumButtonListeners(),this.transitionToBellum()};constructor(t,e,n,i){this.playerGameboardComponent=t,this.shipShufflerButton=e,this.instructionsButton=n,this.transitionToNextPhase=i,this.readyUpButton=this.createReadyUpButton(this.buttonId),this.toggleEventListener(),this.readyUpButtonContainer=this.createReadyUpButtonContainer(),this.readyUpButtonContainer.appendChild(this.readyUpButton)}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.readyUpButtonContainer)}toggleEventListener(){!0===this.#e?(this.readyUpButton.removeEventListener("click",this.readyUp),this.#e=!1):(this.readyUpButton.addEventListener("click",this.readyUp),this.#e=!0)}anchorShips(){this.playerGameboardComponent.toggleParabellumListeners(),this.playerGameboardComponent.toggleShipsDraggable(),this.playerGameboardComponent.toggleShipAdriftClass()}createReadyUpButton(t){const e=o("span",["ready-up-button-text"]);e.textContent=this.readyUpButtonTextContent;const n=o("img",["inactive-ready-up-button"],{alt:"Ready Up (Inactive)",src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-inactive.svg"}),i=o("img",["active-ready-up-button"],{alt:"Ready Up (Active)",src:"https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/assets/images/big-red-button/btn-active.svg"}),r=o("button",[],{id:t});return r.append(i,n,e),r}createReadyUpButtonContainer(){return o("div",["ready-up-button-container"])}removeParabellumButtonListeners(){this.shipShufflerButton.toggleEventListener(),this.instructionsButton.toggleEventListener(),this.toggleEventListener()}transitionToBellum(){this.transitionToNextPhase()}}class O{scoreBoardID="score-board";hitPointMap={player:{battleship:[],carrier:[],cruiser:[],destroyer:[],patrolBoat:[],submarine:[]},opponent:{battleship:[],carrier:[],cruiser:[],destroyer:[],patrolBoat:[],submarine:[]}};constructor(t,e,n){this.gameState=t,this.fleets=e,this.shipTypes=n,this.fleetStatusContainers=this.createFleetStatusContainers(this.fleets),this.shipLabelList=this.createShipLabelList(this.shipTypes),this.scoreBoardContainer=this.createScoreBoardContainer(),this.gameState.eventBus.on("markNextHitPoint",this.markNextHitPoint)}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);const[e,n]=this.fleetStatusContainers;this.scoreBoardContainer.append(e,this.shipLabelList,n),t.appendChild(this.scoreBoardContainer)}createHitPointContainersFragment(t,e){const n=new DocumentFragment;return Object.values(e).forEach((e=>{const i=o("div",["hit-point-container",`${e.type}-hit-point-container`],{id:`${t}-${e.type}-hit-point-container`});for(let n=0;n<e.length;n++){const n=o("div",["hit-point",`${e.type}-hit-point`,`${t}-${e.type}-hit-point`]);i.append(n)}this.storeShipHitPointData(i,t,e.type),n.appendChild(i)})),n}createFleetStatusContainer(t,e){const n=o("h3",["fleet-status-heading"],{id:`${t}-fleet-status-heading`});n.textContent=i(t);const r=this.createHitPointContainersFragment(t,e),a=o("div",["fleet-status-container"],{id:`${t}-fleet-status-container`});return a.append(n,r),a}createFleetStatusContainers(t){return Object.entries(t).map((([t,e])=>{if("string"!=typeof(n=t)||"player"!==n&&"opponent"!==n)throw new Error("Invalid player type.");var n;return this.createFleetStatusContainer(t,e)}))}createScoreBoardContainer(){return o("div",[],{id:`${this.scoreBoardID}-container`})}createShipLabelList(t){const e=new DocumentFragment;t.map((t=>{const n=o("li",["ship-hit-point-label"],{id:`${t}-hit-point-label`});n.textContent=t,e.appendChild(n)}));const n=o("div",[],{id:"ship-label-list"});return n.appendChild(e),n}markNextHitPoint=t=>{const{playerType:e,shipType:n}=t;if(!this.hitPointMap[e]?.[n])throw new Error(`Missing hit-point data for: ${e} - ${n}.`);const i=this.hitPointMap[e][n].pop();i?.classList.add("hit")};storeShipHitPointData(t,e,n){const i=Array.from(t.children).reverse();this.hitPointMap[e][n]=i.filter(S)}}function I(t,e){const n=o("div",["parabellum"],{id:"main-container-three-parabellum"});t.render(n),e.render(n);const i=new DocumentFragment;return i.appendChild(n),i}function F(t){const e=o("div",["bellum"],{id:"main-container-three-bellum"});t.render(e);const n=new DocumentFragment;return n.appendChild(e),n}function G(){const t=o("button",["end-game-button"],{id:"play-again-button"});t.textContent="Play Again",t.addEventListener("click",ot.pressStart);const e=o("button",["end-game-button"],{id:"find-new-opponent-button"});e.textContent="Find New Opponent",e.setAttribute("disabled","true");const n=o("div",[],{id:"end-game-button-container"});n.append(t,e);const i=o("div",["post-bellum"],{id:"main-container-three-post-bellum"});i.append(n);const r=new DocumentFragment;return r.appendChild(i),r}const N={[f.Carrier]:Symbol("CA"),[f.Battleship]:Symbol("BS"),[f.Cruiser]:Symbol("CR"),[f.Submarine]:Symbol("SB"),[f.Destroyer]:Symbol("DD"),[f.PatrolBoat]:Symbol("PB")},M={"battleship-1990":4,"battleship-2002":4,"carrier-1990":5,"carrier-2002":5,"cruiser-1990":void 0,"cruiser-2002":3,"destroyer-1990":3,"destroyer-2002":2,"patrolBoat-1990":2,"patrolBoat-2002":2,"submarine-1990":3,"submarine-2002":3};class z{seaworthy=!0;rotationalPivotConfigurations={transientAngleOfRotation:null,coordinatesArray:null,orientation:null};currentplacementConfigurations={coordinatesArray:null,orientation:null};isPlaced=()=>null!==this.currentplacementConfigurations.coordinatesArray;_hitCounter=0;constructor(t,e=2002){this.type=t,this.version=e,this.symbol=N[t];const n=`${t}-${e}`,i=M[n];if(void 0===i)throw new Error(`Invalid Command: ship type/version combination: ${n}.`);this.length=i}hit=()=>this.isSeaworthy()?(this._hitCounter++,`Hit registered. Hit count: ${this.hitCounter}.`):"This ship has already perished.";isSeaworthy=()=>this.hitCounter<this.length;resetConfigurations=t=>{const e={coordinatesArray:null,orientation:null};this.currentplacementConfigurations=e,!0===t&&(this.rotationalPivotConfigurations={...e,transientAngleOfRotation:null})};get hitCounter(){return this._hitCounter}}class U{constructor(t,e){this.fleet=t,this.version=e}static createFleet(t){const e={};for(const[n,i]of Object.entries(t))i&&A(n)&&(e[n]=new z(i.type,i.version));return e}static createHasbroFleet(){return new U(U.createFleet({carrier:{type:f.Carrier,version:2002},battleship:{type:f.Battleship,version:2002},submarine:{type:f.Submarine,version:2002},cruiser:{type:f.Cruiser,version:2002},destroyer:{type:f.Destroyer,version:2002},patrolBoat:{type:f.PatrolBoat,version:2002}}),2002)}static createMBFleet(){return new U(U.createFleet({carrier:{type:f.Carrier,version:1990},battleship:{type:f.Battleship,version:1990},submarine:{type:f.Submarine,version:1990},destroyer:{type:f.Destroyer,version:1990},patrolBoat:{type:f.PatrolBoat,version:1990}}),1990)}static shipTypes=t=>(t=>1990===t?[f.Carrier,f.Battleship,f.Submarine,f.Destroyer,f.PatrolBoat]:[f.Carrier,f.Battleship,f.Submarine,f.Cruiser,f.Destroyer,f.PatrolBoat])(t);getShip(t){const e=this.fleet[t];if(!e)throw new Error(`Invalid Command: Ship of type ${t} not found in fleet.`);return e}}class V{buttonId="instructions-button";buttonImageId="instructions-image";#e=!1;constructor(t){this.instructionsLightboxController=t,this.instructionsButton=this.createInstructionsButton(),this.instructionsButtonContainer=this.createInstructionsButtonContainer(),this.instructionsButtonContainer.appendChild(this.instructionsButton),this.openInstructionsDialog=()=>this.instructionsLightboxController.openLightbox(),this.toggleEventListener()}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.instructionsButtonContainer)}toggleEventListener(){!0===this.#e?(this.instructionsButton.removeEventListener("click",this.openInstructionsDialog),this.#e=!1):(this.instructionsButton.addEventListener("click",this.openInstructionsDialog),this.#e=!0)}createInstructionsButton(){return o("button",[],{id:this.buttonId,type:"button"})}createInstructionsButtonContainer(){return o("div",[],{id:`${this.buttonId}-container`})}}class H{mainElement=o("main");constructor(t,e,n,i){this.playerCore=t,this.instructionsLightboxController=e,this.cycloneSitRepScroller=n,this.gameState=i,this.instructionsButton=new V(this.instructionsLightboxController),this.mainContainerOne=this.createMainContainerOne(),this.mainContainerTwo=new k(this.playerCore,this.gameState),this.mainContainerThree=this.createMainContainerThree(),this.renderMainContainers()}createMainContainerOne(){return function(t,e,n){const i=o("h3",[],{id:"victory-banner"});new m(i,t,"updateVictoryBannerText").init();const r={parabellum:d(e),bellum:c(n),postBellum:u(i)};return new p("section",r,"parabellum",["main-container"],{id:"main-container-one"})}(this.gameState.eventBus,this.instructionsButton,this.cycloneSitRepScroller)}createMainContainerThree(){return function(t,e,n,i){const r=i.player.gameboardController,a={player:i.player.fleetBuilder.fleet,opponent:i.opponent.fleetBuilder.fleet},o=U.shipTypes(n.version),s=new R(t.id,r,a.player,n),l=new x(t,s,e,n.transitionToNextPhase),h=new O(n,a,o),d={parabellum:I(s,l),bellum:F(h),postBellum:G()};return new p("section",d,"parabellum",["main-container"],{id:"main-container-three"})}(this.mainContainerTwo.playerGameboard,this.instructionsButton,this.gameState,this.playerCore)}renderMainContainers(){this.mainContainerOne.render(this.mainElement),this.mainContainerTwo.render(this.mainElement),this.mainContainerThree.render(this.mainElement)}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.mainElement)}}var _=JSON.parse('[{"textContent":"Drag & drop to reposition"},{"textContent":"Tap to rotate"},{"textContent":"Lock positions & ready up"}]');class j{static dialogId="instructions-dialog";static closeButtonId="instructions-dialog-close-button";constructor(){this.instructionsDialogCloseButton=this.createInstructionsDialogCloseButton(),this.instructionsDialog=this.createInstructionsDialog(this.instructionsDialogCloseButton)}get element(){return this.instructionsDialog}get closeButton(){return this.instructionsDialogCloseButton}createInstructionsDialogCloseButton(){const t=o("button",["close-button"],{id:j.closeButtonId,type:"button","aria-label":"Close Instructions Dialog"});return t.textContent="X",t}createInstructionsDialog(t){const e=o("h3",["tertiary-heading"],{id:"instructions-dialog-heading"});e.textContent="Deploy your Bips:";const n=((t,e,n={})=>{if(!t.length)throw new Error("The listItemTextContentArray is empty.");if(!e)throw new Error("You must identify your list items.");const i=new DocumentFragment;return t.forEach(((t,r)=>{const a=o("li",[`${e}-list-item`],{id:`${e}-list-item-${++r}`,...n});a.textContent=t.textContent,i.appendChild(a)})),i})(_,"instructions"),i=o("ul",["instructions-list"],{id:"instructions-list"});i.appendChild(n);const r=o("div",[],{id:"unanchored-ship-example"}),a=o("p",[],{id:"unanchored-ship-text"});a.textContent="= Bips adrift";const s=o("div",[],{id:"visual-feedback-key-container"});s.append(r,a);const l=o("div",[],{id:"instructions-content"});l.append(e,i,s);const h=o("dialog",[],{id:j.dialogId});return h.append(t,l),h}render(t){if(!t)throw new Error(`Target element not found. Recieved ${t}.`);t.appendChild(this.instructionsDialog)}}class K{static MESSAGES={TURN:{PLAYER:"Waiting for your attack...",OPPONENT:"Your opponent is attacking..."},ATTACK:{HIT:(t,e,n)=>`${t} hit ${e} ${n}!`,SUNK:(t,e,n)=>`${t} sunk ${e} ${n}!`,MISS:t=>`${t} missed!`}};currentPlayer=null;currentSitRep=null;nextSitRep="";#n="turn";constructor(){const{container:t,current:e,next:n}=this.getControlledSitRepElements();this.sitRepContainer=t,this.sitRepTextElements={current:e,next:n}}get element(){return this.sitRepContainer}initialize=t=>{this.currentPlayer=t,this.setInitialTextContent(t)};setAndScrollToNextSitRep=async t=>{this.nextSitRep=t?this.getNextSitRep(t):this.getNextSitRep(),this.sitRepTextElements.next.textContent=this.nextSitRep,this.sitRepContainer.classList.add("scrolling"),await l(this.sitRepContainer),this.resetSitRepContainer(),await s(500)};getAttackSitRep=(t,e)=>{const{hit:n,isSunk:i,type:r}=e,a="player"===t?"You":"Your opponent",o="player"===t?"their":"your";return n&&r?i?K.MESSAGES.ATTACK.SUNK(a,o,r):K.MESSAGES.ATTACK.HIT(a,o,r):K.MESSAGES.ATTACK.MISS(a)};getNextSitRep=t=>{if("attack"===this.#n&&this.toggleCurrentPlayer(),this.toggleSitRepType(),null===this.currentPlayer)throw new Error("`currentPlayer` cannot be null. Ensure it is assigned a valid `PlayerType` before retrieving the next sit rep.");return t?this.getAttackSitRep(this.currentPlayer,t):this.getTurnSitRep(this.currentPlayer)};getTurnSitRep=t=>"player"===t?K.MESSAGES.TURN.PLAYER:K.MESSAGES.TURN.OPPONENT;resetSitRepContainer=()=>{const{current:t,next:e}=this.sitRepTextElements;this.sitRepContainer.classList.remove("scrolling"),this.currentSitRep=this.nextSitRep,t.textContent=this.currentSitRep,this.nextSitRep="",e.textContent=this.nextSitRep,this.sitRepContainer.removeEventListener("transitionend",this.resetSitRepContainer)};setInitialTextContent=t=>{const e="player"===t?K.MESSAGES.TURN.PLAYER:K.MESSAGES.TURN.OPPONENT;this.currentSitRep=e,this.sitRepTextElements.current.textContent=e};toggleCurrentPlayer=()=>{this.currentPlayer="player"===this.currentPlayer?"opponent":"player"};toggleSitRepType=()=>{this.#n="turn"===this.#n?"attack":"turn"};getControlledSitRepElements=()=>{const t=o("div",[],{id:"sit-rep-container"});let e=null,n=null,i=null,r=null;return["current","next"].forEach((t=>{const a=o("div",["sit-rep-text-content"],{id:`${t}-sit-rep-text-content`});"current"===t?e=a:n=a;const s=o("div",["sit-rep-slot"],{id:`${t}-update-container`});"current"===t?i=s:r=s,s.appendChild(a)})),t.append(r,i),{container:t,current:e,next:n}}}class q{FOOTNOTE_TEXT_CONTENT=`© ${(new Date).getFullYear()} Time Capsule NY, LLC. All Rights Reserved`;CYCLONE_STUDIOS_LOGO="https://cyclone-studios.s3.us-east-2.amazonaws.com/s3_cyclone-studios/alphaLogos/cycloneStudios/cycloneStudios.svg";id="cyclone-footer";element=o("footer",[],{id:this.id});#i=null;constructor(){this.element.appendChild(this.generateContent())}static render(t){const e=new q;return e.mount(t),e}generateContent(){const t=o("p",[],{id:"footnote"});t.textContent=this.FOOTNOTE_TEXT_CONTENT;const e=o("p",[],{id:"powered-by-text"});e.textContent="Powered By";const n=o("img",[],{id:"cyclone-studios-logo",src:this.CYCLONE_STUDIOS_LOGO,alt:"Cyclone Studios Logo"}),i=o("picture",[],{id:"cyclone-studios-picture"});i.appendChild(n);const r=o("div",[],{id:"cyclone-studios-container"});r.append(e,i);const a=document.createDocumentFragment();return a.append(t,r),a}mount(t){if(!this.#i){if(!t)throw new Error("Target element not found.");this.#i=t,t.appendChild(this.element)}}unmount(){this.#i?(this.#i.removeChild(this.element),this.#i=null):console.warn("Note to DEV: The Cyclone Studios footer isn't mounted dumbass!")}}class Y{cycloneSitRepScroller=new K;header=function(){const t=function(){const t=o("a",["heading-link"],{id:"heading-link",href:"https://johnkeyscloud.github.io/battleship/"});t.textContent="ShattleBip";const e=o("h1",["main-heading"]);e.appendChild(t);const n=function(t="50px",e="#FFF",n="johnKeysCloud",i){const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M8.20003216,0 C3.67186256,0 0,3.67233045 0,8.2025137 C0,11.8266603 2.34955472,14.9012922 5.60770169,15.9859115 C6.01749428,16.0618219 6.16798309,15.8079721 6.16798309,15.5913056 C6.16798309,15.3957396 6.16033003,14.7495356 6.15685721,14.064154 C3.87553694,14.5603383 3.3941657,13.0963596 3.3941657,13.0963596 C3.02115925,12.1482506 2.48370842,11.896202 2.48370842,11.896202 C1.7397535,11.3870871 2.53978801,11.3975087 2.53978801,11.3975087 C3.36323189,11.4554066 3.79681972,12.242817 3.79681972,12.242817 C4.52816959,13.4968196 5.71510182,13.1342505 6.18303197,12.9247247 C6.25660428,12.3945093 6.46915364,12.0327122 6.70363321,11.8278826 C4.88233278,11.6204154 2.96765212,10.9170854 2.96765212,7.77413412 C2.96765212,6.87864774 3.28798748,6.14688355 3.81257603,5.57247278 C3.72742766,5.36584187 3.44677247,4.53159853 3.89200067,3.40175461 C3.89200067,3.40175461 4.58058343,3.18129256 6.14759636,4.24255971 C6.80164386,4.06076054 7.50315322,3.96966796 8.20003216,3.96658007 C8.89691109,3.96966796 9.59893494,4.06076054 10.2542687,4.24255971 C11.8194166,3.18129256 12.5070347,3.40175461 12.5070347,3.40175461 C12.9533562,4.53159853 12.6725723,5.36584187 12.587424,5.57247278 C13.1131701,6.14688355 13.4313189,6.87858341 13.4313189,7.77413412 C13.4313189,10.9245478 11.5130368,11.6182925 9.68710595,11.8213208 C9.98120223,12.0758783 10.2432714,12.5750862 10.2432714,13.3403025 C10.2432714,14.4377879 10.2337533,15.3211158 10.2337533,15.5913056 C10.2337533,15.8095804 10.3813481,16.0653602 10.7970574,15.9848178 C14.0534036,14.8989763 16.4,11.825438 16.4,8.2025137 C16.4,3.67233045 12.7286519,0 8.20003216,0");const a=document.createElementNS("http://www.w3.org/2000/svg","path");h(a,{d:"M3.07518929,11.6824029 C3.05731167,11.723257 2.99359073,11.7355197 2.93568001,11.7075092 C2.87662002,11.6806603 2.84341872,11.6248974 2.86257332,11.5838496 C2.88013169,11.5417693 2.94385264,11.5300229 3.00278493,11.5582916 C3.06197262,11.5850759 3.09568471,11.6413552 3.07518929,11.6824029 M3.47564797,12.0435714 C3.436828,12.0799722 3.36091196,12.0630626 3.30938611,12.0055571 C3.25613634,11.9481806 3.24617596,11.8715065 3.28557057,11.8345248 C3.32560367,11.7981885 3.39922115,11.8151627 3.45259861,11.8726037 C3.50584838,11.9306256 3.51619186,12.0068479 3.47558413,12.0436359 M3.75038868,12.5056811 C3.70045904,12.5407266 3.61886048,12.5078755 3.5684839,12.4346866 C3.51861811,12.3615623 3.51861811,12.2737872 3.56956933,12.2386127 C3.62013745,12.2034381 3.70045904,12.235063 3.75153796,12.307671 C3.8013399,12.3820861 3.8013399,12.4698612 3.75032483,12.5057457 M4.2149514,13.0409152 C4.1703212,13.0906114 4.07531442,13.0773161 4.0057194,13.0094195 C3.93459201,12.9430719 3.91473508,12.8489074 3.95949298,12.7991467 C4.00463397,12.7493214 4.10021539,12.7633267 4.1703212,12.8306424 C4.24100164,12.8968609 4.26258248,12.9917354 4.21501525,13.0409152 M4.81538402,13.2216286 C4.79578249,13.2860399 4.70422354,13.3153413 4.6120261,13.2879762 C4.51995636,13.259772 4.45968324,13.1842596 4.4782632,13.1191383 C4.49741779,13.0542751 4.58935983,13.0237475 4.68225961,13.0530489 C4.77420165,13.081124 4.83460247,13.1560554 4.81544787,13.2216286 M5.49881989,13.2982381 C5.50111844,13.3661347 5.42290385,13.422414 5.32610931,13.4236402 C5.22874013,13.4257701 5.15001476,13.3708461 5.14899318,13.3041113 C5.14899318,13.2355693 5.22542,13.1798063 5.32272533,13.1781928 C5.41951987,13.1762566 5.49881989,13.2307933 5.49881989,13.2982381 M6.17012451,13.2722283 C6.18174496,13.3384468 6.11444849,13.4064725 6.01835628,13.4245438 C5.92386029,13.4419697 5.83638766,13.4011156 5.82432026,13.3354779 C5.81257211,13.2675814 5.88114555,13.1996203 5.97545,13.1820007 C6.07173375,13.1650911 6.15786557,13.2049126 6.17012451,13.2722283","fill-rule":"nonzero"});const o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("fill",e),o.append(r,a);const s=document.createElementNS("http://www.w3.org/2000/svg","g");h(s,{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}),s.appendChild(o);const l=document.createElementNS("http://www.w3.org/2000/svg","svg");h(l,{viewBox:"0 0 17 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:t,height:t}),l.classList.add("git-hub-svg"),l.appendChild(s);const d=document.createElement("a");return d.classList.add("git-hub-logo-link"),h(d,{href:i?`https://github.com/${n}/${i}`:`https://github.com/${n}`,rel:"noopener noreferrer",target:"_blank",type:"button","aria-label":"GitHub profile link"}),d.appendChild(l),d}(),i=o("nav");return i.append(e,n),i}(),e=o("header");return e.appendChild(t),e}();instructionsDialog=new j;constructor(t,n,i){if(this.gameState=t,this.playerCore=n,this.billowBot=i,!document)throw new Error("Fuck!");const r=document.getElementById("content");if(!r)throw new Error("Shit!");this.content=r,this.instructionsLightboxController=new e(this.instructionsDialog.element,"instructions-dialog-close-button"),this.mainComponent=new H(this.playerCore,this.instructionsLightboxController,this.cycloneSitRepScroller,this.gameState),this.footer=(new q).element,this.seatDomEventsOnBus()}get isMounted(){return!!this.content.firstChild}unmount=()=>{this.content.innerHTML=""};handlePhaseChangeUpdates=async t=>{switch(this.updatePhaseOfWarColor(t.currentGamePhase),await this.updateGameboardContainerState(t),t.currentGamePhase){case"bellum":this.deployForCombat(t);break;case"postBellum":break;default:throw new Error(`${t.currentGamePhase} is not a valid phase of war.`)}};initializeSitRepScroller=t=>{this.cycloneSitRepScroller.element?this.cycloneSitRepScroller.initialize(t):console.error("CycloneSitRepScroller element is null or undefined!")};async deployForCombat(t){if(this.gameState.setInitialPlayer(),!this.gameState.currentPlayer)throw new Error("Current player must be set in game state.");this.initializeSitRepScroller(this.gameState.currentPlayer),"player"===t.currentPlayer?this.readyPlayerOne():"opponent"===t.currentPlayer&&this.billowBot?await this.billowBot.attack():"opponent"===t.currentPlayer&&this.billowBot}readyPlayerOne=async()=>{await this.updateUIActiveGameboard(),this.mainComponent.mainContainerTwo.opponentGameboard.toggleBellumListeners(T.active),this.gameState.eventBus.emit("togglePlayerGameboardControls",T.inactive),this.gameState.eventBus.emit("toggleOpponentGameboardControls",T.active)};render=()=>{this.isMounted&&this.unmount(),this.content.appendChild(this.header),this.mainComponent.render(this.content),this.content.appendChild(this.footer),this.instructionsDialog.render(document.body)};seatDomEventsOnBus=()=>{this.gameState.eventBus.on("transitionToNextPhase",this.transitionToNextPhase),this.gameState.eventBus.on("updateUIActiveGameboard",this.updateUIActiveGameboard),this.gameState.eventBus.on("setAndScrollToNextSitRep",this.cycloneSitRepScroller.setAndScrollToNextSitRep),this.gameState.eventBus.on("unmountDOM",this.unmount)};transitionToNextPhase=async()=>{this.mainComponent.mainContainerOne.swapByOrder(),this.mainComponent.mainContainerThree.swapByOrder(),await this.handlePhaseChangeUpdates(this.gameState)};updateGameboardContainerState=async t=>{const e=this.mainComponent.mainContainerTwo.element;e.classList.toggle("parabellum","parabellum"===t.currentGamePhase),e.classList.toggle("bellum","bellum"===t.currentGamePhase),e.classList.toggle("post-bellum","postBellum"===t.currentGamePhase)};updatePhaseOfWarColor(t){document.documentElement.style.setProperty("--phase-of-war-color",`var(--${t}-color)`)}updateUIActiveGameboard=async()=>{const t=this.mainComponent.mainContainerTwo.element;t.classList.toggle("player-turn","player"===this.gameState.currentPlayer),await l(t,1e3)}}class W{currentGamePhase="parabellum";currentPlayer=null;static getInitialPlayer(){return Math.random()>.5?"player":"opponent"}endGamePlayerShipPositions={};constructor(t,e,n,i){this.playerCore=t,this.eventBus=e,this.isMultiplayer=n,this.version=i,e.on("resetGame",this.resetGame)}resetGame=()=>{ot.pressStart()};setInitialPlayer=()=>{this.currentPlayer=W.getInitialPlayer()};toggleGameboardControls=()=>{const t="player"===this.currentPlayer;t&&this.eventBus.emit("toggleOpponentGameboardControls",T.active),this.eventBus.emit("togglePlayerGameboardControls",t?T.inactive:T.active)};togglePlayerTurn=async()=>{this.currentPlayer="player"===this.currentPlayer?"opponent":"player",this.eventBus.emit("setAndScrollToNextSitRep"),await this.updateUIActiveGameboard(),this.toggleGameboardControls(),this.isMultiplayer||"opponent"!==this.currentPlayer||await this.eventBus.emit("billowAttack")};transitionToNextPhase=()=>{switch(this.currentGamePhase){case"parabellum":this.currentGamePhase="bellum";break;case"bellum":this.currentGamePhase="postBellum";break;case"postBellum":this.currentGamePhase="parabellum"}this.eventBus.emit("transitionToNextPhase")};updateUIActiveGameboard=async()=>{await this.eventBus.emit("updateUIActiveGameboard")}}class X{events={};on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((t=>t!==e)))}async emit(t,e){return this.events[t]?await Promise.all(this.events[t].map((t=>t(e)))):[]}}class J{#r;#a=null;#o=null;#s=500;constructor(t){this.gameState=t,this.#r=new Set,this.populatepossibleAttacksSet(),this.gameState.eventBus.on("billowAttack",this.attack)}attack=async()=>{try{const t=await this.determineNextTarget(),[e]=await this.gameState.eventBus.emit("receiveBillowAttack",t);return e.hit&&this.rememberLastTargetHit(t),e}catch(t){throw console.error("Error in BillowBot.attack:",t),t}};getNextAttackCoordinates(t,e){const n=this.getRandomCoordinates();return this.#a=n,n}async determineNextTarget(){return await this.ponder(this.#s),this.getNextAttackCoordinates(this.#a,this.#o)}ponder(t){return new Promise((e=>setTimeout(e,t)))}populatepossibleAttacksSet(){for(let t=0;t<10;t++)for(let e=0;e<10;e++)this.#r.add(`${t},${e}`)}getRandomCoordinates(){const t=Array.from(this.#r)[Math.floor(Math.random()*this.#r.size)];this.#r.delete(t);const e=t.split(",").map(Number);if(!b(e))throw new Error("Invalid coordinates");return e}getSmartCoordinates(t){if(!t)throw new Error("Last attack coordinates are required");const[e,n]=t;return[0,0]}rememberLastTargetHit(t){this.#a=t,this.#o=!0}}class Q{static vacant=Symbol("VC");_boardSize=10;_fillValue=Q.vacant;constructor(){this._board=Array.from({length:this._boardSize},(()=>Array(this._boardSize).fill(this._fillValue)))}get board(){return this._board}get boardSize(){return this._boardSize}get fillValue(){return this._fillValue}}function Z([t,e],n,i){return{bow:[t,e],stern:"horizontal"===n?[t+i-1,e]:[t,e+i-1]}}const tt=(t,e)=>t>=0&&t<e,et=(t,e)=>t.every((t=>tt(t,e))),nt=(t,e)=>n(t.bow,e.bow)&&n(t.stern,e.stern);class it{constructor(t){this.playerState=t}getValidPositions({orientation:t,shipLength:e}){return function({shipLength:t,orientation:e,battleshipBoardBuilder:n}){const i=(t,e,n)=>"horizontal"===e?n[t]:n.map((e=>e[t])),r=(t,e,i,r)=>{let a=0,o=[];for(let s=0;s<t.length;s++)if(t[s]===n.fillValue){if(a++,a>=r){const t=e?[s-(r-1),i]:[i,s-(r-1)],n=e?[s,i]:[i,s];o.push({bow:t,stern:n})}}else a=0;return o},a={},o=n.board,s="horizontal"===e;for(let n=0;n<o.length;n++){const l=r(i(n,e,o),s,n,t);a[s?`row-${n}`:`column-${n}`]=l}return a}({orientation:t,shipLength:e,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardController:this})}getAllValidBowCoordinates(t,e){let n=new Set;const i=this.getValidPositions({orientation:t,shipLength:e});for(const t of Object.values(i)){if(r=t,!Array.isArray(r)||!r.every((t=>P(t))))throw new Error(`Expected each value of validPositions to be an array of IPosition objects, but received: ${typeof t}.`);t.forEach((t=>n.add(t.bow)))}var r;return n}movePiece(t,e){if(!t.isPlaced())return void console.warn(`Invalid Command: The ${t.type} has not been placed.`);const n=t.currentplacementConfigurations.orientation,i=Z(e,n,t.length);if(r=i,a=this.playerState.gameboardBuilder.boardSize,!et(r.bow,a)||!et(r.stern,a))return void console.warn(`Invalid Command: Position - Bow: [${i.bow}] & Stern: [${i.stern}] is out of bounds for the ${t.type}.`);var r,a;const o=this.getValidPositions({orientation:n,shipLength:t.length}),s="horizontal"===n,[l,h]=e,d=function(t,e){return e?`row-${t}`:`column-${t}`}(s?h:l,s),c=o[d].some((t=>nt(t,i)));if(c){const i={ship:t,coordinates:e,orientation:n},r=!0;this.relocateShip(t,i,r)}else console.warn(`Invalid Command: Position - Bow: [${i.bow}] & Stern: [${i.stern}] is unavailable for the ${t.type}.`)}placePiece({ship:t,coordinates:e,orientation:n}){!function({ship:t,coordinates:e,orientation:n,battleshipBoardController:i,battleshipBoardBuilder:r,battleshipBoardRepository:a}){const o=t.length,[s,l]=e,h="horizontal"===n;if(!tt((h?s:l)+o-1,r.boardSize)){const i=`Invalid Command: The ship placement attempt with the following configurations is out of bounds - Coordinates: ${e}, Length: ${t.length}, Orientation: ${n}.`;throw new Error(i)}if(t.isPlaced())return void console.warn(`Invalid Command: The ${t.type} has already been placed.`);const d=Z(e,n,o);if(!((t,e,n)=>i.getValidPositions(e)[n].some((e=>nt(t,e))))(d,{shipLength:o,orientation:n},h?`row-${l}`:`column-${s}`)){const t=`Invalid Command: "${JSON.stringify(d)}" is unavailable for ship with Size: ${o} and Orientation: ${n}.`;throw new Error(t)}{const e=(t,e)=>{const n=[],[i,r]=t.bow,[a,o]=t.stern,s=e?r:i,l=e?a:o;for(let t=e?i:r;t<=l;t++)n.push(e?[t,s]:[s,t]);return n},i=(t,e)=>{const n=r.board,i=t.symbol;e.forEach((t=>{const[e,r]=t;n[r][e]=i}))},o=(t,e,n)=>{const i={coordinatesArray:e,orientation:n};t.currentplacementConfigurations=i,Object.values(t.rotationalPivotConfigurations).every((t=>null===t))&&(t.rotationalPivotConfigurations={...i,transientAngleOfRotation:y.Degrees0})},s=(t,e)=>{a.addShipToFleetCoordinates(t,e)},l=e(d,h);i(t,l),o(t,l,n),s(t.type,l)}}({ship:t,coordinates:e,orientation:n,battleshipBoardController:this,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardRepository:this.playerState.gameboardRepository}),this.setFleetRotatedPlacePieceParams(this.playerState.fleetBuilder.fleet)}prettyPrint(){console.table(this.playerState.gameboardBuilder.board.map((t=>t.map((t=>"VC"===t.description?null:t.description)))))}receiveAttack(t){const e=this.getShipAt(t);if(null===e)return{hit:!1};e.hit();const n={hit:!0,isSunk:!e.isSeaworthy(),type:e.type};if(!A(n.type))throw new Error("Invalid ship type");return n.hit&&n.isSunk&&this.playerState.gameboardRepository.addSunkenShip(n.type),n}removePiece(t,e=!0){this.isShipValidForRemoval(t)&&((t=>{t.forEach((([t,e])=>{this.playerState.gameboardBuilder.board[e][t]=this.playerState.gameboardBuilder.fillValue}))})(t.currentplacementConfigurations.coordinatesArray),(t=>{this.playerState.gameboardRepository.nullifyShipCoordinatesValue(t)})(t.type),((t,e)=>{e&&this.playerState.gameboardRepository.nullifyShipValidRotationalParams(t.type),t.resetConfigurations(e)})(t,e))}removeAllPieces(t){if(Object.keys(t).length)for(const e of Object.values(t))this.removePiece(e);else console.error("Invalid Command: No ships to remove - Fleet is empty or uninitialized.")}rotatePiece(t){const e=(t,e)=>{const n=t.rotationalPivotConfigurations.transientAngleOfRotation,i=(t=>Array.from(t.keys()).pop()??y.Degrees0)(e);if(n===i){const e=t.rotationalPivotConfigurations.coordinatesArray[0],n=t.rotationalPivotConfigurations.orientation;return t.rotationalPivotConfigurations.transientAngleOfRotation=y.Degrees0,{ship:t,coordinates:e,orientation:n}}const r=((t,e)=>{if(null==e)throw new Error("Current angle doesn't exist");return Array.from(t.keys()).find((t=>t>e))??y.Degrees0})(e,n),a=e.get(r);return t.rotationalPivotConfigurations.transientAngleOfRotation=r,{ship:t,coordinates:a.coordinates,orientation:a.orientation}},n=this.playerState.gameboardRepository.inBoundRotationalPlacePieceForFleet[t.type],i=t.rotationalPivotConfigurations.transientAngleOfRotation,r=(n=>{let r=e(t,n);for(;t.rotationalPivotConfigurations.transientAngleOfRotation!==i&&!this.isRotatedPositionValid(r.coordinates,r.orientation,t.rotationalPivotConfigurations.transientAngleOfRotation,t.length);)r=e(t,n);return r})(n);t.rotationalPivotConfigurations.transientAngleOfRotation!==i?this.relocateShip(t,r,!1):console.warn("No valid rotational position found.")}areCoordinatesVacant(t){const[e,n]=t;return this.playerState.gameboardBuilder.board[n][e]===this.playerState.gameboardBuilder.fillValue}getShipAt(t){if(this.areCoordinatesVacant(t))return null;const e=this.playerState.gameboardBuilder.board,[n,i]=t,r=e[i][n],a=this.getShipTypeFromSymbol(r);return this.playerState.fleetBuilder.getShip(a)}getShipTypeFromSymbol=t=>{if("string"!=typeof(e=t.description)||!["CA","BS","CR","SB","DD","PB"].includes(e))throw new Error("Invalid ship symbol description");var e;switch(t.description){case"CA":return f.Carrier;case"DD":return f.Destroyer;case"SB":return f.Submarine;case"BS":return f.Battleship;case"CR":return f.Cruiser;case"PB":return f.PatrolBoat;default:throw new Error("The symbol description does not return valid ship type.")}};isRotatedPositionValid=([t,e],n,i,r)=>{const a="horizontal"===n,o=this.playerState.gameboardBuilder.boardSize,s=this.playerState.gameboardBuilder.board,l=this.playerState.gameboardBuilder.fillValue,h=a?t:e;let d,c;if(!a&&i===y.Degrees90||a&&i===y.Degrees270||i===y.Degrees0?(d=1,c=r):(d=0,c=r-1),h+r-1>=o)return!1;for(;d<c;d++)if((a?s[e][t+d]:s[e+d][t])!==l)return!1;return!0};getRotatedPlacePieceParams(t){const e=(t,e)=>t-(e-1),n=(t,e)=>e?t===y.Degrees180?"horizontal":"vertical":t===y.Degrees180?"vertical":"horizontal",i=(n,i,[a,o])=>{if(n===y.Degrees0||n===y.Degrees90&&i||n===y.Degrees270&&!i)return r;const s=i?n===y.Degrees180?[e(a,t.length),o]:[a,e(o,t.length)]:n===y.Degrees180?[a,e(o,t.length)]:[e(a,t.length),o];return et(s,this.playerState.gameboardBuilder.boardSize)?s:"outOfBounds"},r=t.rotationalPivotConfigurations.coordinatesArray[0],a=t.rotationalPivotConfigurations.orientation,o=((t,e)=>{const r="horizontal"===e,a={};return[y.Degrees0,y.Degrees90,y.Degrees180,y.Degrees270].forEach((o=>{const s=o===y.Degrees0?t:i(o,r,t);a[o]="outOfBounds"===s?"outOfBounds":{coordinates:s,orientation:o===y.Degrees0?e:n(o,r)}})),a})(r,a),s=(t=>{const e=new Map;for(const i of Object.keys(t)){const r=+i;if(n=r,!Object.values(y).includes(n))throw new Error(`Invalid Type: "${i}" doesn't conform to "AngleOfRotation".`);const a=t[r];if(!E(a)&&!B(a))throw new Error(`Invalid Type: "${a}" doesn't conform to "RotatedPlacePieceParams".`);if(!E(a))continue;const{coordinates:o,orientation:s}=a,l={coordinates:o,orientation:s};e.set(r,l)}var n;return e})(o);return s}isShipValidForRemoval(t){return!(!t.currentplacementConfigurations.coordinatesArray||!this.playerState.gameboardRepository.isShipPlaced(t.type))||(console.error(`Error removing ship: ${t.type} is missing coordinates or not in the fleet.`),!1)}relocateShip(t,e,n){this.removePiece(t,n),this.placePiece(e)}setFleetRotatedPlacePieceParams(t){for(const e of Object.values(t))e.isPlaced()&&this.setShipRotatedPlacePieceParams(e)}setShipRotatedPlacePieceParams(t){const e=this.getRotatedPlacePieceParams(t);this.playerState.gameboardRepository.setShipValidRotationalParams(t,e)}}class rt{#l={};#h={};#d=new Set;#c=new Set;get fleetCoordinates(){return this.#l}get inBoundRotationalPlacePieceForFleet(){return this.#h}addAttackedCoordinates(t){this.#d.add(`[${t[0]}, ${t[1]}]`)}addShipToFleetCoordinates(t,e){this.fleetCoordinates[t]||(this.fleetCoordinates[t]=new Set),e.forEach((e=>{const[n,i]=e,r=`[${n}, ${i}]`;this.fleetCoordinates[t].add(r)}))}addSunkenShip(t){this.#c.add(t)}areAllShipsSunk(){return this.#c.size===Object.keys(this.fleetCoordinates).length}isShipPlaced(t){return null!==this.fleetCoordinates[t]}nullifyShipCoordinatesValue(t){this.fleetCoordinates[t]=null}nullifyShipValidRotationalParams(t){this.inBoundRotationalPlacePieceForFleet[t]=null}setShipValidRotationalParams(t,e){this.#h[t.type]||(this.#h[t.type]=e)}hasTargetBeenAttacked(t){return this.#d.has(`[${t[0]}, ${t[1]}]`)}}const at=t=>{const e=new Q,n=new rt;let i;switch(t){case 1990:i=U.createMBFleet();break;case 2002:i=U.createHasbroFleet();break;default:throw new Error(`There was no Battleship version created in ${t}.`)}return{gameboardBuilder:e,gameboardRepository:n,fleetBuilder:i,gameboardController:new it({gameboardBuilder:e,gameboardRepository:n,fleetBuilder:i})}};class ot{isMultiplayer=!1;version=1990;eventBus=new X;playerCore=(t=>({player:at(t),opponent:at(t)}))(this.version);constructor(){(t=>{const{player:e,opponent:n}=t;D(e.gameboardController,e.fleetBuilder.fleet),D(n.gameboardController,n.fleetBuilder.fleet)})(this.playerCore),this.gameState=new W(this.playerCore,this.eventBus,this.isMultiplayer,this.version),this.billowBot=this.isMultiplayer?null:new J(this.gameState),this.domController=new Y(this.gameState,this.playerCore,this.billowBot)}static pressStart(){const t=new ot;return t.bootUp(),t}bootUp=()=>{console.time("bootUp"),this.domController.render(),console.timeEnd("bootUp")}}console.time("pressStart"),ot.pressStart(),console.timeEnd("pressStart")}();
//# sourceMappingURL=index.bundle.js.map