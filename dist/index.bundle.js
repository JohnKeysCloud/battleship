!function(){"use strict";var e,t;!function(e){e[e.Degrees0=0]="Degrees0",e[e.Degrees90=90]="Degrees90",e[e.Degrees180=180]="Degrees180",e[e.Degrees270=270]="Degrees270"}(e||(e={})),function(e){e.Battleship="battleship",e.Carrier="carrier",e.Cruiser="cruiser",e.Destroyer="destroyer",e.PatrolBoat="patrolBoat",e.Submarine="submarine"}(t||(t={}));class r{static vacant=Symbol("VC");_boardSize=10;_fillValue=r.vacant;constructor(){this._board=Array.from({length:this._boardSize},(()=>Array(this._boardSize).fill(this._fillValue)))}get board(){return this._board}get boardSize(){return this._boardSize}get fillValue(){return this._fillValue}}class o{constructor(e){this.playerState=e}getValidPositions({orientation:e,shipLength:t}){return function({shipLength:e,orientation:t,battleshipBoardBuilder:r}){const o=(e,t,r)=>"horizontal"===t?r[e]:r.map((t=>t[e])),n=(e,t,o,n)=>{let i=0,a=[];for(let s=0;s<e.length;s++)if(e[s]===r.fillValue){if(i++,i>=n){const e=t?[s-(n-1),o]:[o,s-(n-1)],r=t?[s,o]:[o,s];a.push({bow:e,stern:r})}}else i=0;return a},i={},a=r.board,s="horizontal"===t;for(let r=0;r<a.length;r++){const l=n(o(r,t,a),s,r,e);i[s?`row-${r}`:`column-${r}`]=l}return i}({orientation:e,shipLength:t,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardController:this})}getAllValidBowCoordinates(e,t){let r=new Set;const o=this.getValidPositions({orientation:e,shipLength:t});for(const e of Object.values(o)){if(!D(e))throw new Error(`Expected each value of validPositions to be an array of IPosition objects, but received: ${typeof e}.`);e.forEach((e=>r.add(e.bow)))}return r}movePiece(e,t){if(!e.isPlaced())return void console.warn(`Invalid Command: The ${e.type} has not been placed.`);const r=e.currentplacementConfigurations.orientation,o=f(t,r,e.length);if(!b(o,this.playerState.gameboardBuilder.boardSize))return void console.warn(`Invalid Command: Position - Bow: [${o.bow}] & Stern: [${o.stern}] is out of bounds for the ${e.type}.`);const n=this.getValidPositions({orientation:r,shipLength:e.length}),i="horizontal"===r,[a,s]=t,l=function(e,t){return t?`row-${e}`:`column-${e}`}(i?s:a,i);if(n[l].some((e=>S(e,o)))){const o={ship:e,coordinates:t,orientation:r},n=!0;this.relocateShip(e,o,n)}else console.warn(`Invalid Command: Position - Bow: [${o.bow}] & Stern: [${o.stern}] is unavailable for the ${e.type}.`)}placePiece({ship:t,coordinates:r,orientation:o}){!function({ship:t,coordinates:r,orientation:o,battleshipBoardController:n,battleshipBoardBuilder:i,battleshipBoardRepository:a}){const s=t.length,[l,d]=r,c="horizontal"===o;if(!m((c?l:d)+s-1,i.boardSize)){const e=`Invalid Command: The ship placement attempt with the following configurations is out of bounds - Coordinates: ${r}, Length: ${t.length}, Orientation: ${o}.`;throw new Error(e)}if(t.isPlaced())return void console.warn(`Invalid Command: The ${t.type} has already been placed.`);const h=f(r,o,s);if(!((e,t,r)=>n.getValidPositions(t)[r].some((t=>S(e,t))))(h,{shipLength:s,orientation:o},c?`row-${d}`:`column-${l}`)){const e=`Invalid Command: "${JSON.stringify(h)}" is unavailable for ship with Size: ${s} and Orientation: ${o}.`;throw new Error(e)}{const r=(e,t)=>{const r=[],[o,n]=e.bow,[i,a]=e.stern,s=t?n:o,l=t?i:a;for(let e=t?o:n;e<=l;e++)r.push(t?[e,s]:[s,e]);return r},n=(e,t)=>{const r=i.board,o=e.symbol;t.forEach((e=>{const[t,n]=e;r[n][t]=o}))},s=(t,r,o)=>{const n={coordinatesArray:r,orientation:o};t.currentplacementConfigurations=n,Object.values(t.rotationalPivotConfigurations).every((e=>null===e))&&(t.rotationalPivotConfigurations={...n,transientAngleOfRotation:e.Degrees0})},l=(e,t)=>{a.addShipToFleetCoordinates(e,t)},d=r(h,c);n(t,d),s(t,d,o),l(t.type,d)}}({ship:t,coordinates:r,orientation:o,battleshipBoardController:this,battleshipBoardBuilder:this.playerState.gameboardBuilder,battleshipBoardRepository:this.playerState.gameboardRepository}),this.setFleetRotatedPlacePieceParams(this.playerState.fleetBuilder.fleet)}prettyPrint(){console.table(this.playerState.gameboardBuilder.board.map((e=>e.map((e=>"VC"===e.description?null:e.description)))))}removePiece(e,t=!0){this.isShipValidForRemoval(e)&&((e=>{e.forEach((([e,t])=>{this.playerState.gameboardBuilder.board[t][e]=this.playerState.gameboardBuilder.fillValue}))})(e.currentplacementConfigurations.coordinatesArray),(e=>{this.playerState.gameboardRepository.nullifyShipCoordinatesValue(e)})(e.type),((e,t)=>{t&&this.playerState.gameboardRepository.nullifyShipValidRotationalParams(e.type),e.resetConfigurations(t)})(e,t))}removeAllPieces(e){if(Object.keys(e).length)for(const t of Object.values(e))this.removePiece(t);else console.error("Invalid Command: No ships to remove - Fleet is empty or uninitialized.")}rotatePiece(t){const r=(t,r)=>{const o=t.rotationalPivotConfigurations.transientAngleOfRotation,n=(t=>Array.from(t.keys()).pop()??e.Degrees0)(r);if(o===n){const r=t.rotationalPivotConfigurations.coordinatesArray[0],o=t.rotationalPivotConfigurations.orientation;return t.rotationalPivotConfigurations.transientAngleOfRotation=e.Degrees0,{ship:t,coordinates:r,orientation:o}}const i=((t,r)=>{if(null==r)throw new Error("Current angle doesn't exist");return Array.from(t.keys()).find((e=>e>r))??e.Degrees0})(r,o),a=r.get(i);return t.rotationalPivotConfigurations.transientAngleOfRotation=i,{ship:t,coordinates:a.coordinates,orientation:a.orientation}},o=this.playerState.gameboardRepository.inBoundRotationalPlacePieceForFleet[t.type],n=t.rotationalPivotConfigurations.transientAngleOfRotation,i=(e=>{let o=r(t,e);for(;t.rotationalPivotConfigurations.transientAngleOfRotation!==n&&!this.isRotatedPositionValid(o.coordinates,o.orientation,t.rotationalPivotConfigurations.transientAngleOfRotation,t.length);)o=r(t,e);return o})(o);t.rotationalPivotConfigurations.transientAngleOfRotation!==n?this.relocateShip(t,i,!1):console.warn("No valid rotational position found.")}areCoordinatesVacant(e){const[t,r]=e;return this.playerState.gameboardBuilder.board[r][t]===this.playerState.gameboardBuilder.fillValue}getShipAt(e){if(!this.areCoordinatesVacant(e))return this.playerState.gameboardRepository.getShipDataAt(e)}isRotatedPositionValid=([t,r],o,n,i)=>{const a="horizontal"===o,s=this.playerState.gameboardBuilder.boardSize,l=this.playerState.gameboardBuilder.board,d=this.playerState.gameboardBuilder.fillValue,c=a?t:r;let h,u;if(!a&&n===e.Degrees90||a&&n===e.Degrees270||n===e.Degrees0?(h=1,u=i):(h=0,u=i-1),c+i-1>=s)return!1;for(;h<u;h++)if((a?l[r][t+h]:l[r+h][t])!==d)return!1;return!0};getRotatedPlacePieceParams(t){const r=(e,t)=>e-(t-1),o=(t,r)=>r?t===e.Degrees180?"horizontal":"vertical":t===e.Degrees180?"vertical":"horizontal",n=(o,n,[a,s])=>{if(o===e.Degrees0||o===e.Degrees90&&n||o===e.Degrees270&&!n)return i;const l=n?o===e.Degrees180?[r(a,t.length),s]:[a,r(s,t.length)]:o===e.Degrees180?[a,r(s,t.length)]:[r(a,t.length),s];return y(l,this.playerState.gameboardBuilder.boardSize)?l:"outOfBounds"},i=t.rotationalPivotConfigurations.coordinatesArray[0],a=t.rotationalPivotConfigurations.orientation,s=((t,r)=>{const i="horizontal"===r,a={};return[e.Degrees0,e.Degrees90,e.Degrees180,e.Degrees270].forEach((s=>{const l=s===e.Degrees0?t:n(s,i,t);a[s]="outOfBounds"===l?"outOfBounds":{coordinates:l,orientation:s===e.Degrees0?r:o(s,i)}})),a})(i,a),l=(t=>{const r=new Map;for(const n of Object.keys(t)){const i=+n;if(o=i,!Object.values(e).includes(o))throw new Error(`Invalid Type: "${n}" doesn't conform to "AngleOfRotation".`);const a=t[i];if(!P(a)&&!E(a))throw new Error(`Invalid Type: "${a}" doesn't conform to "RotatedPlacePieceParams".`);if(!P(a))continue;const{coordinates:s,orientation:l}=a,d={coordinates:s,orientation:l};r.set(i,d)}var o;return r})(s);return l}isShipValidForRemoval(e){return!(!e.currentplacementConfigurations.coordinatesArray||!this.playerState.gameboardRepository.isShipPlaced(e.type))||(console.error(`Error removing ship: ${e.type} is missing coordinates or not in the fleet.`),!1)}relocateShip(e,t,r){this.removePiece(e,r),this.placePiece(t)}setFleetRotatedPlacePieceParams(e){for(const t of Object.values(e))t.isPlaced()&&this.setShipRotatedPlacePieceParams(t)}setShipRotatedPlacePieceParams(e){const t=this.getRotatedPlacePieceParams(e);this.playerState.gameboardRepository.setShipValidRotationalParams(e,t)}}class n{_fleetCoordinates={};_inBoundRotationalPlacePieceParamsForFleet={};get fleetCoordinates(){return this._fleetCoordinates}get inBoundRotationalPlacePieceForFleet(){return this._inBoundRotationalPlacePieceParamsForFleet}addShipToFleetCoordinates(e,t){this.fleetCoordinates[e]||(this.fleetCoordinates[e]=new Set),t.forEach((t=>{const[r,o]=t,n=`[${r}, ${o}]`;this.fleetCoordinates[e].add(n)}))}getShipDataAt(e){if(!C(this.fleetCoordinates))throw new Error(`Invalid Type: "${this.fleetCoordinates}" doesn't conform to "FleetCoordinates".`);const t=(e,t)=>{if(!$(e))throw new Error(`Invalid Type: "${e}" doesn't conform to "ShipType".`);if(!v(t))throw new Error(`Invalid Type: "${t}" doesn't conform to "OccupiedCoordinatesSet".`)},[r,o]=e,n=`[${r}, ${o}]`;for(const[e,r]of Object.entries(this.fleetCoordinates)){if(!$(e))throw new Error("");if(!v(r))throw new Error;if(t(e,r),r?.has(n))return{shipType:e,occupiedCoordinatesSet:r}}}isShipPlaced(e){return null!==this.fleetCoordinates[e]}nullifyShipCoordinatesValue(e){this.fleetCoordinates[e]=null}nullifyShipValidRotationalParams(e){this.inBoundRotationalPlacePieceForFleet[e]=null}setShipValidRotationalParams(e,t){this._inBoundRotationalPlacePieceParamsForFleet[e.type]||(this._inBoundRotationalPlacePieceParamsForFleet[e.type]=t)}}const i={[t.Carrier]:Symbol("CA"),[t.Battleship]:Symbol("BS"),[t.Cruiser]:Symbol("CR"),[t.Submarine]:Symbol("SB"),[t.Destroyer]:Symbol("DD"),[t.PatrolBoat]:Symbol("PB")},a={"battleship-1990":4,"battleship-2002":4,"carrier-1990":5,"carrier-2002":5,"cruiser-1990":3,"cruiser-2002":void 0,"destroyer-1990":2,"destroyer-2002":3,"patrolBoat-1990":void 0,"patrolBoat-2002":2,"submarine-1990":3,"submarine-2002":3};class s{seaworthy=!0;rotationalPivotConfigurations={transientAngleOfRotation:null,coordinatesArray:null,orientation:null};currentplacementConfigurations={coordinatesArray:null,orientation:null};isPlaced=()=>null!==this.currentplacementConfigurations.coordinatesArray;_hitCounter=0;constructor(e,t=2002){this.type=e,this.version=t,this.symbol=i[e];const r=`${e}-${t}`,o=a[r];if(void 0===o)throw new Error(`Invalid Command: ship type/version combination: ${r}.`);this.length=o}hit=()=>this.isSeaworthy()?(this._hitCounter++,`Hit registered. Hit count: ${this.hitCounter}.`):"This ship has already perished.";isSeaworthy=()=>this.hitCounter<this.length;resetConfigurations=e=>{const t={coordinatesArray:null,orientation:null};this.currentplacementConfigurations=t,!0===e&&(this.rotationalPivotConfigurations={...t,transientAngleOfRotation:null})};get hitCounter(){return this._hitCounter}}class l{constructor(e,t){this.fleet=e,this.version=t}static createFleet(e){const t={};for(const[r,o]of Object.entries(e))o&&$(r)&&(t[r]=new s(o.type,o.version));return t}static createHasbroFleet(){return new l(l.createFleet({carrier:{type:t.Carrier,version:2002},battleship:{type:t.Battleship,version:2002},destroyer:{type:t.Destroyer,version:2002},submarine:{type:t.Submarine,version:2002},patrolBoat:{type:t.PatrolBoat,version:2002}}),2002)}static createMBFleet(){return new l(l.createFleet({carrier:{type:t.Carrier,version:1990},battleship:{type:t.Battleship,version:1990},cruiser:{type:t.Cruiser,version:1990},submarine:{type:t.Submarine,version:1990},destroyer:{type:t.Destroyer,version:1990}}),1990)}getShip(e){const t=this.fleet[e];if(!t)throw new Error(`Invalid Command: Ship of type ${e} not found in fleet.`);return t}}const d=(e,t)=>e.length===t.length&&e.every(((e,r)=>e===t[r])),c=(e,t,r)=>{const o=e.getAttribute(t);if(!o||!r(o))throw new Error(`Invalid or missing attribute: ${t}`);return o},h=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,u=(e,t=[],r={})=>{const o=document.createElement(e);return t.forEach((e=>o.classList.add(e))),Object.entries(r).forEach((([e,t])=>o.setAttribute(e,t))),o},p=(e,t,r)=>{if("player"!==t&&"bot"!==t)throw new Error('`playerType` must be either "player" or "bot"');const o=e.split(t)[1].toLowerCase();return r?`${t}-${o}-${r}`:`${t}-${o}`};function g(e,t,r){return new o({gameboardBuilder:e,gameboardRepository:t,fleetBuilder:r})}function f([e,t],r,o){return{bow:[e,t],stern:"horizontal"===r?[e+o-1,t]:[e,t+o-1]}}const m=(e,t)=>e>=0&&e<t,y=(e,t)=>e.every((e=>m(e,t))),b=(e,t)=>y(e.bow,t)&&y(e.stern,t),S=(e,t)=>d(e.bow,t.bow)&&d(e.stern,t.stern),w=e=>!(!Array.isArray(e)||2!==e.length)&&e.every((e=>"number"==typeof e)),v=e=>{if(null===e)return!0;if(!(e instanceof Set))return!1;for(const t of e)if(!T(t))return!1;return!0},C=e=>{if("object"!=typeof e||null===e)return!1;for(const r in e){if(!Object.values(t).includes(r))return!1;const o=e[r];if(null!==o&&!v(o))return!1}return!0},B=e=>"string"==typeof e&&["horizontal","vertical"].includes(e),E=e=>"outOfBounds"===e,P=e=>"object"==typeof e&&null!==e&&!!w(e.coordinates),D=e=>!!Array.isArray(e)&&e.every((e=>(e=>{if(!(e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||null===t})(e))return!1;const{bow:t,stern:r}=e;return w(t)&&w(r)})(e))),T=e=>"string"==typeof e&&null!==e.match(/^\[\d{1}, \d{1}\]$/),$=e=>Object.values(t).includes(e),{playerOneBoardBuilder:O,playerTwoBoardBuilder:L}={playerOneBoardBuilder:new r,playerTwoBoardBuilder:new r},{playerOneBoardRepository:R,playerTwoBoardRepository:F}={playerOneBoardRepository:new n,playerTwoBoardRepository:new n},{playerOneFleetBuilder:A,playerTwoFleetBuilder:z}=function(e=2002){const t=2002===e?l.createHasbroFleet:l.createMBFleet;return{playerOneFleetBuilder:t(),playerTwoFleetBuilder:t()}}(),{playerOneBoardController:I,playerTwoBoardController:V}=function({playerOneBoardBuilder:e,playerTwoBoardBuilder:t},{playerOneBoardRepository:r,playerTwoBoardRepository:o},{playerOneFleetBuilder:n,playerTwoFleetBuilder:i}){return{playerOneBoardController:g(e,r,n),playerTwoBoardController:g(t,o,i)}}({playerOneBoardBuilder:O,playerTwoBoardBuilder:L},{playerOneBoardRepository:R,playerTwoBoardRepository:F},{playerOneFleetBuilder:A,playerTwoFleetBuilder:z}),M={playerOne:{gameboardBuilder:O,gameboardController:I,gameboardRepository:R,fleetBuilder:A},playerTwo:{gameboardBuilder:L,gameboardController:V,gameboardRepository:F,fleetBuilder:z}};function G(e,t){if(!e)throw new Error("Invalid Command: `gameboardController` is required to randomize the gameboard.");if(!t)throw new Error("Invalid Command: `fleet` is required to randomize the gameboard.");const r=(t,o,n,i=0)=>{if(i>100)throw new Error(`Max recursion depth exceeded when placing the ${t.type}.`);const a=((e,t)=>{const r=t-e;return[h(0,r),h(0,r)]})(t.length,n);return((t,r,o)=>{const n={shipLength:r.length,orientation:o},i=e.getValidPositions(n),[a,s]=t,l="horizontal"===o,c=l?s:a;return i[l?`row-${c}`:`column-${c}`].some((e=>d(e.bow,t)))})(a,t,o)?a:r(t,o,n,i+1)};for(const o in t){if(!$(o))throw new Error(`Invalid Type: "${o}" doesn't conform to "ShipType".`);const n=t[o],i=Math.random()<.5?"horizontal":"vertical",a={ship:n,coordinates:r(n,i,10),orientation:i};e.placePiece(a)}}var H=new class{events={};on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}emit(e,t){this.events[e]&&this.events[e].forEach((e=>e(t)))}};console.time("init"),console.time("randomizeBSGameboards"),G(M.playerOne.gameboardController,M.playerOne.fleetBuilder.fleet),G(M.playerTwo.gameboardController,M.playerTwo.fleetBuilder.fleet),console.timeEnd("randomizeBSGameboards"),new class{fleetElements=new Set;constructor(e,t){this.id=e,this.playerState=t,this.boardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize),H.on("updateGameboard",(()=>{this.updateGameboard()}))}render(e){const t=document.querySelector(e);if(!t)throw new Error(`Target element not found with ID - ${this.id} and selector - "${e}".`);const r=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize);this.boardContainer.appendChild(r),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements),t.appendChild(this.boardContainer)}appendFleetClonesToGameboard(e){const t=this.boardContainer.querySelector(".gameboard");if(!t)throw new Error("Gameboard not found");e.forEach((e=>{const r=u("div",["ship-container-clone"],{id:`${e.getAttribute("id")}-clone`});t.appendChild(r)}))}clearBoardContainer(e){for(;e.firstChild;)e.removeChild(e.firstChild)}createBackgroundCellsFragment(e){const t=new DocumentFragment;return e.forEach(((e,r)=>{e.forEach(((e,o)=>{const n=e.description.toLowerCase(),i=u("div",[`${p(this.id,"player",n)}-cell`,`player-${n}-cell`,"grid-cell"],{"data-x":o.toString(),"data-y":r.toString(),"aria-label":`Row ${r+1}, Column ${o+1}`,role:"gridCell"}),a=u("div",[p(this.id,"player",`${n}-grid-cell-container`),"grid-cell-container"]);a.appendChild(i),t.appendChild(a)}))})),t}createShipElement(e,t,r,o,n){const i=this.generateShipUnitFragment(t,e,this.id),a=u("div",["ship-container"],{id:p(this.id,"player",`${e}-container`),"data-shipType":e,"data-length":t.toString(),"data-orientation":n,draggable:"true"});return a.style.display="grid",a.appendChild(i),"horizontal"===n?(a.style.gridColumn=r,a.style.gridRow=o.toString(),a.style.gridTemplateColumns=`repeat(${t}, 1fr)`):(a.style.gridRow=r,a.style.gridColumn=o.toString(),a.style.gridTemplateRows=`repeat(${t}, 1fr)`),a}generateBoardContainer(e){const t=u("div",["gameboard-container"],{id:p(this.id,"player","gameboard-container")});return t.style.setProperty("--grid-size",e.toString()),this.handleDragListeners(t),this.handleClickListeners(t),t}generateBoardFragment(e){const t=u("div",["gameboard-background"],{id:p(this.id,"player","gameboard-background")});t.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const r=u("div",["gameboard"],{id:p(this.id,"player","gameboard")});r.style.setProperty("--grid-size",e.toString());const o=new DocumentFragment;return o.append(t,r),o}generateShipUnitFragment(e,t,r){const o=new DocumentFragment;for(let n=0;n<e;n++){const e=0===n,i=u("div",["ship-unit",p(r,"player",t)]);e&&(i.classList.add("ship-bow"),i.setAttribute("id",p(r,"player",`${t}-bow`))),o.appendChild(i)}return o}getGridPlacementValue(e,t,r){const o="horizontal"===t,[n,i]=e;return[`${o?n+1:i+1} / span ${r}`,o?i+1:n+1]}handleFleetPlacement(e,t){this.updateFleetElements(e),this.placeFleetOnGameboard(t),this.appendFleetClonesToGameboard(t)}placeFleetOnGameboard(e){const t=this.boardContainer.querySelector(".gameboard");if(!t)throw new Error("Gameboard container not found.");e.forEach((e=>t.appendChild(e)))}updateFleetElements=e=>{this.fleetElements.size&&this.fleetElements.clear();for(const t of Object.values(e.fleet)){const e=t.type,r=t.length,o=t.currentplacementConfigurations.orientation;if(!o)throw new Error("Orientation not set.");const n=t.currentplacementConfigurations.coordinatesArray;if(!n||0===n.length){console.log(`The ${e} has not been placed. Continuing...`);continue}const[i,a]=n[0],[s,l]=this.getGridPlacementValue([i,a],o,r),d=this.createShipElement(e,r,s,l,o);this.fleetElements.add(d)}};updateGameboard(){this.clearBoardContainer(this.boardContainer);const e=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize);this.boardContainer.appendChild(e),this.handleFleetPlacement(this.playerState.fleetBuilder,this.fleetElements)}handleDragListeners(e){const t={currentShipInstance:null,initialPlacementConfigurations:null,isValidDropTarget:!1,currentDragOverCell:null};e.addEventListener("dragstart",(e=>this.handleShipDragStart(e,t))),e.addEventListener("dragenter",(e=>this.handleShipDragEnter(e))),e.addEventListener("dragleave",(e=>this.handleShipDragLeave(e))),e.addEventListener("dragleave",(e=>this.handleShipDragLeave(e))),e.addEventListener("dragover",(e=>this.handleShipDragOver(e,t))),e.addEventListener("drop",(e=>this.handleShipDrop(e,t))),e.addEventListener("dragend",(e=>this.handleShipDragEnd(e,t)))}handleShipDragStart(e,t){if(!(e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");if(!e.target.classList.contains("ship-container"))return;const r=e.target,o=c(e.target,"data-shiptype",$),n=c(e.target,"data-orientation",B);if(((e,t,r)=>{if(!t[r])throw new Error(`The ${r} is not present in the fleet.`);e.currentShipInstance=t[r],e.initialPlacementConfigurations=e.currentShipInstance.currentplacementConfigurations})(t,this.playerState.fleetBuilder.fleet,o),!t.currentShipInstance)throw new Error(`Drag state hasn't been updated with the current ship instance on drag start. Drag State: ${JSON.stringify(t)}`);this.playerState.gameboardController.removePiece(t.currentShipInstance),((e,t)=>{if(!(e.target&&e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");const r=e.target,o=r.getAttribute("id"),n=t.querySelector(`#${o}-clone`);if(!n)throw new Error("Ship clone not found.");if(!o)throw new Error("Ship container doesn't have an ID.");const i=r.getBoundingClientRect();n.style.height=`${i.height}px`,n.style.width=`${i.width}px`;const a=r.querySelector(".ship-bow");if(!a)throw new Error("Ship bow not found.");const s=a?.getBoundingClientRect();e.dataTransfer?.setDragImage(n,s.width/2,s.height/2),n.style.visibility="visible",n.style.pointerEvents="auto",setTimeout((()=>{r.style.pointerEvents="none"}),0)})(e,this.boardContainer),((e,t,r,o)=>{const n=Number(t.getAttribute("data-length"));if(!n||"number"!=typeof(i=n)||![2,3,4,5].includes(i))throw new Error("Invalid or missing ship type attribute.");var i;const a=n;((e,t,r)=>{const n=o.getAllValidBowCoordinates(r,t);e.forEach((e=>{const t=[Number(e.getAttribute("data-x")),Number(e.getAttribute("data-y"))];for(const r of n)d(r,t)&&e.classList.add("valid-bow-coordinates")}))})(e.querySelectorAll(".grid-cell"),a,r)})(this.boardContainer,r,n,this.playerState.gameboardController)}handleShipDragEnter(e){if(!(e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");if(!e.target.classList.contains("grid-cell"))return;const t=e.target;t.classList.contains("valid-bow-coordinates")?t.classList.add("placement-is-valid"):t.classList.add("placement-is-invalid")}handleShipDragLeave(e){if(!(e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");if(!e.target.classList.contains("grid-cell"))return;const t=e.target;t.classList.contains("placement-is-valid")?t.classList.remove("placement-is-valid"):t.classList.contains("placement-is-invalid")&&t.classList.remove("placement-is-invalid")}handleShipDragOver(e,t){if(e.preventDefault(),!(e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");if(!e.target.classList.contains("grid-cell"))return;const r=e.target;t.currentDragOverCell=r,r.classList.contains("valid-bow-coordinates")}handleShipDrop(e,t){if(e.preventDefault(),!(e.target&&e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");if(!e.target.classList.contains("valid-bow-coordinates"))return;const{coordinatesArray:r,orientation:o}=t.initialPlacementConfigurations||{};if(!r||!o)throw new Error("Initial placement configurations are incomplete.");t.isValidDropTarget=!0;const n=e.target,i=n.getAttribute("data-x"),a=n.getAttribute("data-y");if(!i||!a)throw new Error("Missing or invalid grid cell coordinates.");const s=[Number(i),Number(a)];this.playerState.gameboardController.placePiece({ship:t.currentShipInstance,coordinates:s,orientation:o}),this.updateGameboard(),t.isValidDropTarget=!1}handleShipDragEnd(e,t){if(!(e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");if(!e.target.classList.contains("ship-container"))return;const r=e=>{const t=e.getAttribute("id"),r=this.boardContainer.querySelector(`#${t}-clone`);if(!t||!r)throw new Error(`Invalid ship container state. ID: ${t}, Clone: ${r}`);r.style.visibility="hidden",r.style.pointerEvents="none",e.style.pointerEvents="auto"},o=()=>{const{coordinatesArray:e,orientation:r}=t.initialPlacementConfigurations||{};if(!e||!r)throw new Error("Initial placement configurations are incomplete.");const o=e[0];this.playerState.gameboardController.placePiece({ship:t.currentShipInstance,coordinates:o,orientation:r})},n=e.target;try{r(n);const{currentDragOverCell:e,isValidDropTarget:i}=t;if(!e)throw new Error(`Current drag over cell is missing. Drag state: ${JSON.stringify(t)}`);((e,t)=>{const r=t?"placement-is-valid":"placement-is-invalid";e.classList.remove(r)})(e,i),i||o()}catch(e){console.error(e)}}handleClickListeners(e){e.addEventListener("click",(e=>{this.handleShipRotation(e)}))}handleShipRotation(e){if(!(e.target instanceof HTMLDivElement))throw new Error("Target element not found or is not an HTMLElement.");if(!e.target.classList.contains("ship-container"))return;const t=e.target,r=c(t,"data-shiptype",$),o=this.playerState.fleetBuilder.getShip(r);this.playerState.gameboardController.rotatePiece(o),this.updateGameboard()}getId(){return this.id}}("playerOne",M.playerOne).render("#content"),new class{ShipShufflerButtonTextContent="Shuffle Ships";constructor(e,t,r,o="ship-shuffler-button",n=["ship-shuffler-button"]){this.gameboardController=e,this.fleet=t,this.gameboardTargetSelector=r,this.id=o,this.classes=n,this.validateGameboardTarget(this.gameboardTargetSelector),this.ShipShufflerButton=this.createShipShufflerButton(this.id,this.classes),this.ShipShufflerButton.classList.add(...this.classes),this.ShipShufflerButton.textContent=this.ShipShufflerButtonTextContent,this.addEventListener(this.ShipShufflerButton),this.ShipShufflerButtonContainer=this.createShipShufflerButtonContainer(),this.ShipShufflerButtonContainer.appendChild(this.ShipShufflerButton)}render(e){const t=document.querySelector(e);if(!t)throw new Error(`Target element not found: "${e}."`);t.appendChild(this.ShipShufflerButtonContainer)}addEventListener(e){e.addEventListener("click",(()=>{this.randomizeGameboard(),this.updateGameboard(this.gameboardTargetSelector)}))}createShipShufflerButton(e,t){return u("button",[...t],{id:e})}createShipShufflerButtonContainer(){return u("div",["ship-shuffler-button-container"])}randomizeGameboard(){this.gameboardController.removeAllPieces(this.fleet),G(this.gameboardController,this.fleet)}updateGameboard(e){H.emit("updateGameboard",e)}validateGameboardTarget(e){if(!document.querySelector(e))throw new Error(`Invalid gameboard target selector: "${e}"`)}getId(){return this.id}}(M.playerOne.gameboardController,M.playerOne.fleetBuilder.fleet,"#content","player-one-ship-shuffler-button").render("#content"),new class{constructor(e,t){this.id=e,this.playerState=t,this.boardContainer=this.generateBoardContainer(this.playerState.gameboardBuilder.boardSize)}render(e){const t=document.querySelector(e);if(!t)throw new Error(`Target element not found with ID - ${this.id} and selector - "${e}".`);const r=this.generateBoardFragment(this.playerState.gameboardBuilder.boardSize);this.boardContainer.appendChild(r),t.appendChild(this.boardContainer)}createBackgroundCellsFragment(e){const t=new DocumentFragment;return e.forEach(((e,r)=>{e.forEach(((e,o)=>{const n=u("div",[`${p(this.id,"bot")}-cell`,"grid-cell"],{"data-x":o.toString(),"data-y":r.toString(),"aria-label":`Row ${r+1}, Column ${o+1}`,role:"gridCell"}),i=u("div",[p(this.id,"bot","grid-cell-container"),"grid-cell-container"]);i.appendChild(n),t.appendChild(i)}))})),t}generateBoardContainer(e){const t=u("div",["gameboard-container"],{id:p(this.id,"bot","gameboard-container")});return t.style.setProperty("--grid-size",e.toString()),t}generateBoardFragment(e){const t=u("div",["gameboard-background"],{id:p(this.id,"bot","gameboard-background")});t.appendChild(this.createBackgroundCellsFragment(this.playerState.gameboardBuilder.board));const r=u("div",["gameboard"],{id:p(this.id,"bot","gameboard")});r.style.setProperty("--grid-size",e.toString());const o=new DocumentFragment;return o.append(t,r),o}getId(){return this.id}}("botOne",M.playerTwo).render("#content"),console.timeEnd("init")}();
//# sourceMappingURL=index.bundle.js.map